var test = "Ly8gQHRzLW5vY2hlY2sKCnZhciBkZWZhdWx0X2F2YXRhciA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvQ29sYUNhcHJpY2hvc2EvRlBXTFIvbG9nYXJkby5wbmciOwoKZnVuY3Rpb24gY190aGVtZSgpIHsKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmJvZHk7Cgljb25zdCB0aGVtZV9zZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWVfc2VsZWN0Jyk7Cgljb25zdCBzZWxlY3RlZCA9IHRoZW1lX3NlbGVjdC52YWx1ZTsKCWNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnLCBzZWxlY3RlZCk7CgoJc19pbnQyKCd0aGVtZV9zZWxlY3QnKTsKfQoKZnVuY3Rpb24gZ190bV9pKCkgeyByZXR1cm4gTWF0aC5yb3VuZCgrbmV3IERhdGUoKSAvIDEwMDApOyB9Cgpjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CnRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcCIpOwp0b29sdGlwLmlkID0gIndtdG9vbHRpcCI7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcCk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7Cgljb25zdCB0b29sdGlwTWVzc2FnZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiKTsKCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCXRvb2x0aXAuaW5uZXJUZXh0ID0gdG9vbHRpcE1lc3NhZ2U7CgkJdG9vbHRpcC5zdHlsZS50b3AgPSBlbGVtZW50Lm9mZnNldFRvcCAtIHRvb2x0aXAub2Zmc2V0SGVpZ2h0IC0gOCArICJweCI7CgkJdG9vbHRpcC5zdHlsZS5sZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgKGVsZW1lbnQub2Zmc2V0V2lkdGggLSB0b29sdGlwLm9mZnNldFdpZHRoKSAvIDIgKyAicHgiOwoJCXRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcC0tdmlzaWJsZSIpOwoJfQp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IiwgZnVuY3Rpb24gKGV2ZW50KSB7Cgljb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0OwoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CglpZiAodG9vbHRpcE1lc3NhZ2UpIHsKCQl0b29sdGlwLmlubmVyVGV4dCA9ICgiLSIpLnRyaW0oKTsKCQl0b29sdGlwLmNsYXNzTGlzdC5yZW1vdmUoInRvb2x0aXAtLXZpc2libGUiKTsKCX0KfSk7CgovKmFscmVhZHkgZGlzcGF0Y2hlZCBpZHMqLwp2YXIgdV9hbF9ib29sID0gW107CnZhciB1X2FsX2Zsb2F0ID0gW107CnZhciB1X2FsX2ludCA9IFtdOwoKdmFyIHVfYm9vbCA9IFtdOwp2YXIgdV9mbG9hdCA9IFtdOwp2YXIgdV9pbnQgPSBbXTsKdmFyIHVfaW50MiA9IFsidGhlbWVfc2VsZWN0Il07CgpwYXRoID0gInBhbmVsX2NoYXQiOwoKY190ZXh0KHBhdGgsICJjaGF0Ym94dHh0IiwgImNoYXQiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CgpjX2RpdihwYXRoLCAiY2hhdC1jb250YWluZXIiLCB7Cgl3aWR0aDogIjIzMHB4IiwKCWhlaWdodDogIjMxNXB4IiwKCW1heEhlaWdodDogIjMxNXB4IiwKCW92ZXJmbG93WTogImF1dG8iLAoJcGFkZGluZzogIjEwcHgiLAoJYmFja2dyb3VuZENvbG9yOiAndmFyKC0tYy1zZWNvbmRhcnkpJywKfSk7CgpjX2JyKCk7CgpmdW5jdGlvbiBzZW5kX2NoYXQoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJY29uc3QgY2hhdF90ZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlOwoJCXNfYnRuKCJzZW5kX2NoYXQiLCBjaGF0X3RleHQpCgkJCS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAoIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygiZG9uZSIpKQoJCQkJCXJldHVybjsKCgkJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMzUwKTsKCQkJCXVfY2hhdCgpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGNhcmFjdGVyZXMgZXNwZWNpYWxlcywgZGUgNSBhIDY0IGNhcmFjdGVyZXMgc29sYW1lbnRlLiIsIDUwMDAsICJSRUQiKTsKCX0KfQoKY190ZXh0Ym94KHBhdGgsICJjaGF0X3RleHQiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsCgltaW5MZW5ndGg6IDEsCgltYXhMZW5ndGg6IDY0LAoJcmVxdWlyZWQ6IHRydWUsCglwbGFjZWhvbGRlcjogIndyaXRlIGhlcmUiLAoJZXZlbnRMaXN0ZW5lcjogewoJCWtleWRvd246IGZ1bmN0aW9uIChlbCwgZXYpIHsKCQkJaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewoJCQkJc2VuZF9jaGF0KCk7CgkJCX0KCQl9Cgl9Cn0sIHRydWUpOwoKY19idG4ocGF0aCwgImJ0bl9zZW5kX2NoYXQiLCAic2VuZCIsIGZ1bmN0aW9uICgpIHsKCXNlbmRfY2hhdCgpOwp9LCAiRW52aWEgdW4gbWVuc2FqZSBhbCBjaGF0LCB1bmEgdmV6IGNhZGEgMzAgc2VndW5kb3MuIik7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY190ZXh0KHBhdGgsICJ1c2Vyc29ubGluZSIsICJub25lIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMTBweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwoKZnVuY3Rpb24gZ19vbmxpbmVzKCkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJcmV0dXJuOwoKCWdhdGhlcigib25saW5lcyIsICJ6eiIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQl0cnkgewoJCQkJY29uc3QgbGl2ZXMgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgkJCQljb25zdCBvbmxpbmVzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcnNvbmxpbmUnKTsKCQkJCW9ubGluZXNlbC5pbm5lckhUTUwgPSAiPHAgc3R5bGU9J2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjE0cHg7bWFyZ2luLWJvdHRvbTowcHg7bWFyZ2luLXRvcDowcHg7Jz5vbmxpbmVzICgiICsgbGl2ZXMubGl2ZS5sZW5ndGggKyAiKTwvcD48YnI+IiArIGxpdmVzLmxpdmUuam9pbigiLCAiKTsKCQkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJCW5vdGlmeShyZXN1bHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKZ19vbmxpbmVzKCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19idG4ocGF0aCwgIm9wZW5kbGdmaW5kdXNlciIsICJzZWFyY2ggdXNlciIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZHVzZXJkbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIkJ1c2NhIHVuIHVzdWFyaW8uIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSk7CgpjX2JyKCk7CgpjX2RpYWxvZyhwYXRoLCAiZmluZHVzZXJkbGciKTsKcGF0aCA9ICJmaW5kdXNlcmRsZyI7CgpjX3RleHQocGF0aCwgInVzZXJmaW5kdHh0IiwgInNlYXJjaCB1c2VyIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKCmNfYnIocGF0aCk7CgpjX3RleHRib3gocGF0aCwgImZpbmRfdXNlciIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiAzLAoJbWF4TGVuZ3RoOiAyMCwKCXJlcXVpcmVkOiB0cnVlLAoJcGxhY2Vob2xkZXI6ICJhbGlhcyIsCglldmVudExpc3RlbmVyOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQlpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnRuX2ZpbmRfdXNlciIpLmNsaWNrKCk7CgkJCX0KCQl9Cgl9Cn0sIHRydWUpOwoKY29uc3Qgcm9sZWNsciA9IHsgIm5vcm1hbCI6ICIjNjA2MDYwIiwgInByZW1pdW0iOiAiIzhiYjBmZiIsICJjaGFkIjogIiNmZmU1OGIiLCAiR09EIjogIiNmMTRjMzkiLCAiUEFQSSI6ICIjY2U5OGUyIiB9Owp2YXIgZnVfY29vbGRvd24gPSAwOwoKY19idG4ocGF0aCwgImJ0bl9maW5kX3VzZXIiLCAiZmluZCIsIGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZF91c2VyIikudmFsaWRpdHkudmFsaWQpCgkJaWYgKGZ1X2Nvb2xkb3duID4gZ190bV9pKCkpIHsKCQkJY29uc29sZS5sb2coImNvb2xkb3duIiwgKGZ1X2Nvb2xkb3duIC0gZ190bV9pKCkpKQoJCQlub3RpZnkoInJlY2VudGx5IHVzZWQsIHdhaXQgIiArIChmdV9jb29sZG93biAtIGdfdG1faSgpKSArICIgc2Vjb25kcyIsIDcwMDApOwoJCQlyZXR1cm47CgkJfQoJZ2F0aGVyKCJpbmZvX2FsaWFzIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRfdXNlciIpLnZhbHVlKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJdHJ5IHsKCQkJCXZhciB1X2luZiA9IEpTT04ucGFyc2UocmVzdWx0KTsKCgkJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZ0ciIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQl9CgoJCQkJdmFyIHVzZXJfZGF0YSA9ICIiOwoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07CgoJCQkJaWYgKHVfaW5mWyJyb2xlIl0pCgkJCQkJdXNlcl9kYXRhICs9ICI8c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmU7Zm9udC1zaXplOjEwcHg7Y29sb3I6IiArIHJvbGVjbHJbdV9pbmZbInJvbGUiXS50b0xvd2VyQ2FzZSgpXSArICI7Jz4gKCIgKyB1X2luZlsicm9sZSJdICsgIik8L3NwYW4+PGJyPjwvc3Ryb25nPjwvcD4iOwoKCQkJCWlmICh1X2luZlsidXNlcl9pZCJdKQoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+dWlkOiAiICsgdV9pbmZbInVzZXJfaWQiXTsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPmJldGEiOwoKCQkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQoJCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCBmYWxzZSkgKyAiPC9wPiI7CgkJCQllbHNlCgkJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsKCgkJCQlpZiAodV9pbmZbImRlc2NyaXB0aW9uIl0pCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTJweDttYXJnaW4tdG9wOiAwcHg7Jz5ubyBpbmZvPC9wPiIKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmYiKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQlub3RpZnkocmVzdWx0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQlpZiAocmVzdWx0LmluY2x1ZGVzKCJyZWNlbnRseSIpKSB7CgkJCQkJaWYgKGZ1X2Nvb2xkb3duIDwgZ190bV9pKCkpCgkJCQkJCWZ1X2Nvb2xkb3duID0gZ190bV9pKCkgKyAzMDsKCQkJCX0KCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImNsb3NlZmluZHVzZXIiLCAiY2xvc2UiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmR1c2VyZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfZGl2KHBhdGgsICJ1c2VyX2luZmFsaWFzIiwgewoJZGlzcGxheTogImlubGluZS1ncmlkIiwKCWdyaWRUZW1wbGF0ZUNvbHVtbnM6ICJyZXBlYXQoMywgMTA1cHgpIiwKCWdyaWRHYXA6ICIxMHB4Igp9KTsKCmNfYnIocGF0aCwgMik7CgpjX2ltZygidXNlcl9pbmZhbGlhcyIsICJ1c2VyX2F2dHIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLAoJewoJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQlvYmplY3RGaXQ6ICJjb3ZlciIsCgkJYm9yZGVyUmFkaXVzOiAiNXB4IiwKCQlwbGFjZVNlbGY6ICJub3JtYWwiCgl9KTsKCmNfYnIocGF0aCwgMik7CgpjX3RleHQoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9pbmYiLCAibm9uZSIsIHsKCWRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiwKCWNvbG9yOiAid2hpdGUiCn0pOwoKdmFyIGxhc3RfbXNnID0gMDsKdmFyIGZpcnN0X3NuZCA9IDA7CgpmdW5jdGlvbiBwX3NvdW5kKGlkKSB7CglpZiAoZmlyc3Rfc25kID09IDApIHsKCQlmaXJzdF9zbmQrKzsKCX0KCWVsc2UgewoJCXZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJCWVsZW1lbnQudm9sdW1lID0gMC4xOwoJCWVsZW1lbnQucGxheSgpOwoJfQp9CgpmdW5jdGlvbiB1X2NoYXQoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQlyZXR1cm47CgoJZ2F0aGVyKCJnZXRfY2hhdCIsICJ6IikKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCWNvbnN0IGNoYXRzID0gSlNPTi5wYXJzZShyZXN1bHQpOwoJCQljb25zdCBjaGF0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtY29udGFpbmVyJyk7CgkJCWNoYXRDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CgoJCQl2YXIgaGlnaGVzdF90cyA9IDA7CgkJCWNoYXRzLmZvckVhY2goYXN5bmMgKGNoYXQpID0+IHsKCQkJCWlmIChoaWdoZXN0X3RzIDwgY2hhdC50cykKCQkJCQloaWdoZXN0X3RzID0gY2hhdC50czsKCgkJCQljb25zdCBjaGF0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJY2hhdEVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CgkJCQljaGF0RWxlbWVudC5pbm5lckhUTUwgPSBgKDxzcGFuIGRhdGEtdHRpcD0nJHtnX3RtX2R0KGNoYXQudHMsIGZhbHNlKX0nIHN0eWxlPSJvcGFjaXR5OiAwLjU7Ij4ke2dfdG1fZHQoY2hhdC50cyl9PC9zcGFuPikgPHNwYW4gc3R5bGU9JyR7Y2hhdC5yICE9IHVuZGVmaW5lZCA/ICgiY29sb3I6IiArIChPYmplY3QuZW50cmllcyhyb2xlY2xyKVtjaGF0LnJdWyIxIl0pICsgIjsiKSA6ICIifSc+PHN0cm9uZz4ke2NoYXQudX08L3N0cm9uZz48L3NwYW4+OiAke3dpbmRvdy5hdG9iKGNoYXQubXNnKX1gOwoJCQkJY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChjaGF0RWxlbWVudCk7CgoJCQkJY19ocigiY2hhdC1jb250YWluZXIiLCBmYWxzZSwgewoJCQkJCW9wYWNpdHk6ICIwLjIiLAoJCQkJCXBhZGRpbmdUb3A6ICIwcHgiLAoJCQkJCXBhZGRpbmdCb3R0b206ICIwcHgiLAoJCQkJfSk7CgkJCX0pOwoKCQkJaWYgKGxhc3RfbXNnICE9IGhpZ2hlc3RfdHMpIHsKCQkJCXBfc291bmQoInNuZDEiKTsKCQkJCWxhc3RfbXNnID0gaGlnaGVzdF90czsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKdV9jaGF0KCk7Cgp2YXIgcGF0aCA9ICJtYWluX2VsZW1lbnRzIjsKCi8qU1RBUlQgRkVBVFVSRVMqLwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGl0bGVfaWQiKS5pbm5lclRleHQgPSAiWklOQyI7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2lkIikuaW5uZXJUZXh0ID0gImNvbG9yYm90IjsKCmNfdGFiX2J1dHRvbigiZWxlbWVudF9idXR0b25zIiwgWwoJeyBpZDogIm1haW5fdGFiIiwgdGV4dDogIm1haW4iIH0sCgl7IGlkOiAic2V0dGluZ3NfdGFiIiwgdGV4dDogImRlYnVnIiB9LAoJeyBpZDogInFyY29kZV90YWIiLCB0ZXh0OiAiUVIiIH0KXSk7CgpjX3RhYl9idXR0b24oImVsZW1lbnRfcmlnaHRfYnV0dG9ucyIsIFsKCXsgaWQ6ICJwX3VwZGF0ZXMiLCB0ZXh0OiAibG9ncyIgfSwKCXsgaWQ6ICJwX3RpY2tldHMiLCB0ZXh0OiAidGlja2V0cyIgfSwKCXsgaWQ6ICJwX3Byb2ZpbGUiLCB0ZXh0OiAicHJvZmlsZSIgfQpdLCAyKTsKCmNfY29tYm9ib3gocGF0aCwgImFsbF9wcm9maWxlcyIsICJwcm9maWxlIiwgMCwgMjAsIHRydWUsICJQZXJmaWxlcyBwYXJhIGNhZGEgc2l0dWFjaW9uLiIsIGZ1bmN0aW9uICgpIHsKCXJfaW5mbygpOwp9LCB7IG1pbldpZHRoOiAiMTgwcHgiIH0pOwoKY190ZXh0Ym94KHBhdGgsICJwcm9maWxlX25hbWVfYyIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiA0LAoJbWF4TGVuZ3RoOiA5LAoJcmVxdWlyZWQ6IGZhbHNlLAp9LCB0cnVlKTsKCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9jaGFuZ2UiLCAiY2hhbmdlIG5hbWUiLCBmdW5jdGlvbiAoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsaWRpdHkudmFsaWQpIHsKCgkJdmFyIHByb2ZfdmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZmlsZV9uYW1lX2MiKS52YWx1ZTsKCQlzX2luZm8oInByb2ZpbGVfbmFtZSIsIHByb2ZfdmFsdWUpOwoKCQlyX2luZm8oKTsKCQlmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7Cgl9CgllbHNlIHsKCQlub3RpZnkoIk5vIHNlIGFjZXB0YW4gZXNwYWNpb3MgbyBjYXJhY3RlcmVzIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiQ2FtYmlhIGVsIG5vbWJyZSBkZWwgcHJvZmlsZSIsIHsgbWFyZ2luUmlnaHQ6ICIxMHB4IiB9KTsKCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9leHBvcnQiLCAiZXhwb3J0IHByb2ZpbGUiLCBmdW5jdGlvbiAoKSB7CglzX2J0bigiZXhwb3J0X3Byb2ZpbGUiKTsKfSwgIkV4cG9ydGEgZWwgcGVyZmlsIGFjdHVhbCBhbCBDTElQQk9BUkQuIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2ltcG9ydCIsICJpbXBvcnQgcHJvZmlsZSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCJpbXBvcnRfcHJvZmlsZSIpOwoJcl9pbmZvKCk7CglmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7Cn0sICJJbXBvcnRhIHVuIHBlcmZpbCBkZXNkZSBlbCBDTElQQk9BUkQuIik7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19jaGVja2JveChwYXRoLCAiY29sb3Jib3QiLCAiZW5hYmxlZCIsICJBY3RpdmEgZWwgZnVuY2lvbmFtaWVudG8gZGVsIGNvbG9yYm90LiIpOwpjX2NoZWNrYm94KHBhdGgsICJtYXNrX2Zvcm1hdCIsICJtYXNrIGZvcm1hdCIsICJBbCBlc3RhciBhY3RpdmFkbywgdXRpbGl6YSBlbCBtYXNrIHRocmVhZCAoZGVqYW5kbyBpbmhhYmlsaXRhZG8gZWwgc2ltcGxlIGZvcm1hdCkiKTsKY19jaGVja2JveChwYXRoLCAic2ltcGxlX2Zvcm1hdCIsICJzaW1wbGUgZm9ybWF0IiwgIkFsIGVzdGFyIGFjdGl2YWRvLCB1dGlsaXphIHVuIHRocmVhZCBsaW1waW8gc2luIG9wY2lvbmVzIGRlIGRlYnVnLCBldGMuIik7CgpjX2NoZWNrYm94KHBhdGgsICJkaW5hbWljX3Ntb290aCIsICJkaW5hbWljIHNtb290aCIsICJBbCBhY3RpdmFybG8sIGJsb3F1ZWEgZWwgc21vb3RoIHByaW5jaXBhbC4iKTsKY19jb21ib2JveChwYXRoLCAibWFpbl9rZXkiLCAibWFpbiBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IHByaW5jaXBhbCBjb24gbGEgY3VhbCBzZSBhY3RpdmEgZWwgYWltLiIpOwpjX2NvbWJvYm94KHBhdGgsICJzZWNvbmRhcnlfa2V5IiwgInNlY29uZGFyeSBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IHNlY3VuZGFyaWEgY29uIGxhIGN1YWwgc2UgYWN0aXZhIGVsIGFpbS4iKTsKCmNfY29tYm9ib3gocGF0aCwgImRpbmFtaWNfc21vb3RoX3R5cGUiLCAiZGluYW1pYyBzbW9vdGggdHlwZSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJBY29tb2RhIGVsIHNtb290aCBkaW5hbWljYW1lbnRlIGRlcGVuZGllbmRvIGxhIGRpc3RhbmNpYSBkZWwgZW5lbWlnbyIpOwpjX2NvbWJvYm94KHBhdGgsICJjb2xvcl90eXBlIiwgImNvbG9ycyIsIDAsIDQsIGZhbHNlLCAiRWwgY29sb3Igc2VsZWNjaW9uYWRvIGVzIGVuIGVsIGN1YWwgc2UgYmFzYXJhIGVsIGFpbWJvdCIpOwpjX2NvbWJvYm94KHBhdGgsICJzb3J0X21ldGhvZCIsICJtZXRob2RzIiwgMCwgOCwgZmFsc2UsICJEaXN0aW50b3MgbWV0b2RvcyBwYXJhIHF1ZSBlbCBhaW1ib3QgYXB1bnRlLCBzZSByZWNvbWllbmRhIGVsIEJFU1QuIik7CgpjX3NfaW50KHBhdGgsICd0YXJnZXRfb2Zmc2V0X3gnLCAib2Zmc2V0IFgiLCAwLCA1MCwgMSwgMCk7CmNfc19pbnQocGF0aCwgInRhcmdldF9vZmZzZXRfeSIsICJvZmZzZXQgWSIsIDAsIDUwLCAxLCA1KTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3NfZmxvYXQocGF0aCwgInNwZWVkIiwgInNtb290aCIsIDAuMCwgNi4wLCAwLjEsIDIuMCk7CmNfc19pbnQocGF0aCwgImZvdl94IiwgIkZvdiBYIiwgNSwgNTAwLCA1LCA1MCk7CmNfc19pbnQocGF0aCwgImZvdl95IiwgIkZvdiBZIiwgNSwgMjUwLCA1LCA1MCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19jaGVja2JveChwYXRoLCAicmVjb2lsIiwgInJlY29pbCIsICJCYWphcmEgZWwgY3Jvc3NoYWlyIGEgbGEgaG9yYSBkZSBkaXNwYXJhciBjb24gbGEgTUFJTiBrZXkuIik7CmNfY2hlY2tib3gocGF0aCwgInJjc19jcm91Y2hfb25seSIsICJjcm91Y2ggb25seSIsICJTb2xvIGZ1bmNpb25hcmEgc2kgZXN0YW1vcyBhcHJldGFuZG8gQ1RSTCIpOwpjX3NfaW50KHBhdGgsICJyZWNvaWxfZGVsYXkiLCAiZGVsYXkiLCA1LCA1MDAsIDUsIDIwMCk7CmNfc19pbnQocGF0aCwgInJlY29pbF9zdHJlbmdodCIsICJzdHJlbmdodCIsIDEsIDUwLCAxLCAyKTsKY19zX2ludChwYXRoLCAibWF4X3JlY29pbF9vZmZzZXQiLCAibWF4IG9mZnNldCIsIDEsIDUwLCAxLCAyKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2NoZWNrYm94KHBhdGgsICJ0cmlnZ2VyYm90IiwgInRyaWdnZXJib3QiLCAiRGlzcGFyYXJhIGF1dG9tYXRpY2FtZW50ZSBjdWFuZG8gZWwgQ09MT1IgcGFzZSBwb3IgZWwgY3Jvc3NoYWlyLiIpOwpjX2NoZWNrYm94KHBhdGgsICJkaXNhYmxlX2FpbV9vbl90cmlnZ2VyIiwgImRpc2FibGUgYWltIG9uIHRyaWdnZXIiKTsKY19jb21ib2JveChwYXRoLCAidHJpZ2dlcl90eXBlIiwgInR5cGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlKTsKY19jb21ib2JveChwYXRoLCAidHJpZ2dlcl9rZXkiLCAidHJpZ2dlciBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBUUklHR0VSLiIpOwpjX3NfaW50KHBhdGgsICJ0cmlnZ2VyX3JhZGl1cyIsICJmb3YiLCAxLCA1MCwgMSwgMTUpOwpjX3NfaW50KHBhdGgsICJ0cmlnZ2VyX2RlbGF5IiwgImRlbGF5IiwgNSwgNTUwLCA1LCAyNTApOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfY2hlY2tib3gocGF0aCwgImJob3AiLCAiYmhvcCIsICJBbCBhY3RpdmFybG8sIGRlYmVzIGJpbmRlYXIgbGEga2V5IFhCdXR0b24yIG8gTW91c2U1IGFsIGJob3AgZW4gdmV6IGRlbCBlc3BhY2lvLiIpOwpjX3NfaW50KHBhdGgsICJiaG9wX2RlbGF5IiwgImJob3AgZGVsYXkiLCA1LCAyMDAsIDUsIDIwMCk7CgpwYXRoID0gInNldHRpbmdfZWxlbWVudHMiOwpjX2NoZWNrYm94KHBhdGgsICJkZWJ1Z193aW5kb3ciLCAiZGVidWcgd2luZG93Iik7CmNfY2hlY2tib3gocGF0aCwgImNpcmNsZXMiLCAiZGVidWcgY2lyY2xlcyIpOwpjX2NoZWNrYm94KHBhdGgsICJjZW50ZXJfY29sb3JzIiwgImRlYnVnIGNvbG9ycyIpOwpjX2NoZWNrYm94KHBhdGgsICJtYXNrX3dpbmRvdyIsICJkZWJ1ZyBtYXNrIik7CgpmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CmZfY29tYm8oInRyaWdnZXJfdHlwZSIsICJ0cmlnZ2VyX3R5cGUiKTsKZl9jb21ibygiZGluYW1pY19zbW9vdGhfdHlwZSIsICJkaW5hbWljX3Ntb290aF90eXBlIik7CmZfY29tYm8oImNvbG9yX3R5cGUiLCAiY29sb3JzIik7CmZfY29tYm8oInNvcnRfbWV0aG9kIiwgIm1ldGhvZHMiKTsKCmNvbnN0IGJpbmRfZWxlbWVudHMgPSBbCgl7IGlkOiAibWFpbl9rZXkiLCB0YXJnZXQ6ICJtYWluX2tleSIgfSwKCXsgaWQ6ICJzZWNvbmRhcnlfa2V5IiwgdGFyZ2V0OiAic2Vjb25kYXJ5X2tleSIgfSwKCXsgaWQ6ICJ0cmlnZ2VyX2tleSIsIHRhcmdldDogInRyaWdnZXJfa2V5IiB9LApdOwoKLypFTkQgRkVBVFVSRVMqLwoKcGF0aCA9ICJwYW5lbF90aWNrZXRzIjsKCmNfdGV4dChwYXRoLCAidGlja2V0Y2VudGVyIiwgIlRpY2tldCBDZW50ZXIiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7Cgp2YXIgdGlja2V0X2ZhcV9zdCA9IHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCglmb250U2l6ZTogJzE0cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCn0KCmNfdGV4dChwYXRoLCAidGNrdGZhcSIsICItIERvIG5vdCBzcGFtIHRoZSB0aWNrZXQgc3lzdGVtLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYW4gaXNzdWUuPGJyPi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgaGF2ZSBhIGZlYXR1cmUgcmVxdWVzdC48YnI+IiwgdGlja2V0X2ZhcV9zdCk7CmNfdGV4dChwYXRoLCAidGNrdGZhcSIsICItIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IG5lZWQgPHU+aGVscDwvdT4uPGJyPi0gQWxsIHRpY2tldHMgYXJlIDx1PnByaXZhdGU8L3U+Ljxicj4tIERvIG5vdCBwb3N0IGlycmVsZXZhbnQgY29tbWVudHMgaW4gdGlja2V0cyBvciB5b3UgbWF5IGJlIDx1PmJhbm5lZDwvdT4uIiwgdGlja2V0X2ZhcV9zdCk7CgpjX2NvbWJvYm94MihwYXRoLCAidGlja2V0X2JlaGF2aW9yIiwgWyJCdWciLCAiRmVhdHVyZSIsICJPdGhlciJdLCB0cnVlLCAiU2VsZWNjaW9uYSB1bmEgcmF6b24gZGVsIHRpY2tldC4iKTsKCmNfdGV4dGFyZWEocGF0aCwgInRpY2tldF9jb250ZW50IiwgdHJ1ZSwgIiIsIHsKCWhlaWdodDogJzEwMHB4JywKCXJlc2l6ZTogJ25vbmUnLAoJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJd2hpdGVTcGFjZTogJ3ByZS13cmFwJywKCW1hcmdpblRvcDogIjVweCIsCn0sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOSBdKiR7NX0iLAoJbWluTGVuZ3RoOiA1LAoJbWF4TGVuZ3RoOiAyNTYsCglwbGFjZWhvbGRlcjogImluZm8iLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwoKdmFyIHNob3dfdGlja2V0X2MgPSBmYWxzZTsKY19idG4ocGF0aCwgImJ0bl9jcmVhdGVfdGlja2V0IiwgImNyZWF0ZSB0aWNrZXQiLCBmdW5jdGlvbiAoKSB7CglpZiAoIXNob3dfdGlja2V0X2MpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQlzaG93X3RpY2tldF9jID0gdHJ1ZTsKCQlyZXR1cm47Cgl9CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHRpY2tldF9pbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50IikudmFsdWU7CgkJdmFyIHRpY2tldF9yZWFzb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2JlaGF2aW9yIikudmFsdWU7CgoJCXNfYnRuKCJjcmVhdGVfdGlja2V0IiwgdGlja2V0X3JlYXNvbiArICItIiArIHRpY2tldF9pbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDUgYSAyNTYgY2FyYWN0ZXJlcyBzb2xhbWVudGUuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiQ3JlYSB1biB0aWNrZXQgZWwgY3VhbCBzZXJhIGF0ZW5kaWRvL3Zpc3RvIHBvciBsb3MgYWRtaW5pc3RyYWRvcmVzLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKY19idG4ocGF0aCwgImJ0bl9nZXRfdGlja2V0cyIsICJ2aWV3IHRpY2tldHMiLCBmdW5jdGlvbiAoKSB7CglpZiAoc2hvd190aWNrZXRfYykgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJc2hvd190aWNrZXRfYyA9IGZhbHNlOwoJfQoKCXNfYnRuKCJnZXRfdGlja2V0cyIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ1c2VyX2hhc19ub190aWNrZXRzIikpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIHJlc2pzb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CgoJCQlpZiAocmVzanNvbi5sZW5ndGggPT0gMCkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9ICJubyB0aWNrZXRzIjsKCQkJCW5vdGlmeSgidXNlciBoYXMgbm8gdGlja2V0cyIsIDcwMDApOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gIm5vIHRpY2tldHMiOwoKCQkJdmFyIHRvX3RpY2tldHMgPSAiIjsKCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzanNvbikgewoJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc2pzb24sIGtleSkpIHsKCQkJCQljb25zdCBlbGVtZW50ID0gcmVzanNvbltrZXldOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxzdHJvbmc+PHU+IiArIGVsZW1lbnRbInJlYXNvbiJdICsgIiBbIiArIGVsZW1lbnRbImlkIl0gKyAiXTwvdT4gfCA8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIGRhdGEtdHRpcD0nRGVsZXRlIHRpY2tldCcgc3R5bGU9J2hlaWdodDozMHB4O3dpZHRoOmF1dG87ZGlzcGxheTppbmxpbmUtYmxvY2s7Y29sb3I6cmVkOycgb25jbGljaz1cInNfYnRuKCdkZWxldGVfdGlja2V0JywgJyIgKyBlbGVtZW50WyJpZCJdICsgIicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcik7fSk7XCI+JnRpbWVzOzwvYnV0dG9uPjwvc3Ryb25nPjxicj4iOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxwPiIgKyBlbGVtZW50WyJjb250ZW50Il0gKyAiPC9wPiI7CgkJCQkJdG9fdGlja2V0cyArPSAiPGJyPjxicj4iOwoJCQkJfQoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gdG9fdGlja2V0czsKCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0sICJNdWVzdHJhIHR1cyB0aWNrZXRzIGNyZWFkb3MiKTsKCmNfdGV4dChwYXRoLCAidXNlcl90aWNrZXRzIiwgIiIsIHsgdGV4dEFsaWduOiAiY2VudGVyIiB9KTsKCmNfYnIocGF0aCk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfdGV4dChwYXRoLCAibWFpbl9wZl90ZXh0IiwgIlByb2ZpbGUiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFdlaWdodDogJ2JvbGQnLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcyMHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAnMHB4Jwp9KTsKCmNfZGl2KHBhdGgsICJ1c2VyaW5mbyIsIHsKCWRpc3BsYXk6ICJpbmxpbmUtZ3JpZCIsCglncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDFmcikiLAoJZ3JpZEdhcDogIjEwcHgiCn0pOwoKcGF0aCA9ICJ1c2VyaW5mbyI7CmNfaW1nKHBhdGgsICJ1c2VyX2F2YXRhciIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsCgl7CgkJanVzdGlmeVNlbGY6ICJzdGFydCIsCgkJbWFyZ2luTGVmdDogIjEwcHgiLAoJCW9iamVjdEZpdDogImNvdmVyIiwKCQlib3JkZXJSYWRpdXM6ICI1cHgiCgl9KTsKCmNfdGV4dChwYXRoLCAidXNlcl9pbmZvIiwgIm5vbmUiLCB7IGRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiB9KTsKCmZ1bmN0aW9uIG93bl9pbmZvKCkgewoJZ2F0aGVyKCJnZXRfdXNlcl9pbmZvIiwgInoiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJbGV0IHVfaW5mID0gSlNPTi5wYXJzZShyZXN1bHQpOwoKCQkJaWYgKHVfaW5mWyJhdmF0YXIiXSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQl9CgoJCQl2YXIgdXNlcl9kYXRhID0gIiI7CgkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4Oyc+PHN0cm9uZz5AIiArIHVfaW5mWyJhbGlhcyJdOwoKCQkJaWYgKHVfaW5mWyJyb2xlIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxzcGFuIHN0eWxlPSdkaXNwbGF5OmlubGluZTtmb250LXNpemU6MTBweDtjb2xvcjoiICsgcm9sZWNsclt1X2luZlsicm9sZSJdLnRvTG93ZXJDYXNlKCldICsgIjsnPiAoIiArIHVfaW5mWyJyb2xlIl0gKyAiKTwvc3Bhbj48YnI+PC9zdHJvbmc+PC9wPiI7CgoJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+dWlkOiAiICsgdV9pbmZbInVzZXJfaWQiXTsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz5iZXRhIjsKCgkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQoJCQkJdXNlcl9kYXRhICs9ICIgLSBqb2luZWQ6ICIgKyBnX3RtX2R0KHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0sIGZhbHNlKSArICI8L3A+IjsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsKCgkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPmluZm86ICIgKyB3aW5kb3cuYXRvYih1X2luZlsiZGVzY3JpcHRpb24iXSkgKyAiPC9wPiI7CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPHA+PC9wPiIKCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2luZm8iKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9Cgpvd25faW5mbygpOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2FsaWFzIiwgImNoYW5nZSBhbGlhcyIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJQZXJtaXRlIGNhbWJpYXIgZWwgYWxpYXMgMSB2ZXogY2FkYSAzMCBkaWFzLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiYWxpYXNfZGxnIiwge30sIHt9KTsKcGF0aCA9ICJhbGlhc19kbGciOwoKY190ZXh0Ym94KHBhdGgsICJwZl9hbGlhc190ZXh0Ym94IiwgZmFsc2UsICIiLCAiIiwgewoJbWFyZ2luVG9wOiAiNXB4IiwKfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCW1pbkxlbmd0aDogMywKCW1heExlbmd0aDogMjAsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiYnRuX2NoYW5nZV9hbGlhcyIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYWxpYXNfdGV4dGJveCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgdHh0aW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCQlzX2J0bigiY2hhbmdlX2FsaWFzIiwgdHh0aW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlvd25faW5mbygpOwoJCQkJfQoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiY2FuY2VsX2FsaWFzIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoKY19idG4ocGF0aCwgIm9wZW5kbGdhdnRyIiwgImNoYW5nZSBhdmF0YXIiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJDYW1iaWEgZWwgYXZhdGFyIGEgdW5hIGltYWdlbiwgc29sbyBVUkxTLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiYXZ0cl9kbGciKTsKcGF0aCA9ICJhdnRyX2RsZyI7CgpjX2ltZyhwYXRoLCAiYXZ0cl9wcmV2aWV3IiwgZGVmYXVsdF9hdmF0YXIsIDkwLCA5MCwgewoJZGlzcGxheTogImJsb2NrIiwKCW1hcmdpbjogIjAgYXV0byIsCglvYmplY3RGaXQ6ICJjb3ZlciIKfSk7CgpjX2JyKCk7CgpjX3RleHQocGF0aCwgIiIsICJJbWd1ciBVUkwgb25seSwgZXhhbXBsZS4iLCB7Cgl0ZXh0QWxpZ246ICJjZW50ZXIiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CmNfdGV4dChwYXRoLCAiIiwgImh0dHBzOi8vaS5pbWd1ci5jb20vR25KYUVaTC5wbmciLCB7Cgl0ZXh0QWxpZ246ICJjZW50ZXIiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CgpjX3RleHRib3gocGF0aCwgInBmX2F2YXRhcl90ZXh0Ym94IiwgZmFsc2UsICIiLCAiMTAgYSAxMzAgY2FyYWN0ZXJlcy4gRXZpdGFyIHVzYXIgVVJMJ3MgZGUgZ2lmcy92aWRlb3MuIiwgewoJbWFyZ2luVG9wOiAiNXB4IiwKCXdpZHRoOiAiOTUlIgp9LCB7CglwYXR0ZXJuOiAiXihodHRwcz86XC9cLyk/KGlcLmltZ3VyXC5jb21cLykoW2EtekEtWjAtOV0rKShcLmpwZ3xcLmpwZWd8XC5wbmcpJCIsCgltaW5MZW5ndGg6IDIwLAoJbWF4TGVuZ3RoOiA0MCwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJidG5fcHJldmlld19hdmF0YXIiLCAicHJldmlldyIsIGZ1bmN0aW9uICgpIHsKCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwZl9hdmF0YXJfdGV4dGJveCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gZWxlbV9pdGVtLnZhbHVlOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwpjX2hyKHBhdGgsIGZhbHNlKTsKCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2F2YXRhciIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYXZhdGFyX3RleHRib3giKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHR4dGluZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgkJc19idG4oJ2NoYW5nZV9hdmF0YXInLCB0eHRpbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSB0eHRpbmZvOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2YXRhciIpLnNyYyA9IHR4dGluZm87CgoJCQkJCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKTsKCQkJCQlkaWFsb2cuY2xvc2UoKTsKCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImNhbmNlbF9hdnRyIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2Rlc2MiLCAiY2hhbmdlIGRlc2NyaXB0aW9uIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjX2RsZyIpOwoJZGlhbG9nLnNob3dNb2RhbCgpOwp9LCAiQ2FtYmlhIGxhIGRlc2NyaXBjaW9uIGRlIHR1IHBlcmZpbC4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQoKY19kaWFsb2cocGF0aCwgImRlc2NfZGxnIik7CnBhdGggPSAiZGVzY19kbGciOwoKY190ZXh0YXJlYShwYXRoLCAiZGVzY3JpcHRpb25fY29udGVudCIsIGZhbHNlLCAiIiwgewoJaGVpZ2h0OiAnMTAwcHgnLAoJcmVzaXplOiAnbm9uZScsCglvdmVyZmxvdzogJ2hpZGRlbicsCgl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJbWFyZ2luVG9wOiAiNXB4IiwKCWp1c3RpZnlTZWxmOiAiY2VudGVyIiwKCXRleHRib3g6IHsKCQlkaXNwbGF5OiAiaW5oZXJpdCIKCX0KfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsCgltaW5MZW5ndGg6IDQsCgltYXhMZW5ndGg6IDI1NiwKCXBsYWNlaG9sZGVyOiAiZGVzY3JpcHRpb24iLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImJ0bl9jaGFuZ2VfZGVzY3JpcHRpb24iLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NyaXB0aW9uX2NvbnRlbnQiKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIGRlc2NfaW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCgkJc19idG4oImNoYW5nZV9kZXNjcmlwdGlvbiIsIGRlc2NfaW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlvd25faW5mbygpOwoJCQkJfQoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiY2FuY2VsX2Rlc2MiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjX2RsZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7Cgpjb25zdCB2aXJ0dWFsS2V5cyA9IFtdOwoKZm9yIChsZXQgaSA9IDB4NDE7IGkgPD0gMHg1QTsgaSsrKSB7Cgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKfQoKZm9yIChsZXQgaSA9IDB4MzA7IGkgPD0gMHgzOTsgaSsrKSB7Cgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKfQoKY29uc3Qgc3BlY2lhbEtleXMgPSBbCgl7IGNvZGU6IDAsIG5hbWU6ICdOT05FJyB9LAoJeyBjb2RlOiAweDA4LCBuYW1lOiAnQmFja3NwYWNlJyB9LAoJeyBjb2RlOiAweDA5LCBuYW1lOiAnVGFiJyB9LAoJeyBjb2RlOiAweDBELCBuYW1lOiAnRW50ZXInIH0sCgl7IGNvZGU6IDB4MTAsIG5hbWU6ICdTaGlmdCcgfSwKCXsgY29kZTogMHgxMSwgbmFtZTogJ0N0cmwnIH0sCgl7IGNvZGU6IDB4MTIsIG5hbWU6ICdBbHQnIH0sCgl7IGNvZGU6IDB4QTQsIG5hbWU6ICdMZWZ0IEFsdCcgfSwKCXsgY29kZTogMHhBNSwgbmFtZTogJ1JpZ2h0IEFsdCcgfSwKCXsgY29kZTogMHgxMywgbmFtZTogJ1BhdXNlL0JyZWFrJyB9LAoJeyBjb2RlOiAweDVCLCBuYW1lOiAnTGVmdCBXaW5kb3dzJyB9LAoJeyBjb2RlOiAweDVDLCBuYW1lOiAnUmlnaHQgV2luZG93cycgfSwKCXsgY29kZTogMHg1RCwgbmFtZTogJ0FwcGxpY2F0aW9ucycgfSwKCXsgY29kZTogMHg2MCwgbmFtZTogJ051bVBhZCAwJyB9LAoJeyBjb2RlOiAweDYxLCBuYW1lOiAnTnVtUGFkIDEnIH0sCgl7IGNvZGU6IDB4NjIsIG5hbWU6ICdOdW1QYWQgMicgfSwKCXsgY29kZTogMHg2MywgbmFtZTogJ051bVBhZCAzJyB9LAoJeyBjb2RlOiAweDY0LCBuYW1lOiAnTnVtUGFkIDQnIH0sCgl7IGNvZGU6IDB4NjUsIG5hbWU6ICdOdW1QYWQgNScgfSwKCXsgY29kZTogMHg2NiwgbmFtZTogJ051bVBhZCA2JyB9LAoJeyBjb2RlOiAweDY3LCBuYW1lOiAnTnVtUGFkIDcnIH0sCgl7IGNvZGU6IDB4NjgsIG5hbWU6ICdOdW1QYWQgOCcgfSwKCXsgY29kZTogMHg2OSwgbmFtZTogJ051bVBhZCA5JyB9LAoJeyBjb2RlOiAweDcwLCBuYW1lOiAnRjEnIH0sCgl7IGNvZGU6IDB4NzEsIG5hbWU6ICdGMicgfSwKCXsgY29kZTogMHg3MiwgbmFtZTogJ0YzJyB9LAoJeyBjb2RlOiAweDczLCBuYW1lOiAnRjQnIH0sCgl7IGNvZGU6IDB4NzQsIG5hbWU6ICdGNScgfSwKCXsgY29kZTogMHg3NSwgbmFtZTogJ0Y2JyB9LAoJeyBjb2RlOiAweDc2LCBuYW1lOiAnRjcnIH0sCgl7IGNvZGU6IDB4NzcsIG5hbWU6ICdGOCcgfSwKCXsgY29kZTogMHg3OCwgbmFtZTogJ0Y5JyB9LAoJeyBjb2RlOiAweDc5LCBuYW1lOiAnRjEwJyB9LAoJeyBjb2RlOiAweDdBLCBuYW1lOiAnRjExJyB9LAoJeyBjb2RlOiAweDdCLCBuYW1lOiAnRjEyJyB9LAoJeyBjb2RlOiAweDAxLCBuYW1lOiAnTEJVVFRPTicgfSwKCXsgY29kZTogMHgwMiwgbmFtZTogJ1JCVVRUT04nIH0sCgl7IGNvZGU6IDB4MDQsIG5hbWU6ICdNQlVUVE9OJyB9LAoJeyBjb2RlOiAweDA1LCBuYW1lOiAnWEJVVFRPTjEnIH0sCgl7IGNvZGU6IDB4MDYsIG5hbWU6ICdYQlVUVE9OMicgfSwKCXsgY29kZTogMHhCQiwgbmFtZTogJz0nIH0sCgl7IGNvZGU6IDB4QkMsIG5hbWU6ICcsJyB9LAoJeyBjb2RlOiAweEJELCBuYW1lOiAnLScgfSwKCXsgY29kZTogMHhCRSwgbmFtZTogJy4nIH0sCl07Cgp2aXJ0dWFsS2V5cy5wdXNoKC4uLnNwZWNpYWxLZXlzKTsKdmlydHVhbEtleXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5jb2RlIC0gYi5jb2RlOyB9KTsKCmZ1bmN0aW9uIGNyZWF0ZU9wdGlvbkVsZW1lbnQoa2V5RWxlbWVudCwgaWQpIHsKCWNvbnN0IG9wdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCW9wdGlvbkVsZW1lbnQudmFsdWUgPSBrZXlFbGVtZW50LmNvZGU7CglvcHRpb25FbGVtZW50LnRleHQgPSBrZXlFbGVtZW50Lm5hbWU7CglvcHRpb25FbGVtZW50LmlkID0gaWQrIl9vcHQiOwoJcmV0dXJuIG9wdGlvbkVsZW1lbnQ7Cn0KCmJpbmRfZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4gewoJY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnQudGFyZ2V0KTsKCXZpcnR1YWxLZXlzLmZvckVhY2goKGtleSkgPT4gewoJCXRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQoY3JlYXRlT3B0aW9uRWxlbWVudChrZXksIGVsZW1lbnQuaWQpKTsKCX0pOwp9KTsKCmZ1bmN0aW9uIHJfaW5mbygpIHsKCWZvciAoY29uc3QgaSBpbiB1X2Jvb2wpIHsKCQlnX2Jvb2wodV9ib29sW2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCWdfZmxvYXQodV9mbG9hdFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfaW50KSB7CgkJZ19pbnQodV9pbnRbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2ludDIpIHsKCQlnX2ludCh1X2ludDJbaV0sIGZhbHNlKTsKCX0KfQoKZnVuY3Rpb24gdV9zZXJ2ZXIoKSB7Cglmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7CgkJc19ib29sKHVfYm9vbFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfZmxvYXQpIHsKCQlzX2Zsb2F0KHVfZmxvYXRbaV0pOwoJfQp9CgpmdW5jdGlvbiBjZW50ZXJfdGFic19maXgoaWQsIGRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIikgewoJdmFyIGVsZW1lbnRvcyA9IFsnZWxlbWVudF9tYWluJywgJ2VsZW1lbnRfc2V0dGluZycsICdlbGVtZW50X3FyY29kZSddOwoKCWVsZW1lbnRvcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50bykgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50bykpCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJfSk7CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7Cn0KCmZ1bmN0aW9uIHRhYl9zd2l0Y2goaSA9IHRoaXMuaWQsIHBhbmVsID0gImNlbnRlciIsIGRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIikgewoJc3dpdGNoIChwYW5lbCkgewoJCWNhc2UgMjoKCQljYXNlICIyIjoKCQljYXNlICJyaWdodCI6CgkJCWxldCB0YWIyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltjLXRhYjItYnRuXSIpOwoJCQl0YWIyQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHsKCQkJCWlmIChidXR0b24uaWQgPT09IGkpIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CgkJCQl9IGVsc2UgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKTsKCQkJCX0KCQkJfSk7CgkJCXN3aXRjaCAoaSkgewoJCQkJY2FzZSAncF91cGRhdGVzJzoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdwX3RpY2tldHMnOgoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3BfcHJvZmlsZSc6CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gImdyaWQiOwoJCQkJCWJyZWFrOwoJCQl9CgkJCWJyZWFrOwoJCWNhc2UgMToKCQljYXNlICIxIjoKCQljYXNlICJjZW50ZXIiOgoJCQlsZXQgdGFiQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltjLXRhYi1idG5dIik7CgkJCXRhYkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7CgkJCQlpZiAoYnV0dG9uLmlkID09PSBpKSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwoJCQkJfSBlbHNlIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIik7CgkJCQl9CgkJCX0pOwoKCQkJc3dpdGNoIChpKSB7CgkJCQljYXNlICdtYWluX3RhYic6CgkJCQkJY2VudGVyX3RhYnNfZml4KCdlbGVtZW50X21haW4nLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3NldHRpbmdzX3RhYic6CgkJCQkJY2VudGVyX3RhYnNfZml4KCdlbGVtZW50X3NldHRpbmcnLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3FyY29kZV90YWInOgoJCQkJCWNlbnRlcl90YWJzX2ZpeCgnZWxlbWVudF9xcmNvZGUnLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJfQoJCQlicmVhazsKCX0KfQoKdGFiX3N3aXRjaCgibWFpbl90YWIiLCAiY2VudGVyIiwgIm5vbmUiKTsKcl9pbmZvKCk7Cgp2YXIgaXRlcmZvdW5kID0gMDsKdmFyIHdhc19nYW1lX2ZvdW5kID0gZmFsc2U7CnZhciBzaG91bGRfdXBkYXRlID0gdHJ1ZTsKdmFyIGlzX21vdXNlX2luc2lkZSA9IGZhbHNlOwoKZnVuY3Rpb24gaE1vdXNlRSgpIHsgaXNfbW91c2VfaW5zaWRlID0gdHJ1ZTsgfQpmdW5jdGlvbiBoTW91c2VMKCkgeyBpc19tb3VzZV9pbnNpZGUgPSBmYWxzZTsgfQoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VlbnRlciIsIGhNb3VzZUUpOwpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwgaE1vdXNlTCk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ2aXNpYmlsaXR5Y2hhbmdlIiwgKGV2ZW50KSA9PiB7CglpZiAoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID09ICJ2aXNpYmxlIikgewoJCXNob3VsZF91cGRhdGUgPSB0cnVlOwoJfSBlbHNlIHsKCQlzaG91bGRfdXBkYXRlID0gZmFsc2U7Cgl9Cn0pOwoKdmFyIHVwZGF0ZXJ0ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJaWYgKHNob3VsZF91cGRhdGUgJiYgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgIT0gIm5vbmUiICYmIGlzX21vdXNlX2luc2lkZSkgewoJCXJfaW5mbygpOwoJCWdfb25saW5lcygpOwoJfQp9LCA2NTAwKTsKCnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJdV9jaGF0KCk7Cgl9Cn0sIDM1MDApOwoKYXN5bmMgZnVuY3Rpb24gZ2F0aGVyKGluZm8sIGV4dHJhLCBmdW5jMiA9IGZ1bmN0aW9uICgpIHsgfSkgewoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBpbmZvICsgIiZ2YWw9IiArIGV4dHJhLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsKCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQlyZWplY3QoZXJyb3IpOwoJCX0pOwoJfSk7Cn0KCmZ1bmN0aW9uIHppbmNfaW5mbyhpbmZvLCBleHRyYSkgewoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaW5mbywgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKSAhPSB1bmRlZmluZWQpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuaW5uZXJIVE1MID0gZXh0cmEgKyByZXNwb25zZVRleHQ7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCX0KCX0pOwp9Cgp2YXIgd2FpdGluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCSQuZ2V0KCIvZ19pbmZvP2luZm89Z2FtZWZvdW5kIiwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCXdhc19nYW1lX2ZvdW5kID0gcGFyc2VJbnQocmVzcG9uc2VUZXh0KTsKCQlpZiAoIXdhc19nYW1lX2ZvdW5kKSB7CgkJCXppbmNfaW5mbygid2FpdGluZ19nYW1lIiwgImludGlhbGl6aW5nPGJyPmNsb3NpbmcgaW46ICIpOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9kYXlzIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfYnV0dG9ucyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X21haW4iKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9jb25maWciKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOwoJCX0KCQllbHNlIHsKCQkJaXRlcmZvdW5kKys7CgoJCQlpZiAoaXRlcmZvdW5kID4gMikgewoJCQkJemluY19pbmZvKCJ1c2VyX2RheXMiLCAiZGF5cyBsZWZ0OiAiKTsKCQkJCXppbmNfaW5mbygibGFzdF91cGRhdGUiLCAiPHN0cm9uZz5VcGRhdGVkPC9zdHJvbmc+OiAiKTsKCQkJCXppbmNfaW5mbygiY2hhbmdlbG9ncyIsICI8c3Ryb25nPkNoYW5nZWxvZ3M8L3N0cm9uZz46ICIpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXRpbmdfZ2FtZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9idXR0b25zIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X21haW4iKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJdGFiX3N3aXRjaCgibWFpbl90YWIiKTsKCQkJCXRhYl9zd2l0Y2goInBfdXBkYXRlcyIsIDIpOwoJCQkJY2xlYXJJbnRlcnZhbCh3YWl0aW5nKTsKCQkJfQoJCX0KCX0pCn0sIDI1MCk7Cgp2YXIgcnVubmluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCXRyeSB7CgkJJC5nZXQoIi9nX2luZm8/aW5mbz1ydW5uaW5nIiwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQljX2V4aXQoKTsKCQl9KTsKCX0gY2F0Y2ggKGVycm9yKSB7CgkJY29uc29sZS5sb2coZXJyb3IpOwoJCWFsZXJ0KGVycm9yKTsKCQljX2V4aXQoKTsKCX0KfSwgMTI1MCk7CgpmdW5jdGlvbiBjX2RpYWxvZyhpZF93aGVyZSwgaWRfaXRlbSwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7Cgljb25zdCBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaWFsb2ciKTsKCWRpYWxvZy5pZCA9IGlkX2l0ZW07CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oZGlhbG9nLnN0eWxlLCBzdHlsZXopOwoJfQoKCWlmIChlbGVtbnQpIHsKCQlmb3IgKGxldCBrZXkgaW4gZWxlbW50KSB7CgkJCWNvbnN0IGVsZW1lbnQgPSBlbGVtbnRba2V5XTsKCQkJY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGVsZW1lbnQudHlwZSk7CgkJCU9iamVjdC5hc3NpZ24oZWwsIGVsZW1lbnQucHJvcHMpOwoJCQlPYmplY3QuYXNzaWduKGVsLnN0eWxlLCBlbGVtZW50LnN0eWxlcyk7CgkJCWRpYWxvZy5hcHBlbmRDaGlsZChlbCk7CgkJfQoJfQoKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKS5hcHBlbmRDaGlsZChkaWFsb2cpOwp9CgpmdW5jdGlvbiBjX2RpdihpZF93aGVyZSwgaWRfaXRlbSwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7Cgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWRpdi5pZCA9IGlkX2l0ZW07CglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihkaXYsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWRpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihkaXYuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7Cn0KCmZ1bmN0aW9uIGNfdGFiX2J1dHRvbihpZF93aGVyZSwgYnV0dG9ucywgdHlwZXogPSAxKSB7Cgljb25zdCB0YWJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgoJYnV0dG9ucy5mb3JFYWNoKGZ1bmN0aW9uIChidXR0b24sIGluZGV4KSB7CgkJdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJCWJ0bi5jbGFzc05hbWUgPSAidGFiLWJ1dHRvbiI7CgkJYnRuLnNldEF0dHJpYnV0ZSh0eXBleiA9PSAxID8gImMtdGFiLWJ0biIgOiAoImMtdGFiIiArIHR5cGV6ICsgIi1idG4iKSwgIiIpOwoJCWJ0bi5pZCA9IGJ1dHRvbi5pZDsKCQlidG4uaW5uZXJIVE1MID0gYnV0dG9uLnRleHQ7CgoJCWlmIChpbmRleCA9PT0gMCkgewoJCQlidG4uc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMgPSAiMHB4IjsKCQl9IGVsc2UgaWYgKGluZGV4ID09PSBidXR0b25zLmxlbmd0aCAtIDEpIHsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcExlZnRSYWRpdXMgPSAiMHB4IjsKCQl9IGVsc2UgewoJCQlidG4uc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMgPSAiMHB4IjsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcExlZnRSYWRpdXMgPSAiMHB4IjsKCQl9CgoJCWJ0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCQl0YWJfc3dpdGNoKHRoaXMuaWQsIHR5cGV6KTsKCQl9OwoKCQl0YWJDb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTsKCX0pOwp9CgpmdW5jdGlvbiBnX3RtX2R0KHRpbWVzdGFtcCwgaHJtaW4gPSB0cnVlKSB7Cgl2YXIgZGF0ZSA9IG5ldyBEYXRlKCt0aW1lc3RhbXAgKiAxMDAwKTsKCWlmIChocm1pbikgewoJCXZhciBob3VyID0gKCIwIiArIGRhdGUuZ2V0SG91cnMoKSkuc3Vic3RyKC0yKTsKCQl2YXIgbWludXRlcyA9ICgiMCIgKyBkYXRlLmdldE1pbnV0ZXMoKSkuc3Vic3RyKC0yKTsKCQlyZXR1cm4gKGhvdXIgKyAiOiIgKyBtaW51dGVzKTsKCX0KCWVsc2UgewoJCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoJCXZhciBtb250aCA9ICgiMCIgKyAoZGF0ZS5nZXRNb250aCgpICsgMSkpLnN1YnN0cigtMik7CgkJdmFyIGRheSA9ICgiMCIgKyBkYXRlLmdldERhdGUoKSkuc3Vic3RyKC0yKTsKCQlyZXR1cm4gKGRheSArICIvIiArIG1vbnRoICsgIi8iICsgeWVhcik7Cgl9Cn0KCmZ1bmN0aW9uIGNfYnRuKGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBmdW5jMiA9IGZ1bmN0aW9uICgpIHsgfSwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJYnV0dG9uLnR5cGUgPSAiYnV0dG9uIjsKCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJuZXdidXR0b24iKTsKCWJ1dHRvbi5pZCA9IGlkX2l0ZW07CglidXR0b24uaW5uZXJIVE1MID0gdGV4dDsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihidXR0b24sIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihidXR0b24uc3R5bGUsIHN0eWxleik7Cgl9CgoJYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJZnVuYzIoKTsKCX07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlidXR0b24uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKfQoKZnVuY3Rpb24gY19ocihpZF93aGVyZSA9IHBhdGgsIG1hcmdpbiA9IHRydWUsIHN0eWxleiA9IHt9KSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgl2YXIgaHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJociIpOwoJaWYgKG1hcmdpbikKCQloci5zdHlsZS5tYXJnaW5MZWZ0ID0gIi0yMHB4IjsKCWhyLnN0eWxlLmJvcmRlclRvcCA9ICIxcHggc29saWQgdmFyKC0tYy1ocikiOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGhyLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChocik7Cn0KCmZ1bmN0aW9uIGNfYnIoaWRfd2hlcmUgPSBwYXRoLCBhbW91bnQgPSAxKSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cglmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYW1vdW50OyBpbmRleCsrKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwoJfQp9CgpmdW5jdGlvbiBjX2NoZWNrYm94KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSkgewoJY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CglkaXYuY2xhc3NMaXN0LmFkZCgnZWxlbWl0ZW1zX2JnJyk7CglkaXYuaHRtbEZvciA9IGlkX2l0ZW07CgoJY29uc3QgY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJY2hlY2tib3gudHlwZSA9ICJjaGVja2JveCI7CgljaGVja2JveC5pZCA9IGlkX2l0ZW07CgljaGVja2JveC5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKCQl1X3NlcnZlcigpOwoJCWZ1bmMyKGNoZWNrYm94KTsKCX07CgoJY29uc3QgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOwoJbGFiZWwuaHRtbEZvciA9IGlkX2l0ZW07CglsYWJlbC5pbm5lckhUTUwgPSB0ZXh0OwoJbGFiZWwuaWQgPSBpZF9pdGVtICsgInp6enp6IjsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCglkaXYuYXBwZW5kQ2hpbGQoY2hlY2tib3gpOwoJZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgl1X2Jvb2wucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19zX2Zsb2F0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBtaW4sIG1heCwgc3RlcF92YWwsIGRlZmF1bHRfdmFsKSB7Cgl2YXIgc3RlcHZhbF9jZXJvcyA9IChTdHJpbmcoc3RlcF92YWwpLnNwbGl0KCIuIilbMV0gfHwgIiIpOwoJc3RlcHZhbF9jZXJvcyA9IHN0ZXB2YWxfY2Vyb3MubGVuZ3RoOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdmX3NsaWRlcl9iZycpOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1taW4nLCBtaW4pOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoKCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsKCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCBkZWZhdWx0X3ZhbCk7Cgl0aXRsZURpdi50ZXh0Q29udGVudCA9IHRleHQgKyAiOiAiOwoKCWNvbnN0IG51bWJlcl9pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgludW1iZXJfaW5wdXQuY2xhc3NMaXN0LmFkZCgibnVtYmVyc2xpZGVyIik7CgludW1iZXJfaW5wdXQudHlwZSA9ICJudW1iZXIiOwoJbnVtYmVyX2lucHV0LnBhdHRlcm4gPSAiWzAtOV0qIjsKCW51bWJlcl9pbnB1dC5pbnB1dE1vZGUgPSAibnVtZXJpYyI7CgludW1iZXJfaW5wdXQuaWQgPSBpZF9pdGVtOwoJbnVtYmVyX2lucHV0Lm1pbiA9IG1pbjsKCW51bWJlcl9pbnB1dC5tYXggPSBtYXg7CgludW1iZXJfaW5wdXQuc3RlcCA9IHN0ZXBfdmFsOwoJbnVtYmVyX2lucHV0LnZhbHVlID0gZGVmYXVsdF92YWw7CgludW1iZXJfaW5wdXQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsKCQl1X3NlcnZlcigpOwoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7Cgl9OwoKCWNvbnN0IG1pbnVzX2J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJbWludXNfYnRuLmNsYXNzTGlzdC5hZGQoImNvbnRyb2xzLW51bWJlciIpOwoJbWludXNfYnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCW1pbnVzX2J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CgltaW51c19idG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCW1pbnVzX2J0bi5pbm5lckhUTUwgPSAoIiYjODcyMjsiKS50cmltKCk7CgltaW51c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgsIDEsIHN0ZXB2YWxfY2Vyb3MpOwoJCXVfc2VydmVyKCk7CgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCX07CgoJY29uc3QgcGx1c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCXBsdXNfYnRuLmNsYXNzTGlzdC5hZGQoImNvbnRyb2xzLW51bWJlciIpOwoJcGx1c19idG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJcGx1c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJcGx1c19idG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCXBsdXNfYnRuLmlubmVySFRNTCA9ICgiJiM0MzsiKS50cmltKCk7CglwbHVzX2J0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAxLCBtaW4sIG1heCwgMSwgc3RlcHZhbF9jZXJvcyk7CgkJdV9zZXJ2ZXIoKTsKCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJfTsKCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglkaXYuYXBwZW5kQ2hpbGQodGl0bGVEaXYpOwoJZGl2LmFwcGVuZENoaWxkKG1pbnVzX2J0bik7CglkaXYuYXBwZW5kQ2hpbGQobnVtYmVyX2lucHV0KTsKCWRpdi5hcHBlbmRDaGlsZChwbHVzX2J0bik7CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CgoJdV9mbG9hdC5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX2ltZyhpZF93aGVyZSwgaWRfaXRlbSwgaW1hZ2UsIHdpZHRoLCBoZWlnaHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwoKCWltZy5zZXRBdHRyaWJ1dGUoJ2lkJywgaWRfaXRlbSk7CglpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBpbWFnZSk7CglpbWcuc2V0QXR0cmlidXRlKCdhbHQnLCAidV9hdmF0YXIiKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgd2lkdGgpOwoJaW1nLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihpbWcsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWltZy5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihpbWcuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGltZyk7Cn0KCmZ1bmN0aW9uIGNfdGV4dGFyZWEoaWRfd2hlcmUsIGlkX2l0ZW0sIGhpZGRlbiA9IGZhbHNlLCBsYWJlbCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWNvbnN0IHRleHRib3hfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dGJveCIpOwoKCQljb25zdCBsYWJlbEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOwoJCWxhYmVsRWxlbS50ZXh0Q29udGVudCA9IGxhYmVsLnRyaW0oKTsKCQlsYWJlbEVsZW0uaWQgPSBpZF9pdGVtICsgImxibCI7CgkJbGFiZWxFbGVtLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCQlsYWJlbEVsZW0uc2V0QXR0cmlidXRlKCJmb3IiLCBpZF9pdGVtKTsKCgkJaWYgKHN0eWxleiAmJiBzdHlsZXoubGFiZWx6KSB7CgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei5sYWJlbHopOwoJCX0KCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZChsYWJlbEVsZW0pOwoJfQoKCWNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKCgl0ZXh0YXJlYS5pZCA9IGlkX2l0ZW07CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24odGV4dGFyZWEsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCXRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCXRleHRhcmVhLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0YXJlYS5zdHlsZSwgc3R5bGV6KTsKCgkJaWYgKHN0eWxlei50ZXh0Ym94KSB7CgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei50ZXh0Ym94KTsKCQl9Cgl9CgoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKHRleHRhcmVhKTsKCX0gZWxzZSB7CgkJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJaWYgKGxhYmVsID09PSAiIiAmJiBjb250YWluZXIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJfSBlbHNlIGlmIChjb250YWluZXIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGJveF9kaXYpOwoJfQp9CgpmdW5jdGlvbiBjX3RleHRib3goaWRfd2hlcmUsIGlkX2l0ZW0sIGhpZGRlbiA9IGZhbHNlLCBsYWJlbCA9ICIiLCB0b29sdGlwID0gIiIsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSwgZGlzYWJsZXN0eWxlID0gZmFsc2UpIHsKCWNvbnN0IHRleHRib3hfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dGJveCIpOwoKCQljb25zdCBsYWJlbEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOwoJCWxhYmVsRWxlbS50ZXh0Q29udGVudCA9IGxhYmVsLnRyaW0oKTsKCQlsYWJlbEVsZW0uaWQgPSBpZF9pdGVtICsgImxibCI7CgkJbGFiZWxFbGVtLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCQlsYWJlbEVsZW0uc2V0QXR0cmlidXRlKCJmb3IiLCBpZF9pdGVtKTsKCgkJaWYgKHN0eWxleiAmJiBzdHlsZXoubGFiZWx6KSB7CgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei5sYWJlbHopOwoJCX0KCgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQobGFiZWxFbGVtKTsKCX0KCgljb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CglpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoKCWlmIChkaXNhYmxlc3R5bGUpCgkJaW5wdXQuc2V0QXR0cmlidXRlKCdkYXRhLW5vdmFsaWRpbnZhbGlkJywgJycpOwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaW5wdXQuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKQoJfQoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGlucHV0LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlpbnB1dC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKGV2KSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzLCBldik7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpbnB1dC5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oaW5wdXQuc3R5bGUsIHN0eWxleik7CgoJCWlmIChzdHlsZXoudGV4dGJveCkgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoudGV4dGJveCk7CgkJfQoJfQoKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZChpbnB1dCk7Cgl9IGVsc2UgewoJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsKCX0gZWxzZSBpZiAoY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsKCX0KfQoKZnVuY3Rpb24gY190ZXh0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWNvbnN0IHRleHRfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwoJdGV4dF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dCIpOwoKCWlmICh0ZXh0KQoJCXRleHRfZGl2LmlubmVySFRNTCA9IHRleHQudHJpbSgpOwoKCXRleHRfZGl2LmlkID0gaWRfaXRlbTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2RpdiwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJdGV4dF9kaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24odGV4dF9kaXYuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRfZGl2KTsKfQoKZnVuY3Rpb24gY19jb21ib2JveDIoaWRfd2hlcmUsIGlkX2l0ZW0sIG9wdGlvbnMsIGhpZGRlbiA9IGZhbHNlLCB0b29sdGlwID0gIiIsIHN0eWxleiA9IHt9KSB7Cgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCW9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4gewoJCWNvbnN0IG9wdGlvbl9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CgkJb3B0aW9uX2VsZW0udmFsdWUgPSBpbmRleDsKCQlvcHRpb25fZWxlbS50ZXh0ID0gb3B0aW9uOwoJCXNlbGVjdF9lbGVtLmFkZChvcHRpb25fZWxlbSk7Cgl9KTsKCglzZWxlY3RfZWxlbS5zdHlsZS5kaXNwbGF5ID0gKChoaWRkZW4gPT0gdHJ1ZSkgPyAoIm5vbmUiKSA6ICgiaW5saW5lLWJsb2NrIikpOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3RfZWxlbSk7Cn0KCmZ1bmN0aW9uIGNfY29tYm9ib3goaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzYW1lbGluZSA9IGZhbHNlLCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9LCBzdHlsZXogPSB7fSkgewoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCXRleHRfZGl2LmNsYXNzTGlzdC5hZGQoInRleHQiKTsKCXRleHRfZGl2LnRleHRDb250ZW50ID0gdGV4dC50cmltKCk7CgoJY29uc3Qgc2VsZWN0X2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsKCXNlbGVjdF9lbGVtLmNsYXNzTGlzdC5hZGQoInNlbGVjdC1kcm9wZG93biIpOwoJc2VsZWN0X2VsZW0uaWQgPSBpZF9pdGVtOwoKCWlmIChzYW1lbGluZSkKCQlzZWxlY3RfZWxlbS5zdHlsZS5tYXJnaW5SaWdodCA9ICIxMHB4IjsKCglzZWxlY3RfZWxlbS5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWZ1bmMyKCk7Cgl9OwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJc2VsZWN0X2VsZW0uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6KTsKCgkJaWYgKHN0eWxlei50ZXh0X2RpdikgewoJCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXoudGV4dF9kaXYpOwoJCX0KCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsKCgl1X2ludDIucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19zX2ludChpZF93aGVyZSwgaWRfaXRlbSwgaWRfdGV4dCwgbWluLCBtYXgsIHN0ZXAsIHZhbHVlLCB0b29sdGlwID0gIiIpIHsKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAncl9zbGlkZXJfYmcnKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4JywgbWF4KTsKCgljb25zdCB0aXRsZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJdGl0bGVEaXYuY2xhc3NMaXN0LmFkZCgnbF90aXRsZScsICdmX3RpdGxlJyk7Cgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgdmFsdWUpOwoJdGl0bGVEaXYudGV4dENvbnRlbnQgPSBpZF90ZXh0ICsgIjogIjsKCgljb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CgoJY29uc3QgbWludXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCW1pbnVzQnRuLmNsYXNzTmFtZSA9ICJjb250cm9scy1udW1iZXIiOwoJbWludXNCdG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJbWludXNCdG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJbWludXNCdG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCW1pbnVzQnRuLmlubmVySFRNTCA9ICgiJiM4NzIyOyIpLnRyaW0oKTsKCW1pbnVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDAsIG1pbiwgbWF4KTsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWNvbnN0IHBsdXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCXBsdXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7CglwbHVzQnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCXBsdXNCdG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJcGx1c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJcGx1c0J0bi5pbm5lckhUTUwgPSAoIiYjNDM7IikudHJpbSgpOwoJcGx1c0J0bi5vbmNsaWNrID0gKCkgPT4gewoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAxLCBtaW4sIG1heCk7CgkJc19pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQlhcHBseUZpbGwoaW5wdXQpOwoJfTsKCglpbnB1dC5jbGFzc0xpc3QuYWRkKCdzbGlkZXInKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZF9pdGVtKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdyYW5nZScpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCdtaW4nLCBtaW4pOwoJaW5wdXQuc2V0QXR0cmlidXRlKCdtYXgnLCBtYXgpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCdzdGVwJywgc3RlcCk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgdmFsdWUpOwoJaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7CgkJc19pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQlhcHBseUZpbGwoaW5wdXQpOwoJfTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7CglkaXYuYXBwZW5kQ2hpbGQobWludXNCdG4pOwoJZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKCWRpdi5hcHBlbmRDaGlsZChwbHVzQnRuKTsKCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgl1X2ludC5wdXNoKGlkX2l0ZW0pOwp9Cgpjb25zdCBzbGlkZXJQcm9wcyA9IHsKCWJhY2tncm91bmQ6ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMjE0KSIsCn07Cgpjb25zdCBzbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnJfc2xpZGVyX2JnIik7CgpzbGlkZXJzLmZvckVhY2goKHNsaWRlcikgPT4gewoJY29uc3Qgc2xpZGVySW5wdXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLnNsaWRlciIpOwoJY29uc3Qgc2xpZGVyVmFsdWUgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKTsKCglzbGlkZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChldmVudCkgPT4gewoJCXNsaWRlclZhbHVlLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBldmVudC50YXJnZXQudmFsdWUpOwoJCWFwcGx5RmlsbChldmVudC50YXJnZXQpOwoJfSk7CgoJYXBwbHlGaWxsKHNsaWRlcklucHV0KTsKfSk7Cgpjb25zdCBmX3NsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuZl9zbGlkZXJfYmciKTsKCmZfc2xpZGVycy5mb3JFYWNoKGFzeW5jIChzbGlkZXIpID0+IHsKCWNvbnN0IHNsaWRlcklucHV0ID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoIi5udW1iZXJzbGlkZXIiKTsKCWNvbnN0IHNsaWRlclZhbHVlID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoIi5sX3RpdGxlIik7CgoJbGV0IHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHNsaWRlcklucHV0LnN0ZXApLnNwbGl0KCIuIilbMV0gfHwgIiIpOwoKCWFwcGx5RmlsbChzbGlkZXJJbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcy5sZW5ndGgsIHNsaWRlcklucHV0LnZhbHVlKTsKfSk7CgpmdW5jdGlvbiBhcHBseUZpbGwoc2xpZGVyLCBpc19mbHQgPSBmYWxzZSwgZmx0cGFyc2UgPSAxLCB2YWx1ZSkgewoJaWYgKGlzX2ZsdCkgewoJCXNsaWRlci5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoIi5sX3RpdGxlIikuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIHBhcnNlRmxvYXQodmFsdWUpLnRvRml4ZWQoZmx0cGFyc2UpKTsKCQlzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IHNsaWRlclByb3BzLmJhY2tncm91bmQ7CgkJc2xpZGVyLnN0eWxlLmNvbG9yID0gJ3ZhcigtLWMtdGV4dCknOwoJCXNsaWRlci5zdHlsZS5ib3JkZXJSYWRpdXMgPSAiNXB4IjsKCQlzbGlkZXIuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCB2YXIoLS1jLWNvbnRvcm5vcykiOwoJCXJldHVybjsKCX0KCgljb25zdCBwZXJjZW50YWdlID0gKCgxMDAgKiAoc2xpZGVyLnZhbHVlIC0gc2xpZGVyLm1pbikpIC8gKHNsaWRlci5tYXggLSBzbGlkZXIubWluKSkudG9GaXhlZCgxKTsKCWNvbnN0IGJnID0gYGxpbmVhci1ncmFkaWVudCg5MGRlZywgdmFyKC0tYy1wcmltYXJ5KSAwJSwgdmFyKC0tYy1zZWNvbmRhcnkpICR7cGVyY2VudGFnZX0lLCAke3NsaWRlclByb3BzLmJhY2tncm91bmR9ICR7cGVyY2VudGFnZX0lLCAke3NsaWRlclByb3BzLmJhY2tncm91bmR9IDEwMCUpYDsKCXNsaWRlci5zdHlsZS5iYWNrZ3JvdW5kID0gYmc7CglzbGlkZXIucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBzbGlkZXIudmFsdWUpOwp9CgpmdW5jdGlvbiBzdW1yZXN0X2J1dHRvbnMoaXRlbV9pZCwgc3VtLCBtaW4sIG1heCwgaXNfZmx0ID0gMCwgZmx0cGFyc2UgPSAxKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkgPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2coaXRlbV9pZCwgImRvZXNudCBleGlzdCIpOwoJCXJldHVybjsKCX0KCglpZiAoaXNfZmx0KSB7CgkJaWYgKHN1bSkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQl9IGVsc2UgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPCBtaW4pCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgLSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQl9Cgl9CgllbHNlIHsKCQlpZiAoc3VtKSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA+IG1heCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VJbnQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSArIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCk7CgkJfSBlbHNlIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUludChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQl9Cgl9Cn0KCndpbmRvdy5tb2JpbGVDaGVjayA9IGZ1bmN0aW9uICgpIHsKCWxldCBjaGVjayA9IGZhbHNlOwoJKGZ1bmN0aW9uIChhKSB7IGlmICgvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIGNoZWNrID0gdHJ1ZTsgfSkobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7CglyZXR1cm4gY2hlY2s7Cn07Cgp3aW5kb3cuc3RlYW1DaGVjayA9IGZ1bmN0aW9uICgpIHsKCWxldCB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7CglsZXQgaXNTdGVhbUJyb3dzZXIgPSB1c2VyQWdlbnQuaW5kZXhPZigic3RlYW0iKSA+IC0xOwoJcmV0dXJuIGlzU3RlYW1Ccm93c2VyOwp9OwoKaWYgKCF3aW5kb3cubW9iaWxlQ2hlY2soKSkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gInNjYW4gb24gbW9iaWxlIG9yIGVudGVyOiAiICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiBvbiB5b3VyIG1vYmlsZSBicm93c2VyIjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3JjID0gImh0dHBzOi8vY2hhcnQuZ29vZ2xlYXBpcy5jb20vY2hhcnQ/Y2h0PXFyJmNobD0iICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiZjaHM9MjUweDI1MCZjaGxkPUx8MCI7CgoJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQlpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJCXRfcGFuZWwodGhpcywgJ2xlZnRfcGFuZWwnKTsKCQkJdF9wYW5lbCh0aGlzKTsKCQl9CgkJZWxzZSB7CgkJCWlmICh3aW5kb3cuc3RlYW1DaGVjaygpKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMDsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLndpZHRoID0gIjBweCI7CgoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0sIDI1MCk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMDsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsKCgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9LCAyNTApOwoKCQkJCW5vdGlmeSgicGFuZWxzIGRpc2FibGVkIG9uIHN0ZWFtLiIpOwoJCQl9IGVsc2UgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDE7CgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0sIDI1MCk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9LCAyNTApOwoJCQl9CgkJfQoJfTsKfQplbHNlIHsKCWRvY3VtZW50LmJvZHkuc3R5bGUuem9vbSA9ICI3NSUiOwoJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcpOwoJdF9wYW5lbCh0aGlzKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmNvZGVfdGV4dCIpLmlubmVySFRNTCA9ICJvbmx5IG9uIHBjIi50cmltKCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJpbWFnZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7Cn0KCmZ1bmN0aW9uIHN0cmluZzJib29sKHN0cmluZykgewoJc3dpdGNoIChzdHJpbmcudG9Mb3dlckNhc2UoKS50cmltKCkpIHsKCQljYXNlICJ0cnVlIjoKCQljYXNlICJ5ZXMiOgoJCWNhc2UgIjEiOgoJCQlyZXR1cm4gdHJ1ZTsKCQljYXNlICJmYWxzZSI6CgkJY2FzZSAibm8iOgoJCWNhc2UgIjAiOgoJCWNhc2UgbnVsbDoKCQkJcmV0dXJuIGZhbHNlOwoJCWRlZmF1bHQ6CgkJCXJldHVybiBCb29sZWFuKHN0cmluZyk7Cgl9Cn0KCmZ1bmN0aW9uIGdfYm9vbChtb2R1bGUpIHsKCSQuZ2V0KCIvZ19ib29sP2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5jaGVja2VkID0gc3RyaW5nMmJvb2wocmVzcG9uc2VUZXh0KTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJjaGFuZ2UiKSk7CgoJCWlmICghdV9hbF9ib29sLmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCQl1X2FsX2Jvb2wucHVzaChtb2R1bGUpOwoJCX0KCX0pOwp9CgpmdW5jdGlvbiBnX2ludChtb2R1bGUsIHJldHVybmVkID0gdHJ1ZSkgewoJJC5nZXQoIi9nX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSByZXNwb25zZVRleHQ7CgoJCWlmIChtb2R1bGUuaW5jbHVkZXMoInRoZW1lX3NlbGVjdCIpKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsKCQl9CgoJCWlmIChyZXR1cm5lZCkgewoJCQlpZiAoIXVfYWxfaW50LmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoJCQkJdV9hbF9pbnQucHVzaChtb2R1bGUpOwoJCQl9CgoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdfZmxvYXQobW9kdWxlKSB7CgkkLmdldCgiL2dfZmxvYXQ/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQl2YXIgc3RlcHZhbF9jZXJvczIgPSAoU3RyaW5nKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSBwYXJzZUZsb2F0KHJlc3BvbnNlVGV4dCkudG9GaXhlZChzdGVwdmFsX2Nlcm9zMi5sZW5ndGgpOwoJCWlmICghdV9hbF9mbG9hdC5pbmNsdWRlcyhtb2R1bGUpKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoJCQl1X2FsX2Zsb2F0LnB1c2gobW9kdWxlKTsKCQl9CgoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLnZhbHVlOwoJfSk7Cn0KCmZ1bmN0aW9uIHNfYm9vbChtb2R1bGUpIHsKCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpCgkJcmV0dXJuOwoJfQoJdmFyIHZhbHVlID0gbW9kdWxlei5jaGVja2VkOwoKCSQuZ2V0KCIvc19ib29sP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyB9KTsKfQoKZnVuY3Rpb24gc19pbnQyKG1vZHVsZSwgbWluID0gMCwgbWF4ID0gMCkgewoJbGV0IG1vZHVsZXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpOwoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2cobW9kdWxlICsgIiBub3QgZm91bmQiKTsKCQlyZXR1cm47Cgl9CgoJdmFyIHZhbHVlID0gbW9kdWxlei52YWx1ZTsKCglpZiAobWluID09IDAgJiYgbWF4ID09IDApIHsKCQkkLmdldCgiL3NfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQl2YXIgZWxlbWVudEV4aXN0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6Iik7CgkJCWlmIChlbGVtZW50RXhpc3RzICE9IHVuZGVmaW5lZCB8fCBlbGVtZW50RXhpc3RzICE9IG51bGwpCgkJCQllbGVtZW50RXhpc3RzLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsKCQl9KTsKCX0gZWxzZSB7CgkJaWYgKHBhcnNlSW50KHZhbHVlKSA+PSBwYXJzZUludChtaW4pICYmIHBhcnNlSW50KHZhbHVlKSA8PSBwYXJzZUludChtYXgpKSB7CgkJCSQuZ2V0KCIvc19pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQl2YXIgZWxlbWVudEV4aXN0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6Iik7CgkJCQlpZiAoZWxlbWVudEV4aXN0cyAhPSB1bmRlZmluZWQgfHwgZWxlbWVudEV4aXN0cyAhPSBudWxsKQoJCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCQl9KTsKCQl9CgkJZWxzZSB7CgkJCWNvbnNvbGUubG9nKCJtaW5tYXggb3ZlcnBhc3NlZCB8ICIsIHZhbHVlLCBtaW4sIG1heCk7CgkJfQoJfQp9CgpmdW5jdGlvbiBzX2Zsb2F0KG1vZHVsZSkgewoJbGV0IG1vZHVsZXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpOwoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikKCQlyZXR1cm47Cgl9CgoJdmFyIHZhbHVlID0gcGFyc2VGbG9hdChtb2R1bGV6LnZhbHVlKTsKCXZhciBtaW4gPSBwYXJzZUZsb2F0KG1vZHVsZXoubWluKTsKCXZhciBtYXggPSBwYXJzZUZsb2F0KG1vZHVsZXoubWF4KTsKCglpZiAodmFsdWUgPj0gbWluICYmIHZhbHVlIDw9IG1heCkgewoJCSQuZ2V0KCIvc19mbG9hdD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikgIT0gdW5kZWZpbmVkKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKS5pbm5lckhUTUwgPSByZXNwb25zZVRleHQ7CgkJfSk7Cgl9Cn0KCmZ1bmN0aW9uIHNfaW5mbyhtb2R1bGUsIHZhbHVlLCBmdW5jMiA9IGZ1bmN0aW9uICgpIHsgfSkgewoJJC5nZXQoIi9zX2luZm8/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJZnVuYzIoKTsKCX0pOwp9CgpmdW5jdGlvbiBzX2J0bihtb2R1bGUsIHZhbHVlID0gIiIpIHsKCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJaWYgKHZhbHVlID09ICIiKSB7CgkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJcmVqZWN0KGVycm9yKTsKCQkJfSk7CgkJfSBlbHNlIHsKCQkJJC5nZXQoIi90b2dnbGU/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCQlyZWplY3QoZXJyb3IpOwoJCQl9KTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gY19leGl0KCkgewoJc19idG4oImRlYWQiKTsKCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCXdpbmRvdy5vcGVuKCIiLCAiX3NlbGYiLCAiIik7CgkJd2luZG93LmNsb3NlKCk7CgkJaGlzdG9yeS5nbygtMSk7CgkJbmF2aWdhdG9yLmFwcC5iYWNrSGlzdG9yeSgpOwoJCXdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKCX0sIDUwMDApOwp9CgpmdW5jdGlvbiBmX2NvbWJvKGlkX2l0ZW0sIGlkX3NlcnZlcikgewoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaWRfc2VydmVyLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pOwoKCQlpZiAoc2VsZWN0ID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhpZF9pdGVtLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCXZhciByZXNwb25zZSA9IHdpbmRvdy5hdG9iKHJlc3BvbnNlVGV4dCk7CgoJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCXJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSk7CgkJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCQlzZWxlY3QuaW5uZXJIVE1MID0gKCIiKS50cmltKCk7CgoJCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzcG9uc2UpIHsKCQkJCQlpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzcG9uc2UsIGtleSkpIHsKCQkJCQkJY29uc3QgZWxlbWVudCA9IHJlc3BvbnNlW2tleV07CgkJCQkJCXZhciBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCQkJCQkJb3B0LnZhbHVlID0ga2V5OwoJCQkJCQlvcHQuaW5uZXJIVE1MID0gZWxlbWVudFsiaWQiXTsKCQkJCQkJc2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfSk7Cn0KCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBmdW5jdGlvbiAoZikgewoJaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkgewoJCXRfcGFuZWwodGhpcywgJ2xlZnRfcGFuZWwnLCAxKTsKCQl0X3BhbmVsKHRoaXMsICdyaWdodF9wYW5lbCcsIDEpOwoJfQoJZWxzZSB7CgkJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcsIDIpOwoJCXRfcGFuZWwodGhpcywgJ3JpZ2h0X3BhbmVsJywgMik7Cgl9Cn0pOwoKYXN5bmMgZnVuY3Rpb24gdF9wYW5lbChidG4sIGlkID0gInJpZ2h0X3BhbmVsIiwgdHlwZSA9IDApIHsKCWNvbnN0IHBhbmVsX2VsbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCWlmICh0eXBlID09IDApIHsKCQlpZiAocGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgIT0gIm5vbmUiKSB7CgkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOwoJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gIjBweCI7CgkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjAiOwoJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCXBhbmVsX2VsbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl9LCAyNTApOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIHsKCQkJcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMjUwKTsKCgkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICJhdXRvIjsKCQkJcGFuZWxfZWxtLnN0eWxlLmhlaWdodCA9ICJhdXRvIjsKCQkJcGFuZWxfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMSI7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJfQoKCQl9Cgl9CgllbHNlIHsKCQlpZiAocGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgIT0gIm5vbmUiICYmIHR5cGUgPT0gMSkgewoJCQlwYW5lbF9lbG0uc3R5bGUud2lkdGggPSAiMHB4IjsKCQkJcGFuZWxfZWxtLnN0eWxlLmhlaWdodCA9ICIwcHgiOwoJCQlwYW5lbF9lbG0uc3R5bGUub3BhY2l0eSA9ICIwIjsKCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJfSwgMjUwKTsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSBpZiAodHlwZSA9PSAyICYmIHBhbmVsX2VsbS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikgewoJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCWF3YWl0IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4geyB9LCAyNTApOwoKCQkJcGFuZWxfZWxtLnN0eWxlLndpZHRoID0gImF1dG8iOwoJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwoJCQlwYW5lbF9lbG0uc3R5bGUub3BhY2l0eSA9ICIxIjsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQl9CgoJCX0KCX0KfQoKdmFyIHpub3RpZmljYXRpb25JZCA9IDAsIG5vdGlmaWNhdGlvbkNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNub3RpZmljYXRpb24tY29udGFpbmVyIik7CmZ1bmN0aW9uIG5vdGlmeShhLCBiLCBkKSB7IGIgPSB2b2lkIDAgPT09IGIgPyAyNTAwIDogYjsgZCA9ICsrem5vdGlmaWNhdGlvbklkOyB2YXIgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOyBjLmNsYXNzTGlzdC5hZGQoIm5vdGlmaWNhdGlvbiIpOyBjLmlubmVySFRNTCA9ICgiPHA+IiArIGEgKyAiPC9wPjxidXR0b24gY2xhc3M9J2Nsb3NlLWJ1dHRvbicgZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBkICsgIic+JnRpbWVzOzwvYnV0dG9uPiIpLnRyaW0oKTsgYy5zdHlsZS53aWR0aCA9ICJhdXRvIjsgbm90aWZpY2F0aW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKGMpOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5yZW1vdmUoKSB9LCA0NTApIH0sIGIpOyAoYSA9IGMucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9Cm5vdGlmaWNhdGlvbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChhKSB7IGlmIChhLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImNsb3NlLWJ1dHRvbiIpKSB7IHZhciBiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtbm90aWZpY2F0aW9uLWlkPSciICsgYS50YXJnZXQuZGF0YXNldC5ub3RpZmljYXRpb25JZCArICInXSIpLnBhcmVudEVsZW1lbnQ7IGIuc3R5bGUub3BhY2l0eSA9ICIwIjsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGIucmVtb3ZlKCkgfSwgMjUwKTsgKGEgPSBiLnByZXZpb3VzU2libGluZykgJiYgYS5zdHlsZSAmJiAoYS5zdHlsZS5tYXJnaW5Ub3AgPSAiNnB4IikgfSB9KTs=";
eval(atob(test));
