var A = "Ly8gQHRzLW5vY2hlY2sKCnZhciBkZWZhdWx0X2F2YXRhciA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvQ29sYUNhcHJpY2hvc2EvRlBXTFIvbG9nYXJkby5wbmciOwp2YXIgYWxsb3dfYXUgPSB0cnVlOwp2YXIgaGFzX2FsaWFzID0gZmFsc2U7CgpmdW5jdGlvbiBjX3RoZW1lKCkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuYm9keTsKCWNvbnN0IHRoZW1lX3NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aGVtZV9zZWxlY3QnKTsKCWNvbnN0IHNlbGVjdGVkID0gdGhlbWVfc2VsZWN0LnZhbHVlOwoJY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS10aGVtZScsIHNlbGVjdGVkKTsKCglzX2ludDIoJ3RoZW1lX3NlbGVjdCcpOwp9CgpmdW5jdGlvbiBnX3RtX2koKSB7IHJldHVybiBNYXRoLnJvdW5kKCtuZXcgRGF0ZSgpIC8gMTAwMCk7IH0KCmNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKdG9vbHRpcC5jbGFzc0xpc3QuYWRkKCJ0b29sdGlwIik7CnRvb2x0aXAuaWQgPSAid210b29sdGlwIjsKZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0b29sdGlwKTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3ZlciIsIGZ1bmN0aW9uIChldmVudCkgewoJY29uc3QgZWxlbWVudCA9IGV2ZW50LnRhcmdldDsKCWNvbnN0IHRvb2x0aXBNZXNzYWdlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIpOwoJaWYgKHRvb2x0aXBNZXNzYWdlKSB7CgkJdG9vbHRpcC5pbm5lclRleHQgPSB0b29sdGlwTWVzc2FnZTsKCQl0b29sdGlwLnN0eWxlLnRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wIC0gdG9vbHRpcC5vZmZzZXRIZWlnaHQgLSA4ICsgInB4IjsKCQl0b29sdGlwLnN0eWxlLmxlZnQgPSBlbGVtZW50Lm9mZnNldExlZnQgKyAoZWxlbWVudC5vZmZzZXRXaWR0aCAtIHRvb2x0aXAub2Zmc2V0V2lkdGgpIC8gMiArICJweCI7CgkJdG9vbHRpcC5jbGFzc0xpc3QuYWRkKCJ0b29sdGlwLS12aXNpYmxlIik7Cgl9Cn0pOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7Cgljb25zdCB0b29sdGlwTWVzc2FnZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiKTsKCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCXRvb2x0aXAuaW5uZXJUZXh0ID0gKCItIikudHJpbSgpOwoJCXRvb2x0aXAuY2xhc3NMaXN0LnJlbW92ZSgidG9vbHRpcC0tdmlzaWJsZSIpOwoJfQp9KTsKCi8qYWxyZWFkeSBkaXNwYXRjaGVkIGlkcyovCnZhciB1X2FsX2Jvb2wgPSBbXTsKdmFyIHVfYWxfZmxvYXQgPSBbXTsKdmFyIHVfYWxfaW50ID0gW107Cgp2YXIgdV9ib29sID0gW107CnZhciB1X2Zsb2F0ID0gW107CnZhciB1X2ludCA9IFtdOwp2YXIgdV9pbnQyID0gWyJ0aGVtZV9zZWxlY3QiXTsKCnBhdGggPSAicGFuZWxfY2hhdCI7CgpjX3RleHQocGF0aCwgImNoYXRib3h0eHQiLCAiY2hhdCIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAp9KTsKCmNfZGl2KHBhdGgsICJjaGF0LWNvbnRhaW5lciIsIHsKCXdpZHRoOiAiMjMwcHgiLAoJaGVpZ2h0OiAiMzE1cHgiLAoJbWF4SGVpZ2h0OiAiMzE1cHgiLAoJb3ZlcmZsb3dZOiAiYXV0byIsCglwYWRkaW5nOiAiMTBweCIsCgliYWNrZ3JvdW5kQ29sb3I6ICd2YXIoLS1jLXNlY29uZGFyeSknLAp9KTsKCmNfYnIoKTsKCmZ1bmN0aW9uIHNlbmRfY2hhdCgpIHsKCWlmICghaGFzX2FsaWFzKSB7CgkJbm90aWZ5KCJkaXNhYmxlZCB0byBkZWZhdWx0IHVzZXJzIiwgNzAwMCk7CgkJcmV0dXJuOwoJfQoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsaWRpdHkudmFsaWQpIHsKCQljb25zdCBjaGF0X3RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsdWU7CgkJc19idG4oInNlbmRfY2hhdCIsIGNoYXRfdGV4dCkKCQkJLnRoZW4oYXN5bmMgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmICghcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJkb25lIikpCgkJCQkJcmV0dXJuOwoKCQkJCWF3YWl0IHNsZWVwKDM1MCk7CgkJCQl1X2NoYXQoKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZSA9ICIiOwoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZSA9ICIiOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDEgYSA2NCBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0KCmNfdGV4dGJveChwYXRoLCAiY2hhdF90ZXh0IiwgZmFsc2UsICIiLCAiIiwge30sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOSBdKiQiLAoJbWluTGVuZ3RoOiAxLAoJbWF4TGVuZ3RoOiA2NCwKCXJlcXVpcmVkOiB0cnVlLAoJcGxhY2Vob2xkZXI6ICJ3cml0ZSIsCglldmVudExpc3RlbmVyOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQlpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CgkJCQlzZW5kX2NoYXQoKTsKCQkJfQoJCX0KCX0KfSwgdHJ1ZSk7CgpjX2J0bihwYXRoLCAiYnRuX3NlbmRfY2hhdCIsICJzZW5kIiwgZnVuY3Rpb24gKCkgewoJc2VuZF9jaGF0KCk7Cn0sICJFbnZpYSB1biBtZW5zYWplIGFsIGNoYXQsIHVuYSB2ZXogY2FkYSAzMCBzZWd1bmRvcy4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3RleHQocGF0aCwgInVzZXJzb25saW5lIiwgImRpc2FibGVkIG9ubGluZXMiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxMHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CgpmdW5jdGlvbiBnX29ubGluZXMoKSB7CglpZiAoIWhhc19hbGlhcykgcmV0dXJuOwoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQoJCXJldHVybjsKCglnYXRoZXIoIm9ubGluZXMiLCAienoiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJdHJ5IHsKCQkJCWNvbnN0IGxpdmVzID0gSlNPTi5wYXJzZShyZXN1bHQpOwoJCQkJY29uc3Qgb25saW5lc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJzb25saW5lJyk7CgkJCQlvbmxpbmVzZWwuaW5uZXJIVE1MID0gIjxwIGRhdGEtdHRpcD0ndG90YWw6ICIgKyBsaXZlcy5hbGxfb25saW5lcyArICInIHN0eWxlPSdmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNHB4O21hcmdpbi1ib3R0b206MHB4O21hcmdpbi10b3A6MHB4Oyc+b25saW5lcyAoIiArIGxpdmVzLmxpdmUubGVuZ3RoICsgIik8L3A+PGJyPiIgKyBsaXZlcy5saXZlLmpvaW4oIiwgIik7CgkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQljb25zb2xlLmxvZyhlcnJvciwgcmVzdWx0KTsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKZ19vbmxpbmVzKCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19idG4ocGF0aCwgIm9wZW5kbGdmaW5kdXNlciIsICJzZWFyY2ggdXNlciIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZHVzZXJkbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIkJ1c2NhIHVuIHVzdWFyaW8uIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSk7CgpjX2JyKCk7CgpjX2RpYWxvZyhwYXRoLCAiZmluZHVzZXJkbGciKTsKcGF0aCA9ICJmaW5kdXNlcmRsZyI7CgpjX3RleHQocGF0aCwgInVzZXJmaW5kdHh0IiwgInNlYXJjaCB1c2VyIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKCmNfYnIocGF0aCk7CgpjX3RleHRib3gocGF0aCwgImZpbmRfdXNlciIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiAzLAoJbWF4TGVuZ3RoOiAyMCwKCXJlcXVpcmVkOiB0cnVlLAoJcGxhY2Vob2xkZXI6ICJhbGlhcyIsCglldmVudExpc3RlbmVyOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQlpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnRuX2ZpbmRfdXNlciIpLmNsaWNrKCk7CgkJCX0KCQl9Cgl9Cn0sIHRydWUpOwoKY29uc3Qgcm9sZWNsciA9IHsgIm5vcm1hbCI6ICIjNjA2MDYwIiwgInByZW1pdW0iOiAiIzhiYjBmZiIsICJjaGFkIjogIiNmZmU1OGIiLCAiR09EIjogIiNmMTRjMzkiLCAiUEFQSSI6ICIjY2U5OGUyIiB9Owp2YXIgZnVfY29vbGRvd24gPSAwOwoKY19idG4ocGF0aCwgImJ0bl9maW5kX3VzZXIiLCAiZmluZCIsIGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZF91c2VyIikudmFsaWRpdHkudmFsaWQpCgkJaWYgKGZ1X2Nvb2xkb3duID4gZ190bV9pKCkpIHsKCQkJbm90aWZ5KCJyZWNlbnRseSB1c2VkLCB3YWl0ICIgKyAoZnVfY29vbGRvd24gLSBnX3RtX2koKSkgKyAiIHNlY29uZHMiLCA3MDAwKTsKCQkJcmV0dXJuOwoJCX0KCWdhdGhlcigiaW5mb19hbGlhcyIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kX3VzZXIiKS52YWx1ZSkKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCXRyeSB7CgkJCQl2YXIgdV9pbmYgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgoJCQkJaWYgKHVfaW5mWyJhdmF0YXIiXSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2dHIiKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQkJfQoKCQkJCXZhciB1c2VyX2RhdGEgPSAiIjsKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4Oyc+PHN0cm9uZz5AIiArIHVfaW5mWyJhbGlhcyJdOwoKCQkJCWlmICh1X2luZlsicm9sZSJdKQoJCQkJCXVzZXJfZGF0YSArPSAiPHNwYW4gc3R5bGU9J2Rpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOiIgKyByb2xlY2xyW3VfaW5mWyJyb2xlIl0udG9Mb3dlckNhc2UoKV0gKyAiOyc+ICgiICsgdV9pbmZbInJvbGUiXSArICIpPC9zcGFuPjxicj48L3N0cm9uZz48L3A+IjsKCgkJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPnVpZDogIiArIHVfaW5mWyJ1c2VyX2lkIl07CgkJCQllbHNlCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz5iZXRhIjsKCgkJCQlpZiAodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSkKCQkJCQl1c2VyX2RhdGEgKz0gIiAtIGpvaW5lZDogIiArIGdfdG1fZHQodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSwgMCkgKyAiPC9wPiI7CgkJCQllbHNlCgkJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsKCgkJCQlpZiAodV9pbmZbImRlc2NyaXB0aW9uIl0pCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTJweDttYXJnaW4tdG9wOiAwcHg7Jz5ubyBpbmZvPC9wPiIKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmYiKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQlub3RpZnkocmVzdWx0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQlpZiAocmVzdWx0LmluY2x1ZGVzKCJyZWNlbnRseSIpKSB7CgkJCQkJaWYgKGZ1X2Nvb2xkb3duIDwgZ190bV9pKCkpCgkJCQkJCWZ1X2Nvb2xkb3duID0gZ190bV9pKCkgKyAzMDsKCQkJCX0KCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImNsb3NlZmluZHVzZXIiLCAiY2xvc2UiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmR1c2VyZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfZGl2KHBhdGgsICJ1c2VyX2luZmFsaWFzIiwgewoJZGlzcGxheTogImlubGluZS1ncmlkIiwKCWdyaWRUZW1wbGF0ZUNvbHVtbnM6ICJyZXBlYXQoMywgMTA1cHgpIiwKCWdyaWRHYXA6ICIxMHB4Igp9KTsKCmNfYnIocGF0aCwgMik7CgpjX2ltZygidXNlcl9pbmZhbGlhcyIsICJ1c2VyX2F2dHIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLAoJewoJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQlvYmplY3RGaXQ6ICJjb3ZlciIsCgkJYm9yZGVyUmFkaXVzOiAiNXB4IiwKCQlwbGFjZVNlbGY6ICJub3JtYWwiCgl9KTsKCmNfYnIocGF0aCwgMik7CgpjX3RleHQoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9pbmYiLCAibm9uZSIsIHsKCWRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiwKCWNvbG9yOiAid2hpdGUiCn0pOwoKdmFyIGxhc3RfbXNnID0gMDsKdmFyIGZpcnN0X3NuZCA9IDA7CgpmdW5jdGlvbiBwX3NvdW5kKGlkKSB7CglpZiAoZmlyc3Rfc25kID09IDApIHsKCQlmaXJzdF9zbmQrKzsKCX0KCWVsc2UgewoJCXZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJCWVsZW1lbnQudm9sdW1lID0gMC4xOwoJCWVsZW1lbnQucGxheSgpOwoJfQp9CgpmdW5jdGlvbiB1X2NoYXQoKSB7CglpZiAoIWhhc19hbGlhcykgewoJCWNvbnN0IGNoYXRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdC1jb250YWluZXInKTsKCQljaGF0Q29udGFpbmVyLmlubmVySFRNTCA9ICcnOwoJCWNvbnN0IGNoYXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJY2hhdEVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CgkJY2hhdEVsZW1lbnQuaW5uZXJIVE1MID0gYCg8c3BhbiBkYXRhLXR0aXA9JyR7Z190bV9kdChwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApLCAwKX0nIHN0eWxlPSJvcGFjaXR5OiAwLjU7Ij4ke2dfdG1fZHQocGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSl9PC9zcGFuPikgPHNwYW4gc3R5bGU9JyR7KCJjb2xvcjoiICsgKE9iamVjdC5lbnRyaWVzKHJvbGVjbHIpWzRdWyIxIl0pICsgIjsiKX0nPjxzdHJvbmc+WklOQzwvc3Ryb25nPjwvc3Bhbj46IGNoYXQgZGlzYWJsZWQgdG8gZGVmYXVsdCBhbGlhc2VzLCBjaGFuZ2UgeW91ciBhbGlhcyBpbiB0aGUgcmlnaHQgcGFuZWxgOwoJCWNoYXRDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hhdEVsZW1lbnQpOwoJCXJldHVybjsKCX0KCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQlyZXR1cm47CgoJZ2F0aGVyKCJnZXRfY2hhdCIsICJ6IikKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCWNvbnN0IGNoYXRzID0gSlNPTi5wYXJzZShyZXN1bHQpOwoJCQljb25zdCBjaGF0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtY29udGFpbmVyJyk7CgkJCWNoYXRDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CgoJCQlsZXQgaGlnaGVzdF90cyA9IDA7CgkJCWNoYXRzLmZvckVhY2goYXN5bmMgKGNoYXQpID0+IHsKCgkJCQlpZiAoIWNoYXQubXNnLmluY2x1ZGVzKCJkaXNhYmxlZCIpKQoJCQkJCWlmIChoaWdoZXN0X3RzIDwgY2hhdC50cykKCQkJCQkJaGlnaGVzdF90cyA9IGNoYXQudHM7CgoJCQkJY29uc3QgY2hhdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCWNoYXRFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gIjEycHgiOwoKCQkJCWlmICghY2hhdC5tc2cuaW5jbHVkZXMoImRpc2FibGVkIikpCgkJCQkJY2hhdEVsZW1lbnQuaW5uZXJIVE1MID0gYCg8c3BhbiBkYXRhLXR0aXA9JyR7Z190bV9kdChjaGF0LnRzLCAwKX0nIHN0eWxlPSJvcGFjaXR5OiAwLjU7Ij4ke2dfdG1fZHQoY2hhdC50cyl9PC9zcGFuPikgPHNwYW4gc3R5bGU9JyR7Y2hhdC5yICE9IHVuZGVmaW5lZCA/ICgiY29sb3I6IiArIChPYmplY3QuZW50cmllcyhyb2xlY2xyKVtjaGF0LnJdWyIxIl0pICsgIjsiKSA6ICIifSc+PHN0cm9uZz4ke2NoYXQudX08L3N0cm9uZz48L3NwYW4+OiAke3dpbmRvdy5hdG9iKGNoYXQubXNnKX1gOwoJCQkJZWxzZQoJCQkJCWNoYXRFbGVtZW50LmlubmVySFRNTCA9IGAoPHNwYW4gZGF0YS10dGlwPScke2dfdG1fZHQoY2hhdC50cywgMCl9JyBzdHlsZT0ib3BhY2l0eTogMC41OyI+JHtnX3RtX2R0KGNoYXQudHMpfTwvc3Bhbj4pIDxzcGFuIHN0eWxlPScke2NoYXQuciAhPSB1bmRlZmluZWQgPyAoImNvbG9yOiIgKyAoT2JqZWN0LmVudHJpZXMocm9sZWNscilbY2hhdC5yXVsiMSJdKSArICI7IikgOiAiIn0nPjxzdHJvbmc+JHtjaGF0LnV9PC9zdHJvbmc+PC9zcGFuPjogJHtjaGF0Lm1zZ31gOwoKCQkJCWNoYXRDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hhdEVsZW1lbnQpOwoKCQkJCWNfaHIoImNoYXQtY29udGFpbmVyIiwgZmFsc2UsIHsKCQkJCQlvcGFjaXR5OiAiMC4yIiwKCQkJCQlwYWRkaW5nVG9wOiAiMHB4IiwKCQkJCQlwYWRkaW5nQm90dG9tOiAiMHB4IiwKCQkJCX0pOwoJCQl9KTsKCgkJCWlmIChsYXN0X21zZyAhPSBoaWdoZXN0X3RzKSB7CgkJCQlwX3NvdW5kKCJzbmQxIik7CgkJCQlsYXN0X21zZyA9IGhpZ2hlc3RfdHM7CgkJCX0KCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0KCnVfY2hhdCgpOwoKdmFyIHBhdGggPSAibWFpbl9lbGVtZW50cyI7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGl0bGVfaWQiKS5pbm5lclRleHQgPSAiWklOQyI7CgpjX3RhYl9idXR0b24oImVsZW1lbnRfcmlnaHRfYnV0dG9ucyIsIFsKCXsgaWQ6ICJwX3VwZGF0ZXMiLCB0ZXh0OiAibG9ncyIgfSwKCXsgaWQ6ICJwX3RpY2tldHMiLCB0ZXh0OiAidGlja2V0cyIgfSwKCXsgaWQ6ICJwX3Byb2ZpbGUiLCB0ZXh0OiAicHJvZmlsZSIgfQpdLCAyKTsKCi8qU1RBUlQgRkVBVFVSRVMqLwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZHVjdF9pZCIpLmlubmVyVGV4dCA9ICJjb2xvcmJvdCI7CgpjX3RhYl9idXR0b24oImVsZW1lbnRfYnV0dG9ucyIsIFsKCXsgaWQ6ICJtYWluX3RhYiIsIHRleHQ6ICJtYWluIiB9LAoJeyBpZDogInFyY29kZV90YWIiLCB0ZXh0OiAiUVIiIH0sCgl7IGlkOiAic2V0dGluZ3NfdGFiIiwgdGV4dDogImNmZyIgfSwKXSk7CgpjX2NvbWJvYm94KHBhdGgsICJhbGxfcHJvZmlsZXMiLCAiIiwgMCwgMjAsIHRydWUsICIiLCBhc3luYyBmdW5jdGlvbiAoZWwpIHsKCWF3YWl0IHNsZWVwKDUwMCk7CglyX2luZm8oKTsKCWF3YWl0IHNsZWVwKDUwMCk7Cgl1X3NsaWRlcnMoKTsKfSwgeyBtaW5XaWR0aDogIjE4MHB4IiwgbWFyZ2luUmlnaHQ6ICItMTgwcHgiLCBwb3NpdGlvbjogJ3JlbGF0aXZlJywgdG9wOiAnLTY4cHgnLCBsZWZ0OiAnMTAycHgnIH0pOwoKY19jaGVja2JveChwYXRoLCAiY29sb3Jib3QiLCAiZW5hYmxlZCIsICJBY3RpdmEgZWwgZnVuY2lvbmFtaWVudG8gZGVsIGNvbG9yYm90LiIpOwpjX2NoZWNrYm94KHBhdGgsICJkaW5hbWljX3Ntb290aCIsICJkaW5hbWljIHNtb290aCIsICJBbCBhY3RpdmFybG8sIGJsb3F1ZWEgZWwgc21vb3RoIHByaW5jaXBhbC4iKTsKLy9jX2NoZWNrYm94KHBhdGgsICJtYXNrX2Zvcm1hdCIsICJtYXNrIGZvcm1hdCIsICJBbCBlc3RhciBhY3RpdmFkbywgdXRpbGl6YSBlbCBtYXNrIHRocmVhZCAoZGVqYW5kbyBpbmhhYmlsaXRhZG8gZWwgc2ltcGxlIGZvcm1hdCkiKTsKLy9jX2NoZWNrYm94KHBhdGgsICJzaW1wbGVfZm9ybWF0IiwgInNpbXBsZSBmb3JtYXQiLCAiQWwgZXN0YXIgYWN0aXZhZG8sIHV0aWxpemEgdW4gdGhyZWFkIGxpbXBpbyBzaW4gb3BjaW9uZXMgZGUgZGVidWcsIGV0Yy4iKTsKCmNfY29tYm9ib3gocGF0aCwgIm1haW5fa2V5IiwgIm1haW4ga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBwcmluY2lwYWwgY29uIGxhIGN1YWwgc2UgYWN0aXZhIGVsIGFpbS4iKTsKY19jb21ib2JveChwYXRoLCAic2Vjb25kYXJ5X2tleSIsICJzZWNvbmRhcnkga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBzZWN1bmRhcmlhIGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBhaW0uIik7CmNfY29tYm9ib3gocGF0aCwgImRpc2FibGVfc2Vjb25kYXJ5X2tleSIsICJkaXNhYmxlIGtleSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJMYSBLZXkgY29uIGxhIGN1YWwgc2UgZGVzYWN0aXZhIGVsIGFpbS4iKTsKCmNfY29tYm9ib3gocGF0aCwgInR5cGVfZm9ybWF0IiwgImZvcm1hdCIsIDAsIDMsIGZhbHNlLCAiRGlzdGludG9zIG1ldG9kb3MgcGFyYSBlc2NhbmVhci9wcm9jZXNhciBsb3MgY29sb3Jlcy4iKTsKY19jb21ib2JveChwYXRoLCAiZGluYW1pY19zbW9vdGhfdHlwZSIsICJkaW5hbWljIHNtb290aCB0eXBlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkFjb21vZGEgZWwgc21vb3RoIGRpbmFtaWNhbWVudGUgZGVwZW5kaWVuZG8gbGEgZGlzdGFuY2lhIGRlbCBlbmVtaWdvIik7CmNfY29tYm9ib3gocGF0aCwgImNvbG9yX3R5cGUiLCAiY29sb3JzIiwgMCwgNCwgZmFsc2UsICJFbCBjb2xvciBzZWxlY2Npb25hZG8gZXMgZW4gZWwgY3VhbCBzZSBiYXNhcmEgZWwgYWltYm90Iik7CmNfY29tYm9ib3gocGF0aCwgInNvcnRfbWV0aG9kIiwgIm1ldGhvZHMiLCAwLCA4LCBmYWxzZSwgIkRpc3RpbnRvcyBtZXRvZG9zIHBhcmEgcXVlIGVsIGFpbWJvdCBhcHVudGUsIHNlIHJlY29taWVuZGEgZWwgQkVTVC4iKTsKCmNfc19pbnQocGF0aCwgJ3RhcmdldF9vZmZzZXRfeCcsICJvZmZzZXQgWCIsIDAsIDUwLCAxLCAwKTsKY19zX2ludChwYXRoLCAidGFyZ2V0X29mZnNldF95IiwgIm9mZnNldCBZIiwgMCwgNTAsIDEsIDUpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfc19mbG9hdChwYXRoLCAic3BlZWQiLCAic21vb3RoIiwgMC4wLCA2LjAsIDAuMSwgMi4wKTsKY19zX2ludChwYXRoLCAiZm92X3giLCAiRm92IFgiLCA1LCA1MDAsIDUsIDUwKTsKY19zX2ludChwYXRoLCAiZm92X3kiLCAiRm92IFkiLCA1LCAyNTAsIDUsIDUwKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2NoZWNrYm94KHBhdGgsICJyZWNvaWwiLCAicmVjb2lsIiwgIkJhamFyYSBlbCBjcm9zc2hhaXIgYSBsYSBob3JhIGRlIGRpc3BhcmFyIGNvbiBsYSBNQUlOIGtleS4iKTsKY19jaGVja2JveChwYXRoLCAicmNzX2Nyb3VjaF9vbmx5IiwgImNyb3VjaCBvbmx5IiwgIlNvbG8gZnVuY2lvbmFyYSBzaSBlc3RhbW9zIGFwcmV0YW5kbyBDVFJMIik7CmNfc19pbnQocGF0aCwgInJlY29pbF9kZWxheSIsICJkZWxheSIsIDUsIDUwMCwgNSwgMjAwKTsKY19zX2ludChwYXRoLCAicmVjb2lsX3N0cmVuZ2h0IiwgInN0cmVuZ2h0IiwgMSwgNTAsIDEsIDIpOwpjX3NfaW50KHBhdGgsICJtYXhfcmVjb2lsX29mZnNldCIsICJtYXggb2Zmc2V0IiwgMSwgNTAsIDEsIDIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfY2hlY2tib3gocGF0aCwgInRyaWdnZXJib3QiLCAidHJpZ2dlcmJvdCIsICJEaXNwYXJhcmEgYXV0b21hdGljYW1lbnRlIGN1YW5kbyBlbCBDT0xPUiBwYXNlIHBvciBlbCBjcm9zc2hhaXIuIik7CmNfY2hlY2tib3gocGF0aCwgImRpc2FibGVfYWltX29uX3RyaWdnZXIiLCAiZGlzYWJsZSBhaW0iLCAiRGVzaGFiaWxpdGEgZWwgYWltIGN1YW5kbyBlc3RhIHByZXNpb25hZG8gZWwgdHJpZ2dlciIpOwpjX2NvbWJvYm94KHBhdGgsICJ0cmlnZ2VyX3R5cGUiLCAidHlwZSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UpOwpjX2NvbWJvYm94KHBhdGgsICJ0cmlnZ2VyX2tleSIsICJ0cmlnZ2VyIGtleSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJMYSBLZXkgY29uIGxhIGN1YWwgc2UgYWN0aXZhIGVsIFRSSUdHRVIuIik7CmNfc19pbnQocGF0aCwgInRyaWdnZXJfcmFkaXVzIiwgImZvdiIsIDEsIDUwLCAxLCAxNSk7CmNfc19pbnQocGF0aCwgInRyaWdnZXJfZGVsYXkiLCAiZGVsYXkiLCA1LCA1NTAsIDUsIDI1MCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19jaGVja2JveChwYXRoLCAiYmhvcF90b2dnbGUiLCAiYmhvcCIsICJBbCBhY3RpdmFybG8sIGRlYmVzIGJpbmRlYXIgbGEga2V5IFhCdXR0b24yIG8gTW91c2U1IGFsIGJob3AgZW4gdmV6IGRlbCBlc3BhY2lvLiIpOwpjX3NfaW50KHBhdGgsICJiaG9wX2RlbGF5IiwgImJob3AgZGVsYXkiLCA1LCAyMDAsIDUsIDIwMCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19zX2ludChwYXRoLCAiY3VzdG9tX3NsZWVwIiwgInNsZWVwIiwgMSwgMjAwLCAxLCAyMDApOwoKY19zX2ludChwYXRoLCAiYWNjZXB0YWJsZV9hcmVhIiwgImFjY2VwdGFibGUgYXJlYSIsIDUsIDIwMCwgNSwgMjAwKTsKCi8qZGVwcmVjYXRlZApwYXRoID0gInNldHRpbmdfZWxlbWVudHMiOwpjX2NoZWNrYm94KHBhdGgsICJkZWJ1Z193aW5kb3ciLCAiZGVidWcgd2luZG93Iik7CmNfY2hlY2tib3gocGF0aCwgImNpcmNsZXMiLCAiZGVidWcgY2lyY2xlcyIpOwpjX2NoZWNrYm94KHBhdGgsICJjZW50ZXJfY29sb3JzIiwgImRlYnVnIGNvbG9ycyIpOwpjX2NoZWNrYm94KHBhdGgsICJtYXNrX3dpbmRvdyIsICJkZWJ1ZyBtYXNrIik7Ki8KCmZfY29tYm8oInRyaWdnZXJfdHlwZSIsICJ0cmlnZ2VyX3R5cGUiKTsKZl9jb21ibygiZGluYW1pY19zbW9vdGhfdHlwZSIsICJkaW5hbWljX3Ntb290aF90eXBlIik7CmZfY29tYm8oImNvbG9yX3R5cGUiLCAiY29sb3JzIik7CmZfY29tYm8oInNvcnRfbWV0aG9kIiwgIm1ldGhvZHMiKTsKZl9jb21ibygidHlwZV9mb3JtYXQiLCAiZm9ybWF0cyIpOwoKY29uc3QgYmluZF9lbGVtZW50cyA9IFsKCXsgaWQ6ICJtYWluX2tleSIsIHRhcmdldDogIm1haW5fa2V5IiB9LAoJeyBpZDogInNlY29uZGFyeV9rZXkiLCB0YXJnZXQ6ICJzZWNvbmRhcnlfa2V5IiB9LAoJeyBpZDogInRyaWdnZXJfa2V5IiwgdGFyZ2V0OiAidHJpZ2dlcl9rZXkiIH0sCgl7IGlkOiAiZGlzYWJsZV9zZWNvbmRhcnlfa2V5IiwgdGFyZ2V0OiAiZGlzYWJsZV9zZWNvbmRhcnlfa2V5IiB9LApdOwoKLypFTkQgRkVBVFVSRVMqLwoKZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOwpmX2NvbWJvKCJhbGxfcHJvZmlsZXMyIiwgImFsbF9wcm9maWxlcyIpOwoKcGF0aCA9ICJlbGVtZW50c19jZmdiIjsKCmNfY2hlY2tib3gocGF0aCwgImF1dG9fdXBkYXRlX21lbnUiLCAiQXV0by11cGRhdGUgbWVudSIsICJTZSBhY3R1YWxpemFyYSBsYSBwYWdpbmEgYXV0b21hdGljYW1lbnRlIGNhZGEgNSBzZWd1bmRvcyBlbiBjYXNvIGRlIHF1ZSBoYXlhIGNhbWJpb3MgZGVzZGUgb3RyYSBwYWdpbmEuIiwgZnVuY3Rpb24gKGVsKSB7CglhbGxvd19hdSA9IGVsLmNoZWNrZWQ7Cn0pOwoKY19ocigpOwpjX3RleHQocGF0aCwgInJuZCIsICImIzk2Nzk7IGNsb3VkIHByb2ZpbGVzIiwgeyBmb250U2l6ZTogIjE4cHgiLCBmb250V2VpZ2h0OiAiYm9sZCIsIG1hcmdpbkxlZnQ6ICIyMHB4IiB9KTsKCnZhciBzaG93X3ByX2MgPSBmYWxzZTsKY19idG4ocGF0aCwgImJ0bl9zdl9wcm9maWxlIiwgImNyZWF0ZSBwcm9maWxlIiwgZnVuY3Rpb24gKGNfZWwpIHsKCWlmICghc2hvd19wcl9jKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNwcm9maWxlbmFtZSIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1X3Byb2ZpbGVfbGlzdCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJc2hvd19wcl9jID0gdHJ1ZTsKCQlyZXR1cm47Cgl9CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjcHJvZmlsZW5hbWUiKS52YWxpZGl0eS52YWxpZCkgewoJCXZhciB0aWNrZXRfaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjcHJvZmlsZW5hbWUiKS52YWx1ZTsKCQl2YXIgdGlja2V0X3JlYXNvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjcHJvZmlsZW5hbWUiKS52YWx1ZTsKCgkJc19idG4oInNhdmVfcHJvZmlsZSIsIHRpY2tldF9yZWFzb24gKyAiLSIgKyB0aWNrZXRfaW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoIk5vIHNlIGFjZXB0YW4gY2FyYWN0ZXJlcyBlc3BlY2lhbGVzLCBkZSAxIGEgMjAgY2FyYWN0ZXJlcyBzb2xhbWVudGUuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiR3VhcmRhIHR1IHBlcmZpbCBhY3R1YWwgZW4gZWwgc2Vydmlkb3IsIGVsIGN1YWwgcHVlZGVzIGNhcmdhciIsIHsgbWFyZ2luUmlnaHQ6ICI1cHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2xpc3QiLCAicHJvZmlsZSBsaXN0IiwgZnVuY3Rpb24gKCkgewoJaWYgKHNob3dfcHJfYykgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjcHJvZmlsZW5hbWUiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1X3Byb2ZpbGVfbGlzdCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCXNob3dfcHJfYyA9IGZhbHNlOwoJfQoKCXNfYnRuKCJwcm9maWxlX2xpc3QiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJdHJ5IHsKCQkJCWNvbnNvbGUubG9nKHJlc3BvbnNlVGV4dCk7CgkJCQl2YXIgcmVzanNvbiA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKCgkJCQlpZiAocmVzanNvbi5sZW5ndGggPT0gMCkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1X3Byb2ZpbGVfbGlzdCIpLmlubmVySFRNTCA9ICJubyBwcm9maWxlcyI7CgkJCQkJbm90aWZ5KCJ1c2VyIGhhcyBubyBwcm9maWxlcyIsIDcwMDApOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQl2YXIgdG9fdGlja2V0cyA9ICIiOwoJCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzanNvbikgewoJCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNqc29uLCBrZXkpKSB7CgkJCQkJCWNvbnN0IGVsZW1lbnQgPSByZXNqc29uW2tleV07CgkJCQkJCXRvX3RpY2tldHMgKz0gIjwvdHI+IjsKCQkJCQkJdG9fdGlja2V0cyArPSAiPHRkPiIgKyBrZXkgKyAiPC90ZD4iOwoJCQkJCQl0b190aWNrZXRzICs9ICI8dGQ+IiArIGdfdG1fZHQoZWxlbWVudFsidGltZXN0YW1wIl0sIDIpICsgIjwvdGQ+IjsKCQkJCQkJdG9fdGlja2V0cyArPSAiPHRkPiIgKyAiPGJ1dHRvbiBjbGFzcz0nbmV3YnV0dG9uJyBzdHlsZT0naGVpZ2h0OjMwcHg7d2lkdGg6YXV0bztkaXNwbGF5OmlubGluZS1ibG9jazsnIG9uY2xpY2s9XCJzX2J0bignZ2V0X3Byb2ZpbGUnLCAnIiArIGtleSArICInKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICcgJyksIDcwMDApO3JfaW5mbygpO2ZfY29tYm8oJ2FsbF9wcm9maWxlcycsICdhbGxfcHJvZmlsZXMnKTtmX2NvbWJvKCdhbGxfcHJvZmlsZXMyJywgJ2FsbF9wcm9maWxlcycpO30pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge2NvbnNvbGUuZXJyb3IoZXJyb3IpO30pO1wiPnNlbGVjdDwvYnV0dG9uPiIgKyAiPC90ZD4iOwoJCQkJCQl0b190aWNrZXRzICs9ICI8L3RyPiI7CgkJCQkJfQoJCQkJfQoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1X3Byb2ZpbGVfbGlzdCIpLmlubmVySFRNTCA9IGA8YnI+CgkJCQk8dHI+CgkJCQk8dGg+bmFtZTwvdGg+CgkJCQk8dGg+bGFzdCBzYXZlZDwvdGg+CgkJCQk8dGg+b3B0aW9uczwvdGg+CgkJCQk8L3RyPgoJCQkJYDsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1X3Byb2ZpbGVfbGlzdCIpLmlubmVySFRNTCArPSB0b190aWNrZXRzOwoJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJY29uc29sZS5sb2coZXJyb3IpOwoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiXyIpKSB7CgkJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfSwgIk11ZXN0cmEgdHVzIHBlcmZpbGVzIGNyZWFkb3MiKTsKCmNfdGV4dGJveChwYXRoLCAiY3Byb2ZpbGVuYW1lIiwgdHJ1ZSwgIiIsICJwcm9maWxlIG5hbWUiLCB7CglyZXNpemU6ICdub25lJywKCW92ZXJmbG93OiAnaGlkZGVuJywKCXdoaXRlU3BhY2U6ICdwcmUtd3JhcCcsCgltYXJnaW5Ub3A6ICI1cHgiLAp9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiAxLAoJbWF4TGVuZ3RoOiAyMCwKCXBsYWNlaG9sZGVyOiAibmFtZSIsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX3RhYmxlKHBhdGgsICJ1X3Byb2ZpbGVfbGlzdCIpOwoKY19ocigpOwoKY190ZXh0KHBhdGgsICJybmQiLCAiJiM5Njc5OyBsb2NhbCBwcm9maWxlcyIsIHsgZm9udFNpemU6ICIxOHB4IiwgZm9udFdlaWdodDogImJvbGQiLCBtYXJnaW5MZWZ0OiAiMjBweCIgfSk7CgpjX2NvbWJvYm94KHBhdGgsICJhbGxfcHJvZmlsZXMyIiwgInByb2ZpbGUiLCAwLCAyMCwgZmFsc2UsICJQZXJmaWxlcyBwYXJhIGNhZGEgc2l0dWFjaW9uLiIsIGFzeW5jIGZ1bmN0aW9uIChlbCkgewoJYXdhaXQgc2xlZXAoNTAwKTsKCXJfaW5mbygpOwoJYXdhaXQgc2xlZXAoNTAwKTsKCXVfc2xpZGVycygpOwp9LCB7IG1pbldpZHRoOiAiMTgwcHgiIH0pOwoKY190ZXh0Ym94KHBhdGgsICJwcm9maWxlX25hbWVfYyIsIGZhbHNlLCAiIiwgIjQtMTYgY2hhcmFjdGVycy4iLCB7IG1hcmdpbkxlZnQ6ICI1cHgiLCB3aWR0aDogIjE1MHB4IiB9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiA0LAoJbWF4TGVuZ3RoOiA5LAoJcmVxdWlyZWQ6IGZhbHNlLAp9LCB0cnVlKTsKCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9jaGFuZ2UiLCAiY2hhbmdlIG5hbWUiLCBmdW5jdGlvbiAoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgcHJvZl92YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9maWxlX25hbWVfYyIpLnZhbHVlOwoJCXNfaW5mbygicHJvZmlsZV9uYW1lIiwgcHJvZl92YWx1ZSk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsdWUgPSAiIjsKCQlyX2luZm8oKTsKCQlmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CgkJZl9jb21ibygiYWxsX3Byb2ZpbGVzMiIsICJhbGxfcHJvZmlsZXMiKTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBlc3BhY2lvcyBvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICJDYW1iaWEgZWwgbm9tYnJlIGRlbCBwcm9maWxlIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2V4cG9ydCIsICJleHBvcnQgcHJvZmlsZSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCJleHBvcnRfcHJvZmlsZSIpOwp9LCAiRXhwb3J0YSBlbCBwZXJmaWwgYWN0dWFsIGFsIENMSVBCT0FSRC4iLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfaW1wb3J0IiwgImltcG9ydCBwcm9maWxlIiwgZnVuY3Rpb24gKCkgewoJc19idG4oImltcG9ydF9wcm9maWxlIik7CglyX2luZm8oKTsKCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCWZfY29tYm8oImFsbF9wcm9maWxlczIiLCAiYWxsX3Byb2ZpbGVzIik7Cn0sICJJbXBvcnRhIHVuIHBlcmZpbCBkZXNkZSBlbCBDTElQQk9BUkQuIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2ltcG9ydCIsICJzZXQgZGVmYXVsdCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZnJfc2V0ZGVmYXVsdCcpLnNob3dNb2RhbCgpCn0sICJEZXZ1ZWx2ZSBlbCBwZXJmaWwgYSB2YWxvcmVzIGRlZmF1bHQsIHRhbWJpZW4gZWwgbm9tYnJlLiIpOwoKY19kaWFsb2cocGF0aCwgJ2Nmcl9zZXRkZWZhdWx0Jyk7CmNfdGV4dCgnY2ZyX3NldGRlZmF1bHQnLCAiY2ZyZGxnZGVmYXVsdHByIiwgIllvdSBhcmUgYWJvdXQgdG8gc2V0IHRoZSBjdXJyZW50PGJyPnByb2ZpbGUgYXMgZGVmYXVsdCIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CmNfYnRuKCdjZnJfc2V0ZGVmYXVsdCcsICJybmQiLCAiQ09ORklSTSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCdkZWZhdWx0X3Byb2ZpbGUnKTsKCXJfaW5mbygpOwoJZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOwoJZl9jb21ibygiYWxsX3Byb2ZpbGVzMiIsICJhbGxfcHJvZmlsZXMiKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZnJfc2V0ZGVmYXVsdCIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCmNfYnRuKCdjZnJfc2V0ZGVmYXVsdCcsICJybmQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNmcl9zZXRkZWZhdWx0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCgpjX2hyKCk7CgpjX3RleHQocGF0aCwgInJuZCIsICImIzk2Nzk7IGxvY2FsIGNvbmZpZyIsIHsgZm9udFNpemU6ICIxOHB4IiwgZm9udFdlaWdodDogImJvbGQiLCBtYXJnaW5MZWZ0OiAiMjBweCIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9sb2FkY2ZnJyk7CmNfdGV4dCgnY29uZmlybV9sb2FkY2ZnJywgImNvbmZpcm1kbGdsb2FkY2ZnIiwgIllvdSBhcmUgYWJvdXQgdG8gbG9hZCB5b3VyIGxvY2FsIENGRyIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CmNfYnRuKCdjb25maXJtX2xvYWRjZmcnLCAiY29uZmlybWxvYWRjZmciLCAiQ09ORklSTSIsIGFzeW5jIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCdsb2FkX2MnKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2xvYWRjZmciKS5jbG9zZSgpOwoJYXdhaXQgc2xlZXAoNTAwKTsKCXJfaW5mbygpOwoJZl9jb21ibygnYWxsX3Byb2ZpbGVzJywgJ2FsbF9wcm9maWxlcycpOwoJZl9jb21ibygnYWxsX3Byb2ZpbGVzMicsICdhbGxfcHJvZmlsZXMnKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1fbG9hZGNmZycsICJjYW5jZWxfbG9hZGNmZyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9sb2FkY2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX3NhdmVjZmcnKTsKCmNfdGV4dCgnY29uZmlybV9zYXZlY2ZnJywgImNvbmZpcm1kbGdzYXZlY2ZnIiwgIllvdSBhcmUgYWJvdXQgdG8gc2F2ZSB5b3VyIGxvY2FsIENGRyIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CgpjX2J0bignY29uZmlybV9zYXZlY2ZnJywgImNvbmZpcm1zYXZlY2ZnIiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CglzX2J0bignc2F2ZV9jJyk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9zYXZlY2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1fc2F2ZWNmZycsICJjYW5jZWxfc2F2ZWNmZyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9zYXZlY2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9pbXBvcnRjZmcnKTsKY190ZXh0KCdjb25maXJtX2ltcG9ydGNmZycsICJjb25maXJtZGxnaW1wY2ZnIiwgIllvdSBhcmUgYWJvdXQgdG8gSU1QT1JUIGFub3RoZXIgQ0ZHIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsIGNvbG9yOiAid2hpdGUiCn0pOwpjX2J0bignY29uZmlybV9pbXBvcnRjZmcnLCAiY29uZmlybWltcG9ydGNmZyIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJc19idG4oJ2ltcG9ydF9jJykKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2ltcG9ydGNmZyIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCmNfYnRuKCdjb25maXJtX2ltcG9ydGNmZycsICJjYW5jZWxfaW1wb3J0Y2ZnIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2ltcG9ydGNmZyIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leHBvcnRjZmcnKTsKY190ZXh0KCdjb25maXJtX2V4cG9ydGNmZycsICJjb25maXJtZGxnZXhwY2ZnIiwgIllvdSBhcmUgYWJvdXQgdG8gRVhQT1JUIHRoZSBlbnRpcmUgbG9jYWwgQ0ZHLDxicj4gd2hpY2ggaW5jbHVkZSBhbGwgeW91ciBwcm9maWxlcyIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLCBjb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2NvbmZpcm1fZXhwb3J0Y2ZnJywgImNvbmZpcm1leHBvcnRjZmciLCAiQ09ORklSTSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCdleHBvcnRfYycpCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leHBvcnRjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgpjX2J0bignY29uZmlybV9leHBvcnRjZmcnLCAiY2FuY2VsX2V4cG9ydGNmZyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leHBvcnRjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19kaWFsb2coJ2VsZW1lbnRfY29uZmlnJywgJ2NvbmZpcm1fZXhpdCcpOwpjX3RleHQoJ2NvbmZpcm1fZXhpdCcsICJjb25maXJtZGxnZXhpdCIsICJZb3UgYXJlIGFib3V0IHRvIGV4aXQiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwgY29sb3I6ICJ3aGl0ZSIKfSk7CmNfYnRuKCdjb25maXJtX2V4aXQnLCAiY29uZmlybWV4aXQiLCAiQ09ORklSTSIsIGZ1bmN0aW9uICgpIHsKCWNfZXhpdCgpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1fZXhpdCIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCmNfYnRuKCdjb25maXJtX2V4aXQnLCAiY2FuY2VsX2V4aXQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1fZXhpdCIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpwYXRoID0gInBhbmVsX3RpY2tldHMiOwoKY190ZXh0KHBhdGgsICJ0aWNrZXRjZW50ZXIiLCAiVGlja2V0IENlbnRlciIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAp9KTsKCnZhciB0aWNrZXRfZmFxX3N0ID0gewoJdGV4dEFsaWduOiAnY2VudGVyJywKCWZvbnRTaXplOiAnMTRweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKfQoKY190ZXh0KHBhdGgsICJ0Y2t0ZmFxIiwgIi0gRG8gbm90IHNwYW0gdGhlIHRpY2tldCBzeXN0ZW0uPGJyPi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgaGF2ZSBhbiBpc3N1ZS48YnI+LSBPbmx5IGNyZWF0ZSB0aWNrZXRzIGlmIHlvdSBoYXZlIGEgZmVhdHVyZSByZXF1ZXN0Ljxicj4iLCB0aWNrZXRfZmFxX3N0KTsKY190ZXh0KHBhdGgsICJ0Y2t0ZmFxIiwgIi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgbmVlZCA8dT5oZWxwPC91Pi48YnI+LSBBbGwgdGlja2V0cyBhcmUgPHU+cHJpdmF0ZTwvdT4uPGJyPi0gRG8gbm90IHBvc3QgaXJyZWxldmFudCBjb21tZW50cyBpbiB0aWNrZXRzIG9yIHlvdSBtYXkgYmUgPHU+YmFubmVkPC91Pi4iLCB0aWNrZXRfZmFxX3N0KTsKCmNfY29tYm9ib3gyKHBhdGgsICJ0aWNrZXRfYmVoYXZpb3IiLCBbIkJ1ZyIsICJGZWF0dXJlIiwgIk90aGVyIl0sIHRydWUsICJTZWxlY2Npb25hIHVuYSByYXpvbiBkZWwgdGlja2V0LiIpOwoKY190ZXh0YXJlYShwYXRoLCAidGlja2V0X2NvbnRlbnQiLCB0cnVlLCAiIiwgewoJaGVpZ2h0OiAnMTAwcHgnLAoJcmVzaXplOiAnbm9uZScsCglvdmVyZmxvdzogJ2hpZGRlbicsCgl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJbWFyZ2luVG9wOiAiNXB4IiwKfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJHs1fSIsCgltaW5MZW5ndGg6IDUsCgltYXhMZW5ndGg6IDI1NiwKCXBsYWNlaG9sZGVyOiAiaW5mbyIsCglyZXF1aXJlZDogdHJ1ZSwKfSk7Cgp2YXIgc2hvd190aWNrZXRfYyA9IGZhbHNlOwpjX2J0bihwYXRoLCAiYnRuX2NyZWF0ZV90aWNrZXQiLCAiY3JlYXRlIHRpY2tldCIsIGZ1bmN0aW9uICgpIHsKCWlmICghc2hvd190aWNrZXRfYykgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2JlaGF2aW9yIikuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCXNob3dfdGlja2V0X2MgPSB0cnVlOwoJCXJldHVybjsKCX0KCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50IikudmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgdGlja2V0X2luZm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS52YWx1ZTsKCQl2YXIgdGlja2V0X3JlYXNvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS52YWx1ZTsKCgkJc19idG4oImNyZWF0ZV90aWNrZXQiLCB0aWNrZXRfcmVhc29uICsgIi0iICsgdGlja2V0X2luZm8pCgkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGNhcmFjdGVyZXMgZXNwZWNpYWxlcywgZGUgNSBhIDI1NiBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICJDcmVhIHVuIHRpY2tldCBlbCBjdWFsIHNlcmEgYXRlbmRpZG8vdmlzdG8gcG9yIGxvcyBhZG1pbmlzdHJhZG9yZXMuIik7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwpjX2J0bihwYXRoLCAiYnRuX2dldF90aWNrZXRzIiwgInZpZXcgdGlja2V0cyIsIGZ1bmN0aW9uICgpIHsKCWlmIChzaG93X3RpY2tldF9jKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50Iikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2JlaGF2aW9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQlzaG93X3RpY2tldF9jID0gZmFsc2U7Cgl9CgoJc19idG4oImdldF90aWNrZXRzIikKCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCWlmIChyZXNwb25zZVRleHQuc3BsaXQoIl8iKS5sZW5ndGggLSAxID4gMikgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQl2YXIgcmVzanNvbiA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKCgkJCWlmIChyZXNqc29uLmxlbmd0aCA9PSAwKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gIm5vIHRpY2tldHMiOwoJCQkJbm90aWZ5KCJ1c2VyIGhhcyBubyB0aWNrZXRzIiwgNzAwMCk7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX3RpY2tldHMiKS5pbm5lckhUTUwgPSAibm8gdGlja2V0cyI7CgoJCQl2YXIgdG9fdGlja2V0cyA9ICIiOwoJCQlmb3IgKGNvbnN0IGtleSBpbiByZXNqc29uKSB7CgkJCQlpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzanNvbiwga2V5KSkgewoJCQkJCWNvbnN0IGVsZW1lbnQgPSByZXNqc29uW2tleV07CgkJCQkJdG9fdGlja2V0cyArPSAiPHN0cm9uZz48dT4iICsgZWxlbWVudFsicmVhc29uIl0gKyAiIFsiICsgZWxlbWVudFsiaWQiXSArICJdPC91PiB8IDxidXR0b24gY2xhc3M9J25ld2J1dHRvbicgZGF0YS10dGlwPSdEZWxldGUgdGlja2V0JyBzdHlsZT0naGVpZ2h0OjMwcHg7d2lkdGg6YXV0bztkaXNwbGF5OmlubGluZS1ibG9jaztjb2xvcjpyZWQ7JyBvbmNsaWNrPVwic19idG4oJ2RlbGV0ZV90aWNrZXQnLCAnIiArIGVsZW1lbnRbImlkIl0gKyAiJykudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IG5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAnICcpLCA3MDAwKTt9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtjb25zb2xlLmVycm9yKGVycm9yKTt9KTtcIj4mdGltZXM7PC9idXR0b24+PC9zdHJvbmc+PGJyPiI7CgkJCQkJdG9fdGlja2V0cyArPSAiPHA+IiArIGVsZW1lbnRbImNvbnRlbnQiXSArICI8L3A+IjsKCQkJCQl0b190aWNrZXRzICs9ICI8YnI+PGJyPiI7CgkJCQl9CgkJCX0KCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX3RpY2tldHMiKS5pbm5lckhUTUwgPSB0b190aWNrZXRzOwoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfSwgIk11ZXN0cmEgdHVzIHRpY2tldHMgY3JlYWRvcyIpOwoKY190ZXh0KHBhdGgsICJ1c2VyX3RpY2tldHMiLCAiIiwgeyB0ZXh0QWxpZ246ICJjZW50ZXIiIH0pOwoKY19icihwYXRoKTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoKY190ZXh0KHBhdGgsICJtYWluX3BmX3RleHQiLCAiUHJvZmlsZSIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCglmb250V2VpZ2h0OiAnYm9sZCcsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzIwcHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICcwcHgnCn0pOwoKY19kaXYocGF0aCwgInVzZXJpbmZvIiwgewoJZGlzcGxheTogImlubGluZS1ncmlkIiwKCWdyaWRUZW1wbGF0ZUNvbHVtbnM6ICJyZXBlYXQoMywgMWZyKSIsCglncmlkR2FwOiAiMTBweCIKfSk7CgpwYXRoID0gInVzZXJpbmZvIjsKY19pbWcocGF0aCwgInVzZXJfYXZhdGFyIiwgZGVmYXVsdF9hdmF0YXIsIDkwLCA5MCwKCXsKCQlqdXN0aWZ5U2VsZjogInN0YXJ0IiwKCQltYXJnaW5MZWZ0OiAiMTBweCIsCgkJb2JqZWN0Rml0OiAiY292ZXIiLAoJCWJvcmRlclJhZGl1czogIjVweCIKCX0pOwoKY190ZXh0KHBhdGgsICJ1c2VyX2luZm8iLCAibm9uZSIsIHsgZGlzcGxheTogImdyaWQiLCBncmlkVGVtcGxhdGVDb2x1bW5zOiAiMTYwcHgiLCBtYXJnaW5Ub3A6ICIwcHgiIH0pOwoKZnVuY3Rpb24gb3duX2luZm8oKSB7CglnYXRoZXIoImdldF91c2VyX2luZm8iLCAieiIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQlsZXQgdV9pbmYgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgoJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9hdmF0YXIiKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfcHJldmlldyIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCX0KCgkJCXZhciB1c2VyX2RhdGEgPSAiIjsKCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07CgoJCQlpZiAoIXVfaW5mWyJhbGlhcyJdLmluY2x1ZGVzKCJaVXNlciIpKQoJCQkJaGFzX2FsaWFzID0gdHJ1ZTsKCgkJCWlmICh1X2luZlsicm9sZSJdKQoJCQkJdXNlcl9kYXRhICs9ICI8c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmU7Zm9udC1zaXplOjEwcHg7Y29sb3I6IiArIHJvbGVjbHJbdV9pbmZbInJvbGUiXS50b0xvd2VyQ2FzZSgpXSArICI7Jz4gKCIgKyB1X2luZlsicm9sZSJdICsgIik8L3NwYW4+PGJyPjwvc3Ryb25nPjwvcD4iOwoKCQkJaWYgKHVfaW5mWyJ1c2VyX2lkIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPnVpZDogIiArIHVfaW5mWyJ1c2VyX2lkIl07CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+YmV0YSI7CgoJCQlpZiAodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSkKCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCAwKSArICI8L3A+IjsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsKCgkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPmluZm86ICIgKyB3aW5kb3cuYXRvYih1X2luZlsiZGVzY3JpcHRpb24iXSkgKyAiPC9wPiI7CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPHA+PC9wPiIKCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2luZm8iKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9Cgpvd25faW5mbygpOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2FsaWFzIiwgImNoYW5nZSBhbGlhcyIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJQZXJtaXRlIGNhbWJpYXIgZWwgYWxpYXMgMSB2ZXogY2FkYSAzMCBkaWFzLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiYWxpYXNfZGxnIiwge30sIHt9KTsKcGF0aCA9ICJhbGlhc19kbGciOwoKY190ZXh0Ym94KHBhdGgsICJwZl9hbGlhc190ZXh0Ym94IiwgZmFsc2UsICIiLCAiIiwgewoJbWFyZ2luVG9wOiAiNXB4IiwKfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCW1pbkxlbmd0aDogMywKCW1heExlbmd0aDogMjAsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiYnRuX2NoYW5nZV9hbGlhcyIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYWxpYXNfdGV4dGJveCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgdHh0aW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCQlzX2J0bigiY2hhbmdlX2FsaWFzIiwgdHh0aW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlvd25faW5mbygpOwoJCQkJCWhhc19hbGlhcyA9IHRydWU7CgkJCQl9CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJjYW5jZWxfYWxpYXMiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbGlhc19kbGciKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2F2dHIiLCAiY2hhbmdlIGF2YXRhciIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIkNhbWJpYSBlbCBhdmF0YXIgYSB1bmEgaW1hZ2VuLCBzb2xvIFVSTFMuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCmNfZGlhbG9nKHBhdGgsICJhdnRyX2RsZyIpOwpwYXRoID0gImF2dHJfZGxnIjsKCmNfaW1nKHBhdGgsICJhdnRyX3ByZXZpZXciLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLCB7CglkaXNwbGF5OiAiYmxvY2siLAoJbWFyZ2luOiAiMCBhdXRvIiwKCW9iamVjdEZpdDogImNvdmVyIgp9KTsKCmNfYnIoKTsKCmNfdGV4dChwYXRoLCAiIiwgIkltZ3VyIFVSTCBvbmx5LCBleGFtcGxlLiIsIHsKCXRleHRBbGlnbjogImNlbnRlciIsCgljb2xvcjogIndoaXRlIgp9KTsKY190ZXh0KHBhdGgsICIiLCAiaHR0cHM6Ly9pLmltZ3VyLmNvbS9HbkphRVpMLnBuZyIsIHsKCXRleHRBbGlnbjogImNlbnRlciIsCgljb2xvcjogIndoaXRlIgp9KTsKCmNfdGV4dGJveChwYXRoLCAicGZfYXZhdGFyX3RleHRib3giLCBmYWxzZSwgIiIsICIxMCBhIDEzMCBjYXJhY3RlcmVzLiBFdml0YXIgdXNhciBVUkwncyBkZSBnaWZzL3ZpZGVvcy4iLCB7CgltYXJnaW5Ub3A6ICI1cHgiLAoJd2lkdGg6ICI5NSUiCn0sIHsKCXBhdHRlcm46ICJeKGh0dHBzPzpcL1wvKT8oaVwuaW1ndXJcLmNvbVwvKShbYS16QS1aMC05XSspKFwuanBnfFwuanBlZ3xcLnBuZykkIiwKCW1pbkxlbmd0aDogMjAsCgltYXhMZW5ndGg6IDQwLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImJ0bl9wcmV2aWV3X2F2YXRhciIsICJwcmV2aWV3IiwgZnVuY3Rpb24gKCkgewoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2F2YXRhcl90ZXh0Ym94Iik7CgoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSBlbGVtX2l0ZW0udmFsdWU7Cgl9CgllbHNlIHsKCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2JyKCk7CmNfaHIocGF0aCwgZmFsc2UpOwoKY19idG4ocGF0aCwgImJ0bl9jaGFuZ2VfYXZhdGFyIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwZl9hdmF0YXJfdGV4dGJveCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgdHh0aW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCQlzX2J0bignY2hhbmdlX2F2YXRhcicsIHR4dGluZm8pCgkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJjaGFuZ2VkIikgJiYgIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygid2FpdCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfcHJldmlldyIpLnNyYyA9IHR4dGluZm87CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gdHh0aW5mbzsKCgkJCQkJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOwoJCQkJCWRpYWxvZy5jbG9zZSgpOwoJCQkJfQoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiY2FuY2VsX2F2dHIiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfYnRuKHBhdGgsICJvcGVuZGxnZGVzYyIsICJjaGFuZ2UgZGVzY3JpcHRpb24iLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NfZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJDYW1iaWEgbGEgZGVzY3JpcGNpb24gZGUgdHUgcGVyZmlsLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiZGVzY19kbGciKTsKcGF0aCA9ICJkZXNjX2RsZyI7CgpjX3RleHRhcmVhKHBhdGgsICJkZXNjcmlwdGlvbl9jb250ZW50IiwgZmFsc2UsICIiLCB7CgloZWlnaHQ6ICcxMDBweCcsCglyZXNpemU6ICdub25lJywKCW92ZXJmbG93OiAnaGlkZGVuJywKCXdoaXRlU3BhY2U6ICdwcmUtd3JhcCcsCgltYXJnaW5Ub3A6ICI1cHgiLAoJanVzdGlmeVNlbGY6ICJjZW50ZXIiLAoJdGV4dGJveDogewoJCWRpc3BsYXk6ICJpbmhlcml0IgoJfQp9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokIiwKCW1pbkxlbmd0aDogNCwKCW1heExlbmd0aDogMjU2LAoJcGxhY2Vob2xkZXI6ICJkZXNjcmlwdGlvbiIsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiYnRuX2NoYW5nZV9kZXNjcmlwdGlvbiIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY3JpcHRpb25fY29udGVudCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgZGVzY19pbmZvID0gZWxlbV9pdGVtLnZhbHVlOwoKCQlzX2J0bigiY2hhbmdlX2Rlc2NyaXB0aW9uIiwgZGVzY19pbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgewoJCQkJCW93bl9pbmZvKCk7CgkJCQl9CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJjYW5jZWxfZGVzYyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NfZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNvbnN0IHZpcnR1YWxLZXlzID0gW107Cgpmb3IgKGxldCBpID0gMHg0MTsgaSA8PSAweDVBOyBpKyspIHsKCXZpcnR1YWxLZXlzLnB1c2goeyBjb2RlOiBpLCBuYW1lOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpIH0pOwp9Cgpmb3IgKGxldCBpID0gMHgzMDsgaSA8PSAweDM5OyBpKyspIHsKCXZpcnR1YWxLZXlzLnB1c2goeyBjb2RlOiBpLCBuYW1lOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpIH0pOwp9Cgpjb25zdCBzcGVjaWFsS2V5cyA9IFsKCXsgY29kZTogMCwgbmFtZTogJ05PTkUnIH0sCgl7IGNvZGU6IDB4MDgsIG5hbWU6ICdCYWNrc3BhY2UnIH0sCgl7IGNvZGU6IDB4MDksIG5hbWU6ICdUYWInIH0sCgl7IGNvZGU6IDB4MEQsIG5hbWU6ICdFbnRlcicgfSwKCXsgY29kZTogMHgxMCwgbmFtZTogJ1NoaWZ0JyB9LAoJeyBjb2RlOiAweDExLCBuYW1lOiAnQ3RybCcgfSwKCXsgY29kZTogMHgxMiwgbmFtZTogJ0FsdCcgfSwKCXsgY29kZTogMHhBNCwgbmFtZTogJ0xlZnQgQWx0JyB9LAoJeyBjb2RlOiAweEE1LCBuYW1lOiAnUmlnaHQgQWx0JyB9LAoJeyBjb2RlOiAweDEzLCBuYW1lOiAnUGF1c2UvQnJlYWsnIH0sCgl7IGNvZGU6IDB4NUIsIG5hbWU6ICdMZWZ0IFdpbmRvd3MnIH0sCgl7IGNvZGU6IDB4NUMsIG5hbWU6ICdSaWdodCBXaW5kb3dzJyB9LAoJeyBjb2RlOiAweDVELCBuYW1lOiAnQXBwbGljYXRpb25zJyB9LAoJeyBjb2RlOiAweDYwLCBuYW1lOiAnTnVtUGFkIDAnIH0sCgl7IGNvZGU6IDB4NjEsIG5hbWU6ICdOdW1QYWQgMScgfSwKCXsgY29kZTogMHg2MiwgbmFtZTogJ051bVBhZCAyJyB9LAoJeyBjb2RlOiAweDYzLCBuYW1lOiAnTnVtUGFkIDMnIH0sCgl7IGNvZGU6IDB4NjQsIG5hbWU6ICdOdW1QYWQgNCcgfSwKCXsgY29kZTogMHg2NSwgbmFtZTogJ051bVBhZCA1JyB9LAoJeyBjb2RlOiAweDY2LCBuYW1lOiAnTnVtUGFkIDYnIH0sCgl7IGNvZGU6IDB4NjcsIG5hbWU6ICdOdW1QYWQgNycgfSwKCXsgY29kZTogMHg2OCwgbmFtZTogJ051bVBhZCA4JyB9LAoJeyBjb2RlOiAweDY5LCBuYW1lOiAnTnVtUGFkIDknIH0sCgl7IGNvZGU6IDB4NzAsIG5hbWU6ICdGMScgfSwKCXsgY29kZTogMHg3MSwgbmFtZTogJ0YyJyB9LAoJeyBjb2RlOiAweDcyLCBuYW1lOiAnRjMnIH0sCgl7IGNvZGU6IDB4NzMsIG5hbWU6ICdGNCcgfSwKCXsgY29kZTogMHg3NCwgbmFtZTogJ0Y1JyB9LAoJeyBjb2RlOiAweDc1LCBuYW1lOiAnRjYnIH0sCgl7IGNvZGU6IDB4NzYsIG5hbWU6ICdGNycgfSwKCXsgY29kZTogMHg3NywgbmFtZTogJ0Y4JyB9LAoJeyBjb2RlOiAweDc4LCBuYW1lOiAnRjknIH0sCgl7IGNvZGU6IDB4NzksIG5hbWU6ICdGMTAnIH0sCgl7IGNvZGU6IDB4N0EsIG5hbWU6ICdGMTEnIH0sCgl7IGNvZGU6IDB4N0IsIG5hbWU6ICdGMTInIH0sCgl7IGNvZGU6IDB4MDEsIG5hbWU6ICdMQlVUVE9OJyB9LAoJeyBjb2RlOiAweDAyLCBuYW1lOiAnUkJVVFRPTicgfSwKCXsgY29kZTogMHgwNCwgbmFtZTogJ01CVVRUT04nIH0sCgl7IGNvZGU6IDB4MDUsIG5hbWU6ICdYQlVUVE9OMScgfSwKCXsgY29kZTogMHgwNiwgbmFtZTogJ1hCVVRUT04yJyB9LAoJeyBjb2RlOiAweEJCLCBuYW1lOiAnPScgfSwKCXsgY29kZTogMHhCQywgbmFtZTogJywnIH0sCgl7IGNvZGU6IDB4QkQsIG5hbWU6ICctJyB9LAoJeyBjb2RlOiAweEJFLCBuYW1lOiAnLicgfSwKXTsKCnZpcnR1YWxLZXlzLnB1c2goLi4uc3BlY2lhbEtleXMpOwp2aXJ0dWFsS2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhLmNvZGUgLSBiLmNvZGU7IH0pOwoKZnVuY3Rpb24gY3JlYXRlT3B0aW9uRWxlbWVudChrZXlFbGVtZW50LCBpZCkgewoJY29uc3Qgb3B0aW9uRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwoJb3B0aW9uRWxlbWVudC52YWx1ZSA9IGtleUVsZW1lbnQuY29kZTsKCW9wdGlvbkVsZW1lbnQudGV4dCA9IGtleUVsZW1lbnQubmFtZTsKCW9wdGlvbkVsZW1lbnQuaWQgPSBpZCArICJfb3B0IjsKCXJldHVybiBvcHRpb25FbGVtZW50Owp9CgpiaW5kX2VsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHsKCWNvbnN0IHRhcmdldEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50LnRhcmdldCk7Cgl2aXJ0dWFsS2V5cy5mb3JFYWNoKChrZXkpID0+IHsKCQl0YXJnZXRFbGVtZW50LmFwcGVuZENoaWxkKGNyZWF0ZU9wdGlvbkVsZW1lbnQoa2V5LCBlbGVtZW50LmlkKSk7Cgl9KTsKfSk7CgpmdW5jdGlvbiByX2luZm8oKSB7Cglmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7CgkJZ19ib29sKHVfYm9vbFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfZmxvYXQpIHsKCQlnX2Zsb2F0KHVfZmxvYXRbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2ludCkgewoJCWdfaW50KHVfaW50W2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9pbnQyKSB7CgkJZ19pbnQodV9pbnQyW2ldLCBmYWxzZSk7Cgl9Cn0KCmZ1bmN0aW9uIHVfc2VydmVyKCkgewoJZm9yIChjb25zdCBpIGluIHVfYm9vbCkgewoJCXNfYm9vbCh1X2Jvb2xbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2Zsb2F0KSB7CgkJc19mbG9hdCh1X2Zsb2F0W2ldKTsKCX0KfQoKZnVuY3Rpb24gY3RhYl9maXgoaWQsIGRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIikgewoJdmFyIGVsZW1lbnRvcyA9IFsnZWxlbWVudF9tYWluJywgJ2VsZW1lbnRfa2V5cycsICdlbGVtZW50X292ZXJsYXknLCAnZWxlbWVudF9zZXR0aW5nJywgJ2VsZW1lbnRfcXJjb2RlJ107CgoJZWxlbWVudG9zLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnRvKSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKSkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudG8pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cgl9KTsKCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheTsKfQoKZnVuY3Rpb24gdGFiX3N3aXRjaChpID0gdGhpcy5pZCwgcGFuZWwgPSAiY2VudGVyIiwgZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSB7Cglzd2l0Y2ggKHBhbmVsKSB7CgkJY2FzZSAyOgoJCWNhc2UgIjIiOgoJCWNhc2UgInJpZ2h0IjoKCQkJbGV0IHRhYjJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2MtdGFiMi1idG5dIik7CgkJCXRhYjJCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4gewoJCQkJaWYgKGJ1dHRvbi5pZCA9PT0gaSkgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKCQkJCX0gZWxzZSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOwoJCQkJfQoJCQl9KTsKCQkJc3dpdGNoIChpKSB7CgkJCQljYXNlICdwX3VwZGF0ZXMnOgoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3BfdGlja2V0cyc6CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAncF9wcm9maWxlJzoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAiZ3JpZCI7CgkJCQkJYnJlYWs7CgkJCX0KCQkJYnJlYWs7CgkJY2FzZSAxOgoJCWNhc2UgIjEiOgoJCWNhc2UgImNlbnRlciI6CgkJCWxldCB0YWJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2MtdGFiLWJ0bl0iKTsKCQkJdGFiQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHsKCQkJCWlmIChidXR0b24uaWQgPT09IGkpIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CgkJCQl9IGVsc2UgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKTsKCQkJCX0KCQkJfSk7CgoJCQlzd2l0Y2ggKGkpIHsKCQkJCWNhc2UgJ21haW5fdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9tYWluJywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdrZXlzX3RhYic6CgkJCQkJY3RhYl9maXgoJ2VsZW1lbnRfa2V5cycsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAnb3ZlcmxheV90YWInOgoJCQkJCWN0YWJfZml4KCdlbGVtZW50X292ZXJsYXknLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3NldHRpbmdzX3RhYic6CgkJCQkJY3RhYl9maXgoJ2VsZW1lbnRfc2V0dGluZycsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAncXJjb2RlX3RhYic6CgkJCQkJY3RhYl9maXgoJ2VsZW1lbnRfcXJjb2RlJywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCX0KCQkJYnJlYWs7Cgl9Cn0KCnRhYl9zd2l0Y2goIm1haW5fdGFiIiwgImNlbnRlciIsICJub25lIik7CnJfaW5mbygpOwoKdmFyIGl0ZXJmb3VuZCA9IDA7CnZhciB3YXNfZ2FtZV9mb3VuZCA9IGZhbHNlOwp2YXIgc2hvdWxkX3VwZGF0ZSA9IHRydWU7CnZhciBpc19tb3VzZV9pbnNpZGUgPSBmYWxzZTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiLCBmdW5jdGlvbiAoKSB7IGlzX21vdXNlX2luc2lkZSA9IHRydWU7IH0pOwpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwgZnVuY3Rpb24gKCkgeyBpc19tb3VzZV9pbnNpZGUgPSBmYWxzZTsgfSk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ2aXNpYmlsaXR5Y2hhbmdlIiwgKGV2ZW50KSA9PiB7CglzaG91bGRfdXBkYXRlID0gKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PSAidmlzaWJsZSIpOwp9KTsKCnZhciB1cGRhdGVydCA9IHNldEludGVydmFsKGFzeW5jIGZ1bmN0aW9uICgpIHsKCWlmIChhbGxvd19hdSAmJiBzaG91bGRfdXBkYXRlICYmIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsKCQlyX2luZm8oKTsKCQlhd2FpdCBzbGVlcCg1MDApOwoJCXVfc2xpZGVycygpOwoJfQp9LCA1MDAwKTsKCnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJdV9jaGF0KCk7CgkJZ19vbmxpbmVzKCk7Cgl9Cn0sIDIwMDApOwoKYXN5bmMgZnVuY3Rpb24gZ2F0aGVyKGluZm8sIGV4dHJhLCBmdW5jMiA9IGZ1bmN0aW9uICgpIHsgfSkgewoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBpbmZvICsgIiZ2YWw9IiArIGV4dHJhLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsKCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQlyZWplY3QoZXJyb3IpOwoJCX0pOwoJfSk7Cn0KCmZ1bmN0aW9uIHppbmNfaW5mbyhpbmZvLCBleHRyYSkgewoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaW5mbywgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKSAhPSB1bmRlZmluZWQpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuaW5uZXJIVE1MID0gZXh0cmEgKyByZXNwb25zZVRleHQ7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCX0KCX0pOwp9Cgp2YXIgd2FpdGluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCSQuZ2V0KCIvZ19pbmZvP2luZm89Z2FtZWZvdW5kIiwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCXdhc19nYW1lX2ZvdW5kID0gcGFyc2VJbnQocmVzcG9uc2VUZXh0KTsKCQlpZiAoIXdhc19nYW1lX2ZvdW5kKSB7CgkJCXppbmNfaW5mbygid2FpdGluZ19nYW1lIiwgImludGlhbGl6aW5nPGJyPmNsb3NpbmcgaW46ICIpOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9kYXlzIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfYnV0dG9ucyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X21haW4iKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9jb25maWciKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOwoJCX0KCQllbHNlIHsKCQkJaXRlcmZvdW5kKys7CgoJCQlpZiAoaXRlcmZvdW5kID4gMikgewoJCQkJemluY19pbmZvKCJ1c2VyX2RheXMiLCAiZGF5cyBsZWZ0OiAiKTsKCQkJCXppbmNfaW5mbygibGFzdF91cGRhdGUiLCAiPHN0cm9uZz5VcGRhdGVkPC9zdHJvbmc+OiAiKTsKCQkJCXppbmNfaW5mbygiY2hhbmdlbG9ncyIsICI8c3Ryb25nPkNoYW5nZWxvZ3M8L3N0cm9uZz46ICIpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXRpbmdfZ2FtZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9idXR0b25zIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X21haW4iKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJdGFiX3N3aXRjaCgibWFpbl90YWIiKTsKCQkJCXRhYl9zd2l0Y2goInBfdXBkYXRlcyIsIDIpOwoJCQkJY2xlYXJJbnRlcnZhbCh3YWl0aW5nKTsKCQkJfQoJCX0KCX0pCn0sIDI1MCk7Cgp2YXIgcnVubmluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCXRyeSB7CgkJJC5nZXQoIi9nX2luZm8/aW5mbz1ydW5uaW5nIiwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQljX2V4aXQoKTsKCQl9KTsKCX0gY2F0Y2ggKGVycm9yKSB7CgkJY29uc29sZS5sb2coZXJyb3IpOwoJCWFsZXJ0KGVycm9yKTsKCQljX2V4aXQoKTsKCX0KfSwgMTUwMCk7CgpmdW5jdGlvbiBjX2RpYWxvZyhpZF93aGVyZSwgaWRfaXRlbSwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pKSB7CgkJY29uc29sZS5sb2coImVsZW1lbnQgZXhpc3Qgd2l0aCBpZDogIiwgaWRfaXRlbSkKCQlyZXR1cm47Cgl9CgoJY29uc3QgZGlhbG9nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGlhbG9nIik7CglkaWFsb2cuaWQgPSBpZF9pdGVtOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGRpYWxvZy5zdHlsZSwgc3R5bGV6KTsKCX0KCglpZiAoZWxlbW50KSB7CgkJZm9yIChsZXQga2V5IGluIGVsZW1udCkgewoJCQljb25zdCBlbGVtZW50ID0gZWxlbW50W2tleV07CgkJCWNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50LnR5cGUpOwoJCQlPYmplY3QuYXNzaWduKGVsLCBlbGVtZW50LnByb3BzKTsKCQkJT2JqZWN0LmFzc2lnbihlbC5zdHlsZSwgZWxlbWVudC5zdHlsZXMpOwoJCQlkaWFsb2cuYXBwZW5kQ2hpbGQoZWwpOwoJCX0KCX0KCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSkuYXBwZW5kQ2hpbGQoZGlhbG9nKTsKfQoKZnVuY3Rpb24gY19kaXYoaWRfd2hlcmUsIGlkX2l0ZW0sIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJZGl2LmlkID0gaWRfaXRlbTsKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGRpdiwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJZGl2LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGRpdi5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKfQoKZnVuY3Rpb24gY190YWJfYnV0dG9uKGlkX3doZXJlLCBidXR0b25zLCB0eXBleiA9IDEpIHsKCWNvbnN0IHRhYkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCglidXR0b25zLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbiwgaW5kZXgpIHsKCQl2YXIgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CgkJYnRuLmNsYXNzTmFtZSA9ICJ0YWItYnV0dG9uIjsKCQlidG4uc2V0QXR0cmlidXRlKHR5cGV6ID09IDEgPyAiYy10YWItYnRuIiA6ICgiYy10YWIiICsgdHlwZXogKyAiLWJ0biIpLCAiIik7CgkJYnRuLmlkID0gYnV0dG9uLmlkOwoJCWJ0bi5pbm5lckhUTUwgPSBidXR0b24udGV4dDsKCgkJaWYgKGluZGV4ID09PSAwKSB7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BSaWdodFJhZGl1cyA9ICIwcHgiOwoJCX0gZWxzZSBpZiAoaW5kZXggPT09IGJ1dHRvbnMubGVuZ3RoIC0gMSkgewoJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOwoJCX0gZWxzZSB7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BSaWdodFJhZGl1cyA9ICIwcHgiOwoJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOwoJCX0KCgkJYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJCXRhYl9zd2l0Y2godGhpcy5pZCwgdHlwZXopOwoJCX07CgoJCXRhYkNvbnRhaW5lci5hcHBlbmRDaGlsZChidG4pOwoJfSk7Cn0KCmZ1bmN0aW9uIGdfdG1fZHQodGltZXN0YW1wLCBocm1pbiA9IDEpIHsKCXZhciBkYXRlID0gbmV3IERhdGUoK3RpbWVzdGFtcCAqIDEwMDApOwoJaWYgKGhybWluID09IDEpIHsKCQl2YXIgaG91ciA9ICgiMCIgKyBkYXRlLmdldEhvdXJzKCkpLnN1YnN0cigtMik7CgkJdmFyIG1pbnV0ZXMgPSAoIjAiICsgZGF0ZS5nZXRNaW51dGVzKCkpLnN1YnN0cigtMik7CgkJcmV0dXJuIChob3VyICsgIjoiICsgbWludXRlcyk7Cgl9CglpZiAoaHJtaW4gPT0gMikgewoJCXZhciBob3VyID0gKCIwIiArIGRhdGUuZ2V0SG91cnMoKSkuc3Vic3RyKC0yKTsKCQl2YXIgbWludXRlcyA9ICgiMCIgKyBkYXRlLmdldE1pbnV0ZXMoKSkuc3Vic3RyKC0yKTsKCQl2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQl2YXIgbW9udGggPSAoIjAiICsgKGRhdGUuZ2V0TW9udGgoKSArIDEpKS5zdWJzdHIoLTIpOwoJCXZhciBkYXkgPSAoIjAiICsgZGF0ZS5nZXREYXRlKCkpLnN1YnN0cigtMik7CgkJcmV0dXJuIChob3VyICsgIjoiICsgbWludXRlcykgKyAiIC0gIiArIChkYXkgKyAiLyIgKyBtb250aCArICIvIiArIHllYXIpOwoJfQoJZWxzZSB7CgkJdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJdmFyIG1vbnRoID0gKCIwIiArIChkYXRlLmdldE1vbnRoKCkgKyAxKSkuc3Vic3RyKC0yKTsKCQl2YXIgZGF5ID0gKCIwIiArIGRhdGUuZ2V0RGF0ZSgpKS5zdWJzdHIoLTIpOwoJCXJldHVybiAoZGF5ICsgIi8iICsgbW9udGggKyAiLyIgKyB5ZWFyKTsKCX0KfQoKZnVuY3Rpb24gY19idG4oaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCWJ1dHRvbi50eXBlID0gImJ1dHRvbiI7CglidXR0b24uY2xhc3NMaXN0LmFkZCgibmV3YnV0dG9uIik7CglidXR0b24uaWQgPSBpZF9pdGVtOwoJYnV0dG9uLmlubmVySFRNTCA9IHRleHQ7CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oYnV0dG9uLCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oYnV0dG9uLnN0eWxlLCBzdHlsZXopOwoJfQoKCWJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCWZ1bmMyKGJ1dHRvbik7Cgl9OwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7Cn0KCmZ1bmN0aW9uIGNfaHIoaWRfd2hlcmUgPSBwYXRoLCBtYXJnaW4gPSB0cnVlLCBzdHlsZXogPSB7fSkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJdmFyIGhyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHIiKTsKCWlmIChtYXJnaW4pCgkJaHIuc3R5bGUubWFyZ2luTGVmdCA9ICItMjBweCI7CgoJaHIuc3R5bGUuYm9yZGVyID0gIjBweCI7Cgloci5zdHlsZS5ib3JkZXJUb3AgPSAiMXB4IHNvbGlkIHZhcigtLWMtaHIpIjsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihoci5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoaHIpOwp9CgpmdW5jdGlvbiBjX2JyKGlkX3doZXJlID0gcGF0aCwgYW1vdW50ID0gMSkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGFtb3VudDsgaW5kZXgrKykgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKCX0KfQoKZnVuY3Rpb24gY19jaGVja2JveChpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgdG9vbHRpcCA9ICIiLCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdlbGVtaXRlbXNfYmcnKTsKCWRpdi5odG1sRm9yID0gaWRfaXRlbTsKCWRpdi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1mbGV4IjsKCgljb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgljaGVja2JveC50eXBlID0gImNoZWNrYm94IjsKCWNoZWNrYm94LmlkID0gaWRfaXRlbTsKCWNoZWNrYm94Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXVfc2VydmVyKCk7CgkJZnVuYzIoY2hlY2tib3gpOwoJfTsKCgljb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CglsYWJlbC5odG1sRm9yID0gaWRfaXRlbTsKCWxhYmVsLmlubmVySFRNTCA9IHRleHQ7CglsYWJlbC5pZCA9IGlkX2l0ZW0gKyAienp6enoiOwoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCglkaXYuYXBwZW5kQ2hpbGQoY2hlY2tib3gpOwoJZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlfdG9vbHRpcC5jbGFzc05hbWUgPSAiZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTIiOwoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCQlpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCWlfdG9vbHRpcC5zdHlsZS5mb250V2VpZ2h0ID0gIjkwMCI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRTaXplID0gIjE1cHgiOwoJCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CgkJaV90b29sdGlwLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaV90b29sdGlwKTsKCX0KCgl1X2Jvb2wucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19zX2Zsb2F0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBtaW4sIG1heCwgc3RlcF92YWwsIGRlZmF1bHRfdmFsKSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJdmFyIHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHN0ZXBfdmFsKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsKCXN0ZXB2YWxfY2Vyb3MgPSBzdGVwdmFsX2Nlcm9zLmxlbmd0aDsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAnZl9zbGlkZXJfYmcnKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4JywgbWF4KTsKCgljb25zdCB0aXRsZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJdGl0bGVEaXYuY2xhc3NMaXN0LmFkZCgnbF90aXRsZScsICdmX3RpdGxlJyk7Cgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgZGVmYXVsdF92YWwpOwoJdGl0bGVEaXYudGV4dENvbnRlbnQgPSB0ZXh0ICsgIjogIjsKCgljb25zdCBudW1iZXJfaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJbnVtYmVyX2lucHV0LmNsYXNzTGlzdC5hZGQoIm51bWJlcnNsaWRlciIpOwoJbnVtYmVyX2lucHV0LnR5cGUgPSAibnVtYmVyIjsKCW51bWJlcl9pbnB1dC5wYXR0ZXJuID0gIlswLTldKiI7CgludW1iZXJfaW5wdXQuaW5wdXRNb2RlID0gIm51bWVyaWMiOwoJbnVtYmVyX2lucHV0LmlkID0gaWRfaXRlbTsKCW51bWJlcl9pbnB1dC5taW4gPSBtaW47CgludW1iZXJfaW5wdXQubWF4ID0gbWF4OwoJbnVtYmVyX2lucHV0LnN0ZXAgPSBzdGVwX3ZhbDsKCW51bWJlcl9pbnB1dC52YWx1ZSA9IGRlZmF1bHRfdmFsOwoJbnVtYmVyX2lucHV0Lm9uaW5wdXQgPSBmdW5jdGlvbiAoKSB7CgkJdV9zZXJ2ZXIoKTsKCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJfTsKCgljb25zdCBtaW51c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCW1pbnVzX2J0bi5jbGFzc0xpc3QuYWRkKCJjb250cm9scy1udW1iZXIiKTsKCW1pbnVzX2J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgltaW51c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJbWludXNfYnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CgltaW51c19idG4uaW5uZXJIVE1MID0gKCImIzg3MjI7IikudHJpbSgpOwoJbWludXNfYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDAsIG1pbiwgbWF4LCAxLCBzdGVwdmFsX2Nlcm9zKTsKCQl1X3NlcnZlcigpOwoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7Cgl9OwoKCWNvbnN0IHBsdXNfYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CglwbHVzX2J0bi5jbGFzc0xpc3QuYWRkKCJjb250cm9scy1udW1iZXIiKTsKCXBsdXNfYnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCXBsdXNfYnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCXBsdXNfYnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CglwbHVzX2J0bi5pbm5lckhUTUwgPSAoIiYjNDM7IikudHJpbSgpOwoJcGx1c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMSwgbWluLCBtYXgsIDEsIHN0ZXB2YWxfY2Vyb3MpOwoJCXVfc2VydmVyKCk7CgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCX07CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTsKCWRpdi5hcHBlbmRDaGlsZChtaW51c19idG4pOwoJZGl2LmFwcGVuZENoaWxkKG51bWJlcl9pbnB1dCk7CglkaXYuYXBwZW5kQ2hpbGQocGx1c19idG4pOwoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwoKCXVfZmxvYXQucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19pbWcoaWRfd2hlcmUsIGlkX2l0ZW0sIGltYWdlLCB3aWR0aCwgaGVpZ2h0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKCglpbWcuc2V0QXR0cmlidXRlKCdpZCcsIGlkX2l0ZW0pOwoJaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1hZ2UpOwoJaW1nLnNldEF0dHJpYnV0ZSgnYWx0JywgInVfYXZhdGFyIik7CglpbWcuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGhlaWdodCk7CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oaW1nLCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlpbWcuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oaW1nLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbWcpOwp9CgpmdW5jdGlvbiBjX3RleHRhcmVhKGlkX3doZXJlLCBpZF9pdGVtLCBoaWRkZW4gPSBmYWxzZSwgbGFiZWwgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgdGV4dGJveF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Ym94Iik7CgoJCWNvbnN0IGxhYmVsRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CgkJbGFiZWxFbGVtLnRleHRDb250ZW50ID0gbGFiZWwudHJpbSgpOwoJCWxhYmVsRWxlbS5pZCA9IGlkX2l0ZW0gKyAibGJsIjsKCQlsYWJlbEVsZW0uc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoJCWxhYmVsRWxlbS5zZXRBdHRyaWJ1dGUoImZvciIsIGlkX2l0ZW0pOwoKCQlpZiAoc3R5bGV6ICYmIHN0eWxlei5sYWJlbHopIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LmxhYmVseik7CgkJfQoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7Cgl9CgoJY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwoKCXRleHRhcmVhLmlkID0gaWRfaXRlbTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0YXJlYSwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHRleHRhcmVhLnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRib3gpIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCX0KCX0KCglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJfSBlbHNlIHsKCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAobGFiZWwgPT09ICIiICYmIGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7Cgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Ym94X2Rpdik7Cgl9Cn0KCmZ1bmN0aW9uIGNfdGV4dGJveChpZF93aGVyZSwgaWRfaXRlbSwgaGlkZGVuID0gZmFsc2UsIGxhYmVsID0gIiIsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9LCBkaXNhYmxlc3R5bGUgPSBmYWxzZSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsKCgkJY29uc3QgbGFiZWxFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQlsYWJlbEVsZW0udGV4dENvbnRlbnQgPSBsYWJlbC50cmltKCk7CgkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOwoJCWxhYmVsRWxlbS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgkJbGFiZWxFbGVtLnNldEF0dHJpYnV0ZSgiZm9yIiwgaWRfaXRlbSk7CgoJCWlmIChzdHlsZXogJiYgc3R5bGV6LmxhYmVseikgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsKCQl9CgoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7Cgl9CgoJY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQiKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZF9pdGVtKTsKCglpZiAoZGlzYWJsZXN0eWxlKQoJCWlucHV0LnNldEF0dHJpYnV0ZSgnZGF0YS1ub3ZhbGlkaW52YWxpZCcsICcnKTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlucHV0LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCkKCX0KCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihpbnB1dCwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uIChldikgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcywgZXYpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaW5wdXQuc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGlucHV0LnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRib3gpIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCX0KCX0KCglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJfSBlbHNlIHsKCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAobGFiZWwgPT09ICIiICYmIGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7Cgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Ym94X2Rpdik7Cgl9Cn0KCmZ1bmN0aW9uIGNfdGFibGUoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRhYmxlIik7CgoJaWYgKHRleHQpCgkJdGV4dF9kaXYuaW5uZXJIVE1MID0gdGV4dC50cmltKCk7CgoJdGV4dF9kaXYuaWQgPSBpZF9pdGVtOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQl0ZXh0X2Rpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2Rpdi5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwp9CgpmdW5jdGlvbiBjX3RleHQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKCXRleHRfZGl2LmNsYXNzTGlzdC5hZGQoInRleHQiKTsKCglpZiAodGV4dCkKCQl0ZXh0X2Rpdi5pbm5lckhUTUwgPSB0ZXh0LnRyaW0oKTsKCgl0ZXh0X2Rpdi5pZCA9IGlkX2l0ZW07CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24odGV4dF9kaXYsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCXRleHRfZGl2LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0X2Rpdik7Cn0KCmZ1bmN0aW9uIGNfY29tYm9ib3gyKGlkX3doZXJlLCBpZF9pdGVtLCBvcHRpb25zLCBoaWRkZW4gPSBmYWxzZSwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCW9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4gewoJCWNvbnN0IG9wdGlvbl9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CgkJb3B0aW9uX2VsZW0udmFsdWUgPSBpbmRleDsKCQlvcHRpb25fZWxlbS50ZXh0ID0gb3B0aW9uOwoJCXNlbGVjdF9lbGVtLmFkZChvcHRpb25fZWxlbSk7Cgl9KTsKCglzZWxlY3RfZWxlbS5zdHlsZS5kaXNwbGF5ID0gKChoaWRkZW4gPT0gdHJ1ZSkgPyAoIm5vbmUiKSA6ICgiaW5saW5lLWJsb2NrIikpOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3RfZWxlbSk7Cn0KCmZ1bmN0aW9uIGNfY29tYm9ib3goaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzYW1lbGluZSA9IGZhbHNlLCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSwgc3R5bGV6ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKHRleHQgIT0gIiIpIHsKCQl0ZXh0X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Iik7CgkJdGV4dF9kaXYudGV4dENvbnRlbnQgPSB0ZXh0LnRyaW0oKTsKCX0KCgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CglzZWxlY3RfZWxlbS5zdHlsZS5oZWlnaHQgPSAiNDJweCI7CgoJaWYgKHNhbWVsaW5lKQoJCXNlbGVjdF9lbGVtLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjEwcHgiOwoKCXNlbGVjdF9lbGVtLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJZnVuYzIoc2VsZWN0X2VsZW0pOwoJfTsKCgkvL2lmICh0b29sdGlwICE9ICIiKSB7CgkvLwlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJLy99CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oc2VsZWN0X2VsZW0uc3R5bGUsIHN0eWxleik7CgoJCWlmIChzdHlsZXoudGV4dF9kaXYpIHsKCQkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6LnRleHRfZGl2KTsKCQl9Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJaWYgKHRleHQgIT0gIiIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwoJfQoJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlfdG9vbHRpcC5jbGFzc05hbWUgPSAiZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTIiOwoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCQlpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJCWlfdG9vbHRpcC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJaV90b29sdGlwLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IgoJCWlfdG9vbHRpcC5zdHlsZS5mb250V2VpZ2h0ID0gIjkwMCI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRTaXplID0gIjE1cHgiOwoJCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CgoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlfdG9vbHRpcCk7Cgl9CgoJdV9pbnQyLnB1c2goaWRfaXRlbSk7Cn0KCmZ1bmN0aW9uIGNfc19pbnQoaWRfd2hlcmUsIGlkX2l0ZW0sIGlkX3RleHQsIG1pbiwgbWF4LCBzdGVwLCB2YWx1ZSwgdG9vbHRpcCA9ICIiKSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdyX3NsaWRlcl9iZycpOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1taW4nLCBtaW4pOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoKCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsKCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCB2YWx1ZSk7Cgl0aXRsZURpdi50ZXh0Q29udGVudCA9IGlkX3RleHQgKyAiOiAiOwoKCWNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCgljb25zdCBtaW51c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJbWludXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7CgltaW51c0J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgltaW51c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CgltaW51c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJbWludXNCdG4uaW5uZXJIVE1MID0gKCImIzg3MjI7IikudHJpbSgpOwoJbWludXNCdG4ub25jbGljayA9ICgpID0+IHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgpOwoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJYXBwbHlGaWxsKGlucHV0KTsKCX07CgoJY29uc3QgcGx1c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJcGx1c0J0bi5jbGFzc05hbWUgPSAiY29udHJvbHMtbnVtYmVyIjsKCXBsdXNCdG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJcGx1c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CglwbHVzQnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CglwbHVzQnRuLmlubmVySFRNTCA9ICgiJiM0MzsiKS50cmltKCk7CglwbHVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDEsIG1pbiwgbWF4KTsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWlucHV0LmNsYXNzTGlzdC5hZGQoJ3NsaWRlcicpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3JhbmdlJyk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21pbicsIG1pbik7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21heCcsIG1heCk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3N0ZXAnLCBzdGVwKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCB2YWx1ZSk7CglpbnB1dC5vbmNoYW5nZSA9ICgpID0+IHsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTsKCWRpdi5hcHBlbmRDaGlsZChtaW51c0J0bik7CglkaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJZGl2LmFwcGVuZENoaWxkKHBsdXNCdG4pOwoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwoKCXVfaW50LnB1c2goaWRfaXRlbSk7Cn0KCmNvbnN0IHNsaWRlclByb3BzID0gewoJYmFja2dyb3VuZDogInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yMTQpIiwKfTsKCmZ1bmN0aW9uIHVfc2xpZGVycygpIHsKCWNvbnN0IHNsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucl9zbGlkZXJfYmciKTsKCglzbGlkZXJzLmZvckVhY2goKHNsaWRlcikgPT4gewoJCWNvbnN0IHNsaWRlcklucHV0ID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoIi5zbGlkZXIiKTsKCQljb25zdCBzbGlkZXJWYWx1ZSA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpOwoKCQlzbGlkZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChldmVudCkgPT4gewoJCQlzbGlkZXJWYWx1ZS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgZXZlbnQudGFyZ2V0LnZhbHVlKTsKCQkJYXBwbHlGaWxsKGV2ZW50LnRhcmdldCk7CgkJfSk7CgoJCWFwcGx5RmlsbChzbGlkZXJJbnB1dCk7Cgl9KTsKCgljb25zdCBmX3NsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuZl9zbGlkZXJfYmciKTsKCglmX3NsaWRlcnMuZm9yRWFjaChhc3luYyAoc2xpZGVyKSA9PiB7CgkJY29uc3Qgc2xpZGVySW5wdXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLm51bWJlcnNsaWRlciIpOwoKCQlsZXQgc3RlcHZhbF9jZXJvcyA9IChTdHJpbmcoc2xpZGVySW5wdXQuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJCWFwcGx5RmlsbChzbGlkZXJJbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcy5sZW5ndGgsIHNsaWRlcklucHV0LnZhbHVlKTsKCX0pOwp9Cgp1X3NsaWRlcnMoKTsKCmZ1bmN0aW9uIGFwcGx5RmlsbChzbGlkZXIsIGlzX2ZsdCA9IGZhbHNlLCBmbHRwYXJzZSA9IDEsIHZhbHVlKSB7CglpZiAoaXNfZmx0KSB7CgkJc2xpZGVyLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZChmbHRwYXJzZSkpOwoJCXNsaWRlci5zdHlsZS5iYWNrZ3JvdW5kID0gc2xpZGVyUHJvcHMuYmFja2dyb3VuZDsKCQlzbGlkZXIuc3R5bGUuY29sb3IgPSAndmFyKC0tYy10ZXh0KSc7CgkJc2xpZGVyLnN0eWxlLmJvcmRlclJhZGl1cyA9ICI1cHgiOwoJCXNsaWRlci5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHZhcigtLWMtY29udG9ybm9zKSI7CgkJcmV0dXJuOwoJfQoKCWNvbnN0IHBlcmNlbnRhZ2UgPSAoKDEwMCAqIChzbGlkZXIudmFsdWUgLSBzbGlkZXIubWluKSkgLyAoc2xpZGVyLm1heCAtIHNsaWRlci5taW4pKS50b0ZpeGVkKDEpOwoJY29uc3QgYmcgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCB2YXIoLS1jLXByaW1hcnkpIDAlLCB2YXIoLS1jLXNlY29uZGFyeSkgJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gMTAwJSlgOwoJc2xpZGVyLnN0eWxlLmJhY2tncm91bmQgPSBiZzsKCXNsaWRlci5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoIi5sX3RpdGxlIikuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIHNsaWRlci52YWx1ZSk7Cn0KCmZ1bmN0aW9uIHN1bXJlc3RfYnV0dG9ucyhpdGVtX2lkLCBzdW0sIG1pbiwgbWF4LCBpc19mbHQgPSAwLCBmbHRwYXJzZSA9IDEpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKSA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhpdGVtX2lkLCAiZG9lc250IGV4aXN0Iik7CgkJcmV0dXJuOwoJfQoKCWlmIChpc19mbHQpIHsKCQlpZiAoc3VtKSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA+IG1heCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IChwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSArIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCkpLnRvRml4ZWQoZmx0cGFyc2UpOwoJCX0gZWxzZSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA8IG1pbikKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IChwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSAtIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCkpLnRvRml4ZWQoZmx0cGFyc2UpOwoJCX0KCX0KCWVsc2UgewoJCWlmIChzdW0pIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID4gbWF4KQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUludChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpICsgcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQl9IGVsc2UgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPCBtaW4pCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlSW50KG1heCk7CgkJCWVsc2UKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgLSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApOwoJCX0KCX0KfQoKd2luZG93Lm1vYmlsZUNoZWNrID0gZnVuY3Rpb24gKCkgewoJbGV0IGNoZWNrID0gZmFsc2U7CgkoZnVuY3Rpb24gKGEpIHsgaWYgKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSkgfHwgLzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHNcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1wtKG58dSl8YzU1XC98Y2FwaXxjY3dhfGNkbVwtfGNlbGx8Y2h0bXxjbGRjfGNtZFwtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFwtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmXC01fGdcLW1vfGdvKFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZFwtKG18cHx0KXxoZWlcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXC1jfGh0KGMoXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XC18XC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XC8pfGtsb258a3B0IHxrd2NcLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XC8oa3xsfHUpfDUwfDU0fFwtW2Etd10pfGxpYnd8bHlueHxtMVwtd3xtM2dhfG01MFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKVwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblwtMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0XC1nfHFhXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFwtWzItN118aVwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXC18b298cFwtKXxzZGtcL3xzZShjKFwtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaFwtfHNoYXJ8c2llKFwtfG0pfHNrXC0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGhcLXx2XC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcLXx0ZGdcLXx0ZWwoaXxtKXx0aW1cLXx0XC1tb3x0byhwbHxzaCl8dHMoNzB8bVwtfG0zfG01KXx0eFwtOXx1cChcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcLXx5b3VyfHpldG98enRlXC0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlOyB9KShuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhKTsKCXJldHVybiBjaGVjazsKfTsKCndpbmRvdy5zdGVhbUNoZWNrID0gZnVuY3Rpb24gKCkgewoJbGV0IHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKCWxldCBpc1N0ZWFtQnJvd3NlciA9IHVzZXJBZ2VudC5pbmRleE9mKCJzdGVhbSIpID4gLTE7CglyZXR1cm4gaXNTdGVhbUJyb3dzZXI7Cn07CgppZiAoIXdpbmRvdy5tb2JpbGVDaGVjaygpKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJjb2RlX3RleHQiKS5pbm5lckhUTUwgPSAic2NhbiBvbiBtb2JpbGUgb3IgZW50ZXI6ICIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiIG9uIHlvdXIgbW9iaWxlIGJyb3dzZXIiOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyaW1hZ2UiKS5zcmMgPSAiaHR0cHM6Ly9jaGFydC5nb29nbGVhcGlzLmNvbS9jaGFydD9jaHQ9cXImY2hsPSIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiJmNocz0yNTB4MjUwJmNobGQ9THwwIjsKCgl3aW5kb3cub25sb2FkID0gZnVuY3Rpb24gKCkgewoJCWlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApIHsKCQkJdF9wYW5lbCgnbGVmdF9wYW5lbCcpOwoJCQl0X3BhbmVsKCk7CgkJfQoJCWVsc2UgewoJCQlpZiAod2luZG93LnN0ZWFtQ2hlY2soKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDA7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS53aWR0aCA9ICIwcHgiOwoKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9LCAyNTApOwoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDA7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLndpZHRoID0gIjBweCI7CgoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfSwgMjUwKTsKCgkJCQlub3RpZnkoInBhbmVscyBkaXNhYmxlZCBvbiBzdGVhbS4iKTsKCQkJfSBlbHNlIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAxOwoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9LCAyNTApOwoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDE7CgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfSwgMjUwKTsKCQkJfQoJCX0KCX07Cn0KZWxzZSB7Cglkb2N1bWVudC5ib2R5LnN0eWxlLnpvb20gPSAiNzUlIjsKCXRfcGFuZWwoJ2xlZnRfcGFuZWwnKTsKCXRfcGFuZWwoKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmNvZGVfdGV4dCIpLmlubmVySFRNTCA9ICJvbmx5IG9uIHBjIi50cmltKCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJpbWFnZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7Cn0KCmZ1bmN0aW9uIHN0cmluZzJib29sKHN0cmluZykgewoJc3dpdGNoIChzdHJpbmcudG9Mb3dlckNhc2UoKS50cmltKCkpIHsKCQljYXNlICJ0cnVlIjoKCQljYXNlICJ5ZXMiOgoJCWNhc2UgIjEiOgoJCQlyZXR1cm4gdHJ1ZTsKCQljYXNlICJmYWxzZSI6CgkJY2FzZSAibm8iOgoJCWNhc2UgIjAiOgoJCWNhc2UgbnVsbDoKCQkJcmV0dXJuIGZhbHNlOwoJCWRlZmF1bHQ6CgkJCXJldHVybiBCb29sZWFuKHN0cmluZyk7Cgl9Cn0KCmZ1bmN0aW9uIGdfYm9vbChtb2R1bGUpIHsKCSQuZ2V0KCIvZ19ib29sP2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5jaGVja2VkID0gc3RyaW5nMmJvb2wocmVzcG9uc2VUZXh0KTsKCgkJaWYgKCF1X2FsX2Jvb2wuaW5jbHVkZXMobW9kdWxlKSkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJjaGFuZ2UiKSk7CgkJCXVfYWxfYm9vbC5wdXNoKG1vZHVsZSk7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdfaW50KG1vZHVsZSwgcmV0dXJuZWQgPSB0cnVlKSB7CgkkLmdldCgiL2dfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZSA9IHJlc3BvbnNlVGV4dDsKCgkJaWYgKG1vZHVsZS5pbmNsdWRlcygidGhlbWVfc2VsZWN0IikpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCX0KCgkJaWYgKHJldHVybmVkKSB7CgkJCWlmICghdV9hbF9pbnQuaW5jbHVkZXMobW9kdWxlKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiaW5wdXQiKSk7CgkJCQl1X2FsX2ludC5wdXNoKG1vZHVsZSk7CgkJCX0KCgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gZ19mbG9hdChtb2R1bGUpIHsKCSQuZ2V0KCIvZ19mbG9hdD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCXZhciBzdGVwdmFsX2Nlcm9zMiA9IChTdHJpbmcoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5zdGVwKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsKCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZSA9IHBhcnNlRmxvYXQocmVzcG9uc2VUZXh0KS50b0ZpeGVkKHN0ZXB2YWxfY2Vyb3MyLmxlbmd0aCk7CgoJCWlmICghdV9hbF9mbG9hdC5pbmNsdWRlcyhtb2R1bGUpKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoJCQl1X2FsX2Zsb2F0LnB1c2gobW9kdWxlKTsKCQl9CgoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLnZhbHVlOwoJfSk7Cn0KCmZ1bmN0aW9uIHNfYm9vbChtb2R1bGUpIHsKCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpCgkJcmV0dXJuOwoJfQoJdmFyIHZhbHVlID0gbW9kdWxlei5jaGVja2VkOwoKCSQuZ2V0KCIvc19ib29sP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyB9KTsKfQoKZnVuY3Rpb24gc19pbnQyKG1vZHVsZSwgbWluID0gMCwgbWF4ID0gMCkgewoJbGV0IG1vZHVsZXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpOwoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2cobW9kdWxlICsgIiBub3QgZm91bmQiKTsKCQlyZXR1cm47Cgl9CgoJdmFyIHZhbHVlID0gbW9kdWxlei52YWx1ZTsKCglpZiAobWluID09IDAgJiYgbWF4ID09IDApIHsKCQkkLmdldCgiL3NfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQl2YXIgZWxlbWVudEV4aXN0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6Iik7CgkJCWlmIChlbGVtZW50RXhpc3RzICE9IHVuZGVmaW5lZCB8fCBlbGVtZW50RXhpc3RzICE9IG51bGwpCgkJCQllbGVtZW50RXhpc3RzLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsKCQl9KTsKCX0gZWxzZSB7CgkJaWYgKHBhcnNlSW50KHZhbHVlKSA+PSBwYXJzZUludChtaW4pICYmIHBhcnNlSW50KHZhbHVlKSA8PSBwYXJzZUludChtYXgpKSB7CgkJCSQuZ2V0KCIvc19pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQl2YXIgZWxlbWVudEV4aXN0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6Iik7CgkJCQlpZiAoZWxlbWVudEV4aXN0cyAhPSB1bmRlZmluZWQgfHwgZWxlbWVudEV4aXN0cyAhPSBudWxsKQoJCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCQl9KTsKCQl9CgkJZWxzZSB7CgkJCWNvbnNvbGUubG9nKCJtaW5tYXggb3ZlcnBhc3NlZCB8ICIsIHZhbHVlLCBtaW4sIG1heCk7CgkJfQoJfQp9CgpmdW5jdGlvbiBzX2Zsb2F0KG1vZHVsZSkgewoJbGV0IG1vZHVsZXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpOwoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikKCQlyZXR1cm47Cgl9CgoJdmFyIHZhbHVlID0gcGFyc2VGbG9hdChtb2R1bGV6LnZhbHVlKTsKCXZhciBtaW4gPSBwYXJzZUZsb2F0KG1vZHVsZXoubWluKTsKCXZhciBtYXggPSBwYXJzZUZsb2F0KG1vZHVsZXoubWF4KTsKCglpZiAodmFsdWUgPj0gbWluICYmIHZhbHVlIDw9IG1heCkgewoJCSQuZ2V0KCIvc19mbG9hdD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikgIT0gdW5kZWZpbmVkKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKS5pbm5lckhUTUwgPSByZXNwb25zZVRleHQ7CgkJfSk7Cgl9Cn0KCmZ1bmN0aW9uIHNfaW5mbyhtb2R1bGUsIHZhbHVlLCBmdW5jMiA9IGZ1bmN0aW9uICgpIHsgfSkgewoJJC5nZXQoIi9zX2luZm8/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJZnVuYzIoKTsKCX0pOwp9CgpmdW5jdGlvbiBnUm5kSWQobGVuZ3RoID0gOCkgewoJdmFyIGlkID0gJyc7Cgl2YXIgY2hhcmFjdGVycyA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSc7Cgl2YXIgY2hhcmFjdGVyc0xlbmd0aCA9IGNoYXJhY3RlcnMubGVuZ3RoOwoKCWlkID0gJyc7CgoJZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJCWlkICs9IGNoYXJhY3RlcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJhY3RlcnNMZW5ndGgpKTsKCX0KCglyZXR1cm4gaWQ7Cn0KCmZ1bmN0aW9uIHNfYnRuKG1vZHVsZSwgdmFsdWUgPSAiIikgewoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQlpZiAodmFsdWUgPT0gIiIpIHsKCQkJJC5nZXQoIi90b2dnbGU/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCQlyZWplY3QoZXJyb3IpOwoJCQl9KTsKCQl9IGVsc2UgewoJCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsKCQkJfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCXJlamVjdChlcnJvcik7CgkJCX0pOwoJCX0KCX0pOwp9CgpmdW5jdGlvbiBjX2V4aXQoKSB7CglzX2J0bigiZGVhZCIpOwoJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJd2luZG93Lm9wZW4oIiIsICJfc2VsZiIsICIiKTsKCQl3aW5kb3cuY2xvc2UoKTsKCQloaXN0b3J5LmdvKC0xKTsKCQluYXZpZ2F0b3IuYXBwLmJhY2tIaXN0b3J5KCk7CgkJd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwoJfSwgNTAwMCk7Cn0KCmZ1bmN0aW9uIGZfY29tYm8oaWRfaXRlbSwgaWRfc2VydmVyKSB7CgkkLmdldCgiL2dfaW5mbz9pbmZvPSIgKyBpZF9zZXJ2ZXIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQl2YXIgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSk7CgoJCWlmIChzZWxlY3QgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKGlkX2l0ZW0sICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHJlc3BvbnNlID0gd2luZG93LmF0b2IocmVzcG9uc2VUZXh0KTsKCgkJaWYgKHJlc3BvbnNlICE9IG51bGwpIHsKCQkJcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTsKCQkJaWYgKHJlc3BvbnNlICE9IG51bGwpIHsKCQkJCXNlbGVjdC5pbm5lckhUTUwgPSAoIiIpLnRyaW0oKTsKCgkJCQlmb3IgKGNvbnN0IGtleSBpbiByZXNwb25zZSkgewoJCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNwb25zZSwga2V5KSkgewoJCQkJCQljb25zdCBlbGVtZW50ID0gcmVzcG9uc2Vba2V5XTsKCQkJCQkJdmFyIG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwoJCQkJCQlvcHQudmFsdWUgPSBrZXk7CgkJCQkJCW9wdC5pZCA9IGlkX2l0ZW0gKyAiXyIgKyBrZXk7CgkJCQkJCW9wdC5pbm5lckhUTUwgPSBlbGVtZW50WyJpZCJdOwoJCQkJCQlzZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9KTsKfQoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIGZ1bmN0aW9uICgpIHsKCWlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApIHsKCQl0X3BhbmVsKCdsZWZ0X3BhbmVsJywgMSk7CgkJdF9wYW5lbCgncmlnaHRfcGFuZWwnLCAxKTsKCX0KCWVsc2UgewoJCXRfcGFuZWwoJ2xlZnRfcGFuZWwnLCAyKTsKCQl0X3BhbmVsKCdyaWdodF9wYW5lbCcsIDIpOwoJfQp9KTsKCmFzeW5jIGZ1bmN0aW9uIHRfcGFuZWwoaWQgPSAicmlnaHRfcGFuZWwiLCB0eXBlID0gMCkgewoJY29uc3QgcF9lbG0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CglpZiAodHlwZSA9PSAwKSB7CgkJaWYgKHBfZWxtLnN0eWxlLmRpc3BsYXkgIT0gIm5vbmUiKSB7CgkJCXBfZWxtLnN0eWxlLndpZHRoID0gIjBweCI7CgkJCXBfZWxtLnN0eWxlLmhlaWdodCA9ICIwcHgiOwoJCQlwX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjAiOwoJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCXBfZWxtLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCX0sIDI1MCk7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UgewoJCQlwX2VsbS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJYXdhaXQgc2V0VGltZW91dChhc3luYyAoKSA9PiB7IH0sIDI1MCk7CgoJCQlwX2VsbS5zdHlsZS53aWR0aCA9ICJhdXRvIjsKCQkJcF9lbG0uc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwoJCQlwX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjEiOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCX0KCgkJfQoJfQoJZWxzZSB7CgkJaWYgKHBfZWxtLnN0eWxlLmRpc3BsYXkgIT0gIm5vbmUiICYmIHR5cGUgPT0gMSkgewoJCQlwX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOwoJCQlwX2VsbS5zdHlsZS5oZWlnaHQgPSAiMHB4IjsKCQkJcF9lbG0uc3R5bGUub3BhY2l0eSA9ICIwIjsKCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQlwX2VsbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl9LCAyNTApOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIGlmICh0eXBlID09IDIgJiYgcF9lbG0uc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpIHsKCQkJcF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCWF3YWl0IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4geyB9LCAyNTApOwoKCQkJcF9lbG0uc3R5bGUud2lkdGggPSAiYXV0byI7CgkJCXBfZWxtLnN0eWxlLmhlaWdodCA9ICJhdXRvIjsKCQkJcF9lbG0uc3R5bGUub3BhY2l0eSA9ICIxIjsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQl9CgoJCX0KCX0KfQoKdmFyIHpub3RpZmljYXRpb25JZCA9IDAsIG5vdGlmaWNhdGlvbkNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNub3RpZmljYXRpb24tY29udGFpbmVyIik7CmZ1bmN0aW9uIG5vdGlmeShhLCBiLCBkKSB7IGIgPSB2b2lkIDAgPT09IGIgPyAyNTAwIDogYjsgZCA9ICsrem5vdGlmaWNhdGlvbklkOyB2YXIgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOyBjLmNsYXNzTGlzdC5hZGQoIm5vdGlmaWNhdGlvbiIpOyBjLmlubmVySFRNTCA9ICgiPHA+IiArIGEgKyAiPC9wPjxidXR0b24gY2xhc3M9J2Nsb3NlLWJ1dHRvbicgZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBkICsgIic+JnRpbWVzOzwvYnV0dG9uPiIpLnRyaW0oKTsgYy5zdHlsZS5tYXJnaW5MZWZ0ID0gImF1dG8iOyBjLnN0eWxlLndpZHRoID0gImZpdC1jb250ZW50Ijsgbm90aWZpY2F0aW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKGMpOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5yZW1vdmUoKSB9LCA0NTApIH0sIGIpOyAoYSA9IGMucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9Cm5vdGlmaWNhdGlvbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChhKSB7IGlmIChhLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImNsb3NlLWJ1dHRvbiIpKSB7IHZhciBiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtbm90aWZpY2F0aW9uLWlkPSciICsgYS50YXJnZXQuZGF0YXNldC5ub3RpZmljYXRpb25JZCArICInXSIpLnBhcmVudEVsZW1lbnQ7IGIuc3R5bGUub3BhY2l0eSA9ICIwIjsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGIucmVtb3ZlKCkgfSwgMjUwKTsgKGEgPSBiLnByZXZpb3VzU2libGluZykgJiYgYS5zdHlsZSAmJiAoYS5zdHlsZS5tYXJnaW5Ub3AgPSAiNnB4IikgfSB9KTsKCmFzeW5jIGZ1bmN0aW9uIHNsZWVwKG1zKSB7IHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTsgfQoKY29uc29sZS5sb2coImJyZWFraW5nIGNvY29udXRzIik7Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw==";
eval(atob(A));