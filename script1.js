var test = "Ly8gQHRzLW5vY2hlY2sKCnZhciBkZWZhdWx0X2F2YXRhciA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvQ29sYUNhcHJpY2hvc2EvRlBXTFIvbG9nYXJkby5wbmciOwoKZnVuY3Rpb24gY190aGVtZSgpIHsKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmJvZHk7Cgljb25zdCB0aGVtZV9zZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWVfc2VsZWN0Jyk7Cgljb25zdCBzZWxlY3RlZCA9IHRoZW1lX3NlbGVjdC52YWx1ZTsKCWNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnLCBzZWxlY3RlZCk7CgoJc19pbnQyKCd0aGVtZV9zZWxlY3QnKTsKfQoKZnVuY3Rpb24gZ190bV9pKCkgeyByZXR1cm4gTWF0aC5yb3VuZCgrbmV3IERhdGUoKSAvIDEwMDApOyB9Cgpjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CnRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcCIpOwp0b29sdGlwLmlkID0gIndtdG9vbHRpcCI7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcCk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7Cgljb25zdCB0b29sdGlwTWVzc2FnZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiKTsKCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCXRvb2x0aXAuaW5uZXJUZXh0ID0gdG9vbHRpcE1lc3NhZ2U7CgkJdG9vbHRpcC5zdHlsZS50b3AgPSBlbGVtZW50Lm9mZnNldFRvcCAtIHRvb2x0aXAub2Zmc2V0SGVpZ2h0IC0gOCArICJweCI7CgkJdG9vbHRpcC5zdHlsZS5sZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgKGVsZW1lbnQub2Zmc2V0V2lkdGggLSB0b29sdGlwLm9mZnNldFdpZHRoKSAvIDIgKyAicHgiOwoJCXRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcC0tdmlzaWJsZSIpOwoJfQp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IiwgZnVuY3Rpb24gKGV2ZW50KSB7Cgljb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0OwoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CglpZiAodG9vbHRpcE1lc3NhZ2UpIHsKCQl0b29sdGlwLmlubmVyVGV4dCA9ICgiLSIpLnRyaW0oKTsKCQl0b29sdGlwLmNsYXNzTGlzdC5yZW1vdmUoInRvb2x0aXAtLXZpc2libGUiKTsKCX0KfSk7CgovKmFscmVhZHkgZGlzcGF0Y2hlZCBpZHMqLwp2YXIgdV9hbF9ib29sID0gW107CnZhciB1X2FsX2Zsb2F0ID0gW107CnZhciB1X2FsX2ludCA9IFtdOwoKdmFyIHVfYm9vbCA9IFtdOwp2YXIgdV9mbG9hdCA9IFtdOwp2YXIgdV9pbnQgPSBbXTsKdmFyIHVfaW50MiA9IFsidGhlbWVfc2VsZWN0Il07CgpwYXRoID0gInBhbmVsX2NoYXQiOwoKY190ZXh0KHBhdGgsICJjaGF0Ym94dHh0IiwgImNoYXQiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CgpjX2RpdihwYXRoLCAiY2hhdC1jb250YWluZXIiLCB7Cgl3aWR0aDogIjIzMHB4IiwKCWhlaWdodDogIjMxNXB4IiwKCW1heEhlaWdodDogIjMxNXB4IiwKCW92ZXJmbG93WTogImF1dG8iLAoJcGFkZGluZzogIjEwcHgiLAoJYmFja2dyb3VuZENvbG9yOiAndmFyKC0tYy1zZWNvbmRhcnkpJywKfSk7CgpjX2JyKCk7CgpmdW5jdGlvbiBzZW5kX2NoYXQoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJY29uc3QgY2hhdF90ZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlOwoJCXNfYnRuKCJzZW5kX2NoYXQiLCBjaGF0X3RleHQpCgkJCS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAoIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygiZG9uZSIpKQoJCQkJCXJldHVybjsKCgkJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMzUwKTsKCQkJCXVfY2hhdCgpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGNhcmFjdGVyZXMgZXNwZWNpYWxlcywgZGUgNSBhIDY0IGNhcmFjdGVyZXMgc29sYW1lbnRlLiIsIDUwMDAsICJSRUQiKTsKCX0KfQoKY190ZXh0Ym94KHBhdGgsICJjaGF0X3RleHQiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsCgltaW5MZW5ndGg6IDEsCgltYXhMZW5ndGg6IDY0LAoJcmVxdWlyZWQ6IHRydWUsCglwbGFjZWhvbGRlcjogIndyaXRlIGhlcmUiLAoJZXZlbnRMaXN0ZW5lcjogewoJCWtleWRvd246IGZ1bmN0aW9uIChlbCwgZXYpIHsKCQkJaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewoJCQkJc2VuZF9jaGF0KCk7CgkJCX0KCQl9Cgl9Cn0sIHRydWUpOwoKY19idG4ocGF0aCwgImJ0bl9zZW5kX2NoYXQiLCAic2VuZCIsIGZ1bmN0aW9uICgpIHsKCXNlbmRfY2hhdCgpOwp9LCAiRW52aWEgdW4gbWVuc2FqZSBhbCBjaGF0LCB1bmEgdmV6IGNhZGEgMzAgc2VndW5kb3MuIik7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY190ZXh0KHBhdGgsICJ1c2Vyc29ubGluZSIsICJub25lIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMTBweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwoKZnVuY3Rpb24gZ19vbmxpbmVzKCkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJcmV0dXJuOwoKCWdhdGhlcigib25saW5lcyIsICJ6eiIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQl0cnkgewoJCQkJY29uc3QgbGl2ZXMgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgkJCQljb25zdCBvbmxpbmVzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcnNvbmxpbmUnKTsKCQkJCW9ubGluZXNlbC5pbm5lckhUTUwgPSAiPHAgc3R5bGU9J2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjE0cHg7bWFyZ2luLWJvdHRvbTowcHg7bWFyZ2luLXRvcDowcHg7Jz5vbmxpbmVzICgiICsgbGl2ZXMubGl2ZS5sZW5ndGggKyAiKTwvcD48YnI+IiArIGxpdmVzLmxpdmUuam9pbigiLCAiKTsKCQkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJCW5vdGlmeShyZXN1bHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKZ19vbmxpbmVzKCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19idG4ocGF0aCwgIm9wZW5kbGdmaW5kdXNlciIsICJzZWFyY2ggdXNlciIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZHVzZXJkbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIkJ1c2NhIHVuIHVzdWFyaW8uIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSk7CgpjX2JyKCk7CgpjX2RpYWxvZyhwYXRoLCAiZmluZHVzZXJkbGciKTsKcGF0aCA9ICJmaW5kdXNlcmRsZyI7CgpjX3RleHQocGF0aCwgInVzZXJmaW5kdHh0IiwgInNlYXJjaCB1c2VyIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKCmNfYnIocGF0aCk7CgpjX3RleHRib3gocGF0aCwgImZpbmRfdXNlciIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiAzLAoJbWF4TGVuZ3RoOiAyMCwKCXJlcXVpcmVkOiB0cnVlLAoJcGxhY2Vob2xkZXI6ICJhbGlhcyIsCglldmVudExpc3RlbmVyOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQlpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnRuX2ZpbmRfdXNlciIpLmNsaWNrKCk7CgkJCX0KCQl9Cgl9Cn0sIHRydWUpOwoKY29uc3Qgcm9sZWNsciA9IHsgIm5vcm1hbCI6ICIjNjA2MDYwIiwgInByZW1pdW0iOiAiIzhiYjBmZiIsICJjaGFkIjogIiNmZmU1OGIiLCAiR09EIjogIiNmMTRjMzkiLCAiUEFQSSI6ICIjY2U5OGUyIiB9Owp2YXIgZnVfY29vbGRvd24gPSAwOwoKY19idG4ocGF0aCwgImJ0bl9maW5kX3VzZXIiLCAiZmluZCIsIGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZF91c2VyIikudmFsaWRpdHkudmFsaWQpCgkJaWYgKGZ1X2Nvb2xkb3duID4gZ190bV9pKCkpIHsKCQkJY29uc29sZS5sb2coImNvb2xkb3duIiwgKGZ1X2Nvb2xkb3duIC0gZ190bV9pKCkpKQoJCQlub3RpZnkoInJlY2VudGx5IHVzZWQsIHdhaXQgIiArIChmdV9jb29sZG93biAtIGdfdG1faSgpKSArICIgc2Vjb25kcyIsIDcwMDApOwoJCQlyZXR1cm47CgkJfQoJZ2F0aGVyKCJpbmZvX2FsaWFzIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRfdXNlciIpLnZhbHVlKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJdHJ5IHsKCQkJCXZhciB1X2luZiA9IEpTT04ucGFyc2UocmVzdWx0KTsKCgkJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZ0ciIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQl9CgoJCQkJdmFyIHVzZXJfZGF0YSA9ICIiOwoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07CgoJCQkJaWYgKHVfaW5mWyJyb2xlIl0pCgkJCQkJdXNlcl9kYXRhICs9ICI8c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmU7Zm9udC1zaXplOjEwcHg7Y29sb3I6IiArIHJvbGVjbHJbdV9pbmZbInJvbGUiXS50b0xvd2VyQ2FzZSgpXSArICI7Jz4gKCIgKyB1X2luZlsicm9sZSJdICsgIik8L3NwYW4+PGJyPjwvc3Ryb25nPjwvcD4iOwoKCQkJCWlmICh1X2luZlsidXNlcl9pZCJdKQoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+dWlkOiAiICsgdV9pbmZbInVzZXJfaWQiXTsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPmJldGEiOwoKCQkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQoJCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCBmYWxzZSkgKyAiPC9wPiI7CgkJCQllbHNlCgkJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsKCgkJCQlpZiAodV9pbmZbImRlc2NyaXB0aW9uIl0pCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTJweDttYXJnaW4tdG9wOiAwcHg7Jz5ubyBpbmZvPC9wPiIKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmYiKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQlub3RpZnkocmVzdWx0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQlpZiAocmVzdWx0LmluY2x1ZGVzKCJyZWNlbnRseSIpKSB7CgkJCQkJaWYgKGZ1X2Nvb2xkb3duIDwgZ190bV9pKCkpCgkJCQkJCWZ1X2Nvb2xkb3duID0gZ190bV9pKCkgKyAzMDsKCQkJCX0KCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImNsb3NlZmluZHVzZXIiLCAiY2xvc2UiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmR1c2VyZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfZGl2KHBhdGgsICJ1c2VyX2luZmFsaWFzIiwgewoJZGlzcGxheTogImlubGluZS1ncmlkIiwKCWdyaWRUZW1wbGF0ZUNvbHVtbnM6ICJyZXBlYXQoMywgMTA1cHgpIiwKCWdyaWRHYXA6ICIxMHB4Igp9KTsKCmNfYnIocGF0aCwgMik7CgpjX2ltZygidXNlcl9pbmZhbGlhcyIsICJ1c2VyX2F2dHIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLAoJewoJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQlvYmplY3RGaXQ6ICJjb3ZlciIsCgkJYm9yZGVyUmFkaXVzOiAiNXB4IiwKCQlwbGFjZVNlbGY6ICJub3JtYWwiCgl9KTsKCmNfYnIocGF0aCwgMik7CgpjX3RleHQoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9pbmYiLCAibm9uZSIsIHsKCWRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiwKCWNvbG9yOiAid2hpdGUiCn0pOwoKdmFyIGxhc3RfbXNnID0gMDsKdmFyIGZpcnN0X3NuZCA9IDA7CgpmdW5jdGlvbiBwX3NvdW5kKGlkKSB7CglpZiAoZmlyc3Rfc25kID09IDApIHsKCQlmaXJzdF9zbmQrKzsKCX0KCWVsc2UgewoJCXZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJCWVsZW1lbnQudm9sdW1lID0gMC4xOwoJCWVsZW1lbnQucGxheSgpOwoJfQp9CgpmdW5jdGlvbiB1X2NoYXQoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQlyZXR1cm47CgoJZ2F0aGVyKCJnZXRfY2hhdCIsICJ6IikKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCWNvbnN0IGNoYXRzID0gSlNPTi5wYXJzZShyZXN1bHQpOwoJCQljb25zdCBjaGF0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtY29udGFpbmVyJyk7CgkJCWNoYXRDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CgoJCQl2YXIgaGlnaGVzdF90cyA9IDA7CgkJCWNoYXRzLmZvckVhY2goYXN5bmMgKGNoYXQpID0+IHsKCQkJCWlmIChoaWdoZXN0X3RzIDwgY2hhdC50cykKCQkJCQloaWdoZXN0X3RzID0gY2hhdC50czsKCgkJCQljb25zdCBjaGF0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJY2hhdEVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CgkJCQljaGF0RWxlbWVudC5pbm5lckhUTUwgPSBgKDxzcGFuIGRhdGEtdHRpcD0nJHtnX3RtX2R0KGNoYXQudHMsIGZhbHNlKX0nIHN0eWxlPSJvcGFjaXR5OiAwLjU7Ij4ke2dfdG1fZHQoY2hhdC50cyl9PC9zcGFuPikgPHNwYW4gc3R5bGU9JyR7Y2hhdC5yICE9IHVuZGVmaW5lZCA/ICgiY29sb3I6IiArIChPYmplY3QuZW50cmllcyhyb2xlY2xyKVtjaGF0LnJdWyIxIl0pICsgIjsiKSA6ICIifSc+PHN0cm9uZz4ke2NoYXQudX08L3N0cm9uZz48L3NwYW4+OiAke3dpbmRvdy5hdG9iKGNoYXQubXNnKX1gOwoJCQkJY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChjaGF0RWxlbWVudCk7CgoJCQkJY19ocigiY2hhdC1jb250YWluZXIiLCBmYWxzZSwgewoJCQkJCW9wYWNpdHk6ICIwLjIiLAoJCQkJCXBhZGRpbmdUb3A6ICIwcHgiLAoJCQkJCXBhZGRpbmdCb3R0b206ICIwcHgiLAoJCQkJfSk7CgkJCX0pOwoKCQkJaWYgKGxhc3RfbXNnICE9IGhpZ2hlc3RfdHMpIHsKCQkJCXBfc291bmQoInNuZDEiKTsKCQkJCWxhc3RfbXNnID0gaGlnaGVzdF90czsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKdV9jaGF0KCk7Cgp2YXIgcGF0aCA9ICJtYWluX2VsZW1lbnRzIjsKCi8qU1RBUlQgRkVBVFVSRVMqLwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGl0bGVfaWQiKS5pbm5lclRleHQgPSAiWklOQyI7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2lkIikuaW5uZXJUZXh0ID0gImNvbG9yYm90IjsKCmNfdGFiX2J1dHRvbigiZWxlbWVudF9idXR0b25zIiwgWwoJeyBpZDogIm1haW5fdGFiIiwgdGV4dDogIm1haW4iIH0sCgkvKnsgaWQ6ICJzZXR0aW5nc190YWIiLCB0ZXh0OiAiY2ZnIiB9LCovCgl7IGlkOiAicXJjb2RlX3RhYiIsIHRleHQ6ICJRUiIgfQpdKTsKCmNfdGFiX2J1dHRvbigiZWxlbWVudF9yaWdodF9idXR0b25zIiwgWwoJeyBpZDogInBfdXBkYXRlcyIsIHRleHQ6ICJsb2dzIiB9LAoJeyBpZDogInBfdGlja2V0cyIsIHRleHQ6ICJ0aWNrZXRzIiB9LAoJeyBpZDogInBfcHJvZmlsZSIsIHRleHQ6ICJwcm9maWxlIiB9Cl0sIDIpOwoKY19jb21ib2JveChwYXRoLCAiYWxsX3Byb2ZpbGVzIiwgInByb2ZpbGUiLCAwLCAyMCwgdHJ1ZSwgIlBlcmZpbGVzIHBhcmEgY2FkYSBzaXR1YWNpb24uIiwgZnVuY3Rpb24gKCkgewoJcl9pbmZvKCk7Cn0sIHsgbWluV2lkdGg6ICIxODBweCIgfSk7CgpjX3RleHRib3gocGF0aCwgInByb2ZpbGVfbmFtZV9jIiwgZmFsc2UsICIiLCAiIiwge30sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOV0qJCIsCgltaW5MZW5ndGg6IDQsCgltYXhMZW5ndGg6IDksCglyZXF1aXJlZDogZmFsc2UsCn0sIHRydWUpOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2NoYW5nZSIsICJjaGFuZ2UgbmFtZSIsIGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZmlsZV9uYW1lX2MiKS52YWxpZGl0eS52YWxpZCkgewoKCQl2YXIgcHJvZl92YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9maWxlX25hbWVfYyIpLnZhbHVlOwoJCXNfaW5mbygicHJvZmlsZV9uYW1lIiwgcHJvZl92YWx1ZSk7CgoJCXJfaW5mbygpOwoJCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBlc3BhY2lvcyBvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICJDYW1iaWEgZWwgbm9tYnJlIGRlbCBwcm9maWxlIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2V4cG9ydCIsICJleHBvcnQgcHJvZmlsZSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCJleHBvcnRfcHJvZmlsZSIpOwp9LCAiRXhwb3J0YSBlbCBwZXJmaWwgYWN0dWFsIGFsIENMSVBCT0FSRC4iLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfaW1wb3J0IiwgImltcG9ydCBwcm9maWxlIiwgZnVuY3Rpb24gKCkgewoJc19idG4oImltcG9ydF9wcm9maWxlIik7CglyX2luZm8oKTsKCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKfSwgIkltcG9ydGEgdW4gcGVyZmlsIGRlc2RlIGVsIENMSVBCT0FSRC4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2NoZWNrYm94KHBhdGgsICJjb2xvcmJvdCIsICJlbmFibGVkIiwgIkFjdGl2YSBlbCBmdW5jaW9uYW1pZW50byBkZWwgY29sb3Jib3QuIik7CmNfY2hlY2tib3gocGF0aCwgImRpbmFtaWNfc21vb3RoIiwgImRpbmFtaWMgc21vb3RoIiwgIkFsIGFjdGl2YXJsbywgYmxvcXVlYSBlbCBzbW9vdGggcHJpbmNpcGFsLiIpOwovL2NfY2hlY2tib3gocGF0aCwgIm1hc2tfZm9ybWF0IiwgIm1hc2sgZm9ybWF0IiwgIkFsIGVzdGFyIGFjdGl2YWRvLCB1dGlsaXphIGVsIG1hc2sgdGhyZWFkIChkZWphbmRvIGluaGFiaWxpdGFkbyBlbCBzaW1wbGUgZm9ybWF0KSIpOwovL2NfY2hlY2tib3gocGF0aCwgInNpbXBsZV9mb3JtYXQiLCAic2ltcGxlIGZvcm1hdCIsICJBbCBlc3RhciBhY3RpdmFkbywgdXRpbGl6YSB1biB0aHJlYWQgbGltcGlvIHNpbiBvcGNpb25lcyBkZSBkZWJ1ZywgZXRjLiIpOwoKY19jb21ib2JveChwYXRoLCAibWFpbl9rZXkiLCAibWFpbiBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IHByaW5jaXBhbCBjb24gbGEgY3VhbCBzZSBhY3RpdmEgZWwgYWltLiIpOwpjX2NvbWJvYm94KHBhdGgsICJzZWNvbmRhcnlfa2V5IiwgInNlY29uZGFyeSBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IHNlY3VuZGFyaWEgY29uIGxhIGN1YWwgc2UgYWN0aXZhIGVsIGFpbS4iKTsKY19jb21ib2JveChwYXRoLCAiZGlzYWJsZV9zZWNvbmRhcnlfa2V5IiwgImRpc2FibGUga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBjb24gbGEgY3VhbCBzZSBkZXNhY3RpdmEgZWwgYWltLiIpOwoKY19jb21ib2JveChwYXRoLCAidHlwZV9mb3JtYXQiLCAiZm9ybWF0IiwgMCwgMywgZmFsc2UsICJEaXN0aW50b3MgbWV0b2RvcyBwYXJhIGVzY2FuZWFyL3Byb2Nlc2FyIGxvcyBjb2xvcmVzLiIpOwpjX2NvbWJvYm94KHBhdGgsICJkaW5hbWljX3Ntb290aF90eXBlIiwgImRpbmFtaWMgc21vb3RoIHR5cGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiQWNvbW9kYSBlbCBzbW9vdGggZGluYW1pY2FtZW50ZSBkZXBlbmRpZW5kbyBsYSBkaXN0YW5jaWEgZGVsIGVuZW1pZ28iKTsKY19jb21ib2JveChwYXRoLCAiY29sb3JfdHlwZSIsICJjb2xvcnMiLCAwLCA0LCBmYWxzZSwgIkVsIGNvbG9yIHNlbGVjY2lvbmFkbyBlcyBlbiBlbCBjdWFsIHNlIGJhc2FyYSBlbCBhaW1ib3QiKTsKY19jb21ib2JveChwYXRoLCAic29ydF9tZXRob2QiLCAibWV0aG9kcyIsIDAsIDgsIGZhbHNlLCAiRGlzdGludG9zIG1ldG9kb3MgcGFyYSBxdWUgZWwgYWltYm90IGFwdW50ZSwgc2UgcmVjb21pZW5kYSBlbCBCRVNULiIpOwoKY19zX2ludChwYXRoLCAndGFyZ2V0X29mZnNldF94JywgIm9mZnNldCBYIiwgMCwgNTAsIDEsIDApOwpjX3NfaW50KHBhdGgsICJ0YXJnZXRfb2Zmc2V0X3kiLCAib2Zmc2V0IFkiLCAwLCA1MCwgMSwgNSk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19zX2Zsb2F0KHBhdGgsICJzcGVlZCIsICJzbW9vdGgiLCAwLjAsIDYuMCwgMC4xLCAyLjApOwpjX3NfaW50KHBhdGgsICJmb3ZfeCIsICJGb3YgWCIsIDUsIDUwMCwgNSwgNTApOwpjX3NfaW50KHBhdGgsICJmb3ZfeSIsICJGb3YgWSIsIDUsIDI1MCwgNSwgNTApOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfY2hlY2tib3gocGF0aCwgInJlY29pbCIsICJyZWNvaWwiLCAiQmFqYXJhIGVsIGNyb3NzaGFpciBhIGxhIGhvcmEgZGUgZGlzcGFyYXIgY29uIGxhIE1BSU4ga2V5LiIpOwpjX2NoZWNrYm94KHBhdGgsICJyY3NfY3JvdWNoX29ubHkiLCAiY3JvdWNoIG9ubHkiLCAiU29sbyBmdW5jaW9uYXJhIHNpIGVzdGFtb3MgYXByZXRhbmRvIENUUkwiKTsKY19zX2ludChwYXRoLCAicmVjb2lsX2RlbGF5IiwgImRlbGF5IiwgNSwgNTAwLCA1LCAyMDApOwpjX3NfaW50KHBhdGgsICJyZWNvaWxfc3RyZW5naHQiLCAic3RyZW5naHQiLCAxLCA1MCwgMSwgMik7CmNfc19pbnQocGF0aCwgIm1heF9yZWNvaWxfb2Zmc2V0IiwgIm1heCBvZmZzZXQiLCAxLCA1MCwgMSwgMik7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19jaGVja2JveChwYXRoLCAidHJpZ2dlcmJvdCIsICJ0cmlnZ2VyYm90IiwgIkRpc3BhcmFyYSBhdXRvbWF0aWNhbWVudGUgY3VhbmRvIGVsIENPTE9SIHBhc2UgcG9yIGVsIGNyb3NzaGFpci4iKTsKY19jaGVja2JveChwYXRoLCAiZGlzYWJsZV9haW1fb25fdHJpZ2dlciIsICJkaXNhYmxlIGFpbSBvbiB0cmlnZ2VyIik7CmNfY29tYm9ib3gocGF0aCwgInRyaWdnZXJfdHlwZSIsICJ0eXBlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSk7CmNfY29tYm9ib3gocGF0aCwgInRyaWdnZXJfa2V5IiwgInRyaWdnZXIga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBjb24gbGEgY3VhbCBzZSBhY3RpdmEgZWwgVFJJR0dFUi4iKTsKY19zX2ludChwYXRoLCAidHJpZ2dlcl9yYWRpdXMiLCAiZm92IiwgMSwgNTAsIDEsIDE1KTsKY19zX2ludChwYXRoLCAidHJpZ2dlcl9kZWxheSIsICJkZWxheSIsIDUsIDU1MCwgNSwgMjUwKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2NoZWNrYm94KHBhdGgsICJiaG9wIiwgImJob3AiLCAiQWwgYWN0aXZhcmxvLCBkZWJlcyBiaW5kZWFyIGxhIGtleSBYQnV0dG9uMiBvIE1vdXNlNSBhbCBiaG9wIGVuIHZleiBkZWwgZXNwYWNpby4iKTsKY19zX2ludChwYXRoLCAiYmhvcF9kZWxheSIsICJiaG9wIGRlbGF5IiwgNSwgMjAwLCA1LCAyMDApOwoKcGF0aCA9ICJzZXR0aW5nX2VsZW1lbnRzIjsKLypkZXByZWNhdGVkCmNfY2hlY2tib3gocGF0aCwgImRlYnVnX3dpbmRvdyIsICJkZWJ1ZyB3aW5kb3ciKTsKY19jaGVja2JveChwYXRoLCAiY2lyY2xlcyIsICJkZWJ1ZyBjaXJjbGVzIik7CmNfY2hlY2tib3gocGF0aCwgImNlbnRlcl9jb2xvcnMiLCAiZGVidWcgY29sb3JzIik7CmNfY2hlY2tib3gocGF0aCwgIm1hc2tfd2luZG93IiwgImRlYnVnIG1hc2siKTsqLwoKZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOwpmX2NvbWJvKCJ0cmlnZ2VyX3R5cGUiLCAidHJpZ2dlcl90eXBlIik7CmZfY29tYm8oImRpbmFtaWNfc21vb3RoX3R5cGUiLCAiZGluYW1pY19zbW9vdGhfdHlwZSIpOwpmX2NvbWJvKCJjb2xvcl90eXBlIiwgImNvbG9ycyIpOwpmX2NvbWJvKCJzb3J0X21ldGhvZCIsICJtZXRob2RzIik7CmZfY29tYm8oInR5cGVfZm9ybWF0IiwgImZvcm1hdHMiKTsKCmNvbnN0IGJpbmRfZWxlbWVudHMgPSBbCgl7IGlkOiAibWFpbl9rZXkiLCB0YXJnZXQ6ICJtYWluX2tleSIgfSwKCXsgaWQ6ICJzZWNvbmRhcnlfa2V5IiwgdGFyZ2V0OiAic2Vjb25kYXJ5X2tleSIgfSwKCXsgaWQ6ICJ0cmlnZ2VyX2tleSIsIHRhcmdldDogInRyaWdnZXJfa2V5IiB9LAoJeyBpZDogImRpc2FibGVfc2Vjb25kYXJ5X2tleSIsIHRhcmdldDogImRpc2FibGVfc2Vjb25kYXJ5X2tleSIgfSwKXTsKCi8qRU5EIEZFQVRVUkVTKi8KCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2ltcG9ydGNmZycpOwpjX3RleHQoJ2NvbmZpcm1faW1wb3J0Y2ZnJywgImNvbmZpcm1kbGdpbXBjZmciLCAiWW91IGFyZSBhYm91dCB0byBJTVBPUlQgYW5vdGhlciBDRkciLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CmNfYnRuKCdjb25maXJtX2ltcG9ydGNmZycsICJjb25maXJtaW1wb3J0Y2ZnIiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CglzX2J0bignaW1wb3J0X2MnKQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2ltcG9ydGNmZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2J0bignY29uZmlybV9pbXBvcnRjZmcnLCAiY2FuY2VsX2ltcG9ydGNmZyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1faW1wb3J0Y2ZnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2V4cG9ydGNmZycpOwpjX3RleHQoJ2NvbmZpcm1fZXhwb3J0Y2ZnJywgImNvbmZpcm1kbGdleHBjZmciLCAiWW91IGFyZSBhYm91dCB0byBFWFBPUlQgdGhlIGVudGlyZSBsb2NhbCBDRkciLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CmNfYnRuKCdjb25maXJtX2V4cG9ydGNmZycsICJjb25maXJtZXhwb3J0Y2ZnIiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CglzX2J0bignZXhwb3J0X2MnKQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cG9ydGNmZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2J0bignY29uZmlybV9leHBvcnRjZmcnLCAiY2FuY2VsX2V4cG9ydGNmZyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1fZXhwb3J0Y2ZnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2V4aXQnKTsKY190ZXh0KCdjb25maXJtX2V4aXQnLCAiY29uZmlybWRsZ2V4aXQiLCAiWW91IGFyZSBhYm91dCB0byBleGl0IiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwpjX2J0bignY29uZmlybV9leGl0JywgImNvbmZpcm1leGl0IiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CgljX2V4aXQoKTsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leGl0Iik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnRuKCdjb25maXJtX2V4aXQnLCAiY2FuY2VsX2V4aXQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4aXQiKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKcGF0aCA9ICJwYW5lbF90aWNrZXRzIjsKCmNfdGV4dChwYXRoLCAidGlja2V0Y2VudGVyIiwgIlRpY2tldCBDZW50ZXIiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7Cgp2YXIgdGlja2V0X2ZhcV9zdCA9IHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCglmb250U2l6ZTogJzE0cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCn0KCmNfdGV4dChwYXRoLCAidGNrdGZhcSIsICItIERvIG5vdCBzcGFtIHRoZSB0aWNrZXQgc3lzdGVtLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYW4gaXNzdWUuPGJyPi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgaGF2ZSBhIGZlYXR1cmUgcmVxdWVzdC48YnI+IiwgdGlja2V0X2ZhcV9zdCk7CmNfdGV4dChwYXRoLCAidGNrdGZhcSIsICItIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IG5lZWQgPHU+aGVscDwvdT4uPGJyPi0gQWxsIHRpY2tldHMgYXJlIDx1PnByaXZhdGU8L3U+Ljxicj4tIERvIG5vdCBwb3N0IGlycmVsZXZhbnQgY29tbWVudHMgaW4gdGlja2V0cyBvciB5b3UgbWF5IGJlIDx1PmJhbm5lZDwvdT4uIiwgdGlja2V0X2ZhcV9zdCk7CgpjX2NvbWJvYm94MihwYXRoLCAidGlja2V0X2JlaGF2aW9yIiwgWyJCdWciLCAiRmVhdHVyZSIsICJPdGhlciJdLCB0cnVlLCAiU2VsZWNjaW9uYSB1bmEgcmF6b24gZGVsIHRpY2tldC4iKTsKCmNfdGV4dGFyZWEocGF0aCwgInRpY2tldF9jb250ZW50IiwgdHJ1ZSwgIiIsIHsKCWhlaWdodDogJzEwMHB4JywKCXJlc2l6ZTogJ25vbmUnLAoJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJd2hpdGVTcGFjZTogJ3ByZS13cmFwJywKCW1hcmdpblRvcDogIjVweCIsCn0sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOSBdKiR7NX0iLAoJbWluTGVuZ3RoOiA1LAoJbWF4TGVuZ3RoOiAyNTYsCglwbGFjZWhvbGRlcjogImluZm8iLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwoKdmFyIHNob3dfdGlja2V0X2MgPSBmYWxzZTsKY19idG4ocGF0aCwgImJ0bl9jcmVhdGVfdGlja2V0IiwgImNyZWF0ZSB0aWNrZXQiLCBmdW5jdGlvbiAoKSB7CglpZiAoIXNob3dfdGlja2V0X2MpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQlzaG93X3RpY2tldF9jID0gdHJ1ZTsKCQlyZXR1cm47Cgl9CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHRpY2tldF9pbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50IikudmFsdWU7CgkJdmFyIHRpY2tldF9yZWFzb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2JlaGF2aW9yIikudmFsdWU7CgoJCXNfYnRuKCJjcmVhdGVfdGlja2V0IiwgdGlja2V0X3JlYXNvbiArICItIiArIHRpY2tldF9pbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDUgYSAyNTYgY2FyYWN0ZXJlcyBzb2xhbWVudGUuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiQ3JlYSB1biB0aWNrZXQgZWwgY3VhbCBzZXJhIGF0ZW5kaWRvL3Zpc3RvIHBvciBsb3MgYWRtaW5pc3RyYWRvcmVzLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKY19idG4ocGF0aCwgImJ0bl9nZXRfdGlja2V0cyIsICJ2aWV3IHRpY2tldHMiLCBmdW5jdGlvbiAoKSB7CglpZiAoc2hvd190aWNrZXRfYykgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJc2hvd190aWNrZXRfYyA9IGZhbHNlOwoJfQoKCXNfYnRuKCJnZXRfdGlja2V0cyIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ1c2VyX2hhc19ub190aWNrZXRzIikpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIHJlc2pzb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CgoJCQlpZiAocmVzanNvbi5sZW5ndGggPT0gMCkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9ICJubyB0aWNrZXRzIjsKCQkJCW5vdGlmeSgidXNlciBoYXMgbm8gdGlja2V0cyIsIDcwMDApOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gIm5vIHRpY2tldHMiOwoKCQkJdmFyIHRvX3RpY2tldHMgPSAiIjsKCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzanNvbikgewoJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc2pzb24sIGtleSkpIHsKCQkJCQljb25zdCBlbGVtZW50ID0gcmVzanNvbltrZXldOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxzdHJvbmc+PHU+IiArIGVsZW1lbnRbInJlYXNvbiJdICsgIiBbIiArIGVsZW1lbnRbImlkIl0gKyAiXTwvdT4gfCA8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIGRhdGEtdHRpcD0nRGVsZXRlIHRpY2tldCcgc3R5bGU9J2hlaWdodDozMHB4O3dpZHRoOmF1dG87ZGlzcGxheTppbmxpbmUtYmxvY2s7Y29sb3I6cmVkOycgb25jbGljaz1cInNfYnRuKCdkZWxldGVfdGlja2V0JywgJyIgKyBlbGVtZW50WyJpZCJdICsgIicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcik7fSk7XCI+JnRpbWVzOzwvYnV0dG9uPjwvc3Ryb25nPjxicj4iOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxwPiIgKyBlbGVtZW50WyJjb250ZW50Il0gKyAiPC9wPiI7CgkJCQkJdG9fdGlja2V0cyArPSAiPGJyPjxicj4iOwoJCQkJfQoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gdG9fdGlja2V0czsKCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0sICJNdWVzdHJhIHR1cyB0aWNrZXRzIGNyZWFkb3MiKTsKCmNfdGV4dChwYXRoLCAidXNlcl90aWNrZXRzIiwgIiIsIHsgdGV4dEFsaWduOiAiY2VudGVyIiB9KTsKCmNfYnIocGF0aCk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfdGV4dChwYXRoLCAibWFpbl9wZl90ZXh0IiwgIlByb2ZpbGUiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFdlaWdodDogJ2JvbGQnLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcyMHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAnMHB4Jwp9KTsKCmNfZGl2KHBhdGgsICJ1c2VyaW5mbyIsIHsKCWRpc3BsYXk6ICJpbmxpbmUtZ3JpZCIsCglncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDFmcikiLAoJZ3JpZEdhcDogIjEwcHgiCn0pOwoKcGF0aCA9ICJ1c2VyaW5mbyI7CmNfaW1nKHBhdGgsICJ1c2VyX2F2YXRhciIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsCgl7CgkJanVzdGlmeVNlbGY6ICJzdGFydCIsCgkJbWFyZ2luTGVmdDogIjEwcHgiLAoJCW9iamVjdEZpdDogImNvdmVyIiwKCQlib3JkZXJSYWRpdXM6ICI1cHgiCgl9KTsKCmNfdGV4dChwYXRoLCAidXNlcl9pbmZvIiwgIm5vbmUiLCB7IGRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiB9KTsKCmZ1bmN0aW9uIG93bl9pbmZvKCkgewoJZ2F0aGVyKCJnZXRfdXNlcl9pbmZvIiwgInoiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJbGV0IHVfaW5mID0gSlNPTi5wYXJzZShyZXN1bHQpOwoKCQkJaWYgKHVfaW5mWyJhdmF0YXIiXSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQl9CgoJCQl2YXIgdXNlcl9kYXRhID0gIiI7CgkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4Oyc+PHN0cm9uZz5AIiArIHVfaW5mWyJhbGlhcyJdOwoKCQkJaWYgKHVfaW5mWyJyb2xlIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxzcGFuIHN0eWxlPSdkaXNwbGF5OmlubGluZTtmb250LXNpemU6MTBweDtjb2xvcjoiICsgcm9sZWNsclt1X2luZlsicm9sZSJdLnRvTG93ZXJDYXNlKCldICsgIjsnPiAoIiArIHVfaW5mWyJyb2xlIl0gKyAiKTwvc3Bhbj48YnI+PC9zdHJvbmc+PC9wPiI7CgoJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+dWlkOiAiICsgdV9pbmZbInVzZXJfaWQiXTsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz5iZXRhIjsKCgkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQoJCQkJdXNlcl9kYXRhICs9ICIgLSBqb2luZWQ6ICIgKyBnX3RtX2R0KHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0sIGZhbHNlKSArICI8L3A+IjsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsKCgkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPmluZm86ICIgKyB3aW5kb3cuYXRvYih1X2luZlsiZGVzY3JpcHRpb24iXSkgKyAiPC9wPiI7CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPHA+PC9wPiIKCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2luZm8iKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9Cgpvd25faW5mbygpOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2FsaWFzIiwgImNoYW5nZSBhbGlhcyIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJQZXJtaXRlIGNhbWJpYXIgZWwgYWxpYXMgMSB2ZXogY2FkYSAzMCBkaWFzLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiYWxpYXNfZGxnIiwge30sIHt9KTsKcGF0aCA9ICJhbGlhc19kbGciOwoKY190ZXh0Ym94KHBhdGgsICJwZl9hbGlhc190ZXh0Ym94IiwgZmFsc2UsICIiLCAiIiwgewoJbWFyZ2luVG9wOiAiNXB4IiwKfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCW1pbkxlbmd0aDogMywKCW1heExlbmd0aDogMjAsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiYnRuX2NoYW5nZV9hbGlhcyIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYWxpYXNfdGV4dGJveCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgdHh0aW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCQlzX2J0bigiY2hhbmdlX2FsaWFzIiwgdHh0aW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlvd25faW5mbygpOwoJCQkJfQoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiY2FuY2VsX2FsaWFzIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoKY19idG4ocGF0aCwgIm9wZW5kbGdhdnRyIiwgImNoYW5nZSBhdmF0YXIiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJDYW1iaWEgZWwgYXZhdGFyIGEgdW5hIGltYWdlbiwgc29sbyBVUkxTLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiYXZ0cl9kbGciKTsKcGF0aCA9ICJhdnRyX2RsZyI7CgpjX2ltZyhwYXRoLCAiYXZ0cl9wcmV2aWV3IiwgZGVmYXVsdF9hdmF0YXIsIDkwLCA5MCwgewoJZGlzcGxheTogImJsb2NrIiwKCW1hcmdpbjogIjAgYXV0byIsCglvYmplY3RGaXQ6ICJjb3ZlciIKfSk7CgpjX2JyKCk7CgpjX3RleHQocGF0aCwgIiIsICJJbWd1ciBVUkwgb25seSwgZXhhbXBsZS4iLCB7Cgl0ZXh0QWxpZ246ICJjZW50ZXIiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CmNfdGV4dChwYXRoLCAiIiwgImh0dHBzOi8vaS5pbWd1ci5jb20vR25KYUVaTC5wbmciLCB7Cgl0ZXh0QWxpZ246ICJjZW50ZXIiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CgpjX3RleHRib3gocGF0aCwgInBmX2F2YXRhcl90ZXh0Ym94IiwgZmFsc2UsICIiLCAiMTAgYSAxMzAgY2FyYWN0ZXJlcy4gRXZpdGFyIHVzYXIgVVJMJ3MgZGUgZ2lmcy92aWRlb3MuIiwgewoJbWFyZ2luVG9wOiAiNXB4IiwKCXdpZHRoOiAiOTUlIgp9LCB7CglwYXR0ZXJuOiAiXihodHRwcz86XC9cLyk/KGlcLmltZ3VyXC5jb21cLykoW2EtekEtWjAtOV0rKShcLmpwZ3xcLmpwZWd8XC5wbmcpJCIsCgltaW5MZW5ndGg6IDIwLAoJbWF4TGVuZ3RoOiA0MCwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJidG5fcHJldmlld19hdmF0YXIiLCAicHJldmlldyIsIGZ1bmN0aW9uICgpIHsKCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwZl9hdmF0YXJfdGV4dGJveCIpOwoKCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gZWxlbV9pdGVtLnZhbHVlOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwpjX2hyKHBhdGgsIGZhbHNlKTsKCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2F2YXRhciIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYXZhdGFyX3RleHRib3giKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHR4dGluZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgkJc19idG4oJ2NoYW5nZV9hdmF0YXInLCB0eHRpbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSB0eHRpbmZvOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2YXRhciIpLnNyYyA9IHR4dGluZm87CgoJCQkJCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKTsKCQkJCQlkaWFsb2cuY2xvc2UoKTsKCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImNhbmNlbF9hdnRyIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2Rlc2MiLCAiY2hhbmdlIGRlc2NyaXB0aW9uIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjX2RsZyIpOwoJZGlhbG9nLnNob3dNb2RhbCgpOwp9LCAiQ2FtYmlhIGxhIGRlc2NyaXBjaW9uIGRlIHR1IHBlcmZpbC4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQoKY19kaWFsb2cocGF0aCwgImRlc2NfZGxnIik7CnBhdGggPSAiZGVzY19kbGciOwoKY190ZXh0YXJlYShwYXRoLCAiZGVzY3JpcHRpb25fY29udGVudCIsIGZhbHNlLCAiIiwgewoJaGVpZ2h0OiAnMTAwcHgnLAoJcmVzaXplOiAnbm9uZScsCglvdmVyZmxvdzogJ2hpZGRlbicsCgl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJbWFyZ2luVG9wOiAiNXB4IiwKCWp1c3RpZnlTZWxmOiAiY2VudGVyIiwKCXRleHRib3g6IHsKCQlkaXNwbGF5OiAiaW5oZXJpdCIKCX0KfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsCgltaW5MZW5ndGg6IDQsCgltYXhMZW5ndGg6IDI1NiwKCXBsYWNlaG9sZGVyOiAiZGVzY3JpcHRpb24iLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImJ0bl9jaGFuZ2VfZGVzY3JpcHRpb24iLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NyaXB0aW9uX2NvbnRlbnQiKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIGRlc2NfaW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCgkJc19idG4oImNoYW5nZV9kZXNjcmlwdGlvbiIsIGRlc2NfaW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlvd25faW5mbygpOwoJCQkJfQoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiY2FuY2VsX2Rlc2MiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjX2RsZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7Cgpjb25zdCB2aXJ0dWFsS2V5cyA9IFtdOwoKZm9yIChsZXQgaSA9IDB4NDE7IGkgPD0gMHg1QTsgaSsrKSB7Cgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKfQoKZm9yIChsZXQgaSA9IDB4MzA7IGkgPD0gMHgzOTsgaSsrKSB7Cgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKfQoKY29uc3Qgc3BlY2lhbEtleXMgPSBbCgl7IGNvZGU6IDAsIG5hbWU6ICdOT05FJyB9LAoJeyBjb2RlOiAweDA4LCBuYW1lOiAnQmFja3NwYWNlJyB9LAoJeyBjb2RlOiAweDA5LCBuYW1lOiAnVGFiJyB9LAoJeyBjb2RlOiAweDBELCBuYW1lOiAnRW50ZXInIH0sCgl7IGNvZGU6IDB4MTAsIG5hbWU6ICdTaGlmdCcgfSwKCXsgY29kZTogMHgxMSwgbmFtZTogJ0N0cmwnIH0sCgl7IGNvZGU6IDB4MTIsIG5hbWU6ICdBbHQnIH0sCgl7IGNvZGU6IDB4QTQsIG5hbWU6ICdMZWZ0IEFsdCcgfSwKCXsgY29kZTogMHhBNSwgbmFtZTogJ1JpZ2h0IEFsdCcgfSwKCXsgY29kZTogMHgxMywgbmFtZTogJ1BhdXNlL0JyZWFrJyB9LAoJeyBjb2RlOiAweDVCLCBuYW1lOiAnTGVmdCBXaW5kb3dzJyB9LAoJeyBjb2RlOiAweDVDLCBuYW1lOiAnUmlnaHQgV2luZG93cycgfSwKCXsgY29kZTogMHg1RCwgbmFtZTogJ0FwcGxpY2F0aW9ucycgfSwKCXsgY29kZTogMHg2MCwgbmFtZTogJ051bVBhZCAwJyB9LAoJeyBjb2RlOiAweDYxLCBuYW1lOiAnTnVtUGFkIDEnIH0sCgl7IGNvZGU6IDB4NjIsIG5hbWU6ICdOdW1QYWQgMicgfSwKCXsgY29kZTogMHg2MywgbmFtZTogJ051bVBhZCAzJyB9LAoJeyBjb2RlOiAweDY0LCBuYW1lOiAnTnVtUGFkIDQnIH0sCgl7IGNvZGU6IDB4NjUsIG5hbWU6ICdOdW1QYWQgNScgfSwKCXsgY29kZTogMHg2NiwgbmFtZTogJ051bVBhZCA2JyB9LAoJeyBjb2RlOiAweDY3LCBuYW1lOiAnTnVtUGFkIDcnIH0sCgl7IGNvZGU6IDB4NjgsIG5hbWU6ICdOdW1QYWQgOCcgfSwKCXsgY29kZTogMHg2OSwgbmFtZTogJ051bVBhZCA5JyB9LAoJeyBjb2RlOiAweDcwLCBuYW1lOiAnRjEnIH0sCgl7IGNvZGU6IDB4NzEsIG5hbWU6ICdGMicgfSwKCXsgY29kZTogMHg3MiwgbmFtZTogJ0YzJyB9LAoJeyBjb2RlOiAweDczLCBuYW1lOiAnRjQnIH0sCgl7IGNvZGU6IDB4NzQsIG5hbWU6ICdGNScgfSwKCXsgY29kZTogMHg3NSwgbmFtZTogJ0Y2JyB9LAoJeyBjb2RlOiAweDc2LCBuYW1lOiAnRjcnIH0sCgl7IGNvZGU6IDB4NzcsIG5hbWU6ICdGOCcgfSwKCXsgY29kZTogMHg3OCwgbmFtZTogJ0Y5JyB9LAoJeyBjb2RlOiAweDc5LCBuYW1lOiAnRjEwJyB9LAoJeyBjb2RlOiAweDdBLCBuYW1lOiAnRjExJyB9LAoJeyBjb2RlOiAweDdCLCBuYW1lOiAnRjEyJyB9LAoJeyBjb2RlOiAweDAxLCBuYW1lOiAnTEJVVFRPTicgfSwKCXsgY29kZTogMHgwMiwgbmFtZTogJ1JCVVRUT04nIH0sCgl7IGNvZGU6IDB4MDQsIG5hbWU6ICdNQlVUVE9OJyB9LAoJeyBjb2RlOiAweDA1LCBuYW1lOiAnWEJVVFRPTjEnIH0sCgl7IGNvZGU6IDB4MDYsIG5hbWU6ICdYQlVUVE9OMicgfSwKCXsgY29kZTogMHhCQiwgbmFtZTogJz0nIH0sCgl7IGNvZGU6IDB4QkMsIG5hbWU6ICcsJyB9LAoJeyBjb2RlOiAweEJELCBuYW1lOiAnLScgfSwKCXsgY29kZTogMHhCRSwgbmFtZTogJy4nIH0sCl07Cgp2aXJ0dWFsS2V5cy5wdXNoKC4uLnNwZWNpYWxLZXlzKTsKdmlydHVhbEtleXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5jb2RlIC0gYi5jb2RlOyB9KTsKCmZ1bmN0aW9uIGNyZWF0ZU9wdGlvbkVsZW1lbnQoa2V5RWxlbWVudCwgaWQpIHsKCWNvbnN0IG9wdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCW9wdGlvbkVsZW1lbnQudmFsdWUgPSBrZXlFbGVtZW50LmNvZGU7CglvcHRpb25FbGVtZW50LnRleHQgPSBrZXlFbGVtZW50Lm5hbWU7CglvcHRpb25FbGVtZW50LmlkID0gaWQgKyAiX29wdCI7CglyZXR1cm4gb3B0aW9uRWxlbWVudDsKfQoKYmluZF9lbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7Cgljb25zdCB0YXJnZXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudC50YXJnZXQpOwoJdmlydHVhbEtleXMuZm9yRWFjaCgoa2V5KSA9PiB7CgkJdGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChjcmVhdGVPcHRpb25FbGVtZW50KGtleSwgZWxlbWVudC5pZCkpOwoJfSk7Cn0pOwoKZnVuY3Rpb24gcl9pbmZvKCkgewoJZm9yIChjb25zdCBpIGluIHVfYm9vbCkgewoJCWdfYm9vbCh1X2Jvb2xbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2Zsb2F0KSB7CgkJZ19mbG9hdCh1X2Zsb2F0W2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9pbnQpIHsKCQlnX2ludCh1X2ludFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfaW50MikgewoJCWdfaW50KHVfaW50MltpXSwgZmFsc2UpOwoJfQp9CgpmdW5jdGlvbiB1X3NlcnZlcigpIHsKCWZvciAoY29uc3QgaSBpbiB1X2Jvb2wpIHsKCQlzX2Jvb2wodV9ib29sW2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCXNfZmxvYXQodV9mbG9hdFtpXSk7Cgl9Cn0KCmZ1bmN0aW9uIGNlbnRlcl90YWJzX2ZpeChpZCwgZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSB7Cgl2YXIgZWxlbWVudG9zID0gWydlbGVtZW50X21haW4nLCAnZWxlbWVudF9zZXR0aW5nJywgJ2VsZW1lbnRfcXJjb2RlJ107CgoJZWxlbWVudG9zLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnRvKSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKSkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudG8pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cgl9KTsKCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheTsKfQoKZnVuY3Rpb24gdGFiX3N3aXRjaChpID0gdGhpcy5pZCwgcGFuZWwgPSAiY2VudGVyIiwgZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSB7Cglzd2l0Y2ggKHBhbmVsKSB7CgkJY2FzZSAyOgoJCWNhc2UgIjIiOgoJCWNhc2UgInJpZ2h0IjoKCQkJbGV0IHRhYjJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2MtdGFiMi1idG5dIik7CgkJCXRhYjJCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4gewoJCQkJaWYgKGJ1dHRvbi5pZCA9PT0gaSkgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKCQkJCX0gZWxzZSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOwoJCQkJfQoJCQl9KTsKCQkJc3dpdGNoIChpKSB7CgkJCQljYXNlICdwX3VwZGF0ZXMnOgoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3BfdGlja2V0cyc6CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAncF9wcm9maWxlJzoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAiZ3JpZCI7CgkJCQkJYnJlYWs7CgkJCX0KCQkJYnJlYWs7CgkJY2FzZSAxOgoJCWNhc2UgIjEiOgoJCWNhc2UgImNlbnRlciI6CgkJCWxldCB0YWJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2MtdGFiLWJ0bl0iKTsKCQkJdGFiQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHsKCQkJCWlmIChidXR0b24uaWQgPT09IGkpIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CgkJCQl9IGVsc2UgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKTsKCQkJCX0KCQkJfSk7CgoJCQlzd2l0Y2ggKGkpIHsKCQkJCWNhc2UgJ21haW5fdGFiJzoKCQkJCQljZW50ZXJfdGFic19maXgoJ2VsZW1lbnRfbWFpbicsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAnc2V0dGluZ3NfdGFiJzoKCQkJCQljZW50ZXJfdGFic19maXgoJ2VsZW1lbnRfc2V0dGluZycsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAncXJjb2RlX3RhYic6CgkJCQkJY2VudGVyX3RhYnNfZml4KCdlbGVtZW50X3FyY29kZScsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQl9CgkJCWJyZWFrOwoJfQp9Cgp0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOwpyX2luZm8oKTsKCnZhciBpdGVyZm91bmQgPSAwOwp2YXIgd2FzX2dhbWVfZm91bmQgPSBmYWxzZTsKdmFyIHNob3VsZF91cGRhdGUgPSB0cnVlOwp2YXIgaXNfbW91c2VfaW5zaWRlID0gZmFsc2U7CgpmdW5jdGlvbiBoTW91c2VFKCkgeyBpc19tb3VzZV9pbnNpZGUgPSB0cnVlOyB9CmZ1bmN0aW9uIGhNb3VzZUwoKSB7IGlzX21vdXNlX2luc2lkZSA9IGZhbHNlOyB9Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiwgaE1vdXNlRSk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbGVhdmUiLCBoTW91c2VMKTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInZpc2liaWxpdHljaGFuZ2UiLCAoZXZlbnQpID0+IHsKCWlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT0gInZpc2libGUiKSB7CgkJc2hvdWxkX3VwZGF0ZSA9IHRydWU7Cgl9IGVsc2UgewoJCXNob3VsZF91cGRhdGUgPSBmYWxzZTsKCX0KfSk7Cgp2YXIgdXBkYXRlcnQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CglpZiAoc2hvdWxkX3VwZGF0ZSAmJiBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJcl9pbmZvKCk7CgkJZ19vbmxpbmVzKCk7Cgl9Cn0sIDY1MDApOwoKc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJaWYgKGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsKCQl1X2NoYXQoKTsKCX0KfSwgMzUwMCk7Cgphc3luYyBmdW5jdGlvbiBnYXRoZXIoaW5mbywgZXh0cmEsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9KSB7CglyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIGluZm8gKyAiJnZhbD0iICsgZXh0cmEsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCXJlamVjdChlcnJvcik7CgkJfSk7Cgl9KTsKfQoKZnVuY3Rpb24gemluY19pbmZvKGluZm8sIGV4dHJhKSB7CgkkLmdldCgiL2dfaW5mbz9pbmZvPSIgKyBpbmZvLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pICE9IHVuZGVmaW5lZCkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5pbm5lckhUTUwgPSBleHRyYSArIHJlc3BvbnNlVGV4dDsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJfQoJfSk7Cn0KCnZhciB3YWl0aW5nID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJJC5nZXQoIi9nX2luZm8/aW5mbz1nYW1lZm91bmQiLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJd2FzX2dhbWVfZm91bmQgPSBwYXJzZUludChyZXNwb25zZVRleHQpOwoJCWlmICghd2FzX2dhbWVfZm91bmQpIHsKCQkJemluY19pbmZvKCJ3YWl0aW5nX2dhbWUiLCAiaW50aWFsaXppbmc8YnI+Y2xvc2luZyBpbjogIik7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2RheXMiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9idXR0b25zIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfbWFpbiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCXRhYl9zd2l0Y2goIm1haW5fdGFiIiwgImNlbnRlciIsICJub25lIik7CgkJfQoJCWVsc2UgewoJCQlpdGVyZm91bmQrKzsKCgkJCWlmIChpdGVyZm91bmQgPiAyKSB7CgkJCQl6aW5jX2luZm8oInVzZXJfZGF5cyIsICJkYXlzIGxlZnQ6ICIpOwoJCQkJemluY19pbmZvKCJsYXN0X3VwZGF0ZSIsICI8c3Ryb25nPlVwZGF0ZWQ8L3N0cm9uZz46ICIpOwoJCQkJemluY19pbmZvKCJjaGFuZ2Vsb2dzIiwgIjxzdHJvbmc+Q2hhbmdlbG9nczwvc3Ryb25nPjogIik7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2FpdGluZ19nYW1lIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2J1dHRvbnMiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfbWFpbiIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfY29uZmlnIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIpOwoJCQkJdGFiX3N3aXRjaCgicF91cGRhdGVzIiwgMik7CgkJCQljbGVhckludGVydmFsKHdhaXRpbmcpOwoJCQl9CgkJfQoJfSkKfSwgMjUwKTsKCnZhciBydW5uaW5nID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJdHJ5IHsKCQkkLmdldCgiL2dfaW5mbz9pbmZvPXJ1bm5pbmciLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNfZXhpdCgpOwoJCX0pOwoJfSBjYXRjaCAoZXJyb3IpIHsKCQljb25zb2xlLmxvZyhlcnJvcik7CgkJYWxlcnQoZXJyb3IpOwoJCWNfZXhpdCgpOwoJfQp9LCAxMjUwKTsKCmZ1bmN0aW9uIGNfZGlhbG9nKGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgewoJCWNvbnNvbGUubG9nKCJlbGVtZW50IGV4aXN0IHdpdGggaWQ6ICIsIGlkX2l0ZW0pCgkJcmV0dXJuOwoJfQoKCWNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpYWxvZyIpOwoJZGlhbG9nLmlkID0gaWRfaXRlbTsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihkaWFsb2cuc3R5bGUsIHN0eWxleik7Cgl9CgoJaWYgKGVsZW1udCkgewoJCWZvciAobGV0IGtleSBpbiBlbGVtbnQpIHsKCQkJY29uc3QgZWxlbWVudCA9IGVsZW1udFtrZXldOwoJCQljb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZWxlbWVudC50eXBlKTsKCQkJT2JqZWN0LmFzc2lnbihlbCwgZWxlbWVudC5wcm9wcyk7CgkJCU9iamVjdC5hc3NpZ24oZWwuc3R5bGUsIGVsZW1lbnQuc3R5bGVzKTsKCQkJZGlhbG9nLmFwcGVuZENoaWxkKGVsKTsKCQl9Cgl9CgoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpLmFwcGVuZENoaWxkKGRpYWxvZyk7Cn0KCmZ1bmN0aW9uIGNfZGl2KGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJZGl2LmlkID0gaWRfaXRlbTsKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGRpdiwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJZGl2LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGRpdi5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKfQoKZnVuY3Rpb24gY190YWJfYnV0dG9uKGlkX3doZXJlLCBidXR0b25zLCB0eXBleiA9IDEpIHsKCWNvbnN0IHRhYkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCglidXR0b25zLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbiwgaW5kZXgpIHsKCQl2YXIgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CgkJYnRuLmNsYXNzTmFtZSA9ICJ0YWItYnV0dG9uIjsKCQlidG4uc2V0QXR0cmlidXRlKHR5cGV6ID09IDEgPyAiYy10YWItYnRuIiA6ICgiYy10YWIiICsgdHlwZXogKyAiLWJ0biIpLCAiIik7CgkJYnRuLmlkID0gYnV0dG9uLmlkOwoJCWJ0bi5pbm5lckhUTUwgPSBidXR0b24udGV4dDsKCgkJaWYgKGluZGV4ID09PSAwKSB7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BSaWdodFJhZGl1cyA9ICIwcHgiOwoJCX0gZWxzZSBpZiAoaW5kZXggPT09IGJ1dHRvbnMubGVuZ3RoIC0gMSkgewoJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOwoJCX0gZWxzZSB7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BSaWdodFJhZGl1cyA9ICIwcHgiOwoJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOwoJCX0KCgkJYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJCXRhYl9zd2l0Y2godGhpcy5pZCwgdHlwZXopOwoJCX07CgoJCXRhYkNvbnRhaW5lci5hcHBlbmRDaGlsZChidG4pOwoJfSk7Cn0KCmZ1bmN0aW9uIGdfdG1fZHQodGltZXN0YW1wLCBocm1pbiA9IHRydWUpIHsKCXZhciBkYXRlID0gbmV3IERhdGUoK3RpbWVzdGFtcCAqIDEwMDApOwoJaWYgKGhybWluKSB7CgkJdmFyIGhvdXIgPSAoIjAiICsgZGF0ZS5nZXRIb3VycygpKS5zdWJzdHIoLTIpOwoJCXZhciBtaW51dGVzID0gKCIwIiArIGRhdGUuZ2V0TWludXRlcygpKS5zdWJzdHIoLTIpOwoJCXJldHVybiAoaG91ciArICI6IiArIG1pbnV0ZXMpOwoJfQoJZWxzZSB7CgkJdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJdmFyIG1vbnRoID0gKCIwIiArIChkYXRlLmdldE1vbnRoKCkgKyAxKSkuc3Vic3RyKC0yKTsKCQl2YXIgZGF5ID0gKCIwIiArIGRhdGUuZ2V0RGF0ZSgpKS5zdWJzdHIoLTIpOwoJCXJldHVybiAoZGF5ICsgIi8iICsgbW9udGggKyAiLyIgKyB5ZWFyKTsKCX0KfQoKZnVuY3Rpb24gY19idG4oaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9LCB0b29sdGlwID0gIiIsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CglidXR0b24udHlwZSA9ICJidXR0b24iOwoJYnV0dG9uLmNsYXNzTGlzdC5hZGQoIm5ld2J1dHRvbiIpOwoJYnV0dG9uLmlkID0gaWRfaXRlbTsKCWJ1dHRvbi5pbm5lckhUTUwgPSB0ZXh0OwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGJ1dHRvbiwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGJ1dHRvbi5zdHlsZSwgc3R5bGV6KTsKCX0KCglidXR0b24ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQlmdW5jMigpOwoJfTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwp9CgpmdW5jdGlvbiBjX2hyKGlkX3doZXJlID0gcGF0aCwgbWFyZ2luID0gdHJ1ZSwgc3R5bGV6ID0ge30pIHsKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCXZhciBociA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImhyIik7CglpZiAobWFyZ2luKQoJCWhyLnN0eWxlLm1hcmdpbkxlZnQgPSAiLTIwcHgiOwoJaHIuc3R5bGUuYm9yZGVyVG9wID0gIjFweCBzb2xpZCB2YXIoLS1jLWhyKSI7CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oaHIuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGhyKTsKfQoKZnVuY3Rpb24gY19icihpZF93aGVyZSA9IHBhdGgsIGFtb3VudCA9IDEpIHsKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhbW91bnQ7IGluZGV4KyspIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7Cgl9Cn0KCmZ1bmN0aW9uIGNfY2hlY2tib3goaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHRvb2x0aXAgPSAiIiwgZnVuYzIgPSBmdW5jdGlvbiAoY19lbCkgeyB9KSB7Cgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdlbGVtaXRlbXNfYmcnKTsKCWRpdi5odG1sRm9yID0gaWRfaXRlbTsKCgljb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgljaGVja2JveC50eXBlID0gImNoZWNrYm94IjsKCWNoZWNrYm94LmlkID0gaWRfaXRlbTsKCWNoZWNrYm94Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXVfc2VydmVyKCk7CgkJZnVuYzIoY2hlY2tib3gpOwoJfTsKCgljb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CglsYWJlbC5odG1sRm9yID0gaWRfaXRlbTsKCWxhYmVsLmlubmVySFRNTCA9IHRleHQ7CglsYWJlbC5pZCA9IGlkX2l0ZW0gKyAienp6enoiOwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWRpdi5hcHBlbmRDaGlsZChjaGVja2JveCk7CglkaXYuYXBwZW5kQ2hpbGQobGFiZWwpOwoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwoKCXVfYm9vbC5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX3NfZmxvYXQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzdGVwX3ZhbCwgZGVmYXVsdF92YWwpIHsKCXZhciBzdGVwdmFsX2Nlcm9zID0gKFN0cmluZyhzdGVwX3ZhbCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CglzdGVwdmFsX2Nlcm9zID0gc3RlcHZhbF9jZXJvcy5sZW5ndGg7CgoJY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CglkaXYuY2xhc3NMaXN0LmFkZCgnbGVuZ3RoJywgJ2Zfc2xpZGVyX2JnJyk7CglkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW1pbicsIG1pbik7CglkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW1heCcsIG1heCk7CgoJY29uc3QgdGl0bGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCXRpdGxlRGl2LmNsYXNzTGlzdC5hZGQoJ2xfdGl0bGUnLCAnZl90aXRsZScpOwoJdGl0bGVEaXYuc2V0QXR0cmlidXRlKCdkYXRhLWxlbmd0aCcsIGRlZmF1bHRfdmFsKTsKCXRpdGxlRGl2LnRleHRDb250ZW50ID0gdGV4dCArICI6ICI7CgoJY29uc3QgbnVtYmVyX2lucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCW51bWJlcl9pbnB1dC5jbGFzc0xpc3QuYWRkKCJudW1iZXJzbGlkZXIiKTsKCW51bWJlcl9pbnB1dC50eXBlID0gIm51bWJlciI7CgludW1iZXJfaW5wdXQucGF0dGVybiA9ICJbMC05XSoiOwoJbnVtYmVyX2lucHV0LmlucHV0TW9kZSA9ICJudW1lcmljIjsKCW51bWJlcl9pbnB1dC5pZCA9IGlkX2l0ZW07CgludW1iZXJfaW5wdXQubWluID0gbWluOwoJbnVtYmVyX2lucHV0Lm1heCA9IG1heDsKCW51bWJlcl9pbnB1dC5zdGVwID0gc3RlcF92YWw7CgludW1iZXJfaW5wdXQudmFsdWUgPSBkZWZhdWx0X3ZhbDsKCW51bWJlcl9pbnB1dC5vbmlucHV0ID0gZnVuY3Rpb24gKCkgewoJCXVfc2VydmVyKCk7CgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCX07CgoJY29uc3QgbWludXNfYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CgltaW51c19idG4uY2xhc3NMaXN0LmFkZCgiY29udHJvbHMtbnVtYmVyIik7CgltaW51c19idG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJbWludXNfYnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCW1pbnVzX2J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJbWludXNfYnRuLmlubmVySFRNTCA9ICgiJiM4NzIyOyIpLnRyaW0oKTsKCW1pbnVzX2J0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAwLCBtaW4sIG1heCwgMSwgc3RlcHZhbF9jZXJvcyk7CgkJdV9zZXJ2ZXIoKTsKCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJfTsKCgljb25zdCBwbHVzX2J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJcGx1c19idG4uY2xhc3NMaXN0LmFkZCgiY29udHJvbHMtbnVtYmVyIik7CglwbHVzX2J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CglwbHVzX2J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CglwbHVzX2J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJcGx1c19idG4uaW5uZXJIVE1MID0gKCImIzQzOyIpLnRyaW0oKTsKCXBsdXNfYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDEsIG1pbiwgbWF4LCAxLCBzdGVwdmFsX2Nlcm9zKTsKCQl1X3NlcnZlcigpOwoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7Cgl9OwoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7CglkaXYuYXBwZW5kQ2hpbGQobWludXNfYnRuKTsKCWRpdi5hcHBlbmRDaGlsZChudW1iZXJfaW5wdXQpOwoJZGl2LmFwcGVuZENoaWxkKHBsdXNfYnRuKTsKCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgl1X2Zsb2F0LnB1c2goaWRfaXRlbSk7Cn0KCmZ1bmN0aW9uIGNfaW1nKGlkX3doZXJlLCBpZF9pdGVtLCBpbWFnZSwgd2lkdGgsIGhlaWdodCwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgoJY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CgoJaW1nLnNldEF0dHJpYnV0ZSgnaWQnLCBpZF9pdGVtKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ2FsdCcsICJ1X2F2YXRhciIpOwoJaW1nLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCk7CglpbWcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQpOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGltZywgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJaW1nLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGltZy5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoaW1nKTsKfQoKZnVuY3Rpb24gY190ZXh0YXJlYShpZF93aGVyZSwgaWRfaXRlbSwgaGlkZGVuID0gZmFsc2UsIGxhYmVsID0gIiIsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJY29uc3QgdGV4dGJveF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Ym94Iik7CgoJCWNvbnN0IGxhYmVsRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CgkJbGFiZWxFbGVtLnRleHRDb250ZW50ID0gbGFiZWwudHJpbSgpOwoJCWxhYmVsRWxlbS5pZCA9IGlkX2l0ZW0gKyAibGJsIjsKCQlsYWJlbEVsZW0uc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoJCWxhYmVsRWxlbS5zZXRBdHRyaWJ1dGUoImZvciIsIGlkX2l0ZW0pOwoKCQlpZiAoc3R5bGV6ICYmIHN0eWxlei5sYWJlbHopIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LmxhYmVseik7CgkJfQoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7Cgl9CgoJY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwoKCXRleHRhcmVhLmlkID0gaWRfaXRlbTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0YXJlYSwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHRleHRhcmVhLnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRib3gpIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCX0KCX0KCglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJfSBlbHNlIHsKCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAobGFiZWwgPT09ICIiICYmIGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7Cgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Ym94X2Rpdik7Cgl9Cn0KCmZ1bmN0aW9uIGNfdGV4dGJveChpZF93aGVyZSwgaWRfaXRlbSwgaGlkZGVuID0gZmFsc2UsIGxhYmVsID0gIiIsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9LCBkaXNhYmxlc3R5bGUgPSBmYWxzZSkgewoJY29uc3QgdGV4dGJveF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Ym94Iik7CgoJCWNvbnN0IGxhYmVsRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CgkJbGFiZWxFbGVtLnRleHRDb250ZW50ID0gbGFiZWwudHJpbSgpOwoJCWxhYmVsRWxlbS5pZCA9IGlkX2l0ZW0gKyAibGJsIjsKCQlsYWJlbEVsZW0uc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoJCWxhYmVsRWxlbS5zZXRBdHRyaWJ1dGUoImZvciIsIGlkX2l0ZW0pOwoKCQlpZiAoc3R5bGV6ICYmIHN0eWxlei5sYWJlbHopIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LmxhYmVseik7CgkJfQoKCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZChsYWJlbEVsZW0pOwoJfQoKCWNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJ0ZXh0Iik7CglpbnB1dC5zZXRBdHRyaWJ1dGUoImlkIiwgaWRfaXRlbSk7CgoJaWYgKGRpc2FibGVzdHlsZSkKCQlpbnB1dC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbm92YWxpZGludmFsaWQnLCAnJyk7CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlpbnB1dC5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApCgl9CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oaW5wdXQsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWlucHV0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoZXYpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMsIGV2KTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlucHV0LnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihpbnB1dC5zdHlsZSwgc3R5bGV6KTsKCgkJaWYgKHN0eWxlei50ZXh0Ym94KSB7CgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei50ZXh0Ym94KTsKCQl9Cgl9CgoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKCX0gZWxzZSB7CgkJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJaWYgKGxhYmVsID09PSAiIiAmJiBjb250YWluZXIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJfSBlbHNlIGlmIChjb250YWluZXIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGJveF9kaXYpOwoJfQp9CgpmdW5jdGlvbiBjX3RleHQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7Cgl0ZXh0X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Iik7CgoJaWYgKHRleHQpCgkJdGV4dF9kaXYuaW5uZXJIVE1MID0gdGV4dC50cmltKCk7CgoJdGV4dF9kaXYuaWQgPSBpZF9pdGVtOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQl0ZXh0X2Rpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2Rpdi5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwp9CgpmdW5jdGlvbiBjX2NvbWJvYm94MihpZF93aGVyZSwgaWRfaXRlbSwgb3B0aW9ucywgaGlkZGVuID0gZmFsc2UsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30pIHsKCWNvbnN0IHNlbGVjdF9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7CglzZWxlY3RfZWxlbS5jbGFzc0xpc3QuYWRkKCJzZWxlY3QtZHJvcGRvd24iKTsKCXNlbGVjdF9lbGVtLmlkID0gaWRfaXRlbTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCXNlbGVjdF9lbGVtLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJb3B0aW9ucy5mb3JFYWNoKChvcHRpb24sIGluZGV4KSA9PiB7CgkJY29uc3Qgb3B0aW9uX2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCQlvcHRpb25fZWxlbS52YWx1ZSA9IGluZGV4OwoJCW9wdGlvbl9lbGVtLnRleHQgPSBvcHRpb247CgkJc2VsZWN0X2VsZW0uYWRkKG9wdGlvbl9lbGVtKTsKCX0pOwoKCXNlbGVjdF9lbGVtLnN0eWxlLmRpc3BsYXkgPSAoKGhpZGRlbiA9PSB0cnVlKSA/ICgibm9uZSIpIDogKCJpbmxpbmUtYmxvY2siKSk7CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oc2VsZWN0X2VsZW0uc3R5bGUsIHN0eWxleik7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsKfQoKZnVuY3Rpb24gY19jb21ib2JveChpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgbWluLCBtYXgsIHNhbWVsaW5lID0gZmFsc2UsIHRvb2x0aXAgPSAiIiwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0sIHN0eWxleiA9IHt9KSB7Cgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJdGV4dF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dCIpOwoJdGV4dF9kaXYudGV4dENvbnRlbnQgPSB0ZXh0LnRyaW0oKTsKCgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CgoJaWYgKHNhbWVsaW5lKQoJCXNlbGVjdF9lbGVtLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjEwcHgiOwoKCXNlbGVjdF9lbGVtLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJZnVuYzIoKTsKCX07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRfZGl2KSB7CgkJCU9iamVjdC5hc3NpZ24oc2VsZWN0X2VsZW0uc3R5bGUsIHN0eWxlei50ZXh0X2Rpdik7CgkJfQoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0X2Rpdik7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZWN0X2VsZW0pOwoKCXVfaW50Mi5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX3NfaW50KGlkX3doZXJlLCBpZF9pdGVtLCBpZF90ZXh0LCBtaW4sIG1heCwgc3RlcCwgdmFsdWUsIHRvb2x0aXAgPSAiIikgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdyX3NsaWRlcl9iZycpOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1taW4nLCBtaW4pOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoKCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsKCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCB2YWx1ZSk7Cgl0aXRsZURpdi50ZXh0Q29udGVudCA9IGlkX3RleHQgKyAiOiAiOwoKCWNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCgljb25zdCBtaW51c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJbWludXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7CgltaW51c0J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgltaW51c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CgltaW51c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJbWludXNCdG4uaW5uZXJIVE1MID0gKCImIzg3MjI7IikudHJpbSgpOwoJbWludXNCdG4ub25jbGljayA9ICgpID0+IHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgpOwoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJYXBwbHlGaWxsKGlucHV0KTsKCX07CgoJY29uc3QgcGx1c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJcGx1c0J0bi5jbGFzc05hbWUgPSAiY29udHJvbHMtbnVtYmVyIjsKCXBsdXNCdG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJcGx1c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CglwbHVzQnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CglwbHVzQnRuLmlubmVySFRNTCA9ICgiJiM0MzsiKS50cmltKCk7CglwbHVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDEsIG1pbiwgbWF4KTsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWlucHV0LmNsYXNzTGlzdC5hZGQoJ3NsaWRlcicpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3JhbmdlJyk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21pbicsIG1pbik7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21heCcsIG1heCk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3N0ZXAnLCBzdGVwKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCB2YWx1ZSk7CglpbnB1dC5vbmNoYW5nZSA9ICgpID0+IHsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTsKCWRpdi5hcHBlbmRDaGlsZChtaW51c0J0bik7CglkaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJZGl2LmFwcGVuZENoaWxkKHBsdXNCdG4pOwoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwoKCXVfaW50LnB1c2goaWRfaXRlbSk7Cn0KCmNvbnN0IHNsaWRlclByb3BzID0gewoJYmFja2dyb3VuZDogInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yMTQpIiwKfTsKCmNvbnN0IHNsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucl9zbGlkZXJfYmciKTsKCnNsaWRlcnMuZm9yRWFjaCgoc2xpZGVyKSA9PiB7Cgljb25zdCBzbGlkZXJJbnB1dCA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIuc2xpZGVyIik7Cgljb25zdCBzbGlkZXJWYWx1ZSA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpOwoKCXNsaWRlcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKGV2ZW50KSA9PiB7CgkJc2xpZGVyVmFsdWUuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIGV2ZW50LnRhcmdldC52YWx1ZSk7CgkJYXBwbHlGaWxsKGV2ZW50LnRhcmdldCk7Cgl9KTsKCglhcHBseUZpbGwoc2xpZGVySW5wdXQpOwp9KTsKCmNvbnN0IGZfc2xpZGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5mX3NsaWRlcl9iZyIpOwoKZl9zbGlkZXJzLmZvckVhY2goYXN5bmMgKHNsaWRlcikgPT4gewoJY29uc3Qgc2xpZGVySW5wdXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLm51bWJlcnNsaWRlciIpOwoJY29uc3Qgc2xpZGVyVmFsdWUgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKTsKCglsZXQgc3RlcHZhbF9jZXJvcyA9IChTdHJpbmcoc2xpZGVySW5wdXQuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJYXBwbHlGaWxsKHNsaWRlcklucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLmxlbmd0aCwgc2xpZGVySW5wdXQudmFsdWUpOwp9KTsKCmZ1bmN0aW9uIGFwcGx5RmlsbChzbGlkZXIsIGlzX2ZsdCA9IGZhbHNlLCBmbHRwYXJzZSA9IDEsIHZhbHVlKSB7CglpZiAoaXNfZmx0KSB7CgkJc2xpZGVyLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZChmbHRwYXJzZSkpOwoJCXNsaWRlci5zdHlsZS5iYWNrZ3JvdW5kID0gc2xpZGVyUHJvcHMuYmFja2dyb3VuZDsKCQlzbGlkZXIuc3R5bGUuY29sb3IgPSAndmFyKC0tYy10ZXh0KSc7CgkJc2xpZGVyLnN0eWxlLmJvcmRlclJhZGl1cyA9ICI1cHgiOwoJCXNsaWRlci5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHZhcigtLWMtY29udG9ybm9zKSI7CgkJcmV0dXJuOwoJfQoKCWNvbnN0IHBlcmNlbnRhZ2UgPSAoKDEwMCAqIChzbGlkZXIudmFsdWUgLSBzbGlkZXIubWluKSkgLyAoc2xpZGVyLm1heCAtIHNsaWRlci5taW4pKS50b0ZpeGVkKDEpOwoJY29uc3QgYmcgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCB2YXIoLS1jLXByaW1hcnkpIDAlLCB2YXIoLS1jLXNlY29uZGFyeSkgJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gMTAwJSlgOwoJc2xpZGVyLnN0eWxlLmJhY2tncm91bmQgPSBiZzsKCXNsaWRlci5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoIi5sX3RpdGxlIikuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIHNsaWRlci52YWx1ZSk7Cn0KCmZ1bmN0aW9uIHN1bXJlc3RfYnV0dG9ucyhpdGVtX2lkLCBzdW0sIG1pbiwgbWF4LCBpc19mbHQgPSAwLCBmbHRwYXJzZSA9IDEpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKSA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhpdGVtX2lkLCAiZG9lc250IGV4aXN0Iik7CgkJcmV0dXJuOwoJfQoKCWlmIChpc19mbHQpIHsKCQlpZiAoc3VtKSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA+IG1heCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IChwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSArIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCkpLnRvRml4ZWQoZmx0cGFyc2UpOwoJCX0gZWxzZSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA8IG1pbikKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IChwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSAtIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCkpLnRvRml4ZWQoZmx0cGFyc2UpOwoJCX0KCX0KCWVsc2UgewoJCWlmIChzdW0pIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID4gbWF4KQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUludChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpICsgcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQl9IGVsc2UgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPCBtaW4pCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlSW50KG1heCk7CgkJCWVsc2UKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgLSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApOwoJCX0KCX0KfQoKd2luZG93Lm1vYmlsZUNoZWNrID0gZnVuY3Rpb24gKCkgewoJbGV0IGNoZWNrID0gZmFsc2U7CgkoZnVuY3Rpb24gKGEpIHsgaWYgKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSkgfHwgLzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHNcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1wtKG58dSl8YzU1XC98Y2FwaXxjY3dhfGNkbVwtfGNlbGx8Y2h0bXxjbGRjfGNtZFwtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFwtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmXC01fGdcLW1vfGdvKFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZFwtKG18cHx0KXxoZWlcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXC1jfGh0KGMoXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XC18XC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XC8pfGtsb258a3B0IHxrd2NcLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XC8oa3xsfHUpfDUwfDU0fFwtW2Etd10pfGxpYnd8bHlueHxtMVwtd3xtM2dhfG01MFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKVwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblwtMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0XC1nfHFhXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFwtWzItN118aVwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXC18b298cFwtKXxzZGtcL3xzZShjKFwtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaFwtfHNoYXJ8c2llKFwtfG0pfHNrXC0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGhcLXx2XC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcLXx0ZGdcLXx0ZWwoaXxtKXx0aW1cLXx0XC1tb3x0byhwbHxzaCl8dHMoNzB8bVwtfG0zfG01KXx0eFwtOXx1cChcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcLXx5b3VyfHpldG98enRlXC0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlOyB9KShuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhKTsKCXJldHVybiBjaGVjazsKfTsKCndpbmRvdy5zdGVhbUNoZWNrID0gZnVuY3Rpb24gKCkgewoJbGV0IHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKCWxldCBpc1N0ZWFtQnJvd3NlciA9IHVzZXJBZ2VudC5pbmRleE9mKCJzdGVhbSIpID4gLTE7CglyZXR1cm4gaXNTdGVhbUJyb3dzZXI7Cn07CgppZiAoIXdpbmRvdy5tb2JpbGVDaGVjaygpKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJjb2RlX3RleHQiKS5pbm5lckhUTUwgPSAic2NhbiBvbiBtb2JpbGUgb3IgZW50ZXI6ICIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiIG9uIHlvdXIgbW9iaWxlIGJyb3dzZXIiOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyaW1hZ2UiKS5zcmMgPSAiaHR0cHM6Ly9jaGFydC5nb29nbGVhcGlzLmNvbS9jaGFydD9jaHQ9cXImY2hsPSIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiJmNocz0yNTB4MjUwJmNobGQ9THwwIjsKCgl3aW5kb3cub25sb2FkID0gZnVuY3Rpb24gKCkgewoJCWlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApIHsKCQkJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcpOwoJCQl0X3BhbmVsKHRoaXMpOwoJCX0KCQllbHNlIHsKCQkJaWYgKHdpbmRvdy5zdGVhbUNoZWNrKCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsKCgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfSwgMjUwKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS53aWR0aCA9ICIwcHgiOwoKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0sIDI1MCk7CgoJCQkJbm90aWZ5KCJwYW5lbHMgZGlzYWJsZWQgb24gc3RlYW0uIik7CgkJCX0gZWxzZSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfSwgMjUwKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAxOwoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0sIDI1MCk7CgkJCX0KCQl9Cgl9Owp9CmVsc2UgewoJZG9jdW1lbnQuYm9keS5zdHlsZS56b29tID0gIjc1JSI7Cgl0X3BhbmVsKHRoaXMsICdsZWZ0X3BhbmVsJyk7Cgl0X3BhbmVsKHRoaXMpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gIm9ubHkgb24gcGMiLnRyaW0oKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKfQoKZnVuY3Rpb24gc3RyaW5nMmJvb2woc3RyaW5nKSB7Cglzd2l0Y2ggKHN0cmluZy50b0xvd2VyQ2FzZSgpLnRyaW0oKSkgewoJCWNhc2UgInRydWUiOgoJCWNhc2UgInllcyI6CgkJY2FzZSAiMSI6CgkJCXJldHVybiB0cnVlOwoJCWNhc2UgImZhbHNlIjoKCQljYXNlICJubyI6CgkJY2FzZSAiMCI6CgkJY2FzZSBudWxsOgoJCQlyZXR1cm4gZmFsc2U7CgkJZGVmYXVsdDoKCQkJcmV0dXJuIEJvb2xlYW4oc3RyaW5nKTsKCX0KfQoKZnVuY3Rpb24gZ19ib29sKG1vZHVsZSkgewoJJC5nZXQoIi9nX2Jvb2w/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmNoZWNrZWQgPSBzdHJpbmcyYm9vbChyZXNwb25zZVRleHQpOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsKCgkJaWYgKCF1X2FsX2Jvb2wuaW5jbHVkZXMobW9kdWxlKSkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJjaGFuZ2UiKSk7CgkJCXVfYWxfYm9vbC5wdXNoKG1vZHVsZSk7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdfaW50KG1vZHVsZSwgcmV0dXJuZWQgPSB0cnVlKSB7CgkkLmdldCgiL2dfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZSA9IHJlc3BvbnNlVGV4dDsKCgkJaWYgKG1vZHVsZS5pbmNsdWRlcygidGhlbWVfc2VsZWN0IikpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCX0KCgkJaWYgKHJldHVybmVkKSB7CgkJCWlmICghdV9hbF9pbnQuaW5jbHVkZXMobW9kdWxlKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiaW5wdXQiKSk7CgkJCQl1X2FsX2ludC5wdXNoKG1vZHVsZSk7CgkJCX0KCgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gZ19mbG9hdChtb2R1bGUpIHsKCSQuZ2V0KCIvZ19mbG9hdD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCXZhciBzdGVwdmFsX2Nlcm9zMiA9IChTdHJpbmcoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5zdGVwKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsKCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZSA9IHBhcnNlRmxvYXQocmVzcG9uc2VUZXh0KS50b0ZpeGVkKHN0ZXB2YWxfY2Vyb3MyLmxlbmd0aCk7CgkJaWYgKCF1X2FsX2Zsb2F0LmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiaW5wdXQiKSk7CgkJCXVfYWxfZmxvYXQucHVzaChtb2R1bGUpOwoJCX0KCgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikgIT0gdW5kZWZpbmVkKQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7Cgl9KTsKfQoKZnVuY3Rpb24gc19ib29sKG1vZHVsZSkgewoJbGV0IG1vZHVsZXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpOwoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikKCQlyZXR1cm47Cgl9Cgl2YXIgdmFsdWUgPSBtb2R1bGV6LmNoZWNrZWQ7CgoJJC5nZXQoIi9zX2Jvb2w/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IH0pOwp9CgpmdW5jdGlvbiBzX2ludDIobW9kdWxlLCBtaW4gPSAwLCBtYXggPSAwKSB7CglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhtb2R1bGUgKyAiIG5vdCBmb3VuZCIpOwoJCXJldHVybjsKCX0KCgl2YXIgdmFsdWUgPSBtb2R1bGV6LnZhbHVlOwoKCWlmIChtaW4gPT0gMCAmJiBtYXggPT0gMCkgewoJCSQuZ2V0KCIvc19pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCXZhciBlbGVtZW50RXhpc3RzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKTsKCQkJaWYgKGVsZW1lbnRFeGlzdHMgIT0gdW5kZWZpbmVkIHx8IGVsZW1lbnRFeGlzdHMgIT0gbnVsbCkKCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCX0pOwoJfSBlbHNlIHsKCQlpZiAocGFyc2VJbnQodmFsdWUpID49IHBhcnNlSW50KG1pbikgJiYgcGFyc2VJbnQodmFsdWUpIDw9IHBhcnNlSW50KG1heCkpIHsKCQkJJC5nZXQoIi9zX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCXZhciBlbGVtZW50RXhpc3RzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKTsKCQkJCWlmIChlbGVtZW50RXhpc3RzICE9IHVuZGVmaW5lZCB8fCBlbGVtZW50RXhpc3RzICE9IG51bGwpCgkJCQkJZWxlbWVudEV4aXN0cy5pbm5lckhUTUwgPSByZXNwb25zZVRleHQ7CgkJCX0pOwoJCX0KCQllbHNlIHsKCQkJY29uc29sZS5sb2coIm1pbm1heCBvdmVycGFzc2VkIHwgIiwgdmFsdWUsIG1pbiwgbWF4KTsKCQl9Cgl9Cn0KCmZ1bmN0aW9uIHNfZmxvYXQobW9kdWxlKSB7CglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKQoJCXJldHVybjsKCX0KCgl2YXIgdmFsdWUgPSBwYXJzZUZsb2F0KG1vZHVsZXoudmFsdWUpOwoJdmFyIG1pbiA9IHBhcnNlRmxvYXQobW9kdWxlei5taW4pOwoJdmFyIG1heCA9IHBhcnNlRmxvYXQobW9kdWxlei5tYXgpOwoKCWlmICh2YWx1ZSA+PSBtaW4gJiYgdmFsdWUgPD0gbWF4KSB7CgkJJC5nZXQoIi9zX2Zsb2F0P2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsKCQl9KTsKCX0KfQoKZnVuY3Rpb24gc19pbmZvKG1vZHVsZSwgdmFsdWUsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9KSB7CgkkLmdldCgiL3NfaW5mbz9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlmdW5jMigpOwoJfSk7Cn0KCmZ1bmN0aW9uIHNfYnRuKG1vZHVsZSwgdmFsdWUgPSAiIikgewoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQlpZiAodmFsdWUgPT0gIiIpIHsKCQkJJC5nZXQoIi90b2dnbGU/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCQlyZWplY3QoZXJyb3IpOwoJCQl9KTsKCQl9IGVsc2UgewoJCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsKCQkJfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCXJlamVjdChlcnJvcik7CgkJCX0pOwoJCX0KCX0pOwp9CgpmdW5jdGlvbiBjX2V4aXQoKSB7CglzX2J0bigiZGVhZCIpOwoJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJd2luZG93Lm9wZW4oIiIsICJfc2VsZiIsICIiKTsKCQl3aW5kb3cuY2xvc2UoKTsKCQloaXN0b3J5LmdvKC0xKTsKCQluYXZpZ2F0b3IuYXBwLmJhY2tIaXN0b3J5KCk7CgkJd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwoJfSwgNTAwMCk7Cn0KCmZ1bmN0aW9uIGZfY29tYm8oaWRfaXRlbSwgaWRfc2VydmVyKSB7CgkkLmdldCgiL2dfaW5mbz9pbmZvPSIgKyBpZF9zZXJ2ZXIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQl2YXIgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSk7CgoJCWlmIChzZWxlY3QgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKGlkX2l0ZW0sICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHJlc3BvbnNlID0gd2luZG93LmF0b2IocmVzcG9uc2VUZXh0KTsKCgkJaWYgKHJlc3BvbnNlICE9IG51bGwpIHsKCQkJcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTsKCQkJaWYgKHJlc3BvbnNlICE9IG51bGwpIHsKCQkJCXNlbGVjdC5pbm5lckhUTUwgPSAoIiIpLnRyaW0oKTsKCgkJCQlmb3IgKGNvbnN0IGtleSBpbiByZXNwb25zZSkgewoJCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNwb25zZSwga2V5KSkgewoJCQkJCQljb25zdCBlbGVtZW50ID0gcmVzcG9uc2Vba2V5XTsKCQkJCQkJdmFyIG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwoJCQkJCQlvcHQudmFsdWUgPSBrZXk7CgkJCQkJCW9wdC5pbm5lckhUTUwgPSBlbGVtZW50WyJpZCJdOwoJCQkJCQlzZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9KTsKfQoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIGZ1bmN0aW9uIChmKSB7CglpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcsIDEpOwoJCXRfcGFuZWwodGhpcywgJ3JpZ2h0X3BhbmVsJywgMSk7Cgl9CgllbHNlIHsKCQl0X3BhbmVsKHRoaXMsICdsZWZ0X3BhbmVsJywgMik7CgkJdF9wYW5lbCh0aGlzLCAncmlnaHRfcGFuZWwnLCAyKTsKCX0KfSk7Cgphc3luYyBmdW5jdGlvbiB0X3BhbmVsKGJ0biwgaWQgPSAicmlnaHRfcGFuZWwiLCB0eXBlID0gMCkgewoJY29uc3QgcGFuZWxfZWxtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJaWYgKHR5cGUgPT0gMCkgewoJCWlmIChwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIpIHsKCQkJcGFuZWxfZWxtLnN0eWxlLndpZHRoID0gIjBweCI7CgkJCXBhbmVsX2VsbS5zdHlsZS5oZWlnaHQgPSAiMHB4IjsKCQkJcGFuZWxfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMCI7CgkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCX0sIDI1MCk7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UgewoJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCWF3YWl0IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4geyB9LCAyNTApOwoKCQkJcGFuZWxfZWxtLnN0eWxlLndpZHRoID0gImF1dG8iOwoJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwoJCQlwYW5lbF9lbG0uc3R5bGUub3BhY2l0eSA9ICIxIjsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQl9CgoJCX0KCX0KCWVsc2UgewoJCWlmIChwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIgJiYgdHlwZSA9PSAxKSB7CgkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOwoJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gIjBweCI7CgkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjAiOwoJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCXBhbmVsX2VsbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl9LCAyNTApOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIGlmICh0eXBlID09IDIgJiYgcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKSB7CgkJCXBhbmVsX2VsbS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJYXdhaXQgc2V0VGltZW91dChhc3luYyAoKSA9PiB7IH0sIDI1MCk7CgoJCQlwYW5lbF9lbG0uc3R5bGUud2lkdGggPSAiYXV0byI7CgkJCXBhbmVsX2VsbS5zdHlsZS5oZWlnaHQgPSAiYXV0byI7CgkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjEiOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCX0KCgkJfQoJfQp9Cgp2YXIgem5vdGlmaWNhdGlvbklkID0gMCwgbm90aWZpY2F0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI25vdGlmaWNhdGlvbi1jb250YWluZXIiKTsKZnVuY3Rpb24gbm90aWZ5KGEsIGIsIGQpIHsgYiA9IHZvaWQgMCA9PT0gYiA/IDI1MDAgOiBiOyBkID0gKyt6bm90aWZpY2F0aW9uSWQ7IHZhciBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7IGMuY2xhc3NMaXN0LmFkZCgibm90aWZpY2F0aW9uIik7IGMuaW5uZXJIVE1MID0gKCI8cD4iICsgYSArICI8L3A+PGJ1dHRvbiBjbGFzcz0nY2xvc2UtYnV0dG9uJyBkYXRhLW5vdGlmaWNhdGlvbi1pZD0nIiArIGQgKyAiJz4mdGltZXM7PC9idXR0b24+IikudHJpbSgpOyBjLnN0eWxlLndpZHRoID0gImF1dG8iOyBub3RpZmljYXRpb25Db250YWluZXIuYXBwZW5kQ2hpbGQoYyk7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjLnN0eWxlLm9wYWNpdHkgPSAiMCI7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjLnJlbW92ZSgpIH0sIDQ1MCkgfSwgYik7IChhID0gYy5wcmV2aW91c1NpYmxpbmcpICYmIGEuc3R5bGUgJiYgKGEuc3R5bGUubWFyZ2luVG9wID0gIjZweCIpIH0Kbm90aWZpY2F0aW9uQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGEpIHsgaWYgKGEudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY2xvc2UtYnV0dG9uIikpIHsgdmFyIGIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBhLnRhcmdldC5kYXRhc2V0Lm5vdGlmaWNhdGlvbklkICsgIiddIikucGFyZW50RWxlbWVudDsgYi5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYi5yZW1vdmUoKSB9LCAyNTApOyAoYSA9IGIucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9IH0pOw==";
eval(atob(test));
