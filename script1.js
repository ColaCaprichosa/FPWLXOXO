var A = "Ly8gQHRzLW5vY2hlY2sKCnZhciBkZWZhdWx0X2F2YXRhciA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvQ29sYUNhcHJpY2hvc2EvRlBXTFIvbG9nYXJkby5wbmciOwp2YXIgYWxsb3dfYXUgPSBmYWxzZTsKdmFyIGhhc19hbGlhcyA9IGZhbHNlOwoKY29uc3QgZHN0eWxlcyA9IHsKCXNsaWRlcnM6IHsgdHRpcHM6IHsgY29sb3I6ICJ3aGl0ZSIgfSwgdGl0bGV6OiB7IGNvbG9yOiAid2hpdGUiIH0sIGJnejogeyBjb2xvcjogIndoaXRlIiB9IH0sCglkaWFndGl0bGVzOiB7CgkJdGV4dEFsaWduOiAnY2VudGVyJywKCQl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCgkJZm9udFNpemU6ICcxOHB4JywKCQltYXJnaW5Cb3R0b206ICcxMHB4JywKCQltYXJnaW5Ub3A6ICIwcHgiLCBjb2xvcjogIndoaXRlIgoJfSwKCXN1YnRpdGxlczogeyBmb250U2l6ZTogIjE4cHgiLCBmb250V2VpZ2h0OiAiYm9sZCIsIG1hcmdpbkxlZnQ6ICIyMHB4IiB9Cn0KCmNvbnN0IHJvbGVjbHIgPSB7ICJub3JtYWwiOiAiIzYwNjA2MCIsICJwcmVtaXVtIjogIiM4YmIwZmYiLCAiY2hhZCI6ICIjZmZlNThiIiwgIkdPRCI6ICIjZjE0YzM5IiwgIlBBUEkiOiAiI2NlOThlMiIgfTsKdmFyIGZ1X2Nvb2xkb3duID0gMDsKCmZ1bmN0aW9uIGNfdGhlbWUoKSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5ib2R5OwoJY29uc3QgdGhlbWVfc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoZW1lX3NlbGVjdCcpOwoJY29uc3Qgc2VsZWN0ZWQgPSB0aGVtZV9zZWxlY3QudmFsdWU7Cgljb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXRoZW1lJywgc2VsZWN0ZWQpOwoJc19pbnQyKCd0aGVtZV9zZWxlY3QnKTsKfQoKZnVuY3Rpb24gZ190bV9pKCkgeyByZXR1cm4gTWF0aC5yb3VuZCgrbmV3IERhdGUoKSAvIDEwMDApOyB9Cgpjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CnRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcCIpOwp0b29sdGlwLmlkID0gIndtdG9vbHRpcCI7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcCk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBhc3luYyBmdW5jdGlvbiAoZXZlbnQpIHsKCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7CgoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CglpZiAodG9vbHRpcE1lc3NhZ2UpIHsKCQl2YXIgd2ljaF9kaWFnID0gbnVsbDsKCQlmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdV9kaWFsb2dzLmxlbmd0aDsgaW5kZXgrKykgewoJCQlpZiAoaXNfbW9kYWxvcGVuKHVfZGlhbG9nc1tpbmRleF0pKSB7CgkJCQl3aWNoX2RpYWcgPSB1X2RpYWxvZ3NbaW5kZXhdOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCWlmICh3aWNoX2RpYWcgIT0gbnVsbCkgewoJCQljb25zdCBhbHJlYWR5X2V4aXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod2ljaF9kaWFnICsgIl90dGlwIik7CgkJCWNvbnN0IHRvb2x0aXB6ID0gYWxyZWFkeV9leGlzdCB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQkJaWYgKCFhbHJlYWR5X2V4aXN0KSB7CgkJCQl0b29sdGlwei5jbGFzc0xpc3QuYWRkKCJ0b29sdGlwIik7CgkJCQl0b29sdGlwei5pZCA9IHdpY2hfZGlhZyArICJfdHRpcCI7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod2ljaF9kaWFnKS5hcHBlbmRDaGlsZCh0b29sdGlweik7CgkJCX0KCQkJdG9vbHRpcHouaW5uZXJUZXh0ID0gdG9vbHRpcE1lc3NhZ2U7CgkJCXRvb2x0aXB6LnN0eWxlLnRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wIC0gdG9vbHRpcHoub2Zmc2V0SGVpZ2h0IC0gOCArICJweCI7CgkJCXRvb2x0aXB6LnN0eWxlLmxlZnQgPSBlbGVtZW50Lm9mZnNldExlZnQgKyAoZWxlbWVudC5vZmZzZXRXaWR0aCAtIHRvb2x0aXB6Lm9mZnNldFdpZHRoKSAvIDIgKyAicHgiOwoJCQl0b29sdGlwei5jbGFzc0xpc3QuYWRkKCJ0b29sdGlwLS12aXNpYmxlIik7CgkJfQoJCWVsc2UgewoJCQl0b29sdGlwLmlubmVyVGV4dCA9IHRvb2x0aXBNZXNzYWdlOwoJCQl0b29sdGlwLnN0eWxlLnRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wIC0gdG9vbHRpcC5vZmZzZXRIZWlnaHQgLSA4ICsgInB4IjsKCQkJdG9vbHRpcC5zdHlsZS5sZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgKGVsZW1lbnQub2Zmc2V0V2lkdGggLSB0b29sdGlwLm9mZnNldFdpZHRoKSAvIDIgKyAicHgiOwoJCQl0b29sdGlwLmNsYXNzTGlzdC5hZGQoInRvb2x0aXAtLXZpc2libGUiKTsKCQl9Cgl9Cn0pOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7Cgljb25zdCB0b29sdGlwTWVzc2FnZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiKTsKCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCXZhciB3aWNoX2RpYWcgPSBudWxsOwoJCWZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB1X2RpYWxvZ3MubGVuZ3RoOyBpbmRleCsrKSB7CgkJCWlmIChpc19tb2RhbG9wZW4odV9kaWFsb2dzW2luZGV4XSkpIHsKCQkJCXdpY2hfZGlhZyA9IHVfZGlhbG9nc1tpbmRleF07CgkJCX0KCQl9CgoJCWlmICh3aWNoX2RpYWcgIT0gbnVsbCkgewoJCQljb25zdCB0b29sdGlweiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHdpY2hfZGlhZyArICJfdHRpcCIpOwoJCQlpZiAodG9vbHRpcHopIHsKCQkJCXRvb2x0aXB6LmlubmVyVGV4dCA9ICgiLSIpLnRyaW0oKTsKCQkJCXRvb2x0aXB6LmNsYXNzTGlzdC5yZW1vdmUoInRvb2x0aXAtLXZpc2libGUiKTsKCQkJfQoJCQllbHNlIHsKCQkJCXRvb2x0aXAuaW5uZXJUZXh0ID0gKCItIikudHJpbSgpOwoJCQkJdG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCJ0b29sdGlwLS12aXNpYmxlIik7CgkJCX0KCQl9IGVsc2UgewoJCQl0b29sdGlwLmlubmVyVGV4dCA9ICgiLSIpLnRyaW0oKTsKCQkJdG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCJ0b29sdGlwLS12aXNpYmxlIik7CgkJfQoJfQp9KTsKCi8qYWxyZWFkeSBkaXNwYXRjaGVkIGlkcyovCnZhciB1X2FsX2Jvb2wgPSBbXTsKdmFyIHVfYWxfZmxvYXQgPSBbXTsKdmFyIHVfYWxfaW50ID0gW107CnZhciB1X2RpYWxvZ3MgPSBbXTsKdmFyIHVfYm9vbCA9IFtdOwp2YXIgdV9mbG9hdCA9IFtdOwp2YXIgdV9pbnQgPSBbXTsKdmFyIHVfaW50MiA9IFsidGhlbWVfc2VsZWN0Il07CgpwYXRoID0gInBhbmVsX2NoYXQiOwoKY190ZXh0KHBhdGgsICJybmQiLCAiY2hhdCIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAp9KTsKCmNfZGl2KHBhdGgsICJjaGF0LWNvbnRhaW5lciIsIHsKCXdpZHRoOiAiMjMwcHgiLAoJaGVpZ2h0OiAiMzE1cHgiLAoJbWF4SGVpZ2h0OiAiMzE1cHgiLAoJb3ZlcmZsb3dZOiAiYXV0byIsCglwYWRkaW5nOiAiMTBweCIsCgliYWNrZ3JvdW5kQ29sb3I6ICd2YXIoLS1jLXNlY29uZGFyeSknLAp9KTsKCmNfYnIoKTsKCmZ1bmN0aW9uIHNlbmRfY2hhdCgpIHsKCWlmICghaGFzX2FsaWFzKSB7CgkJbm90aWZ5KCJkaXNhYmxlZCB0byBkZWZhdWx0IHVzZXJzIiwgNzAwMCk7CgkJcmV0dXJuOwoJfQoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsaWRpdHkudmFsaWQpIHsKCQljb25zdCBjaGF0X3RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsdWU7CgkJc19idG4oInNlbmRfY2hhdCIsIGNoYXRfdGV4dCkKCQkJLnRoZW4oYXN5bmMgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmICghcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJkb25lIikpCgkJCQkJcmV0dXJuOwoKCQkJCWF3YWl0IHNsZWVwKDM1MCk7CgkJCQl1X2NoYXQoKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZSA9ICIiOwoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZSA9ICIiOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDEgYSA2NCBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0KCmNfdGV4dGJveChwYXRoLCAiY2hhdF90ZXh0IiwgZmFsc2UsICIiLCAiIiwge30sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOSBdKiQiLAoJbWluTGVuZ3RoOiAxLAoJbWF4TGVuZ3RoOiA2NCwKCXJlcXVpcmVkOiB0cnVlLAoJcGxhY2Vob2xkZXI6ICJ3cml0ZSIsCglldmVudExpc3RlbmVyOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQlpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CgkJCQlzZW5kX2NoYXQoKTsKCQkJfQoJCX0KCX0KfSwgdHJ1ZSk7CgpjX2J0bihwYXRoLCAiYnRuX3NlbmRfY2hhdCIsICJzZW5kIiwgZnVuY3Rpb24gKCkgewoJc2VuZF9jaGF0KCk7Cn0sICJFbnZpYSB1biBtZW5zYWplIGFsIGNoYXQsIHVuYSB2ZXogY2FkYSAzMCBzZWd1bmRvcy4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3RleHQocGF0aCwgInVzZXJzb25saW5lIiwgImRpc2FibGVkIG9ubGluZXMiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxMHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CgpmdW5jdGlvbiBnX29ubGluZXMoKSB7CglpZiAoIWhhc19hbGlhcykgcmV0dXJuOwoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQoJCXJldHVybjsKCglnYXRoZXIoIm9ubGluZXMiLCAienoiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJdHJ5IHsKCQkJCWNvbnN0IGxpdmVzID0gSlNPTi5wYXJzZShyZXN1bHQpOwoJCQkJY29uc3Qgb25saW5lc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJzb25saW5lJyk7CgkJCQlvbmxpbmVzZWwuaW5uZXJIVE1MID0gIjxwIGRhdGEtdHRpcD0ndG90YWw6ICIgKyBsaXZlcy5hbGxfb25saW5lcyArICInIHN0eWxlPSdmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNHB4O21hcmdpbi1ib3R0b206MHB4O21hcmdpbi10b3A6MHB4Oyc+b25saW5lcyAoIiArIGxpdmVzLmxpdmUubGVuZ3RoICsgIik8L3A+PGJyPiIgKyBsaXZlcy5saXZlLmpvaW4oIiwgIik7CgkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQljb25zb2xlLmxvZyhlcnJvciwgcmVzdWx0KTsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKZ19vbmxpbmVzKCk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19idG4ocGF0aCwgIm9wZW5kbGdmaW5kdXNlciIsICJzZWFyY2ggdXNlciIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kdXNlcmRsZyIpLnNob3dNb2RhbCgpOwp9LCAiQnVzY2EgdW4gdXN1YXJpby4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KTsKCmNfYnIoKTsKCmNfZGlhbG9nKHBhdGgsICJmaW5kdXNlcmRsZyIsIHt9LCB7fSwgZnVuY3Rpb24gKGNfZWwpIHsKCWNfdGV4dChjX2VsLmlkLCAicm5kIiwgInNlYXJjaCB1c2VyIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCgljX2JyKGNfZWwuaWQpOwoKCWNfdGV4dGJveChjX2VsLmlkLCAiZmluZF91c2VyIiwgZmFsc2UsICIiLCAiIiwge30sIHsKCQlwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJCW1pbkxlbmd0aDogMywKCQltYXhMZW5ndGg6IDIwLAoJCXJlcXVpcmVkOiB0cnVlLAoJCXBsYWNlaG9sZGVyOiAiYWxpYXMiLAoJCWV2ZW50TGlzdGVuZXI6IHsKCQkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQkJaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidG5fZmluZF91c2VyIikuY2xpY2soKTsKCQkJCX0KCQkJfQoJCX0KCX0sIHRydWUpOwoKCWNfYnRuKGNfZWwuaWQsICJidG5fZmluZF91c2VyIiwgImZpbmQiLCBmdW5jdGlvbiAoKSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kX3VzZXIiKS52YWxpZGl0eS52YWxpZCkKCQkJaWYgKGZ1X2Nvb2xkb3duID4gZ190bV9pKCkpIHsKCQkJCW5vdGlmeSgicmVjZW50bHkgdXNlZCwgd2FpdCAiICsgKGZ1X2Nvb2xkb3duIC0gZ190bV9pKCkpICsgIiBzZWNvbmRzIiwgNzAwMCk7CgkJCQlyZXR1cm47CgkJCX0KCQlnYXRoZXIoImluZm9fYWxpYXMiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZF91c2VyIikudmFsdWUpCgkJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJCXRyeSB7CgkJCQkJdmFyIHVfaW5mID0gSlNPTi5wYXJzZShyZXN1bHQpOwoKCQkJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2dHIiKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQkJCX0KCgkJCQkJdmFyIHVzZXJfZGF0YSA9ICIiOwoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4Oyc+PHN0cm9uZz5AIiArIHVfaW5mWyJhbGlhcyJdOwoKCQkJCQlpZiAodV9pbmZbInJvbGUiXSkKCQkJCQkJdXNlcl9kYXRhICs9ICI8c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmU7Zm9udC1zaXplOjEwcHg7Y29sb3I6IiArIHJvbGVjbHJbdV9pbmZbInJvbGUiXS50b0xvd2VyQ2FzZSgpXSArICI7Jz4gKCIgKyB1X2luZlsicm9sZSJdICsgIik8L3NwYW4+PGJyPjwvc3Ryb25nPjwvcD4iOwoKCQkJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkKCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz51aWQ6ICIgKyB1X2luZlsidXNlcl9pZCJdOwoJCQkJCWVsc2UKCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz5iZXRhIjsKCgkJCQkJaWYgKHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0pCgkJCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCAwKSArICI8L3A+IjsKCQkJCQllbHNlCgkJCQkJCXVzZXJfZGF0YSArPSAiPC9wPiI7CgoJCQkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkKCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJCQllbHNlCgkJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPm5vIGluZm88L3A+IgoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmYiKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJCW5vdGlmeShyZXN1bHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCQlpZiAocmVzdWx0LmluY2x1ZGVzKCJyZWNlbnRseSIpKSB7CgkJCQkJCWlmIChmdV9jb29sZG93biA8IGdfdG1faSgpKQoJCQkJCQkJZnVfY29vbGRvd24gPSBnX3RtX2koKSArIDMwOwoJCQkJCX0KCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKCWNfYnRuKGNfZWwuaWQsICJjbG9zZWZpbmR1c2VyIiwgImNsb3NlIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyBtYXJnaW5MZWZ0OiAiMTBweCIgfSk7CgoJY19ocihjX2VsLmlkLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCgljX2RpdihjX2VsLmlkLCAidXNlcl9pbmZhbGlhcyIsIHsKCQlkaXNwbGF5OiAiaW5saW5lLWdyaWQiLAoJCWdyaWRUZW1wbGF0ZUNvbHVtbnM6ICJyZXBlYXQoMywgMTA1cHgpIiwKCQlncmlkR2FwOiAiMTBweCIKCX0pOwoKCWNfYnIoY19lbC5pZCwgMik7CgoJY19pbWcoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9hdnRyIiwgZGVmYXVsdF9hdmF0YXIsIDkwLCA5MCwKCQl7CgkJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQkJb2JqZWN0Rml0OiAiY292ZXIiLAoJCQlib3JkZXJSYWRpdXM6ICI1cHgiLAoJCQlwbGFjZVNlbGY6ICJub3JtYWwiCgkJfSk7CgoJY19icihjX2VsLmlkLCAyKTsKCgljX3RleHQoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9pbmYiLCAibm9uZSIsIHsKCQlkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxNjBweCIsIG1hcmdpblRvcDogIjBweCIsCgkJY29sb3I6ICJ3aGl0ZSIKCX0pOwp9KTsKCnZhciBsYXN0X21zZyA9IDA7CnZhciBmaXJzdF9zbmQgPSAwOwoKZnVuY3Rpb24gcF9zb3VuZChpZCkgewoJaWYgKGZpcnN0X3NuZCA9PSAwKSB7CgkJZmlyc3Rfc25kKys7Cgl9CgllbHNlIHsKCQl2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCQllbGVtZW50LnZvbHVtZSA9IDAuMTsKCQllbGVtZW50LnBsYXkoKTsKCX0KfQoKZnVuY3Rpb24gdV9jaGF0KCkgewoJaWYgKCFoYXNfYWxpYXMpIHsKCQljb25zdCBjaGF0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtY29udGFpbmVyJyk7CgkJY2hhdENvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKCQljb25zdCBjaGF0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCWNoYXRFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gIjEycHgiOwoJCWNoYXRFbGVtZW50LmlubmVySFRNTCA9IGAoPHNwYW4gZGF0YS10dGlwPScke2dfdG1fZHQocGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSwgMCl9JyBzdHlsZT0ib3BhY2l0eTogMC41OyI+JHtnX3RtX2R0KHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkpfTwvc3Bhbj4pIDxzcGFuIHN0eWxlPSckeygiY29sb3I6IiArIChPYmplY3QuZW50cmllcyhyb2xlY2xyKVs0XVsiMSJdKSArICI7Iil9Jz48c3Ryb25nPlpJTkM8L3N0cm9uZz48L3NwYW4+OiBjaGF0IGRpc2FibGVkIHRvIGRlZmF1bHQgYWxpYXNlcywgY2hhbmdlIHlvdXIgYWxpYXMgaW4gdGhlIHJpZ2h0IHBhbmVsYDsKCQljaGF0Q29udGFpbmVyLmFwcGVuZENoaWxkKGNoYXRFbGVtZW50KTsKCQlyZXR1cm47Cgl9CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJcmV0dXJuOwoKCWdhdGhlcigiZ2V0X2NoYXQiLCAieiIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQljb25zdCBjaGF0cyA9IEpTT04ucGFyc2UocmVzdWx0KTsKCQkJY29uc3QgY2hhdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LWNvbnRhaW5lcicpOwoJCQljaGF0Q29udGFpbmVyLmlubmVySFRNTCA9ICcnOwoKCQkJbGV0IGhpZ2hlc3RfdHMgPSAwOwoJCQljaGF0cy5mb3JFYWNoKGFzeW5jIChjaGF0KSA9PiB7CgoJCQkJaWYgKCFjaGF0Lm1zZy5pbmNsdWRlcygiZGlzYWJsZWQiKSkKCQkJCQlpZiAoaGlnaGVzdF90cyA8IGNoYXQudHMpCgkJCQkJCWhpZ2hlc3RfdHMgPSBjaGF0LnRzOwoKCQkJCWNvbnN0IGNoYXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQljaGF0RWxlbWVudC5zdHlsZS5mb250U2l6ZSA9ICIxMnB4IjsKCgkJCQlpZiAoIWNoYXQubXNnLmluY2x1ZGVzKCJkaXNhYmxlZCIpKQoJCQkJCWNoYXRFbGVtZW50LmlubmVySFRNTCA9IGAoPHNwYW4gZGF0YS10dGlwPScke2dfdG1fZHQoY2hhdC50cywgMCl9JyBzdHlsZT0ib3BhY2l0eTogMC41OyI+JHtnX3RtX2R0KGNoYXQudHMpfTwvc3Bhbj4pIDxzcGFuIHN0eWxlPScke2NoYXQuciAhPSB1bmRlZmluZWQgPyAoImNvbG9yOiIgKyAoT2JqZWN0LmVudHJpZXMocm9sZWNscilbY2hhdC5yXVsiMSJdKSArICI7IikgOiAiIn0nPjxzdHJvbmc+JHtjaGF0LnV9PC9zdHJvbmc+PC9zcGFuPjogJHt3aW5kb3cuYXRvYihjaGF0Lm1zZyl9YDsKCQkJCWVsc2UKCQkJCQljaGF0RWxlbWVudC5pbm5lckhUTUwgPSBgKDxzcGFuIGRhdGEtdHRpcD0nJHtnX3RtX2R0KGNoYXQudHMsIDApfScgc3R5bGU9Im9wYWNpdHk6IDAuNTsiPiR7Z190bV9kdChjaGF0LnRzKX08L3NwYW4+KSA8c3BhbiBzdHlsZT0nJHtjaGF0LnIgIT0gdW5kZWZpbmVkID8gKCJjb2xvcjoiICsgKE9iamVjdC5lbnRyaWVzKHJvbGVjbHIpW2NoYXQucl1bIjEiXSkgKyAiOyIpIDogIiJ9Jz48c3Ryb25nPiR7Y2hhdC51fTwvc3Ryb25nPjwvc3Bhbj46ICR7Y2hhdC5tc2d9YDsKCgkJCQljaGF0Q29udGFpbmVyLmFwcGVuZENoaWxkKGNoYXRFbGVtZW50KTsKCgkJCQljX2hyKCJjaGF0LWNvbnRhaW5lciIsIGZhbHNlLCB7CgkJCQkJb3BhY2l0eTogIjAuMiIsCgkJCQkJcGFkZGluZ1RvcDogIjBweCIsCgkJCQkJcGFkZGluZ0JvdHRvbTogIjBweCIsCgkJCQl9KTsKCQkJfSk7CgoJCQlpZiAobGFzdF9tc2cgIT0gaGlnaGVzdF90cykgewoJCQkJcF9zb3VuZCgic25kMSIpOwoJCQkJbGFzdF9tc2cgPSBoaWdoZXN0X3RzOwoJCQl9CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9Cgp2YXIgcGF0aCA9ICJtYWluX2VsZW1lbnRzIjsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aXRsZV9pZCIpLmlubmVyVGV4dCA9ICJaSU5DIjsKCmNfdGFiX2J1dHRvbigiZWxlbWVudF9yaWdodF9idXR0b25zIiwgWwoJeyBpZDogInBfdXBkYXRlcyIsIHRleHQ6ICJsb2dzIiB9LAoJeyBpZDogInBfdGlja2V0cyIsIHRleHQ6ICJ0aWNrZXRzIiB9LAoJeyBpZDogInBfcHJvZmlsZSIsIHRleHQ6ICJwcm9maWxlIiB9Cl0sIDIpOwoKLypTVEFSVCBGRUFUVVJFUyovCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2lkIikuaW5uZXJUZXh0ID0gImNvbG9yYm90IjsKCmNfdGFiX2J1dHRvbigiZWxlbWVudF9idXR0b25zIiwgWwoJeyBpZDogIm1haW5fdGFiIiwgdGV4dDogIm1haW4iIH0sCgl7IGlkOiAicXJjb2RlX3RhYiIsIHRleHQ6ICJRUiIgfSwKCXsgaWQ6ICJzZXR0aW5nc190YWIiLCB0ZXh0OiAiY2ZnIiB9LApdKTsKCmNfY2hlY2tib3gocGF0aCwgImNvbG9yYm90IiwgImVuYWJsZWQiLCAiQWN0aXZhIGVsIGZ1bmNpb25hbWllbnRvIGRlbCBjb2xvcmJvdC4iKTsKY19jdXN0b21zZXR0aW5ncyhwYXRoLCAicm5kIiwgImV4dHJhIG9wdGlvbnMiLCAoY19lbCkgPT4gewoJY190ZXh0KGNfZWwuY2lkLCAicm5kIiwgIk9wdGlvbnMiLCBkc3R5bGVzLmRpYWd0aXRsZXMpOwoKCWNfY29tYm9ib3goY19lbC5jaWQsICJtYWluX2tleSIsICJtYWluIGtleSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJMYSBLZXkgcHJpbmNpcGFsIGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBhaW0uIik7CgljX2NvbWJvYm94KGNfZWwuY2lkLCAic2Vjb25kYXJ5X2tleSIsICJzZWNvbmRhcnkga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBzZWN1bmRhcmlhIGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBhaW0uIik7CgljX2NvbWJvYm94KGNfZWwuY2lkLCAiZGlzYWJsZV9zZWNvbmRhcnlfa2V5IiwgImRpc2FibGUga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBjb24gbGEgY3VhbCBzZSBkZXNhY3RpdmEgZWwgYWltLiIpOwoJY19ocihjX2VsLmNpZCk7CgljX2NvbWJvYm94KGNfZWwuY2lkLCAidHlwZV9mb3JtYXQiLCAiZm9ybWF0IiwgMCwgNCwgZmFsc2UsICJEaXN0aW50b3MgbWV0b2RvcyBwYXJhIGVzY2FuZWFyL3Byb2Nlc2FyIGxvcyBjb2xvcmVzLiIpOwoJY19jb21ib2JveChjX2VsLmNpZCwgImNvbG9yX3R5cGUiLCAiY29sb3JzIiwgMCwgNSwgZmFsc2UsICJFbCBjb2xvciBzZWxlY2Npb25hZG8gZXMgZW4gZWwgY3VhbCBzZSBiYXNhcmEgZWwgYWltYm90Iik7CgljX2NvbWJvYm94KGNfZWwuY2lkLCAic29ydF9tZXRob2QiLCAibWV0aG9kcyIsIDAsIDksIGZhbHNlLCAiRGlzdGludG9zIG1ldG9kb3MgcGFyYSBxdWUgZWwgYWltYm90IGFwdW50ZSwgc2UgcmVjb21pZW5kYSBlbCBCRVNULiIpOwoKCWNfYnRuKGNfZWwuY2lkLCAicm5kIiwgImNsb3NlIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuY2lkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSwgeyBjb2xvcjogIndoaXRlIiwgd2lkdGg6ICIzNTBweCIgfSk7CgpjX2NoZWNrYm94KHBhdGgsICJkaW5hbWljX3Ntb290aCIsICJkaW5hbWljIHNtb290aCIsICJBbCBhY3RpdmFybG8sIGJsb3F1ZWEgZWwgc21vb3RoIHByaW5jaXBhbC4iKTsKY19jdXN0b21zZXR0aW5ncyhwYXRoLCAicm5kIiwgImV4dHJhIG9wdGlvbnMiLCAoY19lbCkgPT4gewoJY190ZXh0KGNfZWwuY2lkLCAicm5kIiwgIk9wdGlvbnMiLCBkc3R5bGVzLmRpYWd0aXRsZXMpOwoKCWNfY29tYm9ib3goY19lbC5jaWQsICJkaW5hbWljX3Ntb290aF90eXBlIiwgImRpbmFtaWMgc21vb3RoIHR5cGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiQWNvbW9kYSBlbCBzbW9vdGggZGluYW1pY2FtZW50ZSBkZXBlbmRpZW5kbyBsYSBkaXN0YW5jaWEgZGVsIGVuZW1pZ28iKTsKCgljX2J0bihjX2VsLmNpZCwgInJuZCIsICJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmNpZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7Cn0sIHsgY29sb3I6ICJ3aGl0ZSIsIHdpZHRoOiAiMzUwcHgiIH0pOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfc19pbnQocGF0aCwgJ3RhcmdldF9vZmZzZXRfeCcsICJvZmZzZXQgWCIsIDAsIDUwLCAxLCAwLCAiQ3VhbnRvIG1hcyB2YWxvciB0ZW5nYSwgbWFzIHNlIGRlc3BsYXphIGEgbGEgZGVyZWNoYSBkZWwgdGFyZ2V0IGluaWNpYWwuIik7CmNfc19pbnQocGF0aCwgInRhcmdldF9vZmZzZXRfeSIsICJvZmZzZXQgWSIsIDAsIDUwLCAxLCA1LCAiQ3VhbnRvIG1hcyB2YWxvciB0ZW5nYSwgbWFzIHNlIGRlc3BsYXphIGEgYWJham8gZGVsIHRhcmdldCBpbmljaWFsLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfc19mbG9hdChwYXRoLCAic3BlZWQiLCAic21vb3RoIiwgMC4wLCAxNS4wLCAwLjEsIDIuMCwgIlN1YXZpZGFkIGRlbCBhcHVudGFkbywgbWllbnRyYXMgbWFzIHRlbmdhLCBtYXMgc3VhdmUgc2UgdmUgZWwgbW92aW1pZW50by4iKTsKY19zX2ludChwYXRoLCAiZm92X3giLCAiRm92IFgiLCA1LCA1MDAsIDUsIDUwLCAiUmFuZ28vRm92IGhvcml6b250YWwsIG1pZW50cmFzIG1hcyB0ZW5nYSwgbWFzIGEgbG8gYW5jaG8gZXNjYW5lYXJhLiIpOwpjX3NfaW50KHBhdGgsICJmb3ZfeSIsICJGb3YgWSIsIDUsIDI1MCwgNSwgNTAsICJSYW5nby9Gb3YgdmVydGljYWwsIG1pZW50cmFzIG1hcyB0ZW5nYSwgbWFzIGEgbG8gYWx0byBlc2NhbmVhcmEuIik7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19jaGVja2JveChwYXRoLCAicmVjb2lsIiwgInJlY29pbCIsICJCYWphcmEgZWwgY3Jvc3NoYWlyIGEgbGEgaG9yYSBkZSBkaXNwYXJhciBjb24gbGEgTUFJTiBrZXkuIik7CmNfY3VzdG9tc2V0dGluZ3MocGF0aCwgInJuZCIsICJleHRyYSBvcHRpb25zIiwgKGNfZWwpID0+IHsKCWNfdGV4dChjX2VsLmNpZCwgInJuZCIsICJPcHRpb25zIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCgljX2NoZWNrYm94KGNfZWwuY2lkLCAicmNzX2Nyb3VjaF9vbmx5IiwgImNyb3VjaCBvbmx5IiwgIlNvbG8gZnVuY2lvbmFyYSBzaSBlc3RhbW9zIGFwcmV0YW5kbyBDVFJMLiIpOwoJY19zX2ludChjX2VsLmNpZCwgInJlY29pbF9kZWxheSIsICJkZWxheSIsIDUsIDUwMCwgNSwgMjAwLCAiRGVsYXkgcGFyYSBjYWRhIGJhamFkYSBkZWwgcmNzLiIsIGRzdHlsZXMuc2xpZGVycyk7CgljX3NfaW50KGNfZWwuY2lkLCAicmVjb2lsX3N0cmVuZ2h0IiwgInN0cmVuZ2h0IiwgMSwgNTAsIDEsIDIsICJGdWVyemEgKFBYKSBxdWUgYmFqYXJhIGVsIHJjcyBjYWRhIERlbGF5LiIsIGRzdHlsZXMuc2xpZGVycyk7CgljX3NfaW50KGNfZWwuY2lkLCAibWF4X3JlY29pbF9vZmZzZXQiLCAibWF4IG9mZnNldCIsIDEsIDUwLCAxLCAyLCAiQ2FudGlkYWQgbWF4aW1hIGRlIHBpeGVsZXMgcXVlIGJhamFyYSBlbCByY3MuIiwgZHN0eWxlcy5zbGlkZXJzKTsKCgljX2J0bihjX2VsLmNpZCwgInJuZCIsICJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmNpZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7Cn0sIHsgY29sb3I6ICJ3aGl0ZSIsIHdpZHRoOiAiMzUwcHgiIH0pOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfY2hlY2tib3gocGF0aCwgInRyaWdnZXJib3QiLCAidHJpZ2dlcmJvdCIsICJEaXNwYXJhcmEgYXV0b21hdGljYW1lbnRlIGN1YW5kbyBlbCBDT0xPUiBwYXNlIHBvciBlbCBjcm9zc2hhaXIuIik7CmNfY3VzdG9tc2V0dGluZ3MocGF0aCwgInJuZCIsICJleHRyYSBvcHRpb25zIiwgKGNfZWwpID0+IHsKCWNfdGV4dChjX2VsLmNpZCwgInJuZCIsICJPcHRpb25zIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCgljX2NoZWNrYm94KGNfZWwuY2lkLCAiZGlzYWJsZV9haW1fb25fdHJpZ2dlciIsICJkaXNhYmxlIGFpbSIsICJEZXNoYWJpbGl0YSBlbCBhaW0gY3VhbmRvIGVzdGEgcHJlc2lvbmFkbyBlbCB0cmlnZ2VyLiIpOwoJY19jb21ib2JveChjX2VsLmNpZCwgInRyaWdnZXJfdHlwZSIsICJ0eXBlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSk7CgljX2NvbWJvYm94KGNfZWwuY2lkLCAidHJpZ2dlcl9rZXkiLCAidHJpZ2dlciBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBUUklHR0VSLiIpOwoJY19icihjX2VsLmNpZCk7CgljX3NfaW50KGNfZWwuY2lkLCAidHJpZ2dlcl9yYWRpdXMiLCAiZm92IiwgMSwgNTAsIDEsIDE1LCAiUmFuZ28vRm92IHBhcmEgZGV0ZWN0YXIgZGVzZGUgZWwgY2VudHJvIGRlIGxhIG1pcmEsIG1pZW50cmFzIG1hcyB0ZW5nYSBtYXMgaW1wcmVjaXNvLiIsCgkJZHN0eWxlcy5zbGlkZXJzKTsKCWNfc19pbnQoY19lbC5jaWQsICJ0cmlnZ2VyX2RlbGF5IiwgImRlbGF5IiwgNSwgNTUwLCA1LCAyNTAsICJEZWxheSBwYXJhIGNhZGEgZGlzcGFyby4iLCBkc3R5bGVzLnNsaWRlcnMpOwoKCWNfYnRuKGNfZWwuY2lkLCAicm5kIiwgImNsb3NlIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuY2lkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSwgeyBjb2xvcjogIndoaXRlIiwgd2lkdGg6ICIzNTBweCIgfSk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19jaGVja2JveChwYXRoLCAiYmhvcF90b2dnbGUiLCAiYmhvcCIsICJBbCBhY3RpdmFybG8sIGRlYmVzIGJpbmRlYXIgbGEga2V5IFhCdXR0b24yIG8gTW91c2U1IGFsIGJob3AgZW4gdmV6IGRlbCBlc3BhY2lvLiIpOwpjX2N1c3RvbXNldHRpbmdzKHBhdGgsICJybmQiLCAiZXh0cmEgb3B0aW9ucyIsIChjX2VsKSA9PiB7CgljX3RleHQoY19lbC5jaWQsICJybmQiLCAiT3B0aW9ucyIsIGRzdHlsZXMuZGlhZ3RpdGxlcyk7CgoJY19zX2ludChjX2VsLmNpZCwgImJob3BfZGVsYXkiLCAiYmhvcCBkZWxheSIsIDUsIDIwMCwgNSwgMjAwLCAiRGVsYXkgZW50cmUgY2FkYSBzYWx0by4iLAoJCXsgdHRpcHM6IHsgY29sb3I6ICJ3aGl0ZSIgfSwgdGl0bGV6OiB7IGNvbG9yOiAid2hpdGUiIH0sIGJnejogeyBjb2xvcjogIndoaXRlIiB9IH0pOwoKCWNfYnRuKGNfZWwuY2lkLCAicm5kIiwgImNsb3NlIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuY2lkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSwgeyB3aWR0aDogIjM1MHB4IiB9KTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3NfaW50KHBhdGgsICJjdXN0b21fc2xlZXAiLCAic2xlZXAgJ21zJyIsIDEsIDIwMCwgMSwgMjAwLCAiTWlsaXNlZ3VuZG9zIHBhcmEgYWN0dWFsaXphciBlbCBjb2xvcmJvdCwgbWllbnRyYXMgbWFzIHZhbG9yLCBtYXMgdGFyZGFyYSBlbiBhY3R1YWxpemFyLiIpOwpjX3NfaW50KHBhdGgsICJhY2NlcHRhYmxlX2FyZWEiLCAiYWNjZXB0YWJsZSBhcmVhIiwgNSwgMjAwLCA1LCAyMDAsICJBcmVhIGFjZXB0YWJsZSBwYXJhIGVsIGZvcm1hdG8gcHkgKHRlc3QpLiIpOwoKZl9jb21ibygidHJpZ2dlcl90eXBlIiwgInRyaWdnZXJfdHlwZSIpOwpmX2NvbWJvKCJkaW5hbWljX3Ntb290aF90eXBlIiwgImRpbmFtaWNfc21vb3RoX3R5cGUiKTsKZl9jb21ibygiY29sb3JfdHlwZSIsICJjb2xvcnMiKTsKZl9jb21ibygic29ydF9tZXRob2QiLCAibWV0aG9kcyIpOwpmX2NvbWJvKCJ0eXBlX2Zvcm1hdCIsICJmb3JtYXRzIik7Cgpjb25zdCBiaW5kX2VsZW1lbnRzID0gWwoJeyBpZDogIm1haW5fa2V5IiwgdGFyZ2V0OiAibWFpbl9rZXkiIH0sCgl7IGlkOiAic2Vjb25kYXJ5X2tleSIsIHRhcmdldDogInNlY29uZGFyeV9rZXkiIH0sCgl7IGlkOiAidHJpZ2dlcl9rZXkiLCB0YXJnZXQ6ICJ0cmlnZ2VyX2tleSIgfSwKCXsgaWQ6ICJkaXNhYmxlX3NlY29uZGFyeV9rZXkiLCB0YXJnZXQ6ICJkaXNhYmxlX3NlY29uZGFyeV9rZXkiIH0sCl07CgovKkVORCBGRUFUVVJFUyovCgovL2ZfY29tYm8oImFsbF9wcm9maWxlczIiLCAiYWxsX3Byb2ZpbGVzIik7CmZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCnBhdGggPSAiZWxlbWVudHNfY2ZnYiI7CgpjX2NoZWNrYm94KHBhdGgsICJhdXRvX3VwZGF0ZV9tZW51IiwgIkF1dG8tdXBkYXRlIG1lbnUiLCAiU2UgYWN0dWFsaXphcmEgbGEgcGFnaW5hIGF1dG9tYXRpY2FtZW50ZSBjYWRhIDUgc2VndW5kb3MgZW4gY2FzbyBkZSBxdWUgaGF5YSBjYW1iaW9zIGRlc2RlIG90cmEgcGFnaW5hLiIsIGZ1bmN0aW9uIChlbCkgewoJYWxsb3dfYXUgPSBlbC5jaGVja2VkOwp9KTsKCmNfaHIoKTsKY190ZXh0KHBhdGgsICJybmQiLCAiJiM5Njc5OyBjbG91ZCBwcm9maWxlcyIsIGRzdHlsZXMuc3VidGl0bGVzKTsKCmNfYnRuKHBhdGgsICJidG5fc3ZfcHJvZmlsZSIsICJjcmVhdGUgcHJvZmlsZSIsIGZ1bmN0aW9uIChjX2VsKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGxnX2NyZWF0ZV9wcm9mIikuc2hvd01vZGFsKCk7Cn0sICJHdWFyZGEgdHUgcGVyZmlsIGFjdHVhbCBlbiBlbCBzZXJ2aWRvciwgZWwgY3VhbCBwdWVkZXMgY2FyZ2FyIiwgeyBtYXJnaW5SaWdodDogIjVweCIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnZGxnX2NyZWF0ZV9wcm9mJywge30sIHt9LCBmdW5jdGlvbiAoY19lbCkgewoJY190ZXh0KGNfZWwuaWQsICJybmQiLCAiQ2xvdWQgcHJvZmlsZSBjcmVhdG9yLiIsIGRzdHlsZXMuZGlhZ3RpdGxlcyk7CgoJY190ZXh0Ym94KGNfZWwuaWQsICJjcHJvZmlsZW5hbWUiLCBmYWxzZSwgInByb2ZpbGUgbmFtZSAiLCAiIiwgewoJCXJlc2l6ZTogJ25vbmUnLAoJCW92ZXJmbG93OiAnaGlkZGVuJywKCQl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJCW1hcmdpblRvcDogIjVweCIsCgkJY29sb3I6ICJ3aGl0ZSIsIGxhYmVsejogeyBjb2xvcjogIndoaXRlIiB9Cgl9LCB7CgkJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCQltaW5MZW5ndGg6IDEsCgkJbWF4TGVuZ3RoOiAxNiwKCQlwbGFjZWhvbGRlcjogIm5hbWUiLAoJCXJlcXVpcmVkOiB0cnVlLAoJfSk7CgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNyZWF0ZSIsIGZ1bmN0aW9uICgpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNwcm9maWxlbmFtZSIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJCXZhciB0aWNrZXRfaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjcHJvZmlsZW5hbWUiKS52YWx1ZTsKCQkJdmFyIHRpY2tldF9yZWFzb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY3Byb2ZpbGVuYW1lIikudmFsdWU7CgoJCQlzX2J0bigic2F2ZV9wcm9maWxlIiwgdGlja2V0X3JlYXNvbiArICItIiArIHRpY2tldF9pbmZvKQoJCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCX0pCgkJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCQl9KTsKCQl9CgkJZWxzZSB7CgkJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDEgYSAxNiBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7CgkJfQoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwp9KTsKCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9saXN0IiwgInByb2ZpbGUgbGlzdCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkbGdfcHJvZl9saXN0Iikuc2hvd01vZGFsKCk7CgoJc19idG4oInByb2ZpbGVfbGlzdCIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQl0cnkgewoJCQkJY29uc29sZS5sb2cocmVzcG9uc2VUZXh0KTsKCQkJCXZhciByZXNqc29uID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpOwoKCQkJCWlmIChyZXNqc29uLmxlbmd0aCA9PSAwKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVfcHJvZmlsZV9saXN0IikuaW5uZXJIVE1MID0gIm5vIHByb2ZpbGVzIjsKCQkJCQlub3RpZnkoInVzZXIgaGFzIG5vIHByb2ZpbGVzIiwgNzAwMCk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCXZhciB0b190aWNrZXRzID0gIiI7CgkJCQlmb3IgKGNvbnN0IGtleSBpbiByZXNqc29uKSB7CgkJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc2pzb24sIGtleSkpIHsKCQkJCQkJY29uc3QgZWxlbWVudCA9IHJlc2pzb25ba2V5XTsKCQkJCQkJdG9fdGlja2V0cyArPSAiPC90cj4iOwoJCQkJCQl0b190aWNrZXRzICs9ICI8dGQ+IiArIGtleSArICI8L3RkPiI7CgkJCQkJCXRvX3RpY2tldHMgKz0gIjx0ZD4iICsgZ190bV9kdChlbGVtZW50WyJ0aW1lc3RhbXAiXSwgMikgKyAiPC90ZD4iOwoJCQkJCQkvKnRvX3RpY2tldHMgKz0gIjx0ZD4iICsgZWxlbWVudFsic3RhdHVzIl0gKyAiPC90ZD4iOyovCgkJCQkJCS8vKi8KCQkJCQkJdG9fdGlja2V0cyArPSAiPHRkPiI7CgkJCQkJCXRvX3RpY2tldHMgKz0gIjxidXR0b24gY2xhc3M9J25ld2J1dHRvbicgdGl0bGU9J2xvYWQgcHJvZmlsZScgc3R5bGU9J2hlaWdodDozMHB4O3dpZHRoOmF1dG87ZGlzcGxheTppbmxpbmUtYmxvY2s7JyBvbmNsaWNrPVwic19idG4oJ2dldF9wcm9maWxlJywgJyIgKyBrZXkgKyAiJykudGhlbihhc3luYyBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IG5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAnICcpLCA3MDAwKTthd2FpdCBsaXZlX3NlcnZlcigpO2ZfY29tYm8oJ2FsbF9wcm9maWxlcycsICdhbGxfcHJvZmlsZXMnKTtmX2NvbWJvKCdhbGxfcHJvZmlsZXMyJywgJ2FsbF9wcm9maWxlcycpO30pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge2NvbnNvbGUuZXJyb3IoZXJyb3IpO30pO1wiPjxpIGNsYXNzPSdmYSBmYS1wbGF5JyBhcmlhLWhpZGRlbj0ndHJ1ZSc+PC9pPjwvYnV0dG9uPiI7CgkJCQkJCXRvX3RpY2tldHMgKz0gIjxidXR0b24gY2xhc3M9J25ld2J1dHRvbicgdGl0bGU9J3NhdmUvb3ZlcnJpZGUgcHJvZmlsZScgc3R5bGU9J21hcmdpbi1sZWZ0OjJweDtoZWlnaHQ6MzBweDt3aWR0aDphdXRvO2Rpc3BsYXk6aW5saW5lLWJsb2NrOycgb25jbGljaz1cImlmKCFjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gb3ZlcnJpZGUgdGhpcyBjbG91ZCBwcm9maWxlIHdpdGggeW91ciBjdXJyZW50IHByb2ZpbGU/JykpIHJldHVybjsgc19idG4oJ3NhdmVfcHJvZmlsZScsICciICsga2V5ICsgIicpLnRoZW4oYXN5bmMgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcil9KVwiPjxpIGNsYXNzPSdmYSBmYS1mbG9wcHktbycgYXJpYS1oaWRkZW49J3RydWUnPjwvaT48L2J1dHRvbj4iOwoJCQkJCQkvKnRvX3RpY2tldHMgKz0gIjxidXR0b24gY2xhc3M9J25ld2J1dHRvbicgdGl0bGU9J2NoYW5nZSBzdGF0dXMnIHN0eWxlPSdtYXJnaW4tbGVmdDoycHg7aGVpZ2h0OjMwcHg7d2lkdGg6YXV0bztkaXNwbGF5OmlubGluZS1ibG9jazsnIG9uY2xpY2s9XCJzX2J0bignY3ByX3N0YXR1cycsICciICsga2V5ICsgIicpLnRoZW4oYXN5bmMgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcik7fSk7XCI+PGkgY2xhc3M9J2ZhIGZhLWV5ZScgYXJpYS1oaWRkZW49J3RydWUnPjwvaT48L2J1dHRvbj4iOyovCgoJCQkJCQl0b190aWNrZXRzICs9ICI8L3RkPiI7CgkJCQkJCS8vKi8KCQkJCQkJdG9fdGlja2V0cyArPSAiPC90cj4iOwoJCQkJCX0KCQkJCX0KCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidV9wcm9maWxlX2xpc3QiKS5pbm5lckhUTUwgPSBgPGJyPgoJCQkJPHRyPgoJCQkJPHRoPm5hbWU8L3RoPgoJCQkJPHRoIHN0eWxlPSJjdXJzb3I6cG9pbnRlcjsiIG9uY2xpY2s9InNvcnRfdGFibGUoMSwgJ3VfcHJvZmlsZV9saXN0JykiPmxhc3Qgc2F2ZWQ8L3RoPgoJCQkJPCEtLTx0aD5zdGF0dXM8L3RoPi0tPgoJCQkJPHRoPm9wdGlvbnM8L3RoPgoJCQkJPC90cj4KCQkJCWA7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidV9wcm9maWxlX2xpc3QiKS5pbm5lckhUTUwgKz0gdG9fdGlja2V0czsKCQkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJCWNvbnNvbGUubG9nKGVycm9yKTsKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoIl8iKSkgewoJCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCX0KCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0sICJNdWVzdHJhIHR1cyBwZXJmaWxlcyBjcmVhZG9zIik7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnZGxnX3Byb2ZfbGlzdCcsIHt9LCB7fSwgZnVuY3Rpb24gKGNfZWwpIHsKCWNfdGV4dChjX2VsLmlkLCAicm5kIiwgIkNsb3VkIHByb2ZpbGVzLiIsIGRzdHlsZXMuZGlhZ3RpdGxlcyk7CgljX3RhYmxlKGNfZWwuaWQsICJ1X3Byb2ZpbGVfbGlzdCIsICIiLCB7IGNvbG9yOiAid2hpdGUiLCB3aWR0aDogIjEwMCUiIH0pOwoJY19idG4oY19lbC5pZCwgInJuZCIsICJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7CgpjX2hyKCk7CgpjX3RleHQocGF0aCwgInJuZCIsICImIzk2Nzk7IGxvY2FsIHByb2ZpbGVzIiwgZHN0eWxlcy5zdWJ0aXRsZXMpOwoKY19jb21ib2JveChwYXRoLCAiYWxsX3Byb2ZpbGVzIiwgInByb2ZpbGUiLCAwLCAyMCwgZmFsc2UsICJQZXJmaWxlcyBwYXJhIGNhZGEgc2l0dWFjaW9uLiIsIGFzeW5jIGZ1bmN0aW9uIChlbCkgewoJYXdhaXQgbGl2ZV9zZXJ2ZXIoKTsKfSwgeyBtaW5XaWR0aDogIjE4MHB4IiB9KTsKCmNfdGV4dGJveChwYXRoLCAicHJvZmlsZV9uYW1lX2MiLCBmYWxzZSwgIiIsICI0LTkgY2hhcmFjdGVycy4iLCB7IG1hcmdpbkxlZnQ6ICI1cHgiLCB3aWR0aDogIjE1MHB4IiB9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiAzLAoJbWF4TGVuZ3RoOiA5LAoJcmVxdWlyZWQ6IGZhbHNlLAp9LCB0cnVlKTsKCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9jaGFuZ2UiLCAiY2hhbmdlIG5hbWUiLCBhc3luYyBmdW5jdGlvbiAoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsaWRpdHkudmFsaWQpIHsKCQl2YXIgcHJvZl92YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9maWxlX25hbWVfYyIpLnZhbHVlOwoJCXNfaW5mbygicHJvZmlsZV9uYW1lIiwgcHJvZl92YWx1ZSk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsdWUgPSAiIjsKCQlhd2FpdCBsaXZlX3NlcnZlcigpOwoJCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBlc3BhY2lvcyBvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICJDYW1iaWEgZWwgbm9tYnJlIGRlbCBwcm9maWxlIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2V4cG9ydCIsICJleHBvcnQgcHJvZmlsZSIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cF9wciIpLnNob3dNb2RhbCgpOwp9LCAiRXhwb3J0YSBlbCBwZXJmaWwgYWN0dWFsIGFsIENMSVBCT0FSRC4iLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leHBfcHInLCB7fSwge30sIGZ1bmN0aW9uIChjX2VsKSB7CgljX3RleHQoY19lbC5pZCwgInJuZCIsICJZb3UgYXJlIGFib3V0IHRvIDx1PkVYUE9SVDwvdT4geW91ciBjdXJyZW50IHByb2ZpbGUuIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiQ09ORklSTSIsIGFzeW5jIGZ1bmN0aW9uICgpIHsKCQlzX2J0bigiZXhwb3J0X3Byb2ZpbGUiKTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwp9KTsKCmNfYnRuKHBhdGgsICJybmQiLCAiaW1wb3J0IHByb2ZpbGUiLCBhc3luYyBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9pbXBfcHIiKS5zaG93TW9kYWwoKTsKfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9pbXBfcHInLCB7fSwge30sIGZ1bmN0aW9uIChjX2VsKSB7CgljX3RleHQoY19lbC5pZCwgInJuZCIsICJZb3UgYXJlIGFib3V0IHRvIGltcG9ydCBhbiA8dT5VTktOT1dOIFBST0ZJTEU8L3U+PGJyPlRoaXMgd2lsbCA8dT5vdmVycmlkZTwvdT4geW91ciBjdXJyZW50IHByb2ZpbGUuIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiQ09ORklSTSIsIGFzeW5jIGZ1bmN0aW9uICgpIHsKCQlzX2J0bigiaW1wb3J0X3Byb2ZpbGUiKTsKCQlhd2FpdCBsaXZlX3NlcnZlcigpOwoJCWZfY29tYm8oJ2FsbF9wcm9maWxlcycsICdhbGxfcHJvZmlsZXMnKTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwp9KTsKCmNfYnRuKHBhdGgsICJybmQiLCAic2V0IGRlZmF1bHQiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2ZyX3NldGRlZmF1bHQnKS5zaG93TW9kYWwoKTsKfSwgIkRldnVlbHZlIGVsIHBlcmZpbCBhIHZhbG9yZXMgZGVmYXVsdCwgdGFtYmllbiBlbCBub21icmUuIik7CgpjX2RpYWxvZyhwYXRoLCAnY2ZyX3NldGRlZmF1bHQnLCB7fSwge30sIGZ1bmN0aW9uIChjX2VsKSB7CgljX3RleHQoY19lbC5pZCwgInJuZCIsICJZb3UgYXJlIGFib3V0IHRvIHNldCB0aGUgY3VycmVudDxicj5wcm9maWxlIHRvIGRlZmF1bHQgVkFMVUVTIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiQ09ORklSTSIsIGFzeW5jIGZ1bmN0aW9uICgpIHsKCQlzX2J0bignZGVmYXVsdF9wcm9maWxlJyk7CgkJYXdhaXQgbGl2ZV9zZXJ2ZXIoKTsKCQlmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY19lbC5pZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7CgpjX2hyKCk7CgpjX3RleHQocGF0aCwgInJuZCIsICImIzk2Nzk7IGxvY2FsIGNvbmZpZyIsIGRzdHlsZXMuc3VidGl0bGVzKTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2xvYWRjZmcnLCB7fSwge30sIGZ1bmN0aW9uIChjX2VsKSB7CgljX3RleHQoY19lbC5pZCwgInJuZCIsICJZb3UgYXJlIGFib3V0IHRvIGxvYWQgeW91ciA8dT5sb2NhbDwvdT4gQ0ZHIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiQ09ORklSTSIsIGFzeW5jIGZ1bmN0aW9uICgpIHsKCQlzX2J0bignbG9hZF9jJyk7CgkJYXdhaXQgbGl2ZV9zZXJ2ZXIoKTsKCQlmX2NvbWJvKCdhbGxfcHJvZmlsZXMnLCAnYWxsX3Byb2ZpbGVzJyk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY19lbC5pZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9zYXZlY2ZnJywge30sIHt9LCBmdW5jdGlvbiAoY19lbCkgewoJY190ZXh0KGNfZWwuaWQsICJybmQiLCAiWW91IGFyZSBhYm91dCB0byBzYXZlIHlvdXIgbG9jYWwgQ0ZHIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CgkJc19idG4oJ3NhdmVfYycpOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgoJY19idG4oY19lbC5pZCwgInJuZCIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY19lbC5pZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7Cn0pOwoKY19kaWFsb2coJ2VsZW1lbnRfY29uZmlnJywgJ2NvbmZpcm1faW1wb3J0Y2ZnJywge30sIHt9LCBmdW5jdGlvbiAoY19lbCkgewoJY190ZXh0KGNfZWwuaWQsICJybmQiLCAiWW91IGFyZSBhYm91dCB0byBJTVBPUlQgYW5vdGhlciBDRkciLCBkc3R5bGVzLmRpYWd0aXRsZXMpOwoJY19idG4oY19lbC5pZCwgInJuZCIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJCXNfYnRuKCdpbXBvcnRfYycpCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY19lbC5pZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leHBvcnRjZmcnLCB7fSwge30sIGZ1bmN0aW9uIChjX2VsKSB7CgljX3RleHQoY19lbC5pZCwgInJuZCIsICJZb3UgYXJlIGFib3V0IHRvIEVYUE9SVCB0aGUgZW50aXJlIGxvY2FsIENGRyw8YnI+IHdoaWNoIGluY2x1ZGUgYWxsIHlvdXIgcHJvZmlsZXMiLCBkc3R5bGVzLmRpYWd0aXRsZXMpOwoJY19idG4oY19lbC5pZCwgInJuZCIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJCXNfYnRuKCdleHBvcnRfYycpCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY19lbC5pZCkuY2xvc2UoKTsKCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leGl0Jywge30sIHt9LCBmdW5jdGlvbiAoY19lbCkgewoJY190ZXh0KGNfZWwuaWQsICJybmQiLCAiWW91IGFyZSBhYm91dCB0byBleGl0IiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiQ09ORklSTSIsIGZ1bmN0aW9uICgpIHsKCQljX2V4aXQoKTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwp9KTsKCnBhdGggPSAicGFuZWxfdGlja2V0cyI7CgpjX3RleHQocGF0aCwgInRpY2tldGNlbnRlciIsICJUaWNrZXQgQ2VudGVyIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwoKdmFyIHRpY2tldF9mYXFfc3QgPSB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFNpemU6ICcxNHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAp9CgpjX3RleHQocGF0aCwgInJuZCIsICItIERvIG5vdCBzcGFtIHRoZSB0aWNrZXQgc3lzdGVtLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYW4gaXNzdWUuPGJyPi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgaGF2ZSBhIGZlYXR1cmUgcmVxdWVzdC48YnI+IiwgdGlja2V0X2ZhcV9zdCk7CmNfdGV4dChwYXRoLCAicm5kIiwgIi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgbmVlZCA8dT5oZWxwPC91Pi48YnI+LSBBbGwgdGlja2V0cyBhcmUgPHU+cHJpdmF0ZTwvdT4uPGJyPi0gRG8gbm90IHBvc3QgaXJyZWxldmFudCBjb21tZW50cyBpbiB0aWNrZXRzIG9yIHlvdSBtYXkgYmUgPHU+YmFubmVkPC91Pi4iLCB0aWNrZXRfZmFxX3N0KTsKCmNfY29tYm9ib3gyKHBhdGgsICJ0aWNrZXRfYmVoYXZpb3IiLCBbIkJ1ZyIsICJGZWF0dXJlIiwgIk90aGVyIl0sIHRydWUsICJTZWxlY2Npb25hIHVuYSByYXpvbiBkZWwgdGlja2V0LiIpOwoKY190ZXh0YXJlYShwYXRoLCAidGlja2V0X2NvbnRlbnQiLCB0cnVlLCAiIiwgewoJaGVpZ2h0OiAnMTAwcHgnLAoJcmVzaXplOiAnbm9uZScsCglvdmVyZmxvdzogJ2hpZGRlbicsCgl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJbWFyZ2luVG9wOiAiNXB4IiwKfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJHs1fSIsCgltaW5MZW5ndGg6IDUsCgltYXhMZW5ndGg6IDI1NiwKCXBsYWNlaG9sZGVyOiAiaW5mbyIsCglyZXF1aXJlZDogdHJ1ZSwKfSk7Cgp2YXIgc2hvd190aWNrZXRfYyA9IGZhbHNlOwpjX2J0bihwYXRoLCAicm5kIiwgImNyZWF0ZSB0aWNrZXQiLCBmdW5jdGlvbiAoKSB7CglpZiAoIXNob3dfdGlja2V0X2MpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQlzaG93X3RpY2tldF9jID0gdHJ1ZTsKCQlyZXR1cm47Cgl9CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHRpY2tldF9pbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50IikudmFsdWU7CgkJdmFyIHRpY2tldF9yZWFzb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2JlaGF2aW9yIikudmFsdWU7CgoJCXNfYnRuKCJjcmVhdGVfdGlja2V0IiwgdGlja2V0X3JlYXNvbiArICItIiArIHRpY2tldF9pbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDUgYSAyNTYgY2FyYWN0ZXJlcyBzb2xhbWVudGUuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiQ3JlYSB1biB0aWNrZXQgZWwgY3VhbCBzZXJhIGF0ZW5kaWRvL3Zpc3RvIHBvciBsb3MgYWRtaW5pc3RyYWRvcmVzLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKY19idG4ocGF0aCwgInJuZCIsICJ2aWV3IHRpY2tldHMiLCBmdW5jdGlvbiAoKSB7CglpZiAoc2hvd190aWNrZXRfYykgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJc2hvd190aWNrZXRfYyA9IGZhbHNlOwoJfQoKCXNfYnRuKCJnZXRfdGlja2V0cyIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQlpZiAocmVzcG9uc2VUZXh0LnNwbGl0KCJfIikubGVuZ3RoIC0gMSA+IDIpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIHJlc2pzb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CgoJCQlpZiAocmVzanNvbi5sZW5ndGggPT0gMCkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9ICJubyB0aWNrZXRzIjsKCQkJCW5vdGlmeSgidXNlciBoYXMgbm8gdGlja2V0cyIsIDcwMDApOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gIm5vIHRpY2tldHMiOwoKCQkJdmFyIHRvX3RpY2tldHMgPSAiIjsKCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzanNvbikgewoJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc2pzb24sIGtleSkpIHsKCQkJCQljb25zdCBlbGVtZW50ID0gcmVzanNvbltrZXldOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxzdHJvbmc+PHU+IiArIGVsZW1lbnRbInJlYXNvbiJdICsgIiBbIiArIGVsZW1lbnRbImlkIl0gKyAiXTwvdT4gfCA8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIGRhdGEtdHRpcD0nRGVsZXRlIHRpY2tldCcgc3R5bGU9J2hlaWdodDozMHB4O3dpZHRoOmF1dG87ZGlzcGxheTppbmxpbmUtYmxvY2s7Y29sb3I6cmVkOycgb25jbGljaz1cInNfYnRuKCdkZWxldGVfdGlja2V0JywgJyIgKyBlbGVtZW50WyJpZCJdICsgIicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcik7fSk7XCI+JnRpbWVzOzwvYnV0dG9uPjwvc3Ryb25nPjxicj4iOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxwPiIgKyBlbGVtZW50WyJjb250ZW50Il0gKyAiPC9wPiI7CgkJCQkJdG9fdGlja2V0cyArPSAiPGJyPjxicj4iOwoJCQkJfQoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gdG9fdGlja2V0czsKCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0sICJNdWVzdHJhIHR1cyB0aWNrZXRzIGNyZWFkb3MiKTsKCmNfdGV4dChwYXRoLCAidXNlcl90aWNrZXRzIiwgIiIsIHsgdGV4dEFsaWduOiAiY2VudGVyIiB9KTsKCmNfYnIocGF0aCk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfdGV4dChwYXRoLCAicm5kIiwgIlByb2ZpbGUiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFdlaWdodDogJ2JvbGQnLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcyMHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAnMHB4Jwp9KTsKCmNfZGl2KHBhdGgsICJ1c2VyaW5mbyIsIHsKCWRpc3BsYXk6ICJpbmxpbmUtZ3JpZCIsCglncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDFmcikiLAoJZ3JpZEdhcDogIjEwcHgiCn0pOwoKcGF0aCA9ICJ1c2VyaW5mbyI7CmNfaW1nKHBhdGgsICJ1c2VyX2F2YXRhciIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsCgl7CgkJanVzdGlmeVNlbGY6ICJzdGFydCIsCgkJbWFyZ2luTGVmdDogIjEwcHgiLAoJCW9iamVjdEZpdDogImNvdmVyIiwKCQlib3JkZXJSYWRpdXM6ICI1cHgiCgl9KTsKCmNfdGV4dChwYXRoLCAidXNlcl9pbmZvIiwgIm5vbmUiLCB7IGRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiB9KTsKCmZ1bmN0aW9uIG93bl9pbmZvKCkgewoJZ2F0aGVyKCJnZXRfdXNlcl9pbmZvIiwgInoiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJbGV0IHVfaW5mID0gSlNPTi5wYXJzZShyZXN1bHQpOwoKCQkJaWYgKHVfaW5mWyJhdmF0YXIiXSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQl9CgoJCQl2YXIgdXNlcl9kYXRhID0gIiI7CgkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4Oyc+PHN0cm9uZz5AIiArIHVfaW5mWyJhbGlhcyJdOwoKCQkJaWYgKCF1X2luZlsiYWxpYXMiXS5pbmNsdWRlcygiWlVzZXIiKSkKCQkJCWhhc19hbGlhcyA9IHRydWU7CgoJCQlpZiAodV9pbmZbInJvbGUiXSkKCQkJCXVzZXJfZGF0YSArPSAiPHNwYW4gc3R5bGU9J2Rpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOiIgKyByb2xlY2xyW3VfaW5mWyJyb2xlIl0udG9Mb3dlckNhc2UoKV0gKyAiOyc+ICgiICsgdV9pbmZbInJvbGUiXSArICIpPC9zcGFuPjxicj48L3N0cm9uZz48L3A+IjsKCgkJCWlmICh1X2luZlsidXNlcl9pZCJdKQoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz51aWQ6ICIgKyB1X2luZlsidXNlcl9pZCJdOwoJCQllbHNlCgkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPnVpZDogTk8iOwoKCQkJaWYgKHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0pCgkJCQl1c2VyX2RhdGEgKz0gIiAtIGpvaW5lZDogIiArIGdfdG1fZHQodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSwgMCkgKyAiPC9wPiI7CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPC9wPiI7CgoJCQlpZiAodV9pbmZbImRlc2NyaXB0aW9uIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTJweDttYXJnaW4tdG9wOiAwcHg7Jz5pbmZvOiAiICsgd2luZG93LmF0b2IodV9pbmZbImRlc2NyaXB0aW9uIl0pICsgIjwvcD4iOwoJCQllbHNlCgkJCQl1c2VyX2RhdGEgKz0gIjxwPjwvcD4iCgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmZvIikuaW5uZXJIVE1MID0gdXNlcl9kYXRhOwoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKb3duX2luZm8oKTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19idG4ocGF0aCwgInJuZCIsICJjaGFuZ2UgYWxpYXMiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIikuc2hvd01vZGFsKCk7Cn0sICJQZXJtaXRlIGNhbWJpYXIgZWwgYWxpYXMgMSB2ZXogY2FkYSAzMCBkaWFzLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgpjX2RpYWxvZyhwYXRoLCAiYWxpYXNfZGxnIiwge30sIHt9LCBmdW5jdGlvbiAoY19lbCkgewoJY190ZXh0KGNfZWwuaWQsICJybmQiLCAiQ2hhbmdlIGFsaWFzIiwgZHN0eWxlcy5kaWFndGl0bGVzKTsKCgljX3RleHRib3goY19lbC5pZCwgInBmX2FsaWFzX3RleHRib3giLCBmYWxzZSwgIiIsICIiLCB7CgkJbWFyZ2luVG9wOiAiNXB4IiwKCX0sIHsKCQlwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJCW1pbkxlbmd0aDogMywKCQltYXhMZW5ndGg6IDIwLAoJCXJlcXVpcmVkOiB0cnVlLAoJfSk7CgoJY19icihjX2VsLmlkKTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCQljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYWxpYXNfdGV4dGJveCIpOwoKCQlpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJCXZhciB0eHRpbmZvID0gZWxlbV9pdGVtLnZhbHVlOwoJCQlzX2J0bigiY2hhbmdlX2FsaWFzIiwgdHh0aW5mbykKCQkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgoJCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQkJb3duX2luZm8oKTsKCQkJCQkJaGFzX2FsaWFzID0gdHJ1ZTsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY19lbC5pZCkuY2xvc2UoKTsKCQkJCQl9CgkJCQl9KQoJCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJfSk7CgkJfQoJCWVsc2UgewoJCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7CgkJfQoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCgljX2JyKGNfZWwuaWQpOwoKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwp9KTsKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CgpjX2J0bihwYXRoLCAicm5kIiwgImNoYW5nZSBhdmF0YXIiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKS5zaG93TW9kYWwoKTsKfSwgIkNhbWJpYSBlbCBhdmF0YXIgYSB1bmEgaW1hZ2VuLCBzb2xvIFVSTFMuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCmNfZGlhbG9nKHBhdGgsICJhdnRyX2RsZyIsIHt9LCB7fSwgZnVuY3Rpb24gKGNfZWwpIHsKCWNfdGV4dChjX2VsLmlkLCAicm5kIiwgIkNoYW5nZSBhdmF0YXIiLCBkc3R5bGVzLmRpYWd0aXRsZXMpOwoKCWNfaW1nKGNfZWwuaWQsICJhdnRyX3ByZXZpZXciLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLCB7CgkJZGlzcGxheTogImJsb2NrIiwKCQltYXJnaW46ICIwIGF1dG8iLAoJCW9iamVjdEZpdDogImNvdmVyIgoJfSk7CgoJY19icihjX2VsLmlkKTsKCgljX3RleHQoY19lbC5pZCwgInJuZCIsICJJbWd1ciBVUkwgb25seSwgZXhhbXBsZS4iLCB7CgkJdGV4dEFsaWduOiAiY2VudGVyIiwKCQljb2xvcjogIndoaXRlIgoJfSk7CgljX3RleHQoY19lbC5pZCwgInJuZCIsICJodHRwczovL2kuaW1ndXIuY29tL0duSmFFWkwucG5nIiwgewoJCXRleHRBbGlnbjogImNlbnRlciIsCgkJY29sb3I6ICJ3aGl0ZSIKCX0pOwoKCWNfdGV4dGJveChjX2VsLmlkLCAicGZfYXZhdGFyX3RleHRib3giLCBmYWxzZSwgIiIsICIxMCBhIDEzMCBjYXJhY3RlcmVzLiBFdml0YXIgdXNhciBVUkwncyBkZSBnaWZzL3ZpZGVvcy4iLCB7CgkJbWFyZ2luVG9wOiAiNXB4IiwKCQl3aWR0aDogIjk1JSIKCX0sIHsKCQlwYXR0ZXJuOiAiXihodHRwcz86XC9cLyk/KGlcLmltZ3VyXC5jb21cLykoW2EtekEtWjAtOV0rKShcLmpwZ3xcLmpwZWd8XC5wbmcpJCIsCgkJbWluTGVuZ3RoOiAyMCwKCQltYXhMZW5ndGg6IDQwLAoJCXJlcXVpcmVkOiB0cnVlLAoJfSk7CgoJY19icihjX2VsLmlkKTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgInByZXZpZXciLCBmdW5jdGlvbiAoKSB7CgkJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2F2YXRhcl90ZXh0Ym94Iik7CgoJCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfcHJldmlldyIpLnNyYyA9IGVsZW1faXRlbS52YWx1ZTsKCQl9CgkJZWxzZSB7CgkJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCQl9Cgl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCWNfYnIoY19lbC5pZCk7CgljX2hyKGNfZWwuaWQsIGZhbHNlKTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCQljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYXZhdGFyX3RleHRib3giKTsKCgkJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCQl2YXIgdHh0aW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCQkJc19idG4oJ2NoYW5nZV9hdmF0YXInLCB0eHRpbmZvKQoJCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgewoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gdHh0aW5mbzsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gdHh0aW5mbzsKCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7CgkJCQkJfQoJCQkJfSkKCQkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCX0pOwoJCX0KCQllbHNlIHsKCQkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJCX0KCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgoJY19icihjX2VsLmlkKTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfYnRuKHBhdGgsICJvcGVuZGxnZGVzYyIsICJjaGFuZ2UgZGVzY3JpcHRpb24iLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY19kbGciKS5zaG93TW9kYWwoKTsKfSwgIkNhbWJpYSBsYSBkZXNjcmlwY2lvbiBkZSB0dSBwZXJmaWwuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCmNfYnIoKTsKCmNfZGlhbG9nKHBhdGgsICJkZXNjX2RsZyIsIHt9LCB7fSwgZnVuY3Rpb24gKGNfZWwpIHsKCWNfdGV4dChjX2VsLmlkLCAicm5kIiwgIkNoYW5nZSBkZXNjcmlwdGlvbiIsIGRzdHlsZXMuZGlhZ3RpdGxlcyk7CgoJY190ZXh0YXJlYShjX2VsLmlkLCAiZGVzY3JpcHRpb25fY29udGVudCIsIGZhbHNlLCAiIiwgewoJCWhlaWdodDogJzEwMHB4JywKCQlyZXNpemU6ICdub25lJywKCQlvdmVyZmxvdzogJ2hpZGRlbicsCgkJd2hpdGVTcGFjZTogJ3ByZS13cmFwJywKCQltYXJnaW5Ub3A6ICI1cHgiLAoJCWp1c3RpZnlTZWxmOiAiY2VudGVyIiwKCQl0ZXh0Ym94OiB7CgkJCWRpc3BsYXk6ICJpbmhlcml0IgoJCX0KCX0sIHsKCQlwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokIiwKCQltaW5MZW5ndGg6IDQsCgkJbWF4TGVuZ3RoOiAyNTYsCgkJcGxhY2Vob2xkZXI6ICJkZXNjcmlwdGlvbiIsCgkJcmVxdWlyZWQ6IHRydWUsCgl9KTsKCgljX2JyKGNfZWwuaWQpOwoKCWNfYnRuKGNfZWwuaWQsICJybmQiLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjcmlwdGlvbl9jb250ZW50Iik7CgoJCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQkJdmFyIGRlc2NfaW5mbyA9IGVsZW1faXRlbS52YWx1ZTsKCgkJCXNfYnRuKCJjaGFuZ2VfZGVzY3JpcHRpb24iLCBkZXNjX2luZm8pCgkJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJjaGFuZ2VkIikgJiYgIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygid2FpdCIpKSB7CgkJCQkJCW93bl9pbmZvKCk7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNfZWwuaWQpLmNsb3NlKCk7CgkJCQkJfQoJCQkJfSkKCQkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCX0pOwoJCX0KCQllbHNlIHsKCQkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJCX0KCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgoJY19icihjX2VsLmlkKTsKCgljX2J0bihjX2VsLmlkLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjX2VsLmlkKS5jbG9zZSgpOwoJfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKfSk7Cgpjb25zdCB2aXJ0dWFsS2V5cyA9IFtdOwoKZm9yIChsZXQgaSA9IDB4NDE7IGkgPD0gMHg1QTsgaSsrKSB7Cgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKfQoKZm9yIChsZXQgaSA9IDB4MzA7IGkgPD0gMHgzOTsgaSsrKSB7Cgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKfQoKY29uc3Qgc3BlY2lhbEtleXMgPSBbCgl7IGNvZGU6IDAsIG5hbWU6ICdOT05FJyB9LAoJeyBjb2RlOiAweDA4LCBuYW1lOiAnQmFja3NwYWNlJyB9LAoJeyBjb2RlOiAweDA5LCBuYW1lOiAnVGFiJyB9LAoJeyBjb2RlOiAweDBELCBuYW1lOiAnRW50ZXInIH0sCgl7IGNvZGU6IDB4MTAsIG5hbWU6ICdTaGlmdCcgfSwKCXsgY29kZTogMHgxMSwgbmFtZTogJ0N0cmwnIH0sCgl7IGNvZGU6IDB4MTIsIG5hbWU6ICdBbHQnIH0sCgl7IGNvZGU6IDB4QTQsIG5hbWU6ICdMZWZ0IEFsdCcgfSwKCXsgY29kZTogMHhBNSwgbmFtZTogJ1JpZ2h0IEFsdCcgfSwKCXsgY29kZTogMHgxMywgbmFtZTogJ1BhdXNlL0JyZWFrJyB9LAoJeyBjb2RlOiAweDVCLCBuYW1lOiAnTGVmdCBXaW5kb3dzJyB9LAoJeyBjb2RlOiAweDVDLCBuYW1lOiAnUmlnaHQgV2luZG93cycgfSwKCXsgY29kZTogMHg1RCwgbmFtZTogJ0FwcGxpY2F0aW9ucycgfSwKCXsgY29kZTogMHg2MCwgbmFtZTogJ051bVBhZCAwJyB9LAoJeyBjb2RlOiAweDYxLCBuYW1lOiAnTnVtUGFkIDEnIH0sCgl7IGNvZGU6IDB4NjIsIG5hbWU6ICdOdW1QYWQgMicgfSwKCXsgY29kZTogMHg2MywgbmFtZTogJ051bVBhZCAzJyB9LAoJeyBjb2RlOiAweDY0LCBuYW1lOiAnTnVtUGFkIDQnIH0sCgl7IGNvZGU6IDB4NjUsIG5hbWU6ICdOdW1QYWQgNScgfSwKCXsgY29kZTogMHg2NiwgbmFtZTogJ051bVBhZCA2JyB9LAoJeyBjb2RlOiAweDY3LCBuYW1lOiAnTnVtUGFkIDcnIH0sCgl7IGNvZGU6IDB4NjgsIG5hbWU6ICdOdW1QYWQgOCcgfSwKCXsgY29kZTogMHg2OSwgbmFtZTogJ051bVBhZCA5JyB9LAoJeyBjb2RlOiAweDcwLCBuYW1lOiAnRjEnIH0sCgl7IGNvZGU6IDB4NzEsIG5hbWU6ICdGMicgfSwKCXsgY29kZTogMHg3MiwgbmFtZTogJ0YzJyB9LAoJeyBjb2RlOiAweDczLCBuYW1lOiAnRjQnIH0sCgl7IGNvZGU6IDB4NzQsIG5hbWU6ICdGNScgfSwKCXsgY29kZTogMHg3NSwgbmFtZTogJ0Y2JyB9LAoJeyBjb2RlOiAweDc2LCBuYW1lOiAnRjcnIH0sCgl7IGNvZGU6IDB4NzcsIG5hbWU6ICdGOCcgfSwKCXsgY29kZTogMHg3OCwgbmFtZTogJ0Y5JyB9LAoJeyBjb2RlOiAweDc5LCBuYW1lOiAnRjEwJyB9LAoJeyBjb2RlOiAweDdBLCBuYW1lOiAnRjExJyB9LAoJeyBjb2RlOiAweDdCLCBuYW1lOiAnRjEyJyB9LAoJeyBjb2RlOiAweDAxLCBuYW1lOiAnTEJVVFRPTicgfSwKCXsgY29kZTogMHgwMiwgbmFtZTogJ1JCVVRUT04nIH0sCgl7IGNvZGU6IDB4MDQsIG5hbWU6ICdNQlVUVE9OJyB9LAoJeyBjb2RlOiAweDA1LCBuYW1lOiAnWEJVVFRPTjEnIH0sCgl7IGNvZGU6IDB4MDYsIG5hbWU6ICdYQlVUVE9OMicgfSwKCXsgY29kZTogMHhCQiwgbmFtZTogJz0nIH0sCgl7IGNvZGU6IDB4QkMsIG5hbWU6ICcsJyB9LAoJeyBjb2RlOiAweEJELCBuYW1lOiAnLScgfSwKCXsgY29kZTogMHhCRSwgbmFtZTogJy4nIH0sCl07Cgp2aXJ0dWFsS2V5cy5wdXNoKC4uLnNwZWNpYWxLZXlzKTsKdmlydHVhbEtleXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5jb2RlIC0gYi5jb2RlOyB9KTsKCmZ1bmN0aW9uIGNyZWF0ZU9wdGlvbkVsZW1lbnQoa2V5RWxlbWVudCwgaWQpIHsKCWNvbnN0IG9wdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCW9wdGlvbkVsZW1lbnQudmFsdWUgPSBrZXlFbGVtZW50LmNvZGU7CglvcHRpb25FbGVtZW50LnRleHQgPSBrZXlFbGVtZW50Lm5hbWU7CglvcHRpb25FbGVtZW50LmlkID0gaWQgKyAiX29wdCI7CglyZXR1cm4gb3B0aW9uRWxlbWVudDsKfQoKYmluZF9lbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7Cgljb25zdCB0YXJnZXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudC50YXJnZXQpOwoJdmlydHVhbEtleXMuZm9yRWFjaCgoa2V5KSA9PiB7CgkJdGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChjcmVhdGVPcHRpb25FbGVtZW50KGtleSwgZWxlbWVudC5pZCkpOwoJfSk7Cn0pOwoKZnVuY3Rpb24gcl9pbmZvKCkgewoJZm9yIChjb25zdCBpIGluIHVfYm9vbCkgewoJCWdfYm9vbCh1X2Jvb2xbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2Zsb2F0KSB7CgkJZ19mbG9hdCh1X2Zsb2F0W2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9pbnQpIHsKCQlnX2ludCh1X2ludFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfaW50MikgewoJCWdfaW50KHVfaW50MltpXSwgZmFsc2UpOwoJfQp9CgpmdW5jdGlvbiB1X3NlcnZlcigpIHsKCWZvciAoY29uc3QgaSBpbiB1X2Jvb2wpIHsKCQlzX2Jvb2wodV9ib29sW2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCXNfZmxvYXQodV9mbG9hdFtpXSk7Cgl9Cn0KCmZ1bmN0aW9uIGN0YWJfZml4KGlkLCBkaXNwbGF5ID0gImlubGluZS1ibG9jayIpIHsKCXZhciBlbGVtZW50b3MgPSBbJ2VsZW1lbnRfbWFpbicsICdlbGVtZW50X2tleXMnLCAnZWxlbWVudF9vdmVybGF5JywgJ2VsZW1lbnRfc2V0dGluZycsICdlbGVtZW50X3FyY29kZSddOwoKCWVsZW1lbnRvcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50bykgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50bykpCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJfSk7CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7Cn0KCmZ1bmN0aW9uIHRhYl9zd2l0Y2goaSA9IHRoaXMuaWQsIHBhbmVsID0gImNlbnRlciIsIGRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIikgewoJc3dpdGNoIChwYW5lbCkgewoJCWNhc2UgMjoKCQljYXNlICIyIjoKCQljYXNlICJyaWdodCI6CgkJCWxldCB0YWIyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltjLXRhYjItYnRuXSIpOwoJCQl0YWIyQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHsKCQkJCWlmIChidXR0b24uaWQgPT09IGkpIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CgkJCQl9IGVsc2UgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKTsKCQkJCX0KCQkJfSk7CgkJCXN3aXRjaCAoaSkgewoJCQkJY2FzZSAncF91cGRhdGVzJzoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdwX3RpY2tldHMnOgoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3BfcHJvZmlsZSc6CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gImdyaWQiOwoJCQkJCWJyZWFrOwoJCQl9CgkJCWJyZWFrOwoJCWNhc2UgMToKCQljYXNlICIxIjoKCQljYXNlICJjZW50ZXIiOgoJCQlsZXQgdGFiQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltjLXRhYi1idG5dIik7CgkJCXRhYkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7CgkJCQlpZiAoYnV0dG9uLmlkID09PSBpKSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwoJCQkJfSBlbHNlIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIik7CgkJCQl9CgkJCX0pOwoKCQkJc3dpdGNoIChpKSB7CgkJCQljYXNlICdtYWluX3RhYic6CgkJCQkJY3RhYl9maXgoJ2VsZW1lbnRfbWFpbicsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAna2V5c190YWInOgoJCQkJCWN0YWJfZml4KCdlbGVtZW50X2tleXMnLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ292ZXJsYXlfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9vdmVybGF5JywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdzZXR0aW5nc190YWInOgoJCQkJCWN0YWJfZml4KCdlbGVtZW50X3NldHRpbmcnLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3FyY29kZV90YWInOgoJCQkJCWN0YWJfZml4KCdlbGVtZW50X3FyY29kZScsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQl9CgkJCWJyZWFrOwoJfQp9Cgp0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOwoKdmFyIGl0ZXJmb3VuZCA9IDA7CnZhciB3YXNfZ2FtZV9mb3VuZCA9IGZhbHNlOwp2YXIgc2hvdWxkX3VwZGF0ZSA9IHRydWU7CnZhciBpc19tb3VzZV9pbnNpZGUgPSBmYWxzZTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiLCBmdW5jdGlvbiAoKSB7IGlzX21vdXNlX2luc2lkZSA9IHRydWU7IH0pOwpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwgZnVuY3Rpb24gKCkgeyBpc19tb3VzZV9pbnNpZGUgPSBmYWxzZTsgfSk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ2aXNpYmlsaXR5Y2hhbmdlIiwgKGV2ZW50KSA9PiB7CglzaG91bGRfdXBkYXRlID0gKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PSAidmlzaWJsZSIpOwp9KTsKCnZhciB1cGRhdGVydCA9IHNldEludGVydmFsKGFzeW5jIGZ1bmN0aW9uICgpIHsKCWlmIChhbGxvd19hdSAmJiBzaG91bGRfdXBkYXRlICYmIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsKCQlhd2FpdCBsaXZlX3NlcnZlcigpOwoJfQp9LCA1MDAwKTsKCnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJdV9jaGF0KCk7CgkJZ19vbmxpbmVzKCk7Cgl9Cn0sIDIwMDApOwoKYXN5bmMgZnVuY3Rpb24gZ2F0aGVyKGluZm8sIGV4dHJhLCBmdW5jMiA9IGZ1bmN0aW9uICgpIHsgfSkgewoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBpbmZvICsgIiZ2YWw9IiArIGV4dHJhLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsKCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQlyZWplY3QoZXJyb3IpOwoJCX0pOwoJfSk7Cn0KCmZ1bmN0aW9uIHppbmNfaW5mbyhpbmZvLCBleHRyYSkgewoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaW5mbywgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKSAhPSB1bmRlZmluZWQpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuaW5uZXJIVE1MID0gZXh0cmEgKyByZXNwb25zZVRleHQ7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCX0KCX0pOwp9Cgp2YXIgd2FpdGluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCSQuZ2V0KCIvZ19pbmZvP2luZm89Z2FtZWZvdW5kIiwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCXdhc19nYW1lX2ZvdW5kID0gcGFyc2VJbnQocmVzcG9uc2VUZXh0KTsKCQlpZiAoIXdhc19nYW1lX2ZvdW5kKSB7CgkJCXppbmNfaW5mbygid2FpdGluZ19nYW1lIiwgImludGlhbGl6aW5nPGJyPmNsb3NpbmcgaW46ICIpOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9kYXlzIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfYnV0dG9ucyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X21haW4iKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9jb25maWciKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOwoJCX0KCQllbHNlIHsKCQkJaXRlcmZvdW5kKys7CgoJCQlpZiAoaXRlcmZvdW5kID4gMikgewoJCQkJemluY19pbmZvKCJ1c2VyX2RheXMiLCAiZGF5cyBsZWZ0OiAiKTsKCQkJCXppbmNfaW5mbygibGFzdF91cGRhdGUiLCAiPHN0cm9uZz5VcGRhdGVkPC9zdHJvbmc+OiAiKTsKCQkJCXppbmNfaW5mbygiY2hhbmdlbG9ncyIsICI8c3Ryb25nPkNoYW5nZWxvZ3M8L3N0cm9uZz46ICIpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXRpbmdfZ2FtZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9idXR0b25zIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X21haW4iKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJdGFiX3N3aXRjaCgibWFpbl90YWIiKTsKCQkJCXRhYl9zd2l0Y2goInBfdXBkYXRlcyIsIDIpOwoJCQkJY2xlYXJJbnRlcnZhbCh3YWl0aW5nKTsKCQkJfQoJCX0KCX0pCn0sIDI1MCk7Cgp2YXIgcnVubmluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCXRyeSB7CgkJJC5nZXQoIi9nX2luZm8/aW5mbz1ydW5uaW5nIiwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQljX2V4aXQoKTsKCQl9KTsKCX0gY2F0Y2ggKGVycm9yKSB7CgkJY29uc29sZS5sb2coZXJyb3IpOwoJCWFsZXJ0KGVycm9yKTsKCQljX2V4aXQoKTsKCX0KfSwgNTAwMCk7CgpmdW5jdGlvbiBjX2RpYWxvZyhpZF93aGVyZSwgaWRfaXRlbSwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9LCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKSkgeyBjb25zb2xlLmxvZyhpZF93aGVyZSwgImRvZXNudCBleGlzdCIpOyByZXR1cm47IH0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgeyBjb25zb2xlLmxvZyhpZF9pdGVtLCAiYWxyZWFkeSBleGlzdHMiKTsgcmV0dXJuOyB9CgoJY29uc3QgZGlhbG9nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGlhbG9nIik7CglkaWFsb2cuaWQgPSBpZF9pdGVtOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGRpYWxvZy5zdHlsZSwgc3R5bGV6KTsKCX0KCglpZiAoZWxlbW50KSB7CgkJZm9yIChsZXQga2V5IGluIGVsZW1udCkgewoJCQljb25zdCBlbGVtZW50ID0gZWxlbW50W2tleV07CgkJCWNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50LnR5cGUpOwoJCQlPYmplY3QuYXNzaWduKGVsLCBlbGVtZW50LnByb3BzKTsKCQkJT2JqZWN0LmFzc2lnbihlbC5zdHlsZSwgZWxlbWVudC5zdHlsZXMpOwoJCQlkaWFsb2cuYXBwZW5kQ2hpbGQoZWwpOwoJCX0KCX0KCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSkuYXBwZW5kQ2hpbGQoZGlhbG9nKTsKCglmdW5jMihkaWFsb2cpOwoKCXVfZGlhbG9ncy5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX2RpdihpZF93aGVyZSwgaWRfaXRlbSwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CglkaXYuaWQgPSBpZF9pdGVtOwoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oZGl2LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlkaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oZGl2LnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwp9CgpmdW5jdGlvbiBjX3RhYl9idXR0b24oaWRfd2hlcmUsIGJ1dHRvbnMsIHR5cGV6ID0gMSkgewoJY29uc3QgdGFiQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWJ1dHRvbnMuZm9yRWFjaChmdW5jdGlvbiAoYnV0dG9uLCBpbmRleCkgewoJCXZhciBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCQlidG4uY2xhc3NOYW1lID0gInRhYi1idXR0b24iOwoJCWJ0bi5zZXRBdHRyaWJ1dGUodHlwZXogPT0gMSA/ICJjLXRhYi1idG4iIDogKCJjLXRhYiIgKyB0eXBleiArICItYnRuIiksICIiKTsKCQlidG4uaWQgPSBidXR0b24uaWQ7CgkJYnRuLmlubmVySFRNTCA9IGJ1dHRvbi50ZXh0OwoKCQlpZiAoaW5kZXggPT09IDApIHsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcFJpZ2h0UmFkaXVzID0gIjBweCI7CgkJfSBlbHNlIGlmIChpbmRleCA9PT0gYnV0dG9ucy5sZW5ndGggLSAxKSB7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gIjBweCI7CgkJfSBlbHNlIHsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcFJpZ2h0UmFkaXVzID0gIjBweCI7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gIjBweCI7CgkJfQoKCQlidG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQkJdGFiX3N3aXRjaCh0aGlzLmlkLCB0eXBleik7CgkJfTsKCgkJdGFiQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ0bik7Cgl9KTsKfQoKZnVuY3Rpb24gZ190bV9kdCh0aW1lc3RhbXAsIGhybWluID0gMSkgewoJdmFyIGRhdGUgPSBuZXcgRGF0ZSgrdGltZXN0YW1wICogMTAwMCk7CglpZiAoaHJtaW4gPT0gMSkgewoJCXZhciBob3VyID0gKCIwIiArIGRhdGUuZ2V0SG91cnMoKSkuc3Vic3RyKC0yKTsKCQl2YXIgbWludXRlcyA9ICgiMCIgKyBkYXRlLmdldE1pbnV0ZXMoKSkuc3Vic3RyKC0yKTsKCQlyZXR1cm4gKGhvdXIgKyAiOiIgKyBtaW51dGVzKTsKCX0KCWVsc2UgaWYgKGhybWluID09IDIpIHsKCQl2YXIgaG91ciA9ICgiMCIgKyBkYXRlLmdldEhvdXJzKCkpLnN1YnN0cigtMik7CgkJdmFyIG1pbnV0ZXMgPSAoIjAiICsgZGF0ZS5nZXRNaW51dGVzKCkpLnN1YnN0cigtMik7CgkJdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJdmFyIG1vbnRoID0gKCIwIiArIChkYXRlLmdldE1vbnRoKCkgKyAxKSkuc3Vic3RyKC0yKTsKCQl2YXIgZGF5ID0gKCIwIiArIGRhdGUuZ2V0RGF0ZSgpKS5zdWJzdHIoLTIpOwoJCXJldHVybiAoZGF5ICsgIi8iICsgbW9udGggKyAiLyIgKyB5ZWFyKSArICIgLSAiICsgKGhvdXIgKyAiOiIgKyBtaW51dGVzKTsKCX0KCWVsc2UgewoJCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoJCXZhciBtb250aCA9ICgiMCIgKyAoZGF0ZS5nZXRNb250aCgpICsgMSkpLnN1YnN0cigtMik7CgkJdmFyIGRheSA9ICgiMCIgKyBkYXRlLmdldERhdGUoKSkuc3Vic3RyKC0yKTsKCQlyZXR1cm4gKGRheSArICIvIiArIG1vbnRoICsgIi8iICsgeWVhcik7Cgl9Cn0KCmZ1bmN0aW9uIGNfYnRuKGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0sIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSkpIHsgY29uc29sZS5sb2coaWRfd2hlcmUsICJkb2VzbnQgZXhpc3QiKTsgcmV0dXJuOyB9CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSkpIHsgY29uc29sZS5sb2coaWRfaXRlbSwgImFscmVhZHkgZXhpc3RzIik7IHJldHVybjsgfQoKCWNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJYnV0dG9uLnR5cGUgPSAiYnV0dG9uIjsKCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJuZXdidXR0b24iKTsKCWJ1dHRvbi5pZCA9IGlkX2l0ZW07CglidXR0b24uaW5uZXJIVE1MID0gdGV4dDsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihidXR0b24sIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihidXR0b24uc3R5bGUsIHN0eWxleik7Cgl9CgoJYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJZnVuYzIoYnV0dG9uKTsKCX07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlidXR0b24uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKfQoKZnVuY3Rpb24gY19ocihpZF93aGVyZSA9IHBhdGgsIG1hcmdpbiA9IHRydWUsIHN0eWxleiA9IHt9KSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgl2YXIgaHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJociIpOwoJaWYgKG1hcmdpbikKCQloci5zdHlsZS5tYXJnaW5MZWZ0ID0gIi0yMHB4IjsKCgloci5zdHlsZS5ib3JkZXIgPSAiMHB4IjsKCWhyLnN0eWxlLmJvcmRlclRvcCA9ICIxcHggc29saWQgdmFyKC0tYy1ocikiOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGhyLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChocik7Cn0KCmZ1bmN0aW9uIGNfYnIoaWRfd2hlcmUgPSBwYXRoLCBhbW91bnQgPSAxKSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cglmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYW1vdW50OyBpbmRleCsrKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwoJfQp9CgpmdW5jdGlvbiBjX2NoZWNrYm94KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpKSB7IGNvbnNvbGUubG9nKGlkX3doZXJlLCAiZG9lc250IGV4aXN0Iik7IHJldHVybjsgfQoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pKSB7IGNvbnNvbGUubG9nKGlkX2l0ZW0sICJhbHJlYWR5IGV4aXN0cyIpOyByZXR1cm47IH0KCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdlbGVtaXRlbXNfYmcnKTsKCWRpdi5odG1sRm9yID0gaWRfaXRlbTsKCWRpdi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1mbGV4IjsKCgljb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgljaGVja2JveC50eXBlID0gImNoZWNrYm94IjsKCWNoZWNrYm94LmlkID0gaWRfaXRlbTsKCWNoZWNrYm94Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXVfc2VydmVyKCk7CgkJZnVuYzIoY2hlY2tib3gpOwoJfTsKCgljb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CglsYWJlbC5odG1sRm9yID0gaWRfaXRlbTsKCWxhYmVsLmlubmVySFRNTCA9IHRleHQ7CglsYWJlbC5pZCA9IGlkX2l0ZW0gKyAienp6enoiOwoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCglkaXYuYXBwZW5kQ2hpbGQoY2hlY2tib3gpOwoJZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlfdG9vbHRpcC5jbGFzc05hbWUgPSAiZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTIiOwoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCQlpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCWlfdG9vbHRpcC5zdHlsZS5mb250V2VpZ2h0ID0gIjkwMCI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRTaXplID0gIjE1cHgiOwoJCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CgkJaV90b29sdGlwLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaV90b29sdGlwKTsKCX0KCgl1X2Jvb2wucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19jdXN0b21zZXR0aW5ncyhpZF93aGVyZSwgaWRfaXRlbSwgdG9vbHRpcCA9ICIiLCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0sIHN0eWxleiA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSkpIHsgY29uc29sZS5sb2coaWRfd2hlcmUsICJkb2VzbnQgZXhpc3QiKTsgcmV0dXJuOyB9CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSkpIHsgY29uc29sZS5sb2coaWRfaXRlbSwgImFscmVhZHkgZXhpc3RzIik7IHJldHVybjsgfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpX3Rvb2x0aXAuY2xhc3NOYW1lID0gImZhIGZhLWNvZyI7CglpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJhcmlhLWhpZGRlbiIsICJ0cnVlIik7CglpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJaV90b29sdGlwLnN0eWxlLmZvbnRXZWlnaHQgPSAiOTAwIjsKCWlfdG9vbHRpcC5zdHlsZS5mb250U2l6ZSA9ICIxNXB4IjsKCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CglpX3Rvb2x0aXAuc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJaV90b29sdGlwLnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKCWlfdG9vbHRpcC5jaWQgPSBpZF9pdGVtICsgIl9kaWFsb2ciOwoKCWlmICh0b29sdGlwICE9ICIiKQoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoKCWlfdG9vbHRpcC5vbmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKCkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlfdG9vbHRpcC5jaWQpLnNob3dNb2RhbCgpOwoJfQoKCWNfZGlhbG9nKGlkX3doZXJlLCBpX3Rvb2x0aXAuY2lkLCBzdHlsZXopOwoKCWZ1bmMyKGlfdG9vbHRpcCk7CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGlfdG9vbHRpcCk7Cgp9CgpmdW5jdGlvbiBjX3NfZmxvYXQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzdGVwX3ZhbCwgZGVmYXVsdF92YWwsIHRvb2x0aXApIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKSkgeyBjb25zb2xlLmxvZyhpZF93aGVyZSwgImRvZXNudCBleGlzdCIpOyByZXR1cm47IH0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgeyBjb25zb2xlLmxvZyhpZF9pdGVtLCAiYWxyZWFkeSBleGlzdHMiKTsgcmV0dXJuOyB9CgoJdmFyIHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHN0ZXBfdmFsKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsKCXN0ZXB2YWxfY2Vyb3MgPSBzdGVwdmFsX2Nlcm9zLmxlbmd0aDsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAnZl9zbGlkZXJfYmcnKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4JywgbWF4KTsKCWRpdi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1mbGV4IjsKCgljb25zdCB0aXRsZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJdGl0bGVEaXYuY2xhc3NMaXN0LmFkZCgnbF90aXRsZScsICdmX3RpdGxlJyk7Cgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgZGVmYXVsdF92YWwpOwoJdGl0bGVEaXYudGV4dENvbnRlbnQgPSB0ZXh0ICsgIjogIjsKCgljb25zdCBudW1iZXJfaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJbnVtYmVyX2lucHV0LmNsYXNzTGlzdC5hZGQoIm51bWJlcnNsaWRlciIpOwoJbnVtYmVyX2lucHV0LnR5cGUgPSAibnVtYmVyIjsKCW51bWJlcl9pbnB1dC5wYXR0ZXJuID0gIlswLTldKiI7CgludW1iZXJfaW5wdXQuaW5wdXRNb2RlID0gIm51bWVyaWMiOwoJbnVtYmVyX2lucHV0LmlkID0gaWRfaXRlbTsKCW51bWJlcl9pbnB1dC5taW4gPSBtaW47CgludW1iZXJfaW5wdXQubWF4ID0gbWF4OwoJbnVtYmVyX2lucHV0LnN0ZXAgPSBzdGVwX3ZhbDsKCW51bWJlcl9pbnB1dC52YWx1ZSA9IGRlZmF1bHRfdmFsOwoJbnVtYmVyX2lucHV0Lm9uaW5wdXQgPSBmdW5jdGlvbiAoKSB7CgkJdV9zZXJ2ZXIoKTsKCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJfTsKCgljb25zdCBtaW51c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCW1pbnVzX2J0bi5jbGFzc0xpc3QuYWRkKCJjb250cm9scy1udW1iZXIiKTsKCW1pbnVzX2J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgltaW51c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJbWludXNfYnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CgltaW51c19idG4uaW5uZXJIVE1MID0gKCImIzg3MjI7IikudHJpbSgpOwoJbWludXNfYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDAsIG1pbiwgbWF4LCAxLCBzdGVwdmFsX2Nlcm9zKTsKCQl1X3NlcnZlcigpOwoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7Cgl9OwoKCWNvbnN0IHBsdXNfYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CglwbHVzX2J0bi5jbGFzc0xpc3QuYWRkKCJjb250cm9scy1udW1iZXIiKTsKCXBsdXNfYnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCXBsdXNfYnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCXBsdXNfYnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CglwbHVzX2J0bi5pbm5lckhUTUwgPSAoIiYjNDM7IikudHJpbSgpOwoJcGx1c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMSwgbWluLCBtYXgsIDEsIHN0ZXB2YWxfY2Vyb3MpOwoJCXVfc2VydmVyKCk7CgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCX07CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTsKCWRpdi5hcHBlbmRDaGlsZChtaW51c19idG4pOwoJZGl2LmFwcGVuZENoaWxkKG51bWJlcl9pbnB1dCk7CglkaXYuYXBwZW5kQ2hpbGQocGx1c19idG4pOwoKCWNvbnN0IGlfdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImkiKTsKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaV90b29sdGlwLmNsYXNzTmFtZSA9ICJmYSBmYS1xdWVzdGlvbi1jaXJjbGUgZmEtMiI7CgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwoJCWlfdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRXZWlnaHQgPSAiOTAwIjsKCQlpX3Rvb2x0aXAuc3R5bGUuZm9udFNpemUgPSAiMTVweCI7CgkJaV90b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAiMC41IjsKCQlpX3Rvb2x0aXAuc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoKCQlpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpX3Rvb2x0aXApOwoJfQoKCXVfZmxvYXQucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19pbWcoaWRfd2hlcmUsIGlkX2l0ZW0sIGltYWdlLCB3aWR0aCwgaGVpZ2h0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKSkgeyBjb25zb2xlLmxvZyhpZF93aGVyZSwgImRvZXNudCBleGlzdCIpOyByZXR1cm47IH0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgeyBjb25zb2xlLmxvZyhpZF9pdGVtLCAiYWxyZWFkeSBleGlzdHMiKTsgcmV0dXJuOyB9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CgoJaW1nLnNldEF0dHJpYnV0ZSgnaWQnLCBpZF9pdGVtKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ2FsdCcsICJ1X2F2YXRhciIpOwoJaW1nLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCk7CglpbWcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQpOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGltZywgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJaW1nLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGltZy5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoaW1nKTsKfQoKZnVuY3Rpb24gY190ZXh0YXJlYShpZF93aGVyZSwgaWRfaXRlbSwgaGlkZGVuID0gZmFsc2UsIGxhYmVsID0gIiIsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpKSB7IGNvbnNvbGUubG9nKGlkX3doZXJlLCAiZG9lc250IGV4aXN0Iik7IHJldHVybjsgfQoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pKSB7IGNvbnNvbGUubG9nKGlkX2l0ZW0sICJhbHJlYWR5IGV4aXN0cyIpOyByZXR1cm47IH0KCgljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsKCgkJY29uc3QgbGFiZWxFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQlsYWJlbEVsZW0udGV4dENvbnRlbnQgPSBsYWJlbC50cmltKCk7CgkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOwoJCWxhYmVsRWxlbS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgkJbGFiZWxFbGVtLnNldEF0dHJpYnV0ZSgiZm9yIiwgaWRfaXRlbSk7CgoJCWlmIChzdHlsZXogJiYgc3R5bGV6LmxhYmVseikgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsKCQl9CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQobGFiZWxFbGVtKTsKCX0KCgljb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CgoJdGV4dGFyZWEuaWQgPSBpZF9pdGVtOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKHRleHRhcmVhLCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQl0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCgl0ZXh0YXJlYS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24odGV4dGFyZWEuc3R5bGUsIHN0eWxleik7CgoJCWlmIChzdHlsZXoudGV4dGJveCkgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoudGV4dGJveCk7CgkJfQoJfQoKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7Cgl9IGVsc2UgewoJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsKCX0gZWxzZSBpZiAoY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsKCX0KfQoKZnVuY3Rpb24gY190ZXh0Ym94KGlkX3doZXJlLCBpZF9pdGVtLCBoaWRkZW4gPSBmYWxzZSwgbGFiZWwgPSAiIiwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30sIGRpc2FibGVzdHlsZSA9IGZhbHNlKSB7CgoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpKSB7IGNvbnNvbGUubG9nKGlkX3doZXJlLCAiZG9lc250IGV4aXN0Iik7IHJldHVybjsgfQoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pKSB7IGNvbnNvbGUubG9nKGlkX2l0ZW0sICJhbHJlYWR5IGV4aXN0cyIpOyByZXR1cm47IH0KCgljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsKCgkJY29uc3QgbGFiZWxFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQlsYWJlbEVsZW0udGV4dENvbnRlbnQgPSBsYWJlbC50cmltKCk7CgkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOwoJCWxhYmVsRWxlbS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgkJbGFiZWxFbGVtLnNldEF0dHJpYnV0ZSgiZm9yIiwgaWRfaXRlbSk7CgoJCWlmIChzdHlsZXogJiYgc3R5bGV6LmxhYmVseikgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsKCQl9CgoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7Cgl9CgoJY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQiKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZF9pdGVtKTsKCglpZiAoZGlzYWJsZXN0eWxlKQoJCWlucHV0LnNldEF0dHJpYnV0ZSgnZGF0YS1ub3ZhbGlkaW52YWxpZCcsICcnKTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlucHV0LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCkKCX0KCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihpbnB1dCwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uIChldikgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcywgZXYpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaW5wdXQuc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGlucHV0LnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRib3gpIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCX0KCX0KCglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJfSBlbHNlIHsKCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAobGFiZWwgPT09ICIiICYmIGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7Cgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Ym94X2Rpdik7Cgl9Cn0KCmZ1bmN0aW9uIGNfdGFibGUoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKSkgeyBjb25zb2xlLmxvZyhpZF93aGVyZSwgImRvZXNudCBleGlzdCIpOyByZXR1cm47IH0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgeyBjb25zb2xlLmxvZyhpZF9pdGVtLCAiYWxyZWFkeSBleGlzdHMiKTsgcmV0dXJuOyB9CgoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpOwoKCWlmICh0ZXh0ICE9ICIiKQoJCXRleHRfZGl2LmlubmVySFRNTCA9IHRleHQudHJpbSgpOwoKCXRleHRfZGl2LmlkID0gaWRfaXRlbTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2RpdiwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJdGV4dF9kaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24odGV4dF9kaXYuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRfZGl2KTsKfQoKZnVuY3Rpb24gY190ZXh0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSkpIHsgY29uc29sZS5sb2coaWRfd2hlcmUsICJkb2VzbnQgZXhpc3QiKTsgcmV0dXJuOyB9CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSkpIHsgY29uc29sZS5sb2coaWRfaXRlbSwgImFscmVhZHkgZXhpc3RzIik7IHJldHVybjsgfQoKCWNvbnN0IHRleHRfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwoJdGV4dF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dCIpOwoKCWlmICh0ZXh0KQoJCXRleHRfZGl2LmlubmVySFRNTCA9IHRleHQudHJpbSgpOwoKCXRleHRfZGl2LmlkID0gaWRfaXRlbTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2RpdiwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJdGV4dF9kaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24odGV4dF9kaXYuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRfZGl2KTsKfQoKZnVuY3Rpb24gY19jb21ib2JveDIoaWRfd2hlcmUsIGlkX2l0ZW0sIG9wdGlvbnMsIGhpZGRlbiA9IGZhbHNlLCB0b29sdGlwID0gIiIsIHN0eWxleiA9IHt9KSB7CgoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpKSB7IGNvbnNvbGUubG9nKGlkX3doZXJlLCAiZG9lc250IGV4aXN0Iik7IHJldHVybjsgfQoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pKSB7IGNvbnNvbGUubG9nKGlkX2l0ZW0sICJhbHJlYWR5IGV4aXN0cyIpOyByZXR1cm47IH0KCgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCW9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4gewoJCWNvbnN0IG9wdGlvbl9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CgkJb3B0aW9uX2VsZW0udmFsdWUgPSBpbmRleDsKCQlvcHRpb25fZWxlbS50ZXh0ID0gb3B0aW9uOwoJCXNlbGVjdF9lbGVtLmFkZChvcHRpb25fZWxlbSk7Cgl9KTsKCglzZWxlY3RfZWxlbS5zdHlsZS5kaXNwbGF5ID0gKChoaWRkZW4gPT0gdHJ1ZSkgPyAoIm5vbmUiKSA6ICgiaW5saW5lLWJsb2NrIikpOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3RfZWxlbSk7Cn0KCmZ1bmN0aW9uIGNfY29tYm9ib3goaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzYW1lbGluZSA9IGZhbHNlLCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSwgc3R5bGV6ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKSkgeyBjb25zb2xlLmxvZyhpZF93aGVyZSwgImRvZXNudCBleGlzdCIpOyByZXR1cm47IH0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgeyBjb25zb2xlLmxvZyhpZF9pdGVtLCAiYWxyZWFkeSBleGlzdHMiKTsgcmV0dXJuOyB9CgoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWlmICh0ZXh0ICE9ICIiKSB7CgkJdGV4dF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dCIpOwoJCXRleHRfZGl2LnRleHRDb250ZW50ID0gdGV4dC50cmltKCk7Cgl9CgoJY29uc3Qgc2VsZWN0X2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsKCXNlbGVjdF9lbGVtLmNsYXNzTGlzdC5hZGQoInNlbGVjdC1kcm9wZG93biIpOwoJc2VsZWN0X2VsZW0uaWQgPSBpZF9pdGVtOwoJc2VsZWN0X2VsZW0uc3R5bGUuaGVpZ2h0ID0gIjQycHgiOwoKCWlmIChzYW1lbGluZSkKCQlzZWxlY3RfZWxlbS5zdHlsZS5tYXJnaW5SaWdodCA9ICIxMHB4IjsKCglzZWxlY3RfZWxlbS5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWZ1bmMyKHNlbGVjdF9lbGVtKTsKCX07CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oc2VsZWN0X2VsZW0uc3R5bGUsIHN0eWxleik7CgoJCWlmIChzdHlsZXoudGV4dF9kaXYpIHsKCQkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6LnRleHRfZGl2KTsKCQl9Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJaWYgKHRleHQgIT0gIiIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwoJfQoJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlfdG9vbHRpcC5jbGFzc05hbWUgPSAiZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTIiOwoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCQlpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJCWlfdG9vbHRpcC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJaV90b29sdGlwLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IgoJCWlfdG9vbHRpcC5zdHlsZS5mb250V2VpZ2h0ID0gIjkwMCI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRTaXplID0gIjE1cHgiOwoJCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CgoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpX3Rvb2x0aXApOwoJfQoKCXVfaW50Mi5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX3NfaW50KGlkX3doZXJlLCBpZF9pdGVtLCBpZF90ZXh0LCBtaW4sIG1heCwgc3RlcCwgdmFsdWUsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKSkgeyBjb25zb2xlLmxvZyhpZF93aGVyZSwgImRvZXNudCBleGlzdCIpOyByZXR1cm47IH0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgeyBjb25zb2xlLmxvZyhpZF9pdGVtLCAiYWxyZWFkeSBleGlzdHMiKTsgcmV0dXJuOyB9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdyX3NsaWRlcl9iZycpOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1taW4nLCBtaW4pOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoJZGl2LnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWZsZXgiOwoJaWYgKHN0eWxleiAmJiBzdHlsZXouYmd6KSB7CgkJT2JqZWN0LmFzc2lnbihkaXYuc3R5bGUsIHN0eWxlei5iZ3opOwoJfQoKCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsKCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCB2YWx1ZSk7Cgl0aXRsZURpdi50ZXh0Q29udGVudCA9IGlkX3RleHQgKyAiOiAiOwoJaWYgKHN0eWxleiAmJiBzdHlsZXoudGl0bGV6KSB7CgkJT2JqZWN0LmFzc2lnbih0aXRsZURpdi5zdHlsZSwgc3R5bGV6LnRpdGxleik7Cgl9CgoJY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoKCWNvbnN0IG1pbnVzQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CgltaW51c0J0bi5jbGFzc05hbWUgPSAiY29udHJvbHMtbnVtYmVyIjsKCW1pbnVzQnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCW1pbnVzQnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCW1pbnVzQnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CgltaW51c0J0bi5pbm5lckhUTUwgPSAoIiYjODcyMjsiKS50cmltKCk7CgltaW51c0J0bi5vbmNsaWNrID0gKCkgPT4gewoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAwLCBtaW4sIG1heCk7CgkJc19pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQlhcHBseUZpbGwoaW5wdXQpOwoJfTsKCgljb25zdCBwbHVzQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CglwbHVzQnRuLmNsYXNzTmFtZSA9ICJjb250cm9scy1udW1iZXIiOwoJcGx1c0J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CglwbHVzQnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCXBsdXNCdG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCXBsdXNCdG4uaW5uZXJIVE1MID0gKCImIzQzOyIpLnRyaW0oKTsKCXBsdXNCdG4ub25jbGljayA9ICgpID0+IHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMSwgbWluLCBtYXgpOwoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJYXBwbHlGaWxsKGlucHV0KTsKCX07CgoJaW5wdXQuY2xhc3NMaXN0LmFkZCgnc2xpZGVyJyk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoImlkIiwgaWRfaXRlbSk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncmFuZ2UnKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgnbWluJywgbWluKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgnbWF4JywgbWF4KTsKCWlucHV0LnNldEF0dHJpYnV0ZSgnc3RlcCcsIHN0ZXApOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIHZhbHVlKTsKCWlucHV0Lm9uY2hhbmdlID0gKCkgPT4gewoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJYXBwbHlGaWxsKGlucHV0KTsKCX07CgoJZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTsKCWRpdi5hcHBlbmRDaGlsZChtaW51c0J0bik7CglkaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJZGl2LmFwcGVuZENoaWxkKHBsdXNCdG4pOwoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwoKCWNvbnN0IGlfdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImkiKTsKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaV90b29sdGlwLmNsYXNzTmFtZSA9ICJmYSBmYS1xdWVzdGlvbi1jaXJjbGUgZmEtMiI7CgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwoJCWlfdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgkJaV90b29sdGlwLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQlpX3Rvb2x0aXAuc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiCgkJaV90b29sdGlwLnN0eWxlLmZvbnRXZWlnaHQgPSAiOTAwIjsKCQlpX3Rvb2x0aXAuc3R5bGUuZm9udFNpemUgPSAiMTVweCI7CgkJaV90b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAiMC41IjsKCgkJaWYgKHN0eWxleiAmJiBzdHlsZXoudHRpcHMpIHsKCQkJT2JqZWN0LmFzc2lnbihpX3Rvb2x0aXAuc3R5bGUsIHN0eWxlei50dGlwcyk7CgkJfQoKCQlpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaV90b29sdGlwKTsKCX0KCgl1X2ludC5wdXNoKGlkX2l0ZW0pOwp9Cgpjb25zdCBzbGlkZXJQcm9wcyA9IHsKCWJhY2tncm91bmQ6ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMjE0KSIsCn07CgpmdW5jdGlvbiB1X3NsaWRlcnMoKSB7Cgljb25zdCBzbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnJfc2xpZGVyX2JnIik7CgoJc2xpZGVycy5mb3JFYWNoKChzbGlkZXIpID0+IHsKCQljb25zdCBzbGlkZXJJbnB1dCA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIuc2xpZGVyIik7CgkJY29uc3Qgc2xpZGVyVmFsdWUgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKTsKCgkJc2xpZGVySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoZXZlbnQpID0+IHsKCQkJc2xpZGVyVmFsdWUuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIGV2ZW50LnRhcmdldC52YWx1ZSk7CgkJCWFwcGx5RmlsbChldmVudC50YXJnZXQpOwoJCX0pOwoKCQlhcHBseUZpbGwoc2xpZGVySW5wdXQpOwoJfSk7CgoJY29uc3QgZl9zbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZfc2xpZGVyX2JnIik7CgoJZl9zbGlkZXJzLmZvckVhY2goYXN5bmMgKHNsaWRlcikgPT4gewoJCWNvbnN0IHNsaWRlcklucHV0ID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoIi5udW1iZXJzbGlkZXIiKTsKCgkJbGV0IHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHNsaWRlcklucHV0LnN0ZXApLnNwbGl0KCIuIilbMV0gfHwgIiIpOwoKCQlhcHBseUZpbGwoc2xpZGVySW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MubGVuZ3RoLCBzbGlkZXJJbnB1dC52YWx1ZSk7Cgl9KTsKfQoKZnVuY3Rpb24gYXBwbHlGaWxsKHNsaWRlciwgaXNfZmx0ID0gZmFsc2UsIGZsdHBhcnNlID0gMSwgdmFsdWUpIHsKCWlmIChpc19mbHQpIHsKCQlzbGlkZXIucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBwYXJzZUZsb2F0KHZhbHVlKS50b0ZpeGVkKGZsdHBhcnNlKSk7CgkJc2xpZGVyLnN0eWxlLmJhY2tncm91bmQgPSBzbGlkZXJQcm9wcy5iYWNrZ3JvdW5kOwoJCXNsaWRlci5zdHlsZS5jb2xvciA9ICd2YXIoLS1jLXRleHQpJzsKCQlzbGlkZXIuc3R5bGUuYm9yZGVyUmFkaXVzID0gIjVweCI7CgkJc2xpZGVyLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgdmFyKC0tYy1jb250b3Jub3MpIjsKCQlyZXR1cm47Cgl9CgoJY29uc3QgcGVyY2VudGFnZSA9ICgoMTAwICogKHNsaWRlci52YWx1ZSAtIHNsaWRlci5taW4pKSAvIChzbGlkZXIubWF4IC0gc2xpZGVyLm1pbikpLnRvRml4ZWQoMSk7Cgljb25zdCBiZyA9IGBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHZhcigtLWMtcHJpbWFyeSkgMCUsIHZhcigtLWMtc2Vjb25kYXJ5KSAke3BlcmNlbnRhZ2V9JSwgJHtzbGlkZXJQcm9wcy5iYWNrZ3JvdW5kfSAke3BlcmNlbnRhZ2V9JSwgJHtzbGlkZXJQcm9wcy5iYWNrZ3JvdW5kfSAxMDAlKWA7CglzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IGJnOwoJc2xpZGVyLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgc2xpZGVyLnZhbHVlKTsKfQoKZnVuY3Rpb24gc3VtcmVzdF9idXR0b25zKGl0ZW1faWQsIHN1bSwgbWluLCBtYXgsIGlzX2ZsdCA9IDAsIGZsdHBhcnNlID0gMSkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKGl0ZW1faWQsICJkb2VzbnQgZXhpc3QiKTsKCQlyZXR1cm47Cgl9CgoJaWYgKGlzX2ZsdCkgewoJCWlmIChzdW0pIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID4gbWF4KQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KG1heCk7CgkJCWVsc2UKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gKHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpICsgcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKSkudG9GaXhlZChmbHRwYXJzZSk7CgkJfSBlbHNlIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KG1heCk7CgkJCWVsc2UKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gKHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKSkudG9GaXhlZChmbHRwYXJzZSk7CgkJfQoJfQoJZWxzZSB7CgkJaWYgKHN1bSkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlSW50KG1heCk7CgkJCWVsc2UKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApOwoJCX0gZWxzZSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA8IG1pbikKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VJbnQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSAtIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCk7CgkJfQoJfQp9Cgp3aW5kb3cubW9iaWxlQ2hlY2sgPSBmdW5jdGlvbiAoKSB7CglsZXQgY2hlY2sgPSBmYWxzZTsKCShmdW5jdGlvbiAoYSkgeyBpZiAoLyhhbmRyb2lkfGJiXGQrfG1lZWdvKS4rbW9iaWxlfGF2YW50Z298YmFkYVwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFwuKGJyb3dzZXJ8bGluayl8dm9kYWZvbmV8d2FwfHdpbmRvd3MgY2V8eGRhfHhpaW5vL2kudGVzdChhKSB8fCAvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298c1wtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfFwtbXxyIHxzICl8YXZhbnxiZShja3xsbHxucSl8YmkobGJ8cmQpfGJsKGFjfGF6KXxicihlfHYpd3xidW1ifGJ3XC0obnx1KXxjNTVcL3xjYXBpfGNjd2F8Y2RtXC18Y2VsbHxjaHRtfGNsZGN8Y21kXC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGNcLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8XC1kKXxlbCg0OXxhaSl8ZW0obDJ8dWwpfGVyKGljfGswKXxlc2w4fGV6KFs0LTddMHxvc3x3YXx6ZSl8ZmV0Y3xmbHkoXC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2ZcLTV8Z1wtbW98Z28oXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkXC0obXxwfHQpfGhlaVwtfGhpKHB0fHRhKXxocCggaXxpcCl8aHNcLWN8aHQoYyhcLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGlcLSgyMHxnb3xtYSl8aTIzMHxpYWMoIHxcLXxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcLyl8a2xvbnxrcHQgfGt3Y1wtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcLyhrfGx8dSl8NTB8NTR8XC1bYS13XSl8bGlid3xseW54fG0xXC13fG0zZ2F8bTUwXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtXC1jcnxtZShyY3xyaSl8bWkobzh8b2F8dHMpfG1tZWZ8bW8oMDF8MDJ8Yml8ZGV8ZG98dChcLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pXC18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfFwtKFsxLThdfGMpKXxwaGlsfHBpcmV8cGwoYXl8dWMpfHBuXC0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHRcLWd8cWFcLWF8cWMoMDd8MTJ8MjF8MzJ8NjB8XC1bMi03XXxpXC0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XC98c2EoZ2V8bWF8bW18bXN8bnl8dmEpfHNjKDAxfGhcLXxvb3xwXC0pfHNka1wvfHNlKGMoXC18MHwxKXw0N3xtY3xuZHxyaSl8c2doXC18c2hhcnxzaWUoXC18bSl8c2tcLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aFwtfHZcLXx2ICl8c3koMDF8bWIpfHQyKDE4fDUwKXx0NigwMHwxMHwxOCl8dGEoZ3R8bGspfHRjbFwtfHRkZ1wtfHRlbChpfG0pfHRpbVwtfHRcLW1vfHRvKHBsfHNoKXx0cyg3MHxtXC18bTN8bTUpfHR4XC05fHVwKFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfFwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYyhcLXwgKXx3ZWJjfHdoaXR8d2koZyB8bmN8bncpfHdtbGJ8d29udXx4NzAwfHlhc1wtfHlvdXJ8emV0b3x6dGVcLS9pLnRlc3QoYS5zdWJzdHIoMCwgNCkpKSBjaGVjayA9IHRydWU7IH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpOwoJcmV0dXJuIGNoZWNrOwp9OwoKd2luZG93LnN0ZWFtQ2hlY2sgPSBmdW5jdGlvbiAoKSB7CglsZXQgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOwoJbGV0IGlzU3RlYW1Ccm93c2VyID0gdXNlckFnZW50LmluZGV4T2YoInN0ZWFtIikgPiAtMTsKCXJldHVybiBpc1N0ZWFtQnJvd3NlcjsKfTsKCmlmICghd2luZG93Lm1vYmlsZUNoZWNrKCkpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmNvZGVfdGV4dCIpLmlubmVySFRNTCA9ICJzY2FuIG9uIG1vYmlsZSBvciBlbnRlcjogIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICIgb24geW91ciBtb2JpbGUgYnJvd3NlciI7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJpbWFnZSIpLnNyYyA9ICJodHRwczovL2NoYXJ0Lmdvb2dsZWFwaXMuY29tL2NoYXJ0P2NodD1xciZjaGw9IiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICImY2hzPTI1MHgyNTAmY2hsZD1MfDAiOwoKCXdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CgkJaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkgewoJCQl0X3BhbmVsKCdsZWZ0X3BhbmVsJyk7CgkJCXRfcGFuZWwoKTsKCQl9CgkJZWxzZSB7CgkJCWlmICh3aW5kb3cuc3RlYW1DaGVjaygpKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMDsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLndpZHRoID0gIjBweCI7CgoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0sIDI1MCk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMDsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsKCgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9LCAyNTApOwoKCQkJCW5vdGlmeSgicGFuZWxzIGRpc2FibGVkIG9uIHN0ZWFtLiIpOwoJCQl9IGVsc2UgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDE7CgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0sIDI1MCk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9LCAyNTApOwoJCQl9CgkJfQoJfTsKfQplbHNlIHsKCWRvY3VtZW50LmJvZHkuc3R5bGUuem9vbSA9ICI3NSUiOwoJdF9wYW5lbCgnbGVmdF9wYW5lbCcpOwoJdF9wYW5lbCgpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gIm9ubHkgb24gcGMiLnRyaW0oKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKfQoKZnVuY3Rpb24gc3RyaW5nMmJvb2woc3RyaW5nKSB7Cglzd2l0Y2ggKHN0cmluZy50b0xvd2VyQ2FzZSgpLnRyaW0oKSkgewoJCWNhc2UgInRydWUiOgoJCWNhc2UgInllcyI6CgkJY2FzZSAiMSI6CgkJCXJldHVybiB0cnVlOwoJCWNhc2UgImZhbHNlIjoKCQljYXNlICJubyI6CgkJY2FzZSAiMCI6CgkJY2FzZSBudWxsOgoJCQlyZXR1cm4gZmFsc2U7CgkJZGVmYXVsdDoKCQkJcmV0dXJuIEJvb2xlYW4oc3RyaW5nKTsKCX0KfQoKZnVuY3Rpb24gZ19ib29sKG1vZHVsZSkgewoJJC5nZXQoIi9nX2Jvb2w/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmNoZWNrZWQgPSBzdHJpbmcyYm9vbChyZXNwb25zZVRleHQpOwoKCQkvKmlmICghdV9hbF9ib29sLmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCQl1X2FsX2Jvb2wucHVzaChtb2R1bGUpOwoJCX0qLwoJfSk7Cn0KCmZ1bmN0aW9uIGdfaW50KG1vZHVsZSwgcmV0dXJuZWQgPSB0cnVlKSB7CgkkLmdldCgiL2dfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZSA9IHJlc3BvbnNlVGV4dDsKCgkJaWYgKG1vZHVsZS5pbmNsdWRlcygidGhlbWVfc2VsZWN0IikpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCX0KCgkJaWYgKHJldHVybmVkKSB7CgkJCS8qaWYgKCF1X2FsX2ludC5pbmNsdWRlcyhtb2R1bGUpKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJpbnB1dCIpKTsKCQkJCXVfYWxfaW50LnB1c2gobW9kdWxlKTsKCQkJfSovCgoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdfZmxvYXQobW9kdWxlKSB7CgkkLmdldCgiL2dfZmxvYXQ/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQl2YXIgc3RlcHZhbF9jZXJvczIgPSAoU3RyaW5nKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSBwYXJzZUZsb2F0KHJlc3BvbnNlVGV4dCkudG9GaXhlZChzdGVwdmFsX2Nlcm9zMi5sZW5ndGgpOwoKCQkvKmlmICghdV9hbF9mbG9hdC5pbmNsdWRlcyhtb2R1bGUpKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoJCQl1X2FsX2Zsb2F0LnB1c2gobW9kdWxlKTsKCQl9Ki8KCgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikgIT0gdW5kZWZpbmVkKQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7Cgl9KTsKfQoKZnVuY3Rpb24gc19ib29sKG1vZHVsZSkgewoJbGV0IG1vZHVsZXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpOwoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikKCQlyZXR1cm47Cgl9Cgl2YXIgdmFsdWUgPSBtb2R1bGV6LmNoZWNrZWQ7CgoJJC5nZXQoIi9zX2Jvb2w/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IH0pOwp9CgpmdW5jdGlvbiBzX2ludDIobW9kdWxlLCBtaW4gPSAwLCBtYXggPSAwKSB7CglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhtb2R1bGUgKyAiIG5vdCBmb3VuZCIpOwoJCXJldHVybjsKCX0KCgl2YXIgdmFsdWUgPSBtb2R1bGV6LnZhbHVlOwoKCWlmIChtaW4gPT0gMCAmJiBtYXggPT0gMCkgewoJCSQuZ2V0KCIvc19pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCXZhciBlbGVtZW50RXhpc3RzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKTsKCQkJaWYgKGVsZW1lbnRFeGlzdHMgIT0gdW5kZWZpbmVkIHx8IGVsZW1lbnRFeGlzdHMgIT0gbnVsbCkKCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCX0pOwoJfSBlbHNlIHsKCQlpZiAocGFyc2VJbnQodmFsdWUpID49IHBhcnNlSW50KG1pbikgJiYgcGFyc2VJbnQodmFsdWUpIDw9IHBhcnNlSW50KG1heCkpIHsKCQkJJC5nZXQoIi9zX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCXZhciBlbGVtZW50RXhpc3RzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKTsKCQkJCWlmIChlbGVtZW50RXhpc3RzICE9IHVuZGVmaW5lZCB8fCBlbGVtZW50RXhpc3RzICE9IG51bGwpCgkJCQkJZWxlbWVudEV4aXN0cy5pbm5lckhUTUwgPSByZXNwb25zZVRleHQ7CgkJCX0pOwoJCX0KCQllbHNlIHsKCQkJY29uc29sZS5sb2coIm1pbm1heCBvdmVycGFzc2VkIHwgIiwgdmFsdWUsIG1pbiwgbWF4KTsKCQl9Cgl9Cn0KCmZ1bmN0aW9uIHNfZmxvYXQobW9kdWxlKSB7CglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKQoJCXJldHVybjsKCX0KCgl2YXIgdmFsdWUgPSBwYXJzZUZsb2F0KG1vZHVsZXoudmFsdWUpOwoJdmFyIG1pbiA9IHBhcnNlRmxvYXQobW9kdWxlei5taW4pOwoJdmFyIG1heCA9IHBhcnNlRmxvYXQobW9kdWxlei5tYXgpOwoKCWlmICh2YWx1ZSA+PSBtaW4gJiYgdmFsdWUgPD0gbWF4KSB7CgkJJC5nZXQoIi9zX2Zsb2F0P2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsKCQl9KTsKCX0KfQoKZnVuY3Rpb24gc19pbmZvKG1vZHVsZSwgdmFsdWUsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9KSB7CgkkLmdldCgiL3NfaW5mbz9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlmdW5jMigpOwoJfSk7Cn0KCmZ1bmN0aW9uIGdSbmRJZChsZW5ndGggPSA4KSB7Cgl2YXIgaWQgPSAnJzsKCXZhciBjaGFyYWN0ZXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JzsKCXZhciBjaGFyYWN0ZXJzTGVuZ3RoID0gY2hhcmFjdGVycy5sZW5ndGg7CgoJaWQgPSAnJzsKCglmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CgkJaWQgKz0gY2hhcmFjdGVycy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcmFjdGVyc0xlbmd0aCkpOwoJfQoKCXJldHVybiBpZDsKfQoKZnVuY3Rpb24gc19idG4obW9kdWxlLCB2YWx1ZSA9ICIiKSB7CglyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCWlmICh2YWx1ZSA9PSAiIikgewoJCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsKCQkJfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCXJlamVjdChlcnJvcik7CgkJCX0pOwoJCX0gZWxzZSB7CgkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJcmVqZWN0KGVycm9yKTsKCQkJfSk7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGNfZXhpdCgpIHsKCXNfYnRuKCJkZWFkIik7CglzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQl3aW5kb3cub3BlbigiIiwgIl9zZWxmIiwgIiIpOwoJCXdpbmRvdy5jbG9zZSgpOwoJCWhpc3RvcnkuZ28oLTEpOwoJCW5hdmlnYXRvci5hcHAuYmFja0hpc3RvcnkoKTsKCQl3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7Cgl9LCA1MDAwKTsKfQoKZnVuY3Rpb24gZl9jb21ibyhpZF9pdGVtLCBpZF9zZXJ2ZXIpIHsKCSQuZ2V0KCIvZ19pbmZvP2luZm89IiArIGlkX3NlcnZlciwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCXZhciBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKTsKCgkJaWYgKHNlbGVjdCA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2coaWRfaXRlbSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQl2YXIgcmVzcG9uc2UgPSB3aW5kb3cuYXRvYihyZXNwb25zZVRleHQpOwoKCQlpZiAocmVzcG9uc2UgIT0gbnVsbCkgewoJCQlyZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2UpOwoJCQlpZiAocmVzcG9uc2UgIT0gbnVsbCkgewoJCQkJc2VsZWN0LmlubmVySFRNTCA9ICgiIikudHJpbSgpOwoKCQkJCWZvciAoY29uc3Qga2V5IGluIHJlc3BvbnNlKSB7CgkJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc3BvbnNlLCBrZXkpKSB7CgkJCQkJCWNvbnN0IGVsZW1lbnQgPSByZXNwb25zZVtrZXldOwoJCQkJCQl2YXIgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CgkJCQkJCW9wdC52YWx1ZSA9IGtleTsKCQkJCQkJb3B0LmlkID0gaWRfaXRlbSArICJfIiArIGtleTsKCQkJCQkJb3B0LmlubmVySFRNTCA9IGVsZW1lbnRbImlkIl07CgkJCQkJCXNlbGVjdC5hcHBlbmRDaGlsZChvcHQpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0pOwp9Cgp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgZnVuY3Rpb24gKCkgewoJaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkgewoJCXRfcGFuZWwoJ2xlZnRfcGFuZWwnLCAxKTsKCQl0X3BhbmVsKCdyaWdodF9wYW5lbCcsIDEpOwoJfQoJZWxzZSB7CgkJdF9wYW5lbCgnbGVmdF9wYW5lbCcsIDIpOwoJCXRfcGFuZWwoJ3JpZ2h0X3BhbmVsJywgMik7Cgl9Cn0pOwoKYXN5bmMgZnVuY3Rpb24gdF9wYW5lbChpZCA9ICJyaWdodF9wYW5lbCIsIHR5cGUgPSAwKSB7Cgljb25zdCBwX2VsbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCWlmICh0eXBlID09IDApIHsKCQlpZiAocF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIpIHsKCQkJcF9lbG0uc3R5bGUud2lkdGggPSAiMHB4IjsKCQkJcF9lbG0uc3R5bGUuaGVpZ2h0ID0gIjBweCI7CgkJCXBfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMCI7CgkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJcF9lbG0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJfSwgMjUwKTsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSB7CgkJCXBfZWxtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMjUwKTsKCgkJCXBfZWxtLnN0eWxlLndpZHRoID0gImF1dG8iOwoJCQlwX2VsbS5zdHlsZS5oZWlnaHQgPSAiYXV0byI7CgkJCXBfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMSI7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJfQoKCQl9Cgl9CgllbHNlIHsKCQlpZiAocF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIgJiYgdHlwZSA9PSAxKSB7CgkJCXBfZWxtLnN0eWxlLndpZHRoID0gIjBweCI7CgkJCXBfZWxtLnN0eWxlLmhlaWdodCA9ICIwcHgiOwoJCQlwX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjAiOwoJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCXBfZWxtLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCX0sIDI1MCk7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UgaWYgKHR5cGUgPT0gMiAmJiBwX2VsbS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikgewoJCQlwX2VsbS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJYXdhaXQgc2V0VGltZW91dChhc3luYyAoKSA9PiB7IH0sIDI1MCk7CgoJCQlwX2VsbS5zdHlsZS53aWR0aCA9ICJhdXRvIjsKCQkJcF9lbG0uc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwoJCQlwX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjEiOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCX0KCgkJfQoJfQp9Cgp2YXIgem5vdGlmaWNhdGlvbklkID0gMCwgbm90aWZpY2F0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI25vdGlmaWNhdGlvbi1jb250YWluZXIiKTsKZnVuY3Rpb24gbm90aWZ5KGEsIGIsIGQpIHsgYiA9IHZvaWQgMCA9PT0gYiA/IDI1MDAgOiBiOyBkID0gKyt6bm90aWZpY2F0aW9uSWQ7IHZhciBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7IGMuY2xhc3NMaXN0LmFkZCgibm90aWZpY2F0aW9uIik7IGMuaW5uZXJIVE1MID0gKCI8cD4iICsgYSArICI8L3A+PGJ1dHRvbiBjbGFzcz0nY2xvc2UtYnV0dG9uJyBkYXRhLW5vdGlmaWNhdGlvbi1pZD0nIiArIGQgKyAiJz4mdGltZXM7PC9idXR0b24+IikudHJpbSgpOyBjLnN0eWxlLm1hcmdpbkxlZnQgPSAiYXV0byI7IGMuc3R5bGUud2lkdGggPSAiZml0LWNvbnRlbnQiOyBub3RpZmljYXRpb25Db250YWluZXIuYXBwZW5kQ2hpbGQoYyk7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjLnN0eWxlLm9wYWNpdHkgPSAiMCI7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjLnJlbW92ZSgpIH0sIDQ1MCkgfSwgYik7IChhID0gYy5wcmV2aW91c1NpYmxpbmcpICYmIGEuc3R5bGUgJiYgKGEuc3R5bGUubWFyZ2luVG9wID0gIjZweCIpIH0Kbm90aWZpY2F0aW9uQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGEpIHsgaWYgKGEudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY2xvc2UtYnV0dG9uIikpIHsgdmFyIGIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBhLnRhcmdldC5kYXRhc2V0Lm5vdGlmaWNhdGlvbklkICsgIiddIikucGFyZW50RWxlbWVudDsgYi5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYi5yZW1vdmUoKSB9LCAyNTApOyAoYSA9IGIucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9IH0pOwphc3luYyBmdW5jdGlvbiBzbGVlcChtcykgeyByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7IH0KCmZ1bmN0aW9uIGlzX21vZGFsb3BlbihtaWQpIHsKCXZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1pZCk7CglpZiAobW9kYWwpIHsKCQlyZXR1cm4gbW9kYWwuaGFzQXR0cmlidXRlKCdvcGVuJyk7Cgl9CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIHNvcnRfdGFibGUobiwgaWQpIHsKCXZhciB0YWJsZSwKCQlyb3dzLAoJCXN3aXRjaGluZywKCQlpLAoJCXgsCgkJeSwKCQlzaG91bGRTd2l0Y2gsCgkJZGlyLAoJCXN3aXRjaGNvdW50ID0gMDsKCXRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJc3dpdGNoaW5nID0gdHJ1ZTsKCWRpciA9ICJhc2MiOwoJd2hpbGUgKHN3aXRjaGluZykgewoJCXN3aXRjaGluZyA9IGZhbHNlOwoJCXJvd3MgPSB0YWJsZS5yb3dzOwoJCWZvciAoaSA9IDE7IGkgPCByb3dzLmxlbmd0aCAtIDE7IGkrKykgewoJCQlzaG91bGRTd2l0Y2ggPSBmYWxzZTsKCQkJeCA9IHJvd3NbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIlREIilbbl07CgkJCXkgPSByb3dzW2kgKyAxXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiVEQiKVtuXTsKCQkJaWYgKGRpciA9PSAiYXNjIikgewoJCQkJaWYgKHguaW5uZXJIVE1MLnRvTG93ZXJDYXNlKCkgPiB5LmlubmVySFRNTC50b0xvd2VyQ2FzZSgpKSB7CgkJCQkJc2hvdWxkU3dpdGNoID0gdHJ1ZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfSBlbHNlIGlmIChkaXIgPT0gImRlc2MiKSB7CgkJCQlpZiAoeC5pbm5lckhUTUwudG9Mb3dlckNhc2UoKSA8IHkuaW5uZXJIVE1MLnRvTG93ZXJDYXNlKCkpIHsKCQkJCQlzaG91bGRTd2l0Y2ggPSB0cnVlOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoJCWlmIChzaG91bGRTd2l0Y2gpIHsKCQkJcm93c1tpXS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShyb3dzW2kgKyAxXSwgcm93c1tpXSk7CgkJCXN3aXRjaGluZyA9IHRydWU7CgkJCXN3aXRjaGNvdW50Kys7CgkJfSBlbHNlIHsKCQkJaWYgKHN3aXRjaGNvdW50ID09IDAgJiYgZGlyID09ICJhc2MiKSB7CgkJCQlkaXIgPSAiZGVzYyI7CgkJCQlzd2l0Y2hpbmcgPSB0cnVlOwoJCQl9CgkJfQoJfQp9Cgphc3luYyBmdW5jdGlvbiBsaXZlX3NlcnZlcigpIHsKCWF3YWl0IHNsZWVwKDE1MDApOwoJcl9pbmZvKCk7Cglhd2FpdCBzbGVlcCgxNTAwKTsKCXVfc2xpZGVycygpOwoJYXdhaXQgc2xlZXAoMTAwKTsKCXBfc291bmQoInNuZDEiKTsKfQpsaXZlX3NlcnZlcigpOwoKY29uc29sZS5sb2coImJyZWFraW5nIGNvY29udXRzIik7Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw==";
eval(atob(A));