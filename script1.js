var test = "Ly8gQHRzLW5vY2hlY2sNCg0KdmFyIGRlZmF1bHRfYXZhdGFyID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9Db2xhQ2FwcmljaG9zYS9GUFdMUi9sb2dhcmRvLnBuZyI7DQoNCmZ1bmN0aW9uIGNfdGhlbWUoKSB7DQoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuYm9keTsNCgljb25zdCB0aGVtZV9zZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWVfc2VsZWN0Jyk7DQoJY29uc3Qgc2VsZWN0ZWQgPSB0aGVtZV9zZWxlY3QudmFsdWU7DQoJY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS10aGVtZScsIHNlbGVjdGVkKTsNCg0KCXNfaW50MigndGhlbWVfc2VsZWN0Jyk7DQp9DQoNCmZ1bmN0aW9uIGdfdG1faSgpIHsgcmV0dXJuIE1hdGgucm91bmQoK25ldyBEYXRlKCkgLyAxMDAwKTsgfQ0KDQpjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQp0b29sdGlwLmNsYXNzTGlzdC5hZGQoInRvb2x0aXAiKTsNCnRvb2x0aXAuaWQgPSAid210b29sdGlwIjsNCmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcCk7DQoNCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3ZlciIsIGZ1bmN0aW9uIChldmVudCkgew0KCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7DQoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7DQoJaWYgKHRvb2x0aXBNZXNzYWdlKSB7DQoJCXRvb2x0aXAuaW5uZXJUZXh0ID0gdG9vbHRpcE1lc3NhZ2U7DQoJCXRvb2x0aXAuc3R5bGUudG9wID0gZWxlbWVudC5vZmZzZXRUb3AgLSB0b29sdGlwLm9mZnNldEhlaWdodCAtIDggKyAicHgiOw0KCQl0b29sdGlwLnN0eWxlLmxlZnQgPSBlbGVtZW50Lm9mZnNldExlZnQgKyAoZWxlbWVudC5vZmZzZXRXaWR0aCAtIHRvb2x0aXAub2Zmc2V0V2lkdGgpIC8gMiArICJweCI7DQoJCXRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcC0tdmlzaWJsZSIpOw0KCX0NCn0pOw0KDQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW91dCIsIGZ1bmN0aW9uIChldmVudCkgew0KCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7DQoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7DQoJaWYgKHRvb2x0aXBNZXNzYWdlKSB7DQoJCXRvb2x0aXAuaW5uZXJUZXh0ID0gKCItIikudHJpbSgpOw0KCQl0b29sdGlwLmNsYXNzTGlzdC5yZW1vdmUoInRvb2x0aXAtLXZpc2libGUiKTsNCgl9DQp9KTsNCg0KLyphbHJlYWR5IGRpc3BhdGNoZWQgaWRzKi8NCnZhciB1X2FsX2Jvb2wgPSBbXTsNCnZhciB1X2FsX2Zsb2F0ID0gW107DQp2YXIgdV9hbF9pbnQgPSBbXTsNCg0KdmFyIHVfYm9vbCA9IFtdOw0KdmFyIHVfZmxvYXQgPSBbXTsNCnZhciB1X2ludCA9IFtdOw0KdmFyIHVfaW50MiA9IFsidGhlbWVfc2VsZWN0Il07DQoNCnBhdGggPSAicGFuZWxfY2hhdCI7DQoNCmNfdGV4dChwYXRoLCAiY2hhdGJveHR4dCIsICJjaGF0Iiwgew0KCXRleHRBbGlnbjogJ2NlbnRlcicsDQoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLA0KCWZvbnRTaXplOiAnMThweCcsDQoJbWFyZ2luQm90dG9tOiAnMTBweCcsDQoJbWFyZ2luVG9wOiAiMHB4IiwNCn0pOw0KDQpjX2RpdihwYXRoLCAiY2hhdC1jb250YWluZXIiLCB7DQoJd2lkdGg6ICIyMzBweCIsDQoJaGVpZ2h0OiAiMzE1cHgiLA0KCW1heEhlaWdodDogIjMxNXB4IiwNCglvdmVyZmxvd1k6ICJhdXRvIiwNCglwYWRkaW5nOiAiMTBweCIsDQoJYmFja2dyb3VuZENvbG9yOiAndmFyKC0tYy1zZWNvbmRhcnkpJywNCn0pOw0KDQpjX2JyKCk7DQoNCmZ1bmN0aW9uIHNlbmRfY2hhdCgpIHsNCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbGlkaXR5LnZhbGlkKSB7DQoJCWNvbnN0IGNoYXRfdGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZTsNCgkJc19idG4oInNlbmRfY2hhdCIsIGNoYXRfdGV4dCkNCgkJCS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7DQoNCgkJCQlpZiAoIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygiZG9uZSIpKQ0KCQkJCQlyZXR1cm47DQoNCgkJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMzUwKTsNCgkJCQl1X2NoYXQoKTsNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsdWUgPSAiIjsNCgkJCX0pDQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7DQoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7DQoJCQl9KTsNCgl9DQoJZWxzZSB7DQoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDUgYSA2NCBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7DQoJfQ0KfQ0KDQpjX3RleHRib3gocGF0aCwgImNoYXRfdGV4dCIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7DQoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsDQoJbWluTGVuZ3RoOiAxLA0KCW1heExlbmd0aDogNjQsDQoJcmVxdWlyZWQ6IHRydWUsDQoJcGxhY2Vob2xkZXI6ICJ3cml0ZSBoZXJlIiwNCglldmVudExpc3RlbmVyOiB7DQoJCWtleWRvd246IGZ1bmN0aW9uIChlbCwgZXYpIHsNCgkJCWlmIChldi5rZXkgPT09ICdFbnRlcicpIHsNCgkJCQlzZW5kX2NoYXQoKTsNCgkJCX0NCgkJfQ0KCX0NCn0sIHRydWUpOw0KDQpjX2J0bihwYXRoLCAiYnRuX3NlbmRfY2hhdCIsICJzZW5kIiwgZnVuY3Rpb24gKCkgew0KCXNlbmRfY2hhdCgpOw0KfSwgIkVudmlhIHVuIG1lbnNhamUgYWwgY2hhdCwgdW5hIHZleiBjYWRhIDMwIHNlZ3VuZG9zLiIpOw0KDQpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOw0KDQpjX3RleHQocGF0aCwgInVzZXJzb25saW5lIiwgIm5vbmUiLCB7DQoJdGV4dEFsaWduOiAnY2VudGVyJywNCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsDQoJZm9udFNpemU6ICcxMHB4JywNCgltYXJnaW5Cb3R0b206ICcxMHB4JywNCgltYXJnaW5Ub3A6ICIwcHgiLA0KfSk7DQoNCmZ1bmN0aW9uIGdfb25saW5lcygpIHsNCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikNCgkJcmV0dXJuOw0KDQoJZ2F0aGVyKCJvbmxpbmVzIiwgInp6IikNCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgew0KCQkJdHJ5IHsNCgkJCQljb25zdCBsaXZlcyA9IEpTT04ucGFyc2UocmVzdWx0KTsNCgkJCQljb25zdCBvbmxpbmVzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcnNvbmxpbmUnKTsNCgkJCQlvbmxpbmVzZWwuaW5uZXJIVE1MID0gIjxwIHN0eWxlPSdmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNHB4O21hcmdpbi1ib3R0b206MHB4O21hcmdpbi10b3A6MHB4Oyc+b25saW5lcyAoIiArIGxpdmVzLmxpdmUubGVuZ3RoICsgIik8L3A+PGJyPiIgKyBsaXZlcy5saXZlLmpvaW4oIiwgIik7DQoJCQl9IGNhdGNoIChlcnJvcikgew0KCQkJCW5vdGlmeShyZXN1bHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsNCgkJCX0NCgkJfSkNCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgew0KCQkJY29uc29sZS5lcnJvcihlcnJvcik7DQoJCX0pOw0KfQ0KDQpnX29ubGluZXMoKTsNCg0KY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsNCg0KY19idG4ocGF0aCwgIm9wZW5kbGdmaW5kdXNlciIsICJzZWFyY2ggdXNlciIsIGZ1bmN0aW9uICgpIHsNCgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmR1c2VyZGxnIik7DQoJZGlhbG9nLnNob3dNb2RhbCgpOw0KfSwgIkJ1c2NhIHVuIHVzdWFyaW8uIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSk7DQoNCmNfYnIoKTsNCg0KY19kaWFsb2cocGF0aCwgImZpbmR1c2VyZGxnIik7DQpwYXRoID0gImZpbmR1c2VyZGxnIjsNCg0KY190ZXh0KHBhdGgsICJ1c2VyZmluZHR4dCIsICJzZWFyY2ggdXNlciIsIHsNCgl0ZXh0QWxpZ246ICdjZW50ZXInLA0KCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywNCglmb250U2l6ZTogJzE4cHgnLA0KCW1hcmdpbkJvdHRvbTogJzEwcHgnLA0KCW1hcmdpblRvcDogIjBweCIsDQoJY29sb3I6ICJ3aGl0ZSINCn0pOw0KDQpjX2JyKHBhdGgpOw0KDQpjX3RleHRib3gocGF0aCwgImZpbmRfdXNlciIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7DQoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwNCgltaW5MZW5ndGg6IDMsDQoJbWF4TGVuZ3RoOiAyMCwNCglyZXF1aXJlZDogdHJ1ZSwNCglwbGFjZWhvbGRlcjogImFsaWFzIiwNCglldmVudExpc3RlbmVyOiB7DQoJCWtleWRvd246IGZ1bmN0aW9uIChlbCwgZXYpIHsNCgkJCWlmIChldi5rZXkgPT09ICdFbnRlcicpIHsNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnRuX2ZpbmRfdXNlciIpLmNsaWNrKCk7DQoJCQl9DQoJCX0NCgl9DQp9LCB0cnVlKTsNCg0KY29uc3Qgcm9sZWNsciA9IHsgIm5vcm1hbCI6ICIjNjA2MDYwIiwgInByZW1pdW0iOiAiIzhiYjBmZiIsICJjaGFkIjogIiNmZmU1OGIiLCAiR09EIjogIiNmMTRjMzkiLCAiUEFQSSI6ICIjY2U5OGUyIiB9Ow0KdmFyIGZ1X2Nvb2xkb3duID0gMDsNCg0KY19idG4ocGF0aCwgImJ0bl9maW5kX3VzZXIiLCAiZmluZCIsIGZ1bmN0aW9uICgpIHsNCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRfdXNlciIpLnZhbGlkaXR5LnZhbGlkKQ0KCQlpZiAoZnVfY29vbGRvd24gPiBnX3RtX2koKSkgew0KCQkJY29uc29sZS5sb2coImNvb2xkb3duIiwgKGZ1X2Nvb2xkb3duIC0gZ190bV9pKCkpKQ0KCQkJbm90aWZ5KCJyZWNlbnRseSB1c2VkLCB3YWl0ICIgKyAoZnVfY29vbGRvd24gLSBnX3RtX2koKSkgKyAiIHNlY29uZHMiLCA3MDAwKTsNCgkJCXJldHVybjsNCgkJfQ0KCWdhdGhlcigiaW5mb19hbGlhcyIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kX3VzZXIiKS52YWx1ZSkNCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgew0KCQkJdHJ5IHsNCgkJCQl2YXIgdV9pbmYgPSBKU09OLnBhcnNlKHJlc3VsdCk7DQoNCgkJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7DQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2dHIiKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOw0KCQkJCX0NCg0KCQkJCXZhciB1c2VyX2RhdGEgPSAiIjsNCgkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdtYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDsnPjxzdHJvbmc+QCIgKyB1X2luZlsiYWxpYXMiXTsNCg0KCQkJCWlmICh1X2luZlsicm9sZSJdKQ0KCQkJCQl1c2VyX2RhdGEgKz0gIjxzcGFuIHN0eWxlPSdkaXNwbGF5OmlubGluZTtmb250LXNpemU6MTBweDtjb2xvcjoiICsgcm9sZWNsclt1X2luZlsicm9sZSJdLnRvTG93ZXJDYXNlKCldICsgIjsnPiAoIiArIHVfaW5mWyJyb2xlIl0gKyAiKTwvc3Bhbj48YnI+PC9zdHJvbmc+PC9wPiI7DQoNCgkJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkNCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz51aWQ6ICIgKyB1X2luZlsidXNlcl9pZCJdOw0KCQkJCWVsc2UNCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz5iZXRhIjsNCg0KCQkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQ0KCQkJCQl1c2VyX2RhdGEgKz0gIiAtIGpvaW5lZDogIiArIGdfdG1fZHQodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSwgZmFsc2UpICsgIjwvcD4iOw0KCQkJCWVsc2UNCgkJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsNCg0KCQkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkNCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsNCgkJCQllbHNlDQoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPm5vIGluZm88L3A+Ig0KDQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfaW5mIikuaW5uZXJIVE1MID0gdXNlcl9kYXRhOw0KCQkJfSBjYXRjaCAoZXJyb3IpIHsNCgkJCQlub3RpZnkocmVzdWx0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7DQoJCQkJaWYgKHJlc3VsdC5pbmNsdWRlcygicmVjZW50bHkiKSkgew0KCQkJCQlpZiAoZnVfY29vbGRvd24gPCBnX3RtX2koKSkNCgkJCQkJCWZ1X2Nvb2xkb3duID0gZ190bV9pKCkgKyAzMDsNCgkJCQl9DQoJCQl9DQoJCX0pDQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsNCgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KCQl9KTsNCn0sICIiLCB7IG1hcmdpbkxlZnQ6ICIxMHB4IiB9KTsNCg0KY19idG4ocGF0aCwgImNsb3NlZmluZHVzZXIiLCAiY2xvc2UiLCBmdW5jdGlvbiAoKSB7DQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kdXNlcmRsZyIpOw0KCWRpYWxvZy5jbG9zZSgpOw0KfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOw0KDQpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOw0KDQpjX2RpdihwYXRoLCAidXNlcl9pbmZhbGlhcyIsIHsNCglkaXNwbGF5OiAiaW5saW5lLWdyaWQiLA0KCWdyaWRUZW1wbGF0ZUNvbHVtbnM6ICJyZXBlYXQoMywgMTA1cHgpIiwNCglncmlkR2FwOiAiMTBweCINCn0pOw0KDQpjX2JyKHBhdGgsIDIpOw0KDQpjX2ltZygidXNlcl9pbmZhbGlhcyIsICJ1c2VyX2F2dHIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLA0KCXsNCgkJbWFyZ2luTGVmdDogIjEwcHgiLA0KCQlvYmplY3RGaXQ6ICJjb3ZlciIsDQoJCWJvcmRlclJhZGl1czogIjVweCIsDQoJCXBsYWNlU2VsZjogIm5vcm1hbCINCgl9KTsNCg0KY19icihwYXRoLCAyKTsNCg0KY190ZXh0KCJ1c2VyX2luZmFsaWFzIiwgInVzZXJfaW5mIiwgIm5vbmUiLCB7DQoJZGlzcGxheTogImdyaWQiLCBncmlkVGVtcGxhdGVDb2x1bW5zOiAiMTYwcHgiLCBtYXJnaW5Ub3A6ICIwcHgiLA0KCWNvbG9yOiAid2hpdGUiDQp9KTsNCg0KdmFyIGxhc3RfbXNnID0gMDsNCnZhciBmaXJzdF9zbmQgPSAwOw0KDQpmdW5jdGlvbiBwX3NvdW5kKGlkKSB7DQoJaWYgKGZpcnN0X3NuZCA9PSAwKSB7DQoJCWZpcnN0X3NuZCsrOw0KCX0NCgllbHNlIHsNCgkJdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQoJCWVsZW1lbnQudm9sdW1lID0gMC4xOw0KCQllbGVtZW50LnBsYXkoKTsNCgl9DQp9DQoNCmZ1bmN0aW9uIHVfY2hhdCgpIHsNCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikNCgkJcmV0dXJuOw0KDQoJZ2F0aGVyKCJnZXRfY2hhdCIsICJ6IikNCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgew0KCQkJY29uc3QgY2hhdHMgPSBKU09OLnBhcnNlKHJlc3VsdCk7DQoJCQljb25zdCBjaGF0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtY29udGFpbmVyJyk7DQoJCQljaGF0Q29udGFpbmVyLmlubmVySFRNTCA9ICcnOw0KDQoJCQl2YXIgaGlnaGVzdF90cyA9IDA7DQoJCQljaGF0cy5mb3JFYWNoKGFzeW5jIChjaGF0KSA9PiB7DQoJCQkJaWYgKGhpZ2hlc3RfdHMgPCBjaGF0LnRzKQ0KCQkJCQloaWdoZXN0X3RzID0gY2hhdC50czsNCg0KCQkJCWNvbnN0IGNoYXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQoJCQkJY2hhdEVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7DQoJCQkJY2hhdEVsZW1lbnQuaW5uZXJIVE1MID0gYCg8c3BhbiBkYXRhLXR0aXA9JyR7Z190bV9kdChjaGF0LnRzLCBmYWxzZSl9JyBzdHlsZT0ib3BhY2l0eTogMC41OyI+JHtnX3RtX2R0KGNoYXQudHMpfTwvc3Bhbj4pIDxzcGFuIHN0eWxlPScke2NoYXQuciAhPSB1bmRlZmluZWQgPyAoImNvbG9yOiIgKyAoT2JqZWN0LmVudHJpZXMocm9sZWNscilbY2hhdC5yXVsiMSJdKSArICI7IikgOiAiIn0nPjxzdHJvbmc+JHtjaGF0LnV9PC9zdHJvbmc+PC9zcGFuPjogJHt3aW5kb3cuYXRvYihjaGF0Lm1zZyl9YDsNCgkJCQljaGF0Q29udGFpbmVyLmFwcGVuZENoaWxkKGNoYXRFbGVtZW50KTsNCg0KCQkJCWNfaHIoImNoYXQtY29udGFpbmVyIiwgZmFsc2UsIHsNCgkJCQkJb3BhY2l0eTogIjAuMiIsDQoJCQkJCXBhZGRpbmdUb3A6ICIwcHgiLA0KCQkJCQlwYWRkaW5nQm90dG9tOiAiMHB4IiwNCgkJCQl9KTsNCgkJCX0pOw0KDQoJCQlpZiAobGFzdF9tc2cgIT0gaGlnaGVzdF90cykgew0KCQkJCXBfc291bmQoInNuZDEiKTsNCgkJCQlsYXN0X21zZyA9IGhpZ2hlc3RfdHM7DQoJCQl9DQoJCX0pDQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsNCgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KCQl9KTsNCn0NCg0KdV9jaGF0KCk7DQoNCnZhciBwYXRoID0gIm1haW5fZWxlbWVudHMiOw0KDQovKlNUQVJUIEZFQVRVUkVTKi8NCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aXRsZV9pZCIpLmlubmVyVGV4dCA9ICJaSU5DIjsNCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2lkIikuaW5uZXJUZXh0ID0gImNvbG9yYm90IjsNCg0KY190YWJfYnV0dG9uKCJlbGVtZW50X2J1dHRvbnMiLCBbDQoJeyBpZDogIm1haW5fdGFiIiwgdGV4dDogIm1haW4iIH0sDQoJeyBpZDogInNldHRpbmdzX3RhYiIsIHRleHQ6ICJkZWJ1ZyIgfSwNCgl7IGlkOiAicXJjb2RlX3RhYiIsIHRleHQ6ICJRUiIgfQ0KXSk7DQoNCmNfdGFiX2J1dHRvbigiZWxlbWVudF9yaWdodF9idXR0b25zIiwgWw0KCXsgaWQ6ICJwX3VwZGF0ZXMiLCB0ZXh0OiAibG9ncyIgfSwNCgl7IGlkOiAicF90aWNrZXRzIiwgdGV4dDogInRpY2tldHMiIH0sDQoJeyBpZDogInBfcHJvZmlsZSIsIHRleHQ6ICJwcm9maWxlIiB9DQpdLCAyKTsNCg0KY19jb21ib2JveChwYXRoLCAiYWxsX3Byb2ZpbGVzIiwgInByb2ZpbGUiLCAwLCAyMCwgdHJ1ZSwgIlBlcmZpbGVzIHBhcmEgY2FkYSBzaXR1YWNpb24uIiwgZnVuY3Rpb24gKCkgew0KCXJfaW5mbygpOw0KfSwgeyBtaW5XaWR0aDogIjE4MHB4IiB9KTsNCg0KY190ZXh0Ym94KHBhdGgsICJwcm9maWxlX25hbWVfYyIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7DQoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwNCgltaW5MZW5ndGg6IDQsDQoJbWF4TGVuZ3RoOiA5LA0KCXJlcXVpcmVkOiBmYWxzZSwNCn0sIHRydWUpOw0KDQpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfY2hhbmdlIiwgImNoYW5nZSBuYW1lIiwgZnVuY3Rpb24gKCkgew0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZmlsZV9uYW1lX2MiKS52YWxpZGl0eS52YWxpZCkgew0KDQoJCXZhciBwcm9mX3ZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsdWU7DQoJCXNfaW5mbygicHJvZmlsZV9uYW1lIiwgcHJvZl92YWx1ZSk7DQoNCgkJcl9pbmZvKCk7DQoJCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsNCgl9DQoJZWxzZSB7DQoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBlc3BhY2lvcyBvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7DQoJfQ0KfSwgIkNhbWJpYSBlbCBub21icmUgZGVsIHByb2ZpbGUiLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7DQoNCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9leHBvcnQiLCAiZXhwb3J0IHByb2ZpbGUiLCBmdW5jdGlvbiAoKSB7DQoJc19idG4oImV4cG9ydF9wcm9maWxlIik7DQp9LCAiRXhwb3J0YSBlbCBwZXJmaWwgYWN0dWFsIGFsIENMSVBCT0FSRC4iLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7DQoNCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9pbXBvcnQiLCAiaW1wb3J0IHByb2ZpbGUiLCBmdW5jdGlvbiAoKSB7DQoJc19idG4oImltcG9ydF9wcm9maWxlIik7DQoJcl9pbmZvKCk7DQoJZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOw0KfSwgIkltcG9ydGEgdW4gcGVyZmlsIGRlc2RlIGVsIENMSVBCT0FSRC4iKTsNCg0KY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsNCg0KY19jaGVja2JveChwYXRoLCAiY29sb3Jib3QiLCAiZW5hYmxlZCIsICJBY3RpdmEgZWwgZnVuY2lvbmFtaWVudG8gZGVsIGNvbG9yYm90LiIpOw0KY19jaGVja2JveChwYXRoLCAibWFza19mb3JtYXQiLCAibWFzayBmb3JtYXQiLCAiQWwgZXN0YXIgYWN0aXZhZG8sIHV0aWxpemEgZWwgbWFzayB0aHJlYWQgKGRlamFuZG8gaW5oYWJpbGl0YWRvIGVsIHNpbXBsZSBmb3JtYXQpIik7DQpjX2NoZWNrYm94KHBhdGgsICJzaW1wbGVfZm9ybWF0IiwgInNpbXBsZSBmb3JtYXQiLCAiQWwgZXN0YXIgYWN0aXZhZG8sIHV0aWxpemEgdW4gdGhyZWFkIGxpbXBpbyBzaW4gb3BjaW9uZXMgZGUgZGVidWcsIGV0Yy4iKTsNCg0KY19jaGVja2JveChwYXRoLCAiZGluYW1pY19zbW9vdGgiLCAiZGluYW1pYyBzbW9vdGgiLCAiQWwgYWN0aXZhcmxvLCBibG9xdWVhIGVsIHNtb290aCBwcmluY2lwYWwuIik7DQpjX2NvbWJvYm94KHBhdGgsICJtYWluX2tleSIsICJtYWluIGtleSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJMYSBLZXkgcHJpbmNpcGFsIGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBhaW0uIik7DQpjX2NvbWJvYm94KHBhdGgsICJzZWNvbmRhcnlfa2V5IiwgInNlY29uZGFyeSBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IHNlY3VuZGFyaWEgY29uIGxhIGN1YWwgc2UgYWN0aXZhIGVsIGFpbS4iKTsNCg0KY19jb21ib2JveChwYXRoLCAiZGluYW1pY19zbW9vdGhfdHlwZSIsICJkaW5hbWljIHNtb290aCB0eXBlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkFjb21vZGEgZWwgc21vb3RoIGRpbmFtaWNhbWVudGUgZGVwZW5kaWVuZG8gbGEgZGlzdGFuY2lhIGRlbCBlbmVtaWdvIik7DQpjX2NvbWJvYm94KHBhdGgsICJjb2xvcl90eXBlIiwgImNvbG9ycyIsIDAsIDQsIGZhbHNlLCAiRWwgY29sb3Igc2VsZWNjaW9uYWRvIGVzIGVuIGVsIGN1YWwgc2UgYmFzYXJhIGVsIGFpbWJvdCIpOw0KY19jb21ib2JveChwYXRoLCAic29ydF9tZXRob2QiLCAibWV0aG9kcyIsIDAsIDgsIGZhbHNlLCAiRGlzdGludG9zIG1ldG9kb3MgcGFyYSBxdWUgZWwgYWltYm90IGFwdW50ZSwgc2UgcmVjb21pZW5kYSBlbCBCRVNULiIpOw0KDQpjX3NfaW50KHBhdGgsICd0YXJnZXRfb2Zmc2V0X3gnLCAib2Zmc2V0IFgiLCAwLCA1MCwgMSwgMCk7DQpjX3NfaW50KHBhdGgsICJ0YXJnZXRfb2Zmc2V0X3kiLCAib2Zmc2V0IFkiLCAwLCA1MCwgMSwgNSk7DQoNCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7DQoNCmNfc19mbG9hdChwYXRoLCAic3BlZWQiLCAic21vb3RoIiwgMC4wLCA2LjAsIDAuMSwgMi4wKTsNCmNfc19pbnQocGF0aCwgImZvdl94IiwgIkZvdiBYIiwgNSwgNTAwLCA1LCA1MCk7DQpjX3NfaW50KHBhdGgsICJmb3ZfeSIsICJGb3YgWSIsIDUsIDI1MCwgNSwgNTApOw0KDQpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOw0KDQpjX2NoZWNrYm94KHBhdGgsICJyZWNvaWwiLCAicmVjb2lsIiwgIkJhamFyYSBlbCBjcm9zc2hhaXIgYSBsYSBob3JhIGRlIGRpc3BhcmFyIGNvbiBsYSBNQUlOIGtleS4iKTsNCmNfY2hlY2tib3gocGF0aCwgInJjc19jcm91Y2hfb25seSIsICJjcm91Y2ggb25seSIsICJTb2xvIGZ1bmNpb25hcmEgc2kgZXN0YW1vcyBhcHJldGFuZG8gQ1RSTCIpOw0KY19zX2ludChwYXRoLCAicmVjb2lsX2RlbGF5IiwgImRlbGF5IiwgNSwgNTAwLCA1LCAyMDApOw0KY19zX2ludChwYXRoLCAicmVjb2lsX3N0cmVuZ2h0IiwgInN0cmVuZ2h0IiwgMSwgNTAsIDEsIDIpOw0KY19zX2ludChwYXRoLCAibWF4X3JlY29pbF9vZmZzZXQiLCAibWF4IG9mZnNldCIsIDEsIDUwLCAxLCAyKTsNCg0KY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsNCg0KY19jaGVja2JveChwYXRoLCAidHJpZ2dlcmJvdCIsICJ0cmlnZ2VyYm90IiwgIkRpc3BhcmFyYSBhdXRvbWF0aWNhbWVudGUgY3VhbmRvIGVsIENPTE9SIHBhc2UgcG9yIGVsIGNyb3NzaGFpci4iKTsNCmNfY2hlY2tib3gocGF0aCwgImRpc2FibGVfYWltX29uX3RyaWdnZXIiLCAiZGlzYWJsZSBhaW0gb24gdHJpZ2dlciIpOw0KY19jb21ib2JveChwYXRoLCAidHJpZ2dlcl90eXBlIiwgInR5cGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlKTsNCmNfY29tYm9ib3gocGF0aCwgInRyaWdnZXJfa2V5IiwgInRyaWdnZXIga2V5IiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkxhIEtleSBjb24gbGEgY3VhbCBzZSBhY3RpdmEgZWwgVFJJR0dFUi4iKTsNCmNfc19pbnQocGF0aCwgInRyaWdnZXJfcmFkaXVzIiwgImZvdiIsIDEsIDUwLCAxLCAxNSk7DQpjX3NfaW50KHBhdGgsICJ0cmlnZ2VyX2RlbGF5IiwgImRlbGF5IiwgNSwgNTUwLCA1LCAyNTApOw0KDQpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOw0KDQpjX2NoZWNrYm94KHBhdGgsICJiaG9wIiwgImJob3AiLCAiQWwgYWN0aXZhcmxvLCBkZWJlcyBiaW5kZWFyIGxhIGtleSBYQnV0dG9uMiBvIE1vdXNlNSBhbCBiaG9wIGVuIHZleiBkZWwgZXNwYWNpby4iKTsNCmNfc19pbnQocGF0aCwgImJob3BfZGVsYXkiLCAiYmhvcCBkZWxheSIsIDUsIDIwMCwgNSwgMjAwKTsNCg0KcGF0aCA9ICJzZXR0aW5nX2VsZW1lbnRzIjsNCmNfY2hlY2tib3gocGF0aCwgImRlYnVnX3dpbmRvdyIsICJkZWJ1ZyB3aW5kb3ciKTsNCmNfY2hlY2tib3gocGF0aCwgImNpcmNsZXMiLCAiZGVidWcgY2lyY2xlcyIpOw0KY19jaGVja2JveChwYXRoLCAiY2VudGVyX2NvbG9ycyIsICJkZWJ1ZyBjb2xvcnMiKTsNCmNfY2hlY2tib3gocGF0aCwgIm1hc2tfd2luZG93IiwgImRlYnVnIG1hc2siKTsNCg0KZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOw0KZl9jb21ibygidHJpZ2dlcl90eXBlIiwgInRyaWdnZXJfdHlwZSIpOw0KZl9jb21ibygiZGluYW1pY19zbW9vdGhfdHlwZSIsICJkaW5hbWljX3Ntb290aF90eXBlIik7DQpmX2NvbWJvKCJjb2xvcl90eXBlIiwgImNvbG9ycyIpOw0KZl9jb21ibygic29ydF9tZXRob2QiLCAibWV0aG9kcyIpOw0KDQpjb25zdCBiaW5kX2VsZW1lbnRzID0gWw0KCXsgaWQ6ICJtYWluX2tleSIsIHRhcmdldDogIm1haW5fa2V5IiB9LA0KCXsgaWQ6ICJzZWNvbmRhcnlfa2V5IiwgdGFyZ2V0OiAic2Vjb25kYXJ5X2tleSIgfSwNCgl7IGlkOiAidHJpZ2dlcl9rZXkiLCB0YXJnZXQ6ICJ0cmlnZ2VyX2tleSIgfSwNCl07DQoNCi8qRU5EIEZFQVRVUkVTKi8NCg0KcGF0aCA9ICJwYW5lbF90aWNrZXRzIjsNCg0KY190ZXh0KHBhdGgsICJ0aWNrZXRjZW50ZXIiLCAiVGlja2V0IENlbnRlciIsIHsNCgl0ZXh0QWxpZ246ICdjZW50ZXInLA0KCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywNCglmb250U2l6ZTogJzE4cHgnLA0KCW1hcmdpbkJvdHRvbTogJzEwcHgnLA0KCW1hcmdpblRvcDogIjBweCIsDQp9KTsNCg0KdmFyIHRpY2tldF9mYXFfc3QgPSB7DQoJdGV4dEFsaWduOiAnY2VudGVyJywNCglmb250U2l6ZTogJzE0cHgnLA0KCW1hcmdpbkJvdHRvbTogJzEwcHgnLA0KfQ0KDQpjX3RleHQocGF0aCwgInRja3RmYXEiLCAiLSBEbyBub3Qgc3BhbSB0aGUgdGlja2V0IHN5c3RlbS48YnI+LSBPbmx5IGNyZWF0ZSB0aWNrZXRzIGlmIHlvdSBoYXZlIGFuIGlzc3VlLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYSBmZWF0dXJlIHJlcXVlc3QuPGJyPiIsIHRpY2tldF9mYXFfc3QpOw0KY190ZXh0KHBhdGgsICJ0Y2t0ZmFxIiwgIi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgbmVlZCA8dT5oZWxwPC91Pi48YnI+LSBBbGwgdGlja2V0cyBhcmUgPHU+cHJpdmF0ZTwvdT4uPGJyPi0gRG8gbm90IHBvc3QgaXJyZWxldmFudCBjb21tZW50cyBpbiB0aWNrZXRzIG9yIHlvdSBtYXkgYmUgPHU+YmFubmVkPC91Pi4iLCB0aWNrZXRfZmFxX3N0KTsNCg0KY19jb21ib2JveDIocGF0aCwgInRpY2tldF9iZWhhdmlvciIsIFsiQnVnIiwgIkZlYXR1cmUiLCAiT3RoZXIiXSwgdHJ1ZSwgIlNlbGVjY2lvbmEgdW5hIHJhem9uIGRlbCB0aWNrZXQuIik7DQoNCmNfdGV4dGFyZWEocGF0aCwgInRpY2tldF9jb250ZW50IiwgdHJ1ZSwgIiIsIHsNCgloZWlnaHQ6ICcxMDBweCcsDQoJcmVzaXplOiAnbm9uZScsDQoJb3ZlcmZsb3c6ICdoaWRkZW4nLA0KCXdoaXRlU3BhY2U6ICdwcmUtd3JhcCcsDQoJbWFyZ2luVG9wOiAiNXB4IiwNCn0sIHsNCglwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokezV9IiwNCgltaW5MZW5ndGg6IDUsDQoJbWF4TGVuZ3RoOiAyNTYsDQoJcGxhY2Vob2xkZXI6ICJpbmZvIiwNCglyZXF1aXJlZDogdHJ1ZSwNCn0pOw0KDQp2YXIgc2hvd190aWNrZXRfYyA9IGZhbHNlOw0KY19idG4ocGF0aCwgImJ0bl9jcmVhdGVfdGlja2V0IiwgImNyZWF0ZSB0aWNrZXQiLCBmdW5jdGlvbiAoKSB7DQoJaWYgKCFzaG93X3RpY2tldF9jKSB7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsNCgkJc2hvd190aWNrZXRfYyA9IHRydWU7DQoJCXJldHVybjsNCgl9DQoNCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50IikudmFsaWRpdHkudmFsaWQpIHsNCgkJdmFyIHRpY2tldF9pbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50IikudmFsdWU7DQoJCXZhciB0aWNrZXRfcmVhc29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnZhbHVlOw0KDQoJCXNfYnRuKCJjcmVhdGVfdGlja2V0IiwgdGlja2V0X3JlYXNvbiArICItIiArIHRpY2tldF9pbmZvKQ0KCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgew0KCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsNCgkJCX0pDQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7DQoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7DQoJCQl9KTsNCgl9DQoJZWxzZSB7DQoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDUgYSAyNTYgY2FyYWN0ZXJlcyBzb2xhbWVudGUuIiwgNTAwMCwgIlJFRCIpOw0KCX0NCn0sICJDcmVhIHVuIHRpY2tldCBlbCBjdWFsIHNlcmEgYXRlbmRpZG8vdmlzdG8gcG9yIGxvcyBhZG1pbmlzdHJhZG9yZXMuIik7DQoNCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7DQpjX2J0bihwYXRoLCAiYnRuX2dldF90aWNrZXRzIiwgInZpZXcgdGlja2V0cyIsIGZ1bmN0aW9uICgpIHsNCglpZiAoc2hvd190aWNrZXRfYykgew0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2JlaGF2aW9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJc2hvd190aWNrZXRfYyA9IGZhbHNlOw0KCX0NCg0KCXNfYnRuKCJnZXRfdGlja2V0cyIpDQoJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoInVzZXJfaGFzX25vX3RpY2tldHMiKSkgew0KCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCXZhciByZXNqc29uID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpOw0KDQoJCQlpZiAocmVzanNvbi5sZW5ndGggPT0gMCkgew0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX3RpY2tldHMiKS5pbm5lckhUTUwgPSAibm8gdGlja2V0cyI7DQoJCQkJbm90aWZ5KCJ1c2VyIGhhcyBubyB0aWNrZXRzIiwgNzAwMCk7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gIm5vIHRpY2tldHMiOw0KDQoJCQl2YXIgdG9fdGlja2V0cyA9ICIiOw0KCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzanNvbikgew0KCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNqc29uLCBrZXkpKSB7DQoJCQkJCWNvbnN0IGVsZW1lbnQgPSByZXNqc29uW2tleV07DQoJCQkJCXRvX3RpY2tldHMgKz0gIjxzdHJvbmc+PHU+IiArIGVsZW1lbnRbInJlYXNvbiJdICsgIiBbIiArIGVsZW1lbnRbImlkIl0gKyAiXTwvdT4gfCA8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIGRhdGEtdHRpcD0nRGVsZXRlIHRpY2tldCcgc3R5bGU9J2hlaWdodDozMHB4O3dpZHRoOmF1dG87ZGlzcGxheTppbmxpbmUtYmxvY2s7Y29sb3I6cmVkOycgb25jbGljaz1cInNfYnRuKCdkZWxldGVfdGlja2V0JywgJyIgKyBlbGVtZW50WyJpZCJdICsgIicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcik7fSk7XCI+JnRpbWVzOzwvYnV0dG9uPjwvc3Ryb25nPjxicj4iOw0KCQkJCQl0b190aWNrZXRzICs9ICI8cD4iICsgZWxlbWVudFsiY29udGVudCJdICsgIjwvcD4iOw0KCQkJCQl0b190aWNrZXRzICs9ICI8YnI+PGJyPiI7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gdG9fdGlja2V0czsNCgkJfSkNCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgew0KCQkJY29uc29sZS5lcnJvcihlcnJvcik7DQoJCX0pOw0KfSwgIk11ZXN0cmEgdHVzIHRpY2tldHMgY3JlYWRvcyIpOw0KDQpjX3RleHQocGF0aCwgInVzZXJfdGlja2V0cyIsICIiLCB7IHRleHRBbGlnbjogImNlbnRlciIgfSk7DQoNCmNfYnIocGF0aCk7DQoNCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOw0KDQpjX3RleHQocGF0aCwgIm1haW5fcGZfdGV4dCIsICJQcm9maWxlIiwgew0KCXRleHRBbGlnbjogJ2NlbnRlcicsDQoJZm9udFdlaWdodDogJ2JvbGQnLA0KCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywNCglmb250U2l6ZTogJzIwcHgnLA0KCW1hcmdpbkJvdHRvbTogJzEwcHgnLA0KCW1hcmdpblRvcDogJzBweCcNCn0pOw0KDQpjX2RpdihwYXRoLCAidXNlcmluZm8iLCB7DQoJZGlzcGxheTogImlubGluZS1ncmlkIiwNCglncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDFmcikiLA0KCWdyaWRHYXA6ICIxMHB4Ig0KfSk7DQoNCnBhdGggPSAidXNlcmluZm8iOw0KY19pbWcocGF0aCwgInVzZXJfYXZhdGFyIiwgZGVmYXVsdF9hdmF0YXIsIDkwLCA5MCwNCgl7DQoJCWp1c3RpZnlTZWxmOiAic3RhcnQiLA0KCQltYXJnaW5MZWZ0OiAiMTBweCIsDQoJCW9iamVjdEZpdDogImNvdmVyIiwNCgkJYm9yZGVyUmFkaXVzOiAiNXB4Ig0KCX0pOw0KDQpjX3RleHQocGF0aCwgInVzZXJfaW5mbyIsICJub25lIiwgeyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxNjBweCIsIG1hcmdpblRvcDogIjBweCIgfSk7DQoNCmZ1bmN0aW9uIG93bl9pbmZvKCkgew0KCWdhdGhlcigiZ2V0X3VzZXJfaW5mbyIsICJ6IikNCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgew0KCQkJbGV0IHVfaW5mID0gSlNPTi5wYXJzZShyZXN1bHQpOw0KDQoJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsNCgkJCX0NCg0KCQkJdmFyIHVzZXJfZGF0YSA9ICIiOw0KCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07DQoNCgkJCWlmICh1X2luZlsicm9sZSJdKQ0KCQkJCXVzZXJfZGF0YSArPSAiPHNwYW4gc3R5bGU9J2Rpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOiIgKyByb2xlY2xyW3VfaW5mWyJyb2xlIl0udG9Mb3dlckNhc2UoKV0gKyAiOyc+ICgiICsgdV9pbmZbInJvbGUiXSArICIpPC9zcGFuPjxicj48L3N0cm9uZz48L3A+IjsNCg0KCQkJaWYgKHVfaW5mWyJ1c2VyX2lkIl0pDQoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz51aWQ6ICIgKyB1X2luZlsidXNlcl9pZCJdOw0KCQkJZWxzZQ0KCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+YmV0YSI7DQoNCgkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQ0KCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCBmYWxzZSkgKyAiPC9wPiI7DQoJCQllbHNlDQoJCQkJdXNlcl9kYXRhICs9ICI8L3A+IjsNCg0KCQkJaWYgKHVfaW5mWyJkZXNjcmlwdGlvbiJdKQ0KCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPmluZm86ICIgKyB3aW5kb3cuYXRvYih1X2luZlsiZGVzY3JpcHRpb24iXSkgKyAiPC9wPiI7DQoJCQllbHNlDQoJCQkJdXNlcl9kYXRhICs9ICI8cD48L3A+Ig0KDQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmZvIikuaW5uZXJIVE1MID0gdXNlcl9kYXRhOw0KCQl9KQ0KCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7DQoJCQljb25zb2xlLmVycm9yKGVycm9yKTsNCgkJfSk7DQp9DQoNCm93bl9pbmZvKCk7DQoNCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOw0KY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsNCg0KY19idG4ocGF0aCwgIm9wZW5kbGdhbGlhcyIsICJjaGFuZ2UgYWxpYXMiLCBmdW5jdGlvbiAoKSB7DQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbGlhc19kbGciKTsNCglkaWFsb2cuc2hvd01vZGFsKCk7DQp9LCAiUGVybWl0ZSBjYW1iaWFyIGVsIGFsaWFzIDEgdmV6IGNhZGEgMzAgZGlhcy4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQ0KDQpjX2RpYWxvZyhwYXRoLCAiYWxpYXNfZGxnIiwge30sIHt9KTsNCnBhdGggPSAiYWxpYXNfZGxnIjsNCg0KY190ZXh0Ym94KHBhdGgsICJwZl9hbGlhc190ZXh0Ym94IiwgZmFsc2UsICIiLCAiIiwgew0KCW1hcmdpblRvcDogIjVweCIsDQp9LCB7DQoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwNCgltaW5MZW5ndGg6IDMsDQoJbWF4TGVuZ3RoOiAyMCwNCglyZXF1aXJlZDogdHJ1ZSwNCn0pOw0KDQpjX2JyKCk7DQoNCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2FsaWFzIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsNCgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYWxpYXNfdGV4dGJveCIpOw0KDQoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgew0KCQl2YXIgdHh0aW5mbyA9IGVsZW1faXRlbS52YWx1ZTsNCgkJc19idG4oImNoYW5nZV9hbGlhcyIsIHR4dGluZm8pDQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7DQoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOw0KDQoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgew0KCQkJCQlvd25faW5mbygpOw0KCQkJCX0NCgkJCX0pDQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7DQoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7DQoJCQl9KTsNCgl9DQoJZWxzZSB7DQoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsNCgl9DQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOw0KDQpjX2JyKCk7DQoNCmNfYnRuKHBhdGgsICJjYW5jZWxfYWxpYXMiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgew0KCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxpYXNfZGxnIik7DQoJZGlhbG9nLmNsb3NlKCk7DQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOw0KDQpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsNCg0KY19idG4ocGF0aCwgIm9wZW5kbGdhdnRyIiwgImNoYW5nZSBhdmF0YXIiLCBmdW5jdGlvbiAoKSB7DQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOw0KCWRpYWxvZy5zaG93TW9kYWwoKTsNCn0sICJDYW1iaWEgZWwgYXZhdGFyIGEgdW5hIGltYWdlbiwgc29sbyBVUkxTLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pDQoNCmNfZGlhbG9nKHBhdGgsICJhdnRyX2RsZyIpOw0KcGF0aCA9ICJhdnRyX2RsZyI7DQoNCmNfaW1nKHBhdGgsICJhdnRyX3ByZXZpZXciLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLCB7DQoJZGlzcGxheTogImJsb2NrIiwNCgltYXJnaW46ICIwIGF1dG8iLA0KCW9iamVjdEZpdDogImNvdmVyIg0KfSk7DQoNCmNfYnIoKTsNCg0KY190ZXh0KHBhdGgsICIiLCAiSW1ndXIgVVJMIG9ubHksIGV4YW1wbGUuIiwgew0KCXRleHRBbGlnbjogImNlbnRlciIsDQoJY29sb3I6ICJ3aGl0ZSINCn0pOw0KY190ZXh0KHBhdGgsICIiLCAiaHR0cHM6Ly9pLmltZ3VyLmNvbS9HbkphRVpMLnBuZyIsIHsNCgl0ZXh0QWxpZ246ICJjZW50ZXIiLA0KCWNvbG9yOiAid2hpdGUiDQp9KTsNCg0KY190ZXh0Ym94KHBhdGgsICJwZl9hdmF0YXJfdGV4dGJveCIsIGZhbHNlLCAiIiwgIjEwIGEgMTMwIGNhcmFjdGVyZXMuIEV2aXRhciB1c2FyIFVSTCdzIGRlIGdpZnMvdmlkZW9zLiIsIHsNCgltYXJnaW5Ub3A6ICI1cHgiLA0KCXdpZHRoOiAiOTUlIg0KfSwgew0KCXBhdHRlcm46ICJeKGh0dHBzPzpcL1wvKT8oaVwuaW1ndXJcLmNvbVwvKShbYS16QS1aMC05XSspKFwuanBnfFwuanBlZ3xcLnBuZykkIiwNCgltaW5MZW5ndGg6IDIwLA0KCW1heExlbmd0aDogNDAsDQoJcmVxdWlyZWQ6IHRydWUsDQp9KTsNCg0KY19icigpOw0KDQpjX2J0bihwYXRoLCAiYnRuX3ByZXZpZXdfYXZhdGFyIiwgInByZXZpZXciLCBmdW5jdGlvbiAoKSB7DQoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2F2YXRhcl90ZXh0Ym94Iik7DQoNCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSBlbGVtX2l0ZW0udmFsdWU7DQoJfQ0KCWVsc2Ugew0KCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7DQoJfQ0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsNCg0KY19icigpOw0KY19ocihwYXRoLCBmYWxzZSk7DQoNCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2F2YXRhciIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7DQoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2F2YXRhcl90ZXh0Ym94Iik7DQoNCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7DQoJCXZhciB0eHRpbmZvID0gZWxlbV9pdGVtLnZhbHVlOw0KCQlzX2J0bignY2hhbmdlX2F2YXRhcicsIHR4dGluZm8pDQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7DQoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOw0KDQoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gdHh0aW5mbzsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gdHh0aW5mbzsNCg0KCQkJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7DQoJCQkJCWRpYWxvZy5jbG9zZSgpOw0KCQkJCX0NCgkJCX0pDQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7DQoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7DQoJCQl9KTsNCgl9DQoJZWxzZSB7DQoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsNCgl9DQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOw0KDQpjX2JyKCk7DQoNCmNfYnRuKHBhdGgsICJjYW5jZWxfYXZ0ciIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7DQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOw0KCWRpYWxvZy5jbG9zZSgpOw0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsNCg0KcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7DQoNCmNfYnRuKHBhdGgsICJvcGVuZGxnZGVzYyIsICJjaGFuZ2UgZGVzY3JpcHRpb24iLCBmdW5jdGlvbiAoKSB7DQoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjX2RsZyIpOw0KCWRpYWxvZy5zaG93TW9kYWwoKTsNCn0sICJDYW1iaWEgbGEgZGVzY3JpcGNpb24gZGUgdHUgcGVyZmlsLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pDQoNCmNfZGlhbG9nKHBhdGgsICJkZXNjX2RsZyIpOw0KcGF0aCA9ICJkZXNjX2RsZyI7DQoNCmNfdGV4dGFyZWEocGF0aCwgImRlc2NyaXB0aW9uX2NvbnRlbnQiLCBmYWxzZSwgIiIsIHsNCgloZWlnaHQ6ICcxMDBweCcsDQoJcmVzaXplOiAnbm9uZScsDQoJb3ZlcmZsb3c6ICdoaWRkZW4nLA0KCXdoaXRlU3BhY2U6ICdwcmUtd3JhcCcsDQoJbWFyZ2luVG9wOiAiNXB4IiwNCglqdXN0aWZ5U2VsZjogImNlbnRlciIsDQoJdGV4dGJveDogew0KCQlkaXNwbGF5OiAiaW5oZXJpdCINCgl9DQp9LCB7DQoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsDQoJbWluTGVuZ3RoOiA0LA0KCW1heExlbmd0aDogMjU2LA0KCXBsYWNlaG9sZGVyOiAiZGVzY3JpcHRpb24iLA0KCXJlcXVpcmVkOiB0cnVlLA0KfSk7DQoNCmNfYnIoKTsNCg0KY19idG4ocGF0aCwgImJ0bl9jaGFuZ2VfZGVzY3JpcHRpb24iLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgew0KCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjcmlwdGlvbl9jb250ZW50Iik7DQoNCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7DQoJCXZhciBkZXNjX2luZm8gPSBlbGVtX2l0ZW0udmFsdWU7DQoNCgkJc19idG4oImNoYW5nZV9kZXNjcmlwdGlvbiIsIGRlc2NfaW5mbykNCgkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7DQoNCgkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJjaGFuZ2VkIikgJiYgIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygid2FpdCIpKSB7DQoJCQkJCW93bl9pbmZvKCk7DQoJCQkJfQ0KCQkJfSkNCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsNCgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsNCgkJCX0pOw0KCX0NCgllbHNlIHsNCgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOw0KCX0NCn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7DQoNCmNfYnIoKTsNCg0KY19idG4ocGF0aCwgImNhbmNlbF9kZXNjIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsNCgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NfZGxnIik7DQoJZGlhbG9nLmNsb3NlKCk7DQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOw0KDQpjb25zdCB2aXJ0dWFsS2V5cyA9IFtdOw0KDQpmb3IgKGxldCBpID0gMHg0MTsgaSA8PSAweDVBOyBpKyspIHsNCgl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsNCn0NCg0KZm9yIChsZXQgaSA9IDB4MzA7IGkgPD0gMHgzOTsgaSsrKSB7DQoJdmlydHVhbEtleXMucHVzaCh7IGNvZGU6IGksIG5hbWU6IFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgfSk7DQp9DQoNCmNvbnN0IHNwZWNpYWxLZXlzID0gWw0KCXsgY29kZTogMCwgbmFtZTogJ05PTkUnIH0sDQoJeyBjb2RlOiAweDA4LCBuYW1lOiAnQmFja3NwYWNlJyB9LA0KCXsgY29kZTogMHgwOSwgbmFtZTogJ1RhYicgfSwNCgl7IGNvZGU6IDB4MEQsIG5hbWU6ICdFbnRlcicgfSwNCgl7IGNvZGU6IDB4MTAsIG5hbWU6ICdTaGlmdCcgfSwNCgl7IGNvZGU6IDB4MTEsIG5hbWU6ICdDdHJsJyB9LA0KCXsgY29kZTogMHgxMiwgbmFtZTogJ0FsdCcgfSwNCgl7IGNvZGU6IDB4QTQsIG5hbWU6ICdMZWZ0IEFsdCcgfSwNCgl7IGNvZGU6IDB4QTUsIG5hbWU6ICdSaWdodCBBbHQnIH0sDQoJeyBjb2RlOiAweDEzLCBuYW1lOiAnUGF1c2UvQnJlYWsnIH0sDQoJeyBjb2RlOiAweDVCLCBuYW1lOiAnTGVmdCBXaW5kb3dzJyB9LA0KCXsgY29kZTogMHg1QywgbmFtZTogJ1JpZ2h0IFdpbmRvd3MnIH0sDQoJeyBjb2RlOiAweDVELCBuYW1lOiAnQXBwbGljYXRpb25zJyB9LA0KCXsgY29kZTogMHg2MCwgbmFtZTogJ051bVBhZCAwJyB9LA0KCXsgY29kZTogMHg2MSwgbmFtZTogJ051bVBhZCAxJyB9LA0KCXsgY29kZTogMHg2MiwgbmFtZTogJ051bVBhZCAyJyB9LA0KCXsgY29kZTogMHg2MywgbmFtZTogJ051bVBhZCAzJyB9LA0KCXsgY29kZTogMHg2NCwgbmFtZTogJ051bVBhZCA0JyB9LA0KCXsgY29kZTogMHg2NSwgbmFtZTogJ051bVBhZCA1JyB9LA0KCXsgY29kZTogMHg2NiwgbmFtZTogJ051bVBhZCA2JyB9LA0KCXsgY29kZTogMHg2NywgbmFtZTogJ051bVBhZCA3JyB9LA0KCXsgY29kZTogMHg2OCwgbmFtZTogJ051bVBhZCA4JyB9LA0KCXsgY29kZTogMHg2OSwgbmFtZTogJ051bVBhZCA5JyB9LA0KCXsgY29kZTogMHg3MCwgbmFtZTogJ0YxJyB9LA0KCXsgY29kZTogMHg3MSwgbmFtZTogJ0YyJyB9LA0KCXsgY29kZTogMHg3MiwgbmFtZTogJ0YzJyB9LA0KCXsgY29kZTogMHg3MywgbmFtZTogJ0Y0JyB9LA0KCXsgY29kZTogMHg3NCwgbmFtZTogJ0Y1JyB9LA0KCXsgY29kZTogMHg3NSwgbmFtZTogJ0Y2JyB9LA0KCXsgY29kZTogMHg3NiwgbmFtZTogJ0Y3JyB9LA0KCXsgY29kZTogMHg3NywgbmFtZTogJ0Y4JyB9LA0KCXsgY29kZTogMHg3OCwgbmFtZTogJ0Y5JyB9LA0KCXsgY29kZTogMHg3OSwgbmFtZTogJ0YxMCcgfSwNCgl7IGNvZGU6IDB4N0EsIG5hbWU6ICdGMTEnIH0sDQoJeyBjb2RlOiAweDdCLCBuYW1lOiAnRjEyJyB9LA0KCXsgY29kZTogMHgwMSwgbmFtZTogJ0xCVVRUT04nIH0sDQoJeyBjb2RlOiAweDAyLCBuYW1lOiAnUkJVVFRPTicgfSwNCgl7IGNvZGU6IDB4MDQsIG5hbWU6ICdNQlVUVE9OJyB9LA0KCXsgY29kZTogMHgwNSwgbmFtZTogJ1hCVVRUT04xJyB9LA0KCXsgY29kZTogMHgwNiwgbmFtZTogJ1hCVVRUT04yJyB9LA0KCXsgY29kZTogMHhCQiwgbmFtZTogJz0nIH0sDQoJeyBjb2RlOiAweEJDLCBuYW1lOiAnLCcgfSwNCgl7IGNvZGU6IDB4QkQsIG5hbWU6ICctJyB9LA0KCXsgY29kZTogMHhCRSwgbmFtZTogJy4nIH0sDQpdOw0KDQp2aXJ0dWFsS2V5cy5wdXNoKC4uLnNwZWNpYWxLZXlzKTsNCnZpcnR1YWxLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEuY29kZSAtIGIuY29kZTsgfSk7DQoNCmZ1bmN0aW9uIGNyZWF0ZU9wdGlvbkVsZW1lbnQoa2V5RWxlbWVudCwgaWQpIHsNCgljb25zdCBvcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7DQoJb3B0aW9uRWxlbWVudC52YWx1ZSA9IGtleUVsZW1lbnQuY29kZTsNCglvcHRpb25FbGVtZW50LnRleHQgPSBrZXlFbGVtZW50Lm5hbWU7DQoJb3B0aW9uRWxlbWVudC5pZCA9IGlkKyJfb3B0IjsNCglyZXR1cm4gb3B0aW9uRWxlbWVudDsNCn0NCg0KYmluZF9lbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7DQoJY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnQudGFyZ2V0KTsNCgl2aXJ0dWFsS2V5cy5mb3JFYWNoKChrZXkpID0+IHsNCgkJdGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChjcmVhdGVPcHRpb25FbGVtZW50KGtleSwgZWxlbWVudC5pZCkpOw0KCX0pOw0KfSk7DQoNCmZ1bmN0aW9uIHJfaW5mbygpIHsNCglmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7DQoJCWdfYm9vbCh1X2Jvb2xbaV0pOw0KCX0NCg0KCWZvciAoY29uc3QgaSBpbiB1X2Zsb2F0KSB7DQoJCWdfZmxvYXQodV9mbG9hdFtpXSk7DQoJfQ0KDQoJZm9yIChjb25zdCBpIGluIHVfaW50KSB7DQoJCWdfaW50KHVfaW50W2ldKTsNCgl9DQoNCglmb3IgKGNvbnN0IGkgaW4gdV9pbnQyKSB7DQoJCWdfaW50KHVfaW50MltpXSwgZmFsc2UpOw0KCX0NCn0NCg0KZnVuY3Rpb24gdV9zZXJ2ZXIoKSB7DQoJZm9yIChjb25zdCBpIGluIHVfYm9vbCkgew0KCQlzX2Jvb2wodV9ib29sW2ldKTsNCgl9DQoNCglmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgew0KCQlzX2Zsb2F0KHVfZmxvYXRbaV0pOw0KCX0NCn0NCg0KZnVuY3Rpb24gY2VudGVyX3RhYnNfZml4KGlkLCBkaXNwbGF5ID0gImlubGluZS1ibG9jayIpIHsNCgl2YXIgZWxlbWVudG9zID0gWydlbGVtZW50X21haW4nLCAnZWxlbWVudF9zZXR0aW5nJywgJ2VsZW1lbnRfcXJjb2RlJ107DQoNCgllbGVtZW50b3MuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudG8pIHsNCgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKSkNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KCX0pOw0KDQoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5Ow0KfQ0KDQpmdW5jdGlvbiB0YWJfc3dpdGNoKGkgPSB0aGlzLmlkLCBwYW5lbCA9ICJjZW50ZXIiLCBkaXNwbGF5ID0gImlubGluZS1ibG9jayIpIHsNCglzd2l0Y2ggKHBhbmVsKSB7DQoJCWNhc2UgMjoNCgkJY2FzZSAiMiI6DQoJCWNhc2UgInJpZ2h0IjoNCgkJCWxldCB0YWIyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltjLXRhYjItYnRuXSIpOw0KCQkJdGFiMkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7DQoJCQkJaWYgKGJ1dHRvbi5pZCA9PT0gaSkgew0KCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7DQoJCQkJfSBlbHNlIHsNCgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOw0KCQkJCX0NCgkJCX0pOw0KCQkJc3dpdGNoIChpKSB7DQoJCQkJY2FzZSAncF91cGRhdGVzJzoNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ3BfdGlja2V0cyc6DQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICdwX3Byb2ZpbGUnOg0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJncmlkIjsNCgkJCQkJYnJlYWs7DQoJCQl9DQoJCQlicmVhazsNCgkJY2FzZSAxOg0KCQljYXNlICIxIjoNCgkJY2FzZSAiY2VudGVyIjoNCgkJCWxldCB0YWJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2MtdGFiLWJ0bl0iKTsNCgkJCXRhYkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7DQoJCQkJaWYgKGJ1dHRvbi5pZCA9PT0gaSkgew0KCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7DQoJCQkJfSBlbHNlIHsNCgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQlzd2l0Y2ggKGkpIHsNCgkJCQljYXNlICdtYWluX3RhYic6DQoJCQkJCWNlbnRlcl90YWJzX2ZpeCgnZWxlbWVudF9tYWluJywgZGlzcGxheSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ3NldHRpbmdzX3RhYic6DQoJCQkJCWNlbnRlcl90YWJzX2ZpeCgnZWxlbWVudF9zZXR0aW5nJywgZGlzcGxheSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ3FyY29kZV90YWInOg0KCQkJCQljZW50ZXJfdGFic19maXgoJ2VsZW1lbnRfcXJjb2RlJywgZGlzcGxheSk7DQoJCQkJCWJyZWFrOw0KCQkJfQ0KCQkJYnJlYWs7DQoJfQ0KfQ0KDQp0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOw0Kcl9pbmZvKCk7DQoNCnZhciBpdGVyZm91bmQgPSAwOw0KdmFyIHdhc19nYW1lX2ZvdW5kID0gZmFsc2U7DQp2YXIgc2hvdWxkX3VwZGF0ZSA9IHRydWU7DQp2YXIgaXNfbW91c2VfaW5zaWRlID0gZmFsc2U7DQoNCmZ1bmN0aW9uIGhNb3VzZUUoKSB7IGlzX21vdXNlX2luc2lkZSA9IHRydWU7IH0NCmZ1bmN0aW9uIGhNb3VzZUwoKSB7IGlzX21vdXNlX2luc2lkZSA9IGZhbHNlOyB9DQoNCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiLCBoTW91c2VFKTsNCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbGVhdmUiLCBoTW91c2VMKTsNCg0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidmlzaWJpbGl0eWNoYW5nZSIsIChldmVudCkgPT4gew0KCWlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT0gInZpc2libGUiKSB7DQoJCXNob3VsZF91cGRhdGUgPSB0cnVlOw0KCX0gZWxzZSB7DQoJCXNob3VsZF91cGRhdGUgPSBmYWxzZTsNCgl9DQp9KTsNCg0KdmFyIHVwZGF0ZXJ0ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KCWlmIChzaG91bGRfdXBkYXRlICYmIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsNCgkJcl9pbmZvKCk7DQoJCWdfb25saW5lcygpOw0KCX0NCn0sIDY1MDApOw0KDQpzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7DQoJaWYgKGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsNCgkJdV9jaGF0KCk7DQoJfQ0KfSwgMzUwMCk7DQoNCmFzeW5jIGZ1bmN0aW9uIGdhdGhlcihpbmZvLCBleHRyYSwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0pIHsNCglyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBpbmZvICsgIiZ2YWw9IiArIGV4dHJhLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7DQoJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7DQoJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7DQoJCQlyZWplY3QoZXJyb3IpOw0KCQl9KTsNCgl9KTsNCn0NCg0KZnVuY3Rpb24gemluY19pbmZvKGluZm8sIGV4dHJhKSB7DQoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaW5mbywgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgew0KCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykgIT0gdW5kZWZpbmVkKSB7DQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5pbm5lckhUTUwgPSBleHRyYSArIHJlc3BvbnNlVGV4dDsNCgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJfQ0KCX0pOw0KfQ0KDQp2YXIgd2FpdGluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsNCgkkLmdldCgiL2dfaW5mbz9pbmZvPWdhbWVmb3VuZCIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJd2FzX2dhbWVfZm91bmQgPSBwYXJzZUludChyZXNwb25zZVRleHQpOw0KCQlpZiAoIXdhc19nYW1lX2ZvdW5kKSB7DQoJCQl6aW5jX2luZm8oIndhaXRpbmdfZ2FtZSIsICJpbnRpYWxpemluZzxicj5jbG9zaW5nIGluOiAiKTsNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2RheXMiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfYnV0dG9ucyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9tYWluIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIsICJjZW50ZXIiLCAibm9uZSIpOw0KCQl9DQoJCWVsc2Ugew0KCQkJaXRlcmZvdW5kKys7DQoNCgkJCWlmIChpdGVyZm91bmQgPiAyKSB7DQoJCQkJemluY19pbmZvKCJ1c2VyX2RheXMiLCAiZGF5cyBsZWZ0OiAiKTsNCgkJCQl6aW5jX2luZm8oImxhc3RfdXBkYXRlIiwgIjxzdHJvbmc+VXBkYXRlZDwvc3Ryb25nPjogIik7DQoJCQkJemluY19pbmZvKCJjaGFuZ2Vsb2dzIiwgIjxzdHJvbmc+Q2hhbmdlbG9nczwvc3Ryb25nPjogIik7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXRpbmdfZ2FtZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfYnV0dG9ucyIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfbWFpbiIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJCXRhYl9zd2l0Y2goIm1haW5fdGFiIik7DQoJCQkJdGFiX3N3aXRjaCgicF91cGRhdGVzIiwgMik7DQoJCQkJY2xlYXJJbnRlcnZhbCh3YWl0aW5nKTsNCgkJCX0NCgkJfQ0KCX0pDQp9LCAyNTApOw0KDQp2YXIgcnVubmluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsNCgl0cnkgew0KCQkkLmdldCgiL2dfaW5mbz9pbmZvPXJ1bm5pbmciLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7DQoJCQljX2V4aXQoKTsNCgkJfSk7DQoJfSBjYXRjaCAoZXJyb3IpIHsNCgkJY19leGl0KCk7DQoJfQ0KfSwgMTI1MCk7DQoNCmZ1bmN0aW9uIGNfZGlhbG9nKGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsNCgljb25zdCBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaWFsb2ciKTsNCglkaWFsb2cuaWQgPSBpZF9pdGVtOw0KDQoJaWYgKHN0eWxleikgew0KCQlPYmplY3QuYXNzaWduKGRpYWxvZy5zdHlsZSwgc3R5bGV6KTsNCgl9DQoNCglpZiAoZWxlbW50KSB7DQoJCWZvciAobGV0IGtleSBpbiBlbGVtbnQpIHsNCgkJCWNvbnN0IGVsZW1lbnQgPSBlbGVtbnRba2V5XTsNCgkJCWNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50LnR5cGUpOw0KCQkJT2JqZWN0LmFzc2lnbihlbCwgZWxlbWVudC5wcm9wcyk7DQoJCQlPYmplY3QuYXNzaWduKGVsLnN0eWxlLCBlbGVtZW50LnN0eWxlcyk7DQoJCQlkaWFsb2cuYXBwZW5kQ2hpbGQoZWwpOw0KCQl9DQoJfQ0KDQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpLmFwcGVuZENoaWxkKGRpYWxvZyk7DQp9DQoNCmZ1bmN0aW9uIGNfZGl2KGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsNCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCglkaXYuaWQgPSBpZF9pdGVtOw0KCWlmIChlbGVtbnQpIHsNCgkJT2JqZWN0LmFzc2lnbihkaXYsIGVsZW1udCk7DQoNCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7DQoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsNCgkJCQlkaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCX0NCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbihkaXYuc3R5bGUsIHN0eWxleik7DQoJfQ0KDQoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOw0KCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOw0KfQ0KDQpmdW5jdGlvbiBjX3RhYl9idXR0b24oaWRfd2hlcmUsIGJ1dHRvbnMsIHR5cGV6ID0gMSkgew0KCWNvbnN0IHRhYkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsNCg0KCWJ1dHRvbnMuZm9yRWFjaChmdW5jdGlvbiAoYnV0dG9uLCBpbmRleCkgew0KCQl2YXIgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQoJCWJ0bi5jbGFzc05hbWUgPSAidGFiLWJ1dHRvbiI7DQoJCWJ0bi5zZXRBdHRyaWJ1dGUodHlwZXogPT0gMSA/ICJjLXRhYi1idG4iIDogKCJjLXRhYiIgKyB0eXBleiArICItYnRuIiksICIiKTsNCgkJYnRuLmlkID0gYnV0dG9uLmlkOw0KCQlidG4uaW5uZXJIVE1MID0gYnV0dG9uLnRleHQ7DQoNCgkJaWYgKGluZGV4ID09PSAwKSB7DQoJCQlidG4uc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMgPSAiMHB4IjsNCgkJfSBlbHNlIGlmIChpbmRleCA9PT0gYnV0dG9ucy5sZW5ndGggLSAxKSB7DQoJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOw0KCQl9IGVsc2Ugew0KCQkJYnRuLnN0eWxlLmJvcmRlclRvcFJpZ2h0UmFkaXVzID0gIjBweCI7DQoJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOw0KCQl9DQoNCgkJYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7DQoJCQl0YWJfc3dpdGNoKHRoaXMuaWQsIHR5cGV6KTsNCgkJfTsNCg0KCQl0YWJDb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTsNCgl9KTsNCn0NCg0KZnVuY3Rpb24gZ190bV9kdCh0aW1lc3RhbXAsIGhybWluID0gdHJ1ZSkgew0KCXZhciBkYXRlID0gbmV3IERhdGUoK3RpbWVzdGFtcCAqIDEwMDApOw0KCWlmIChocm1pbikgew0KCQl2YXIgaG91ciA9ICgiMCIgKyBkYXRlLmdldEhvdXJzKCkpLnN1YnN0cigtMik7DQoJCXZhciBtaW51dGVzID0gKCIwIiArIGRhdGUuZ2V0TWludXRlcygpKS5zdWJzdHIoLTIpOw0KCQlyZXR1cm4gKGhvdXIgKyAiOiIgKyBtaW51dGVzKTsNCgl9DQoJZWxzZSB7DQoJCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOw0KCQl2YXIgbW9udGggPSAoIjAiICsgKGRhdGUuZ2V0TW9udGgoKSArIDEpKS5zdWJzdHIoLTIpOw0KCQl2YXIgZGF5ID0gKCIwIiArIGRhdGUuZ2V0RGF0ZSgpKS5zdWJzdHIoLTIpOw0KCQlyZXR1cm4gKGRheSArICIvIiArIG1vbnRoICsgIi8iICsgeWVhcik7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBjX2J0bihpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0sIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7DQoJY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQoJYnV0dG9uLnR5cGUgPSAiYnV0dG9uIjsNCglidXR0b24uY2xhc3NMaXN0LmFkZCgibmV3YnV0dG9uIik7DQoJYnV0dG9uLmlkID0gaWRfaXRlbTsNCglidXR0b24uaW5uZXJIVE1MID0gdGV4dDsNCg0KCWlmIChlbGVtbnQpIHsNCgkJT2JqZWN0LmFzc2lnbihidXR0b24sIGVsZW1udCk7DQoNCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7DQoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsNCgkJCQlidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCX0NCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbihidXR0b24uc3R5bGUsIHN0eWxleik7DQoJfQ0KDQoJYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7DQoJCWZ1bmMyKCk7DQoJfTsNCg0KCWlmICh0b29sdGlwICE9ICIiKSB7DQoJCWJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOw0KCX0NCg0KCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsNCgljb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsNCn0NCg0KZnVuY3Rpb24gY19ocihpZF93aGVyZSA9IHBhdGgsIG1hcmdpbiA9IHRydWUsIHN0eWxleiA9IHt9KSB7DQoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOw0KCXZhciBociA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImhyIik7DQoJaWYgKG1hcmdpbikNCgkJaHIuc3R5bGUubWFyZ2luTGVmdCA9ICItMjBweCI7DQoJaHIuc3R5bGUuYm9yZGVyVG9wID0gIjFweCBzb2xpZCB2YXIoLS1jLWhyKSI7DQoNCglpZiAoc3R5bGV6KSB7DQoJCU9iamVjdC5hc3NpZ24oaHIuc3R5bGUsIHN0eWxleik7DQoJfQ0KDQoJY29udGFpbmVyLmFwcGVuZENoaWxkKGhyKTsNCn0NCg0KZnVuY3Rpb24gY19icihpZF93aGVyZSA9IHBhdGgsIGFtb3VudCA9IDEpIHsNCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7DQoJZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGFtb3VudDsgaW5kZXgrKykgew0KCQljb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBjX2NoZWNrYm94KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSkgew0KCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCWRpdi5jbGFzc0xpc3QuYWRkKCdlbGVtaXRlbXNfYmcnKTsNCglkaXYuaHRtbEZvciA9IGlkX2l0ZW07DQoNCgljb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQoJY2hlY2tib3gudHlwZSA9ICJjaGVja2JveCI7DQoJY2hlY2tib3guaWQgPSBpZF9pdGVtOw0KCWNoZWNrYm94Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgew0KCQl1X3NlcnZlcigpOw0KCQlmdW5jMihjaGVja2JveCk7DQoJfTsNCg0KCWNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsNCglsYWJlbC5odG1sRm9yID0gaWRfaXRlbTsNCglsYWJlbC5pbm5lckhUTUwgPSB0ZXh0Ow0KCWxhYmVsLmlkID0gaWRfaXRlbSArICJ6enp6eiI7DQoNCglpZiAodG9vbHRpcCAhPSAiIikgew0KCQlkaXYuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsNCgl9DQoNCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7DQoNCglkaXYuYXBwZW5kQ2hpbGQoY2hlY2tib3gpOw0KCWRpdi5hcHBlbmRDaGlsZChsYWJlbCk7DQoNCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsNCg0KCXVfYm9vbC5wdXNoKGlkX2l0ZW0pOw0KfQ0KDQpmdW5jdGlvbiBjX3NfZmxvYXQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzdGVwX3ZhbCwgZGVmYXVsdF92YWwpIHsNCgl2YXIgc3RlcHZhbF9jZXJvcyA9IChTdHJpbmcoc3RlcF92YWwpLnNwbGl0KCIuIilbMV0gfHwgIiIpOw0KCXN0ZXB2YWxfY2Vyb3MgPSBzdGVwdmFsX2Nlcm9zLmxlbmd0aDsNCg0KCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAnZl9zbGlkZXJfYmcnKTsNCglkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW1pbicsIG1pbik7DQoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOw0KDQoJY29uc3QgdGl0bGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsNCgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgZGVmYXVsdF92YWwpOw0KCXRpdGxlRGl2LnRleHRDb250ZW50ID0gdGV4dCArICI6ICI7DQoNCgljb25zdCBudW1iZXJfaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KCW51bWJlcl9pbnB1dC5jbGFzc0xpc3QuYWRkKCJudW1iZXJzbGlkZXIiKTsNCgludW1iZXJfaW5wdXQudHlwZSA9ICJudW1iZXIiOw0KCW51bWJlcl9pbnB1dC5wYXR0ZXJuID0gIlswLTldKiI7DQoJbnVtYmVyX2lucHV0LmlucHV0TW9kZSA9ICJudW1lcmljIjsNCgludW1iZXJfaW5wdXQuaWQgPSBpZF9pdGVtOw0KCW51bWJlcl9pbnB1dC5taW4gPSBtaW47DQoJbnVtYmVyX2lucHV0Lm1heCA9IG1heDsNCgludW1iZXJfaW5wdXQuc3RlcCA9IHN0ZXBfdmFsOw0KCW51bWJlcl9pbnB1dC52YWx1ZSA9IGRlZmF1bHRfdmFsOw0KCW51bWJlcl9pbnB1dC5vbmlucHV0ID0gZnVuY3Rpb24gKCkgew0KCQl1X3NlcnZlcigpOw0KCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOw0KCX07DQoNCgljb25zdCBtaW51c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCgltaW51c19idG4uY2xhc3NMaXN0LmFkZCgiY29udHJvbHMtbnVtYmVyIik7DQoJbWludXNfYnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsNCgltaW51c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOw0KCW1pbnVzX2J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOw0KCW1pbnVzX2J0bi5pbm5lckhUTUwgPSAoIiYjODcyMjsiKS50cmltKCk7DQoJbWludXNfYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7DQoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAwLCBtaW4sIG1heCwgMSwgc3RlcHZhbF9jZXJvcyk7DQoJCXVfc2VydmVyKCk7DQoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7DQoJfTsNCg0KCWNvbnN0IHBsdXNfYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQoJcGx1c19idG4uY2xhc3NMaXN0LmFkZCgiY29udHJvbHMtbnVtYmVyIik7DQoJcGx1c19idG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOw0KCXBsdXNfYnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsNCglwbHVzX2J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOw0KCXBsdXNfYnRuLmlubmVySFRNTCA9ICgiJiM0MzsiKS50cmltKCk7DQoJcGx1c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsNCgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDEsIG1pbiwgbWF4LCAxLCBzdGVwdmFsX2Nlcm9zKTsNCgkJdV9zZXJ2ZXIoKTsNCgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsNCgl9Ow0KDQoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOw0KCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7DQoJZGl2LmFwcGVuZENoaWxkKG1pbnVzX2J0bik7DQoJZGl2LmFwcGVuZENoaWxkKG51bWJlcl9pbnB1dCk7DQoJZGl2LmFwcGVuZENoaWxkKHBsdXNfYnRuKTsNCg0KCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOw0KDQoJdV9mbG9hdC5wdXNoKGlkX2l0ZW0pOw0KfQ0KDQpmdW5jdGlvbiBjX2ltZyhpZF93aGVyZSwgaWRfaXRlbSwgaW1hZ2UsIHdpZHRoLCBoZWlnaHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgew0KCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsNCg0KCWNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOw0KDQoJaW1nLnNldEF0dHJpYnV0ZSgnaWQnLCBpZF9pdGVtKTsNCglpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBpbWFnZSk7DQoJaW1nLnNldEF0dHJpYnV0ZSgnYWx0JywgInVfYXZhdGFyIik7DQoJaW1nLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCk7DQoJaW1nLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsNCg0KCWlmIChlbGVtbnQpIHsNCgkJT2JqZWN0LmFzc2lnbihpbWcsIGVsZW1udCk7DQoNCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7DQoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsNCgkJCQlpbWcuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCX0NCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbihpbWcuc3R5bGUsIHN0eWxleik7DQoJfQ0KDQoJY29udGFpbmVyLmFwcGVuZENoaWxkKGltZyk7DQp9DQoNCmZ1bmN0aW9uIGNfdGV4dGFyZWEoaWRfd2hlcmUsIGlkX2l0ZW0sIGhpZGRlbiA9IGZhbHNlLCBsYWJlbCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsNCgljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCWlmIChsYWJlbCAhPT0gIiIpIHsNCgkJdGV4dGJveF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dGJveCIpOw0KDQoJCWNvbnN0IGxhYmVsRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7DQoJCWxhYmVsRWxlbS50ZXh0Q29udGVudCA9IGxhYmVsLnRyaW0oKTsNCgkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOw0KCQlsYWJlbEVsZW0uc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOw0KCQlsYWJlbEVsZW0uc2V0QXR0cmlidXRlKCJmb3IiLCBpZF9pdGVtKTsNCg0KCQlpZiAoc3R5bGV6ICYmIHN0eWxlei5sYWJlbHopIHsNCgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei5sYWJlbHopOw0KCQl9DQoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7DQoJfQ0KDQoJY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOw0KDQoJdGV4dGFyZWEuaWQgPSBpZF9pdGVtOw0KDQoJaWYgKGVsZW1udCkgew0KCQlPYmplY3QuYXNzaWduKHRleHRhcmVhLCBlbGVtbnQpOw0KDQoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgew0KCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7DQoJCQkJdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCX0NCg0KCXRleHRhcmVhLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsNCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbih0ZXh0YXJlYS5zdHlsZSwgc3R5bGV6KTsNCg0KCQlpZiAoc3R5bGV6LnRleHRib3gpIHsNCgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei50ZXh0Ym94KTsNCgkJfQ0KCX0NCg0KCWlmIChsYWJlbCAhPT0gIiIpIHsNCgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOw0KCX0gZWxzZSB7DQoJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsNCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsNCgl9DQoNCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7DQoJaWYgKGxhYmVsID09PSAiIiAmJiBjb250YWluZXIpIHsNCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsNCgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgew0KCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGJveF9kaXYpOw0KCX0NCn0NCg0KZnVuY3Rpb24gY190ZXh0Ym94KGlkX3doZXJlLCBpZF9pdGVtLCBoaWRkZW4gPSBmYWxzZSwgbGFiZWwgPSAiIiwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30sIGRpc2FibGVzdHlsZSA9IGZhbHNlKSB7DQoJY29uc3QgdGV4dGJveF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCglpZiAobGFiZWwgIT09ICIiKSB7DQoJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsNCg0KCQljb25zdCBsYWJlbEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOw0KCQlsYWJlbEVsZW0udGV4dENvbnRlbnQgPSBsYWJlbC50cmltKCk7DQoJCWxhYmVsRWxlbS5pZCA9IGlkX2l0ZW0gKyAibGJsIjsNCgkJbGFiZWxFbGVtLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsNCgkJbGFiZWxFbGVtLnNldEF0dHJpYnV0ZSgiZm9yIiwgaWRfaXRlbSk7DQoNCgkJaWYgKHN0eWxleiAmJiBzdHlsZXoubGFiZWx6KSB7DQoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsNCgkJfQ0KDQoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7DQoJfQ0KDQoJY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KCWlucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJ0ZXh0Iik7DQoJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOw0KDQoJaWYgKGRpc2FibGVzdHlsZSkNCgkJaW5wdXQuc2V0QXR0cmlidXRlKCdkYXRhLW5vdmFsaWRpbnZhbGlkJywgJycpOw0KDQoJaWYgKHRvb2x0aXAgIT0gIiIpIHsNCgkJaW5wdXQuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKQ0KCX0NCg0KCWlmIChlbGVtbnQpIHsNCgkJT2JqZWN0LmFzc2lnbihpbnB1dCwgZWxlbW50KTsNCg0KCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsNCgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgew0KCQkJCWlucHV0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoZXYpIHsNCgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzLCBldik7DQoJCQkJfSk7DQoJCQl9DQoJCX0NCgl9DQoNCglpbnB1dC5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7DQoNCglpZiAoc3R5bGV6KSB7DQoJCU9iamVjdC5hc3NpZ24oaW5wdXQuc3R5bGUsIHN0eWxleik7DQoNCgkJaWYgKHN0eWxlei50ZXh0Ym94KSB7DQoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoudGV4dGJveCk7DQoJCX0NCgl9DQoNCglpZiAobGFiZWwgIT09ICIiKSB7DQoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGlucHV0KTsNCgl9IGVsc2Ugew0KCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7DQoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7DQoJfQ0KDQoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOw0KCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7DQoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7DQoJfSBlbHNlIGlmIChjb250YWluZXIpIHsNCgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsNCgl9DQp9DQoNCmZ1bmN0aW9uIGNfdGV4dChpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7DQoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7DQoJdGV4dF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dCIpOw0KDQoJaWYgKHRleHQpDQoJCXRleHRfZGl2LmlubmVySFRNTCA9IHRleHQudHJpbSgpOw0KDQoJdGV4dF9kaXYuaWQgPSBpZF9pdGVtOw0KDQoJaWYgKGVsZW1udCkgew0KCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LCBlbGVtbnQpOw0KDQoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgew0KCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7DQoJCQkJdGV4dF9kaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCX0NCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbih0ZXh0X2Rpdi5zdHlsZSwgc3R5bGV6KTsNCgl9DQoNCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7DQoJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRfZGl2KTsNCn0NCg0KZnVuY3Rpb24gY19jb21ib2JveDIoaWRfd2hlcmUsIGlkX2l0ZW0sIG9wdGlvbnMsIGhpZGRlbiA9IGZhbHNlLCB0b29sdGlwID0gIiIsIHN0eWxleiA9IHt9KSB7DQoJY29uc3Qgc2VsZWN0X2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsNCglzZWxlY3RfZWxlbS5jbGFzc0xpc3QuYWRkKCJzZWxlY3QtZHJvcGRvd24iKTsNCglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07DQoNCglpZiAodG9vbHRpcCAhPSAiIikgew0KCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOw0KCX0NCg0KCW9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4gew0KCQljb25zdCBvcHRpb25fZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOw0KCQlvcHRpb25fZWxlbS52YWx1ZSA9IGluZGV4Ow0KCQlvcHRpb25fZWxlbS50ZXh0ID0gb3B0aW9uOw0KCQlzZWxlY3RfZWxlbS5hZGQob3B0aW9uX2VsZW0pOw0KCX0pOw0KDQoJc2VsZWN0X2VsZW0uc3R5bGUuZGlzcGxheSA9ICgoaGlkZGVuID09IHRydWUpID8gKCJub25lIikgOiAoImlubGluZS1ibG9jayIpKTsNCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6KTsNCgl9DQoNCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7DQoJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsNCn0NCg0KZnVuY3Rpb24gY19jb21ib2JveChpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgbWluLCBtYXgsIHNhbWVsaW5lID0gZmFsc2UsIHRvb2x0aXAgPSAiIiwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0sIHN0eWxleiA9IHt9KSB7DQoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgl0ZXh0X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Iik7DQoJdGV4dF9kaXYudGV4dENvbnRlbnQgPSB0ZXh0LnRyaW0oKTsNCg0KCWNvbnN0IHNlbGVjdF9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7DQoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7DQoJc2VsZWN0X2VsZW0uaWQgPSBpZF9pdGVtOw0KDQoJaWYgKHNhbWVsaW5lKQ0KCQlzZWxlY3RfZWxlbS5zdHlsZS5tYXJnaW5SaWdodCA9ICIxMHB4IjsNCg0KCXNlbGVjdF9lbGVtLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgew0KCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOw0KCQlmdW5jMigpOw0KCX07DQoNCglpZiAodG9vbHRpcCAhPSAiIikgew0KCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOw0KCX0NCg0KCWlmIChzdHlsZXopIHsNCgkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6KTsNCg0KCQlpZiAoc3R5bGV6LnRleHRfZGl2KSB7DQoJCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXoudGV4dF9kaXYpOw0KCQl9DQoJfQ0KDQoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOw0KCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0X2Rpdik7DQoJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsNCg0KCXVfaW50Mi5wdXNoKGlkX2l0ZW0pOw0KfQ0KDQpmdW5jdGlvbiBjX3NfaW50KGlkX3doZXJlLCBpZF9pdGVtLCBpZF90ZXh0LCBtaW4sIG1heCwgc3RlcCwgdmFsdWUsIHRvb2x0aXAgPSAiIikgew0KCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsNCg0KCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAncl9zbGlkZXJfYmcnKTsNCglkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW1pbicsIG1pbik7DQoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOw0KDQoJY29uc3QgdGl0bGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsNCgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgdmFsdWUpOw0KCXRpdGxlRGl2LnRleHRDb250ZW50ID0gaWRfdGV4dCArICI6ICI7DQoNCgljb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7DQoNCgljb25zdCBtaW51c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KCW1pbnVzQnRuLmNsYXNzTmFtZSA9ICJjb250cm9scy1udW1iZXIiOw0KCW1pbnVzQnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsNCgltaW51c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7DQoJbWludXNCdG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsNCgltaW51c0J0bi5pbm5lckhUTUwgPSAoIiYjODcyMjsiKS50cmltKCk7DQoJbWludXNCdG4ub25jbGljayA9ICgpID0+IHsNCgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDAsIG1pbiwgbWF4KTsNCgkJc19pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsNCgkJYXBwbHlGaWxsKGlucHV0KTsNCgl9Ow0KDQoJY29uc3QgcGx1c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KCXBsdXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7DQoJcGx1c0J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7DQoJcGx1c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7DQoJcGx1c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOw0KCXBsdXNCdG4uaW5uZXJIVE1MID0gKCImIzQzOyIpLnRyaW0oKTsNCglwbHVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7DQoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAxLCBtaW4sIG1heCk7DQoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7DQoJCWFwcGx5RmlsbChpbnB1dCk7DQoJfTsNCg0KCWlucHV0LmNsYXNzTGlzdC5hZGQoJ3NsaWRlcicpOw0KCWlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZF9pdGVtKTsNCglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncmFuZ2UnKTsNCglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21pbicsIG1pbik7DQoJaW5wdXQuc2V0QXR0cmlidXRlKCdtYXgnLCBtYXgpOw0KCWlucHV0LnNldEF0dHJpYnV0ZSgnc3RlcCcsIHN0ZXApOw0KCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCB2YWx1ZSk7DQoJaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7DQoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7DQoJCWFwcGx5RmlsbChpbnB1dCk7DQoJfTsNCg0KCWlmICh0b29sdGlwICE9ICIiKSB7DQoJCWRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOw0KCX0NCg0KCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7DQoJZGl2LmFwcGVuZENoaWxkKG1pbnVzQnRuKTsNCglkaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOw0KCWRpdi5hcHBlbmRDaGlsZChwbHVzQnRuKTsNCg0KCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOw0KDQoJdV9pbnQucHVzaChpZF9pdGVtKTsNCn0NCg0KY29uc3Qgc2xpZGVyUHJvcHMgPSB7DQoJYmFja2dyb3VuZDogInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yMTQpIiwNCn07DQoNCmNvbnN0IHNsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucl9zbGlkZXJfYmciKTsNCg0Kc2xpZGVycy5mb3JFYWNoKChzbGlkZXIpID0+IHsNCgljb25zdCBzbGlkZXJJbnB1dCA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIuc2xpZGVyIik7DQoJY29uc3Qgc2xpZGVyVmFsdWUgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKTsNCg0KCXNsaWRlcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKGV2ZW50KSA9PiB7DQoJCXNsaWRlclZhbHVlLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBldmVudC50YXJnZXQudmFsdWUpOw0KCQlhcHBseUZpbGwoZXZlbnQudGFyZ2V0KTsNCgl9KTsNCg0KCWFwcGx5RmlsbChzbGlkZXJJbnB1dCk7DQp9KTsNCg0KY29uc3QgZl9zbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZfc2xpZGVyX2JnIik7DQoNCmZfc2xpZGVycy5mb3JFYWNoKGFzeW5jIChzbGlkZXIpID0+IHsNCgljb25zdCBzbGlkZXJJbnB1dCA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIubnVtYmVyc2xpZGVyIik7DQoJY29uc3Qgc2xpZGVyVmFsdWUgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKTsNCg0KCWxldCBzdGVwdmFsX2Nlcm9zID0gKFN0cmluZyhzbGlkZXJJbnB1dC5zdGVwKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsNCg0KCWFwcGx5RmlsbChzbGlkZXJJbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcy5sZW5ndGgsIHNsaWRlcklucHV0LnZhbHVlKTsNCn0pOw0KDQpmdW5jdGlvbiBhcHBseUZpbGwoc2xpZGVyLCBpc19mbHQgPSBmYWxzZSwgZmx0cGFyc2UgPSAxLCB2YWx1ZSkgew0KCWlmIChpc19mbHQpIHsNCgkJc2xpZGVyLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZChmbHRwYXJzZSkpOw0KCQlzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IHNsaWRlclByb3BzLmJhY2tncm91bmQ7DQoJCXNsaWRlci5zdHlsZS5jb2xvciA9ICd2YXIoLS1jLXRleHQpJzsNCgkJc2xpZGVyLnN0eWxlLmJvcmRlclJhZGl1cyA9ICI1cHgiOw0KCQlzbGlkZXIuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCB2YXIoLS1jLWNvbnRvcm5vcykiOw0KCQlyZXR1cm47DQoJfQ0KDQoJY29uc3QgcGVyY2VudGFnZSA9ICgoMTAwICogKHNsaWRlci52YWx1ZSAtIHNsaWRlci5taW4pKSAvIChzbGlkZXIubWF4IC0gc2xpZGVyLm1pbikpLnRvRml4ZWQoMSk7DQoJY29uc3QgYmcgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCB2YXIoLS1jLXByaW1hcnkpIDAlLCB2YXIoLS1jLXNlY29uZGFyeSkgJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gMTAwJSlgOw0KCXNsaWRlci5zdHlsZS5iYWNrZ3JvdW5kID0gYmc7DQoJc2xpZGVyLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgc2xpZGVyLnZhbHVlKTsNCn0NCg0KZnVuY3Rpb24gc3VtcmVzdF9idXR0b25zKGl0ZW1faWQsIHN1bSwgbWluLCBtYXgsIGlzX2ZsdCA9IDAsIGZsdHBhcnNlID0gMSkgew0KCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKSA9PSB1bmRlZmluZWQpIHsNCgkJY29uc29sZS5sb2coaXRlbV9pZCwgImRvZXNudCBleGlzdCIpOw0KCQlyZXR1cm47DQoJfQ0KDQoJaWYgKGlzX2ZsdCkgew0KCQlpZiAoc3VtKSB7DQoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpDQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KG1heCk7DQoJCQllbHNlDQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsNCgkJfSBlbHNlIHsNCgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA8IG1pbikNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsNCgkJCWVsc2UNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IChwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSAtIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCkpLnRvRml4ZWQoZmx0cGFyc2UpOw0KCQl9DQoJfQ0KCWVsc2Ugew0KCQlpZiAoc3VtKSB7DQoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpDQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUludChtYXgpOw0KCQkJZWxzZQ0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApOw0KCQl9IGVsc2Ugew0KCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQ0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VJbnQobWF4KTsNCgkJCWVsc2UNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsNCgkJfQ0KCX0NCn0NCg0Kd2luZG93Lm1vYmlsZUNoZWNrID0gZnVuY3Rpb24gKCkgew0KCWxldCBjaGVjayA9IGZhbHNlOw0KCShmdW5jdGlvbiAoYSkgeyBpZiAoLyhhbmRyb2lkfGJiXGQrfG1lZWdvKS4rbW9iaWxlfGF2YW50Z298YmFkYVwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFwuKGJyb3dzZXJ8bGluayl8dm9kYWZvbmV8d2FwfHdpbmRvd3MgY2V8eGRhfHhpaW5vL2kudGVzdChhKSB8fCAvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298c1wtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfFwtbXxyIHxzICl8YXZhbnxiZShja3xsbHxucSl8YmkobGJ8cmQpfGJsKGFjfGF6KXxicihlfHYpd3xidW1ifGJ3XC0obnx1KXxjNTVcL3xjYXBpfGNjd2F8Y2RtXC18Y2VsbHxjaHRtfGNsZGN8Y21kXC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGNcLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8XC1kKXxlbCg0OXxhaSl8ZW0obDJ8dWwpfGVyKGljfGswKXxlc2w4fGV6KFs0LTddMHxvc3x3YXx6ZSl8ZmV0Y3xmbHkoXC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2ZcLTV8Z1wtbW98Z28oXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkXC0obXxwfHQpfGhlaVwtfGhpKHB0fHRhKXxocCggaXxpcCl8aHNcLWN8aHQoYyhcLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGlcLSgyMHxnb3xtYSl8aTIzMHxpYWMoIHxcLXxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcLyl8a2xvbnxrcHQgfGt3Y1wtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcLyhrfGx8dSl8NTB8NTR8XC1bYS13XSl8bGlid3xseW54fG0xXC13fG0zZ2F8bTUwXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtXC1jcnxtZShyY3xyaSl8bWkobzh8b2F8dHMpfG1tZWZ8bW8oMDF8MDJ8Yml8ZGV8ZG98dChcLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pXC18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfFwtKFsxLThdfGMpKXxwaGlsfHBpcmV8cGwoYXl8dWMpfHBuXC0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHRcLWd8cWFcLWF8cWMoMDd8MTJ8MjF8MzJ8NjB8XC1bMi03XXxpXC0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XC98c2EoZ2V8bWF8bW18bXN8bnl8dmEpfHNjKDAxfGhcLXxvb3xwXC0pfHNka1wvfHNlKGMoXC18MHwxKXw0N3xtY3xuZHxyaSl8c2doXC18c2hhcnxzaWUoXC18bSl8c2tcLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aFwtfHZcLXx2ICl8c3koMDF8bWIpfHQyKDE4fDUwKXx0NigwMHwxMHwxOCl8dGEoZ3R8bGspfHRjbFwtfHRkZ1wtfHRlbChpfG0pfHRpbVwtfHRcLW1vfHRvKHBsfHNoKXx0cyg3MHxtXC18bTN8bTUpfHR4XC05fHVwKFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfFwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYyhcLXwgKXx3ZWJjfHdoaXR8d2koZyB8bmN8bncpfHdtbGJ8d29udXx4NzAwfHlhc1wtfHlvdXJ8emV0b3x6dGVcLS9pLnRlc3QoYS5zdWJzdHIoMCwgNCkpKSBjaGVjayA9IHRydWU7IH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpOw0KCXJldHVybiBjaGVjazsNCn07DQoNCndpbmRvdy5zdGVhbUNoZWNrID0gZnVuY3Rpb24gKCkgew0KCWxldCB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7DQoJbGV0IGlzU3RlYW1Ccm93c2VyID0gdXNlckFnZW50LmluZGV4T2YoInN0ZWFtIikgPiAtMTsNCglyZXR1cm4gaXNTdGVhbUJyb3dzZXI7DQp9Ow0KDQppZiAoIXdpbmRvdy5tb2JpbGVDaGVjaygpKSB7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gInNjYW4gb24gbW9iaWxlIG9yIGVudGVyOiAiICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiBvbiB5b3VyIG1vYmlsZSBicm93c2VyIjsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJpbWFnZSIpLnNyYyA9ICJodHRwczovL2NoYXJ0Lmdvb2dsZWFwaXMuY29tL2NoYXJ0P2NodD1xciZjaGw9IiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICImY2hzPTI1MHgyNTAmY2hsZD1MfDAiOw0KDQoJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsNCgkJaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkgew0KCQkJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcpOw0KCQkJdF9wYW5lbCh0aGlzKTsNCgkJfQ0KCQllbHNlIHsNCgkJCWlmICh3aW5kb3cuc3RlYW1DaGVjaygpKSB7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDA7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsNCg0KCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJCX0sIDI1MCk7DQoNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOw0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsNCg0KCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJfSwgMjUwKTsNCg0KCQkJCW5vdGlmeSgicGFuZWxzIGRpc2FibGVkIG9uIHN0ZWFtLiIpOw0KCQkJfSBlbHNlIHsNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsNCgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJfSwgMjUwKTsNCg0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDE7DQoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7DQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJfSwgMjUwKTsNCgkJCX0NCgkJfQ0KCX07DQp9DQplbHNlIHsNCglkb2N1bWVudC5ib2R5LnN0eWxlLnpvb20gPSAiNzUlIjsNCgl0X3BhbmVsKHRoaXMsICdsZWZ0X3BhbmVsJyk7DQoJdF9wYW5lbCh0aGlzKTsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJjb2RlX3RleHQiKS5pbm5lckhUTUwgPSAib25seSBvbiBwYyIudHJpbSgpOw0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCn0NCg0KZnVuY3Rpb24gc3RyaW5nMmJvb2woc3RyaW5nKSB7DQoJc3dpdGNoIChzdHJpbmcudG9Mb3dlckNhc2UoKS50cmltKCkpIHsNCgkJY2FzZSAidHJ1ZSI6DQoJCWNhc2UgInllcyI6DQoJCWNhc2UgIjEiOg0KCQkJcmV0dXJuIHRydWU7DQoJCWNhc2UgImZhbHNlIjoNCgkJY2FzZSAibm8iOg0KCQljYXNlICIwIjoNCgkJY2FzZSBudWxsOg0KCQkJcmV0dXJuIGZhbHNlOw0KCQlkZWZhdWx0Og0KCQkJcmV0dXJuIEJvb2xlYW4oc3RyaW5nKTsNCgl9DQp9DQoNCmZ1bmN0aW9uIGdfYm9vbChtb2R1bGUpIHsNCgkkLmdldCgiL2dfYm9vbD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7DQoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuY2hlY2tlZCA9IHN0cmluZzJib29sKHJlc3BvbnNlVGV4dCk7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsNCg0KCQlpZiAoIXVfYWxfYm9vbC5pbmNsdWRlcyhtb2R1bGUpKSB7DQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJjaGFuZ2UiKSk7DQoJCQl1X2FsX2Jvb2wucHVzaChtb2R1bGUpOw0KCQl9DQoJfSk7DQp9DQoNCmZ1bmN0aW9uIGdfaW50KG1vZHVsZSwgcmV0dXJuZWQgPSB0cnVlKSB7DQoJJC5nZXQoIi9nX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7DQoJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSByZXNwb25zZVRleHQ7DQoNCgkJaWYgKG1vZHVsZS5pbmNsdWRlcygidGhlbWVfc2VsZWN0IikpIHsNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsNCgkJfQ0KDQoJCWlmIChyZXR1cm5lZCkgew0KCQkJaWYgKCF1X2FsX2ludC5pbmNsdWRlcyhtb2R1bGUpKSB7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiaW5wdXQiKSk7DQoJCQkJdV9hbF9pbnQucHVzaChtb2R1bGUpOw0KCQkJfQ0KDQoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpDQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLnZhbHVlOw0KCQl9DQoJfSk7DQp9DQoNCmZ1bmN0aW9uIGdfZmxvYXQobW9kdWxlKSB7DQoJJC5nZXQoIi9nX2Zsb2F0P2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgew0KCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsNCgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOw0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJdmFyIHN0ZXB2YWxfY2Vyb3MyID0gKFN0cmluZyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLnN0ZXApLnNwbGl0KCIuIilbMV0gfHwgIiIpOw0KDQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSBwYXJzZUZsb2F0KHJlc3BvbnNlVGV4dCkudG9GaXhlZChzdGVwdmFsX2Nlcm9zMi5sZW5ndGgpOw0KCQlpZiAoIXVfYWxfZmxvYXQuaW5jbHVkZXMobW9kdWxlKSkgew0KCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiaW5wdXQiKSk7DQoJCQl1X2FsX2Zsb2F0LnB1c2gobW9kdWxlKTsNCgkJfQ0KDQoJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkNCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZTsNCgl9KTsNCn0NCg0KZnVuY3Rpb24gc19ib29sKG1vZHVsZSkgew0KCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsNCglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsNCgkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikNCgkJcmV0dXJuOw0KCX0NCgl2YXIgdmFsdWUgPSBtb2R1bGV6LmNoZWNrZWQ7DQoNCgkkLmdldCgiL3NfYm9vbD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgfSk7DQp9DQoNCmZ1bmN0aW9uIHNfaW50Mihtb2R1bGUsIG1pbiA9IDAsIG1heCA9IDApIHsNCglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7DQoJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7DQoJCWNvbnNvbGUubG9nKG1vZHVsZSArICIgbm90IGZvdW5kIik7DQoJCXJldHVybjsNCgl9DQoNCgl2YXIgdmFsdWUgPSBtb2R1bGV6LnZhbHVlOw0KDQoJaWYgKG1pbiA9PSAwICYmIG1heCA9PSAwKSB7DQoJCSQuZ2V0KCIvc19pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7DQoJCQl2YXIgZWxlbWVudEV4aXN0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6Iik7DQoJCQlpZiAoZWxlbWVudEV4aXN0cyAhPSB1bmRlZmluZWQgfHwgZWxlbWVudEV4aXN0cyAhPSBudWxsKQ0KCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0Ow0KCQl9KTsNCgl9IGVsc2Ugew0KCQlpZiAocGFyc2VJbnQodmFsdWUpID49IHBhcnNlSW50KG1pbikgJiYgcGFyc2VJbnQodmFsdWUpIDw9IHBhcnNlSW50KG1heCkpIHsNCgkJCSQuZ2V0KCIvc19pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7DQoJCQkJdmFyIGVsZW1lbnRFeGlzdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpOw0KCQkJCWlmIChlbGVtZW50RXhpc3RzICE9IHVuZGVmaW5lZCB8fCBlbGVtZW50RXhpc3RzICE9IG51bGwpDQoJCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0Ow0KCQkJfSk7DQoJCX0NCgkJZWxzZSB7DQoJCQljb25zb2xlLmxvZygibWlubWF4IG92ZXJwYXNzZWQgfCAiLCB2YWx1ZSwgbWluLCBtYXgpOw0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBzX2Zsb2F0KG1vZHVsZSkgew0KCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsNCglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsNCgkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikNCgkJcmV0dXJuOw0KCX0NCg0KCXZhciB2YWx1ZSA9IHBhcnNlRmxvYXQobW9kdWxlei52YWx1ZSk7DQoJdmFyIG1pbiA9IHBhcnNlRmxvYXQobW9kdWxlei5taW4pOw0KCXZhciBtYXggPSBwYXJzZUZsb2F0KG1vZHVsZXoubWF4KTsNCg0KCWlmICh2YWx1ZSA+PSBtaW4gJiYgdmFsdWUgPD0gbWF4KSB7DQoJCSQuZ2V0KCIvc19mbG9hdD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsNCgkJfSk7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBzX2luZm8obW9kdWxlLCB2YWx1ZSwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0pIHsNCgkkLmdldCgiL3NfaW5mbz9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJZnVuYzIoKTsNCgl9KTsNCn0NCg0KZnVuY3Rpb24gc19idG4obW9kdWxlLCB2YWx1ZSA9ICIiKSB7DQoJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCgkJaWYgKHZhbHVlID09ICIiKSB7DQoJCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsNCgkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7DQoJCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgew0KCQkJCXJlamVjdChlcnJvcik7DQoJCQl9KTsNCgkJfSBlbHNlIHsNCgkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgew0KCQkJCXJlc29sdmUocmVzcG9uc2VUZXh0KTsNCgkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7DQoJCQkJcmVqZWN0KGVycm9yKTsNCgkJCX0pOw0KCQl9DQoJfSk7DQp9DQoNCmZ1bmN0aW9uIGNfZXhpdCgpIHsNCglzX2J0bigiZGVhZCIpOw0KCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQl3aW5kb3cub3BlbigiIiwgIl9zZWxmIiwgIiIpOw0KCQl3aW5kb3cuY2xvc2UoKTsNCgkJaGlzdG9yeS5nbygtMSk7DQoJCW5hdmlnYXRvci5hcHAuYmFja0hpc3RvcnkoKTsNCgkJd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOw0KCX0sIDUwMDApOw0KfQ0KDQpmdW5jdGlvbiBmX2NvbWJvKGlkX2l0ZW0sIGlkX3NlcnZlcikgew0KCSQuZ2V0KCIvZ19pbmZvP2luZm89IiArIGlkX3NlcnZlciwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgew0KCQl2YXIgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSk7DQoNCgkJaWYgKHNlbGVjdCA9PSB1bmRlZmluZWQpIHsNCgkJCWNvbnNvbGUubG9nKGlkX2l0ZW0sICJkb2VzbnQgZXhpc3QiKTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXZhciByZXNwb25zZSA9IHdpbmRvdy5hdG9iKHJlc3BvbnNlVGV4dCk7DQoNCgkJaWYgKHJlc3BvbnNlICE9IG51bGwpIHsNCgkJCXJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSk7DQoJCQlpZiAocmVzcG9uc2UgIT0gbnVsbCkgew0KCQkJCXNlbGVjdC5pbm5lckhUTUwgPSAoIiIpLnRyaW0oKTsNCg0KCQkJCWZvciAoY29uc3Qga2V5IGluIHJlc3BvbnNlKSB7DQoJCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNwb25zZSwga2V5KSkgew0KCQkJCQkJY29uc3QgZWxlbWVudCA9IHJlc3BvbnNlW2tleV07DQoJCQkJCQl2YXIgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7DQoJCQkJCQlvcHQudmFsdWUgPSBrZXk7DQoJCQkJCQlvcHQuaW5uZXJIVE1MID0gZWxlbWVudFsiaWQiXTsNCgkJCQkJCXNlbGVjdC5hcHBlbmRDaGlsZChvcHQpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfSk7DQp9DQoNCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBmdW5jdGlvbiAoZikgew0KCWlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApIHsNCgkJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcsIDEpOw0KCQl0X3BhbmVsKHRoaXMsICdyaWdodF9wYW5lbCcsIDEpOw0KCX0NCgllbHNlIHsNCgkJdF9wYW5lbCh0aGlzLCAnbGVmdF9wYW5lbCcsIDIpOw0KCQl0X3BhbmVsKHRoaXMsICdyaWdodF9wYW5lbCcsIDIpOw0KCX0NCn0pOw0KDQphc3luYyBmdW5jdGlvbiB0X3BhbmVsKGJ0biwgaWQgPSAicmlnaHRfcGFuZWwiLCB0eXBlID0gMCkgew0KCWNvbnN0IHBhbmVsX2VsbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsNCglpZiAodHlwZSA9PSAwKSB7DQoJCWlmIChwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIpIHsNCgkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOw0KCQkJcGFuZWxfZWxtLnN0eWxlLmhlaWdodCA9ICIwcHgiOw0KCQkJcGFuZWxfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMCI7DQoJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsNCgkJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCX0sIDI1MCk7DQoNCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgew0KCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCWVsc2Ugew0KCQkJcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJYXdhaXQgc2V0VGltZW91dChhc3luYyAoKSA9PiB7IH0sIDI1MCk7DQoNCgkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICJhdXRvIjsNCgkJCXBhbmVsX2VsbS5zdHlsZS5oZWlnaHQgPSAiYXV0byI7DQoJCQlwYW5lbF9lbG0uc3R5bGUub3BhY2l0eSA9ICIxIjsNCg0KCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7DQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJfQ0KCQkJfQ0KDQoJCX0NCgl9DQoJZWxzZSB7DQoJCWlmIChwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIgJiYgdHlwZSA9PSAxKSB7DQoJCQlwYW5lbF9lbG0uc3R5bGUud2lkdGggPSAiMHB4IjsNCgkJCXBhbmVsX2VsbS5zdHlsZS5oZWlnaHQgPSAiMHB4IjsNCgkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjAiOw0KCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7DQoJCQkJcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQl9LCAyNTApOw0KDQoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsNCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9yaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQllbHNlIGlmICh0eXBlID09IDIgJiYgcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKSB7DQoJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMjUwKTsNCg0KCQkJcGFuZWxfZWxtLnN0eWxlLndpZHRoID0gImF1dG8iOw0KCQkJcGFuZWxfZWxtLnN0eWxlLmhlaWdodCA9ICJhdXRvIjsNCgkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjEiOw0KDQoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsNCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCQl9DQoJCQl9DQoNCgkJfQ0KCX0NCn0NCg0KdmFyIHpub3RpZmljYXRpb25JZCA9IDAsIG5vdGlmaWNhdGlvbkNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNub3RpZmljYXRpb24tY29udGFpbmVyIik7DQpmdW5jdGlvbiBub3RpZnkoYSwgYiwgZCkgeyBiID0gdm9pZCAwID09PSBiID8gMjUwMCA6IGI7IGQgPSArK3pub3RpZmljYXRpb25JZDsgdmFyIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsgYy5jbGFzc0xpc3QuYWRkKCJub3RpZmljYXRpb24iKTsgYy5pbm5lckhUTUwgPSAoIjxwPiIgKyBhICsgIjwvcD48YnV0dG9uIGNsYXNzPSdjbG9zZS1idXR0b24nIGRhdGEtbm90aWZpY2F0aW9uLWlkPSciICsgZCArICInPiZ0aW1lczs8L2J1dHRvbj4iKS50cmltKCk7IGMuc3R5bGUud2lkdGggPSAiYXV0byI7IG5vdGlmaWNhdGlvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChjKTsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGMuc3R5bGUub3BhY2l0eSA9ICIwIjsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGMucmVtb3ZlKCkgfSwgNDUwKSB9LCBiKTsgKGEgPSBjLnByZXZpb3VzU2libGluZykgJiYgYS5zdHlsZSAmJiAoYS5zdHlsZS5tYXJnaW5Ub3AgPSAiNnB4IikgfQ0Kbm90aWZpY2F0aW9uQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGEpIHsgaWYgKGEudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY2xvc2UtYnV0dG9uIikpIHsgdmFyIGIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBhLnRhcmdldC5kYXRhc2V0Lm5vdGlmaWNhdGlvbklkICsgIiddIikucGFyZW50RWxlbWVudDsgYi5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYi5yZW1vdmUoKSB9LCAyNTApOyAoYSA9IGIucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9IH0pOw==";
eval(atob(test));
