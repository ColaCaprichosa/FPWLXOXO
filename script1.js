var A = "Ly8gQHRzLW5vY2hlY2sKCnZhciBkZWZhdWx0X2F2YXRhciA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvQ29sYUNhcHJpY2hvc2EvRlBXTFIvbG9nYXJkby5wbmciOwp2YXIgYWxsb3dfYXUgPSB0cnVlOwp2YXIgaGFzX2FsaWFzID0gZmFsc2U7CgpmdW5jdGlvbiBjX3RoZW1lKCkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuYm9keTsKCWNvbnN0IHRoZW1lX3NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aGVtZV9zZWxlY3QnKTsKCWNvbnN0IHNlbGVjdGVkID0gdGhlbWVfc2VsZWN0LnZhbHVlOwoJY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS10aGVtZScsIHNlbGVjdGVkKTsKCXNfaW50MigndGhlbWVfc2VsZWN0Jyk7Cn0KCmZ1bmN0aW9uIGdfdG1faSgpIHsgcmV0dXJuIE1hdGgucm91bmQoK25ldyBEYXRlKCkgLyAxMDAwKTsgfQoKY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwp0b29sdGlwLmNsYXNzTGlzdC5hZGQoInRvb2x0aXAiKTsKdG9vbHRpcC5pZCA9ICJ3bXRvb2x0aXAiOwpkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRvb2x0aXApOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdmVyIiwgZnVuY3Rpb24gKGV2ZW50KSB7Cgljb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0OwoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CglpZiAodG9vbHRpcE1lc3NhZ2UpIHsKCQl0b29sdGlwLmlubmVyVGV4dCA9IHRvb2x0aXBNZXNzYWdlOwoJCXRvb2x0aXAuc3R5bGUudG9wID0gZWxlbWVudC5vZmZzZXRUb3AgLSB0b29sdGlwLm9mZnNldEhlaWdodCAtIDggKyAicHgiOwoJCXRvb2x0aXAuc3R5bGUubGVmdCA9IGVsZW1lbnQub2Zmc2V0TGVmdCArIChlbGVtZW50Lm9mZnNldFdpZHRoIC0gdG9vbHRpcC5vZmZzZXRXaWR0aCkgLyAyICsgInB4IjsKCQl0b29sdGlwLmNsYXNzTGlzdC5hZGQoInRvb2x0aXAtLXZpc2libGUiKTsKCX0KfSk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW91dCIsIGZ1bmN0aW9uIChldmVudCkgewoJY29uc3QgZWxlbWVudCA9IGV2ZW50LnRhcmdldDsKCWNvbnN0IHRvb2x0aXBNZXNzYWdlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIpOwoJaWYgKHRvb2x0aXBNZXNzYWdlKSB7CgkJdG9vbHRpcC5pbm5lclRleHQgPSAoIi0iKS50cmltKCk7CgkJdG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCJ0b29sdGlwLS12aXNpYmxlIik7Cgl9Cn0pOwoKLyphbHJlYWR5IGRpc3BhdGNoZWQgaWRzKi8KdmFyIHVfYWxfYm9vbCA9IFtdOwp2YXIgdV9hbF9mbG9hdCA9IFtdOwp2YXIgdV9hbF9pbnQgPSBbXTsKCnZhciB1X2Jvb2wgPSBbXTsKdmFyIHVfZmxvYXQgPSBbXTsKdmFyIHVfaW50ID0gW107CnZhciB1X2ludDIgPSBbInRoZW1lX3NlbGVjdCJdOwoKcGF0aCA9ICJwYW5lbF9jaGF0IjsKCmNfdGV4dChwYXRoLCAiY2hhdGJveHR4dCIsICJjaGF0IiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwoKY19kaXYocGF0aCwgImNoYXQtY29udGFpbmVyIiwgewoJd2lkdGg6ICIyMzBweCIsCgloZWlnaHQ6ICIzMTVweCIsCgltYXhIZWlnaHQ6ICIzMTVweCIsCglvdmVyZmxvd1k6ICJhdXRvIiwKCXBhZGRpbmc6ICIxMHB4IiwKCWJhY2tncm91bmRDb2xvcjogJ3ZhcigtLWMtc2Vjb25kYXJ5KScsCn0pOwoKY19icigpOwoKZnVuY3Rpb24gc2VuZF9jaGF0KCkgewoJaWYgKCFoYXNfYWxpYXMpIHsKCQlub3RpZnkoImRpc2FibGVkIHRvIGRlZmF1bHQgdXNlcnMiLCA3MDAwKTsKCQlyZXR1cm47Cgl9CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWxpZGl0eS52YWxpZCkgewoJCWNvbnN0IGNoYXRfdGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZTsKCQlzX2J0bigic2VuZF9jaGF0IiwgY2hhdF90ZXh0KQoJCQkudGhlbihhc3luYyBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgoJCQkJaWYgKCFyZXNwb25zZVRleHQuaW5jbHVkZXMoImRvbmUiKSkKCQkJCQlyZXR1cm47CgoJCQkJYXdhaXQgc2xlZXAoMzUwKTsKCQkJCXVfY2hhdCgpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlID0gIiI7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGNhcmFjdGVyZXMgZXNwZWNpYWxlcywgZGUgMSBhIDY0IGNhcmFjdGVyZXMgc29sYW1lbnRlLiIsIDUwMDAsICJSRUQiKTsKCX0KfQoKY190ZXh0Ym94KHBhdGgsICJjaGF0X3RleHQiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJCIsCgltaW5MZW5ndGg6IDEsCgltYXhMZW5ndGg6IDY0LAoJcmVxdWlyZWQ6IHRydWUsCglwbGFjZWhvbGRlcjogIndyaXRlIiwKCWV2ZW50TGlzdGVuZXI6IHsKCQlrZXlkb3duOiBmdW5jdGlvbiAoZWwsIGV2KSB7CgkJCWlmIChldi5rZXkgPT09ICdFbnRlcicpIHsKCQkJCXNlbmRfY2hhdCgpOwoJCQl9CgkJfQoJfQp9LCB0cnVlKTsKCmNfYnRuKHBhdGgsICJidG5fc2VuZF9jaGF0IiwgInNlbmQiLCBmdW5jdGlvbiAoKSB7CglzZW5kX2NoYXQoKTsKfSwgIkVudmlhIHVuIG1lbnNhamUgYWwgY2hhdCwgdW5hIHZleiBjYWRhIDMwIHNlZ3VuZG9zLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfdGV4dChwYXRoLCAidXNlcnNvbmxpbmUiLCAiZGlzYWJsZWQgb25saW5lcyIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzEwcHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAp9KTsKCmZ1bmN0aW9uIGdfb25saW5lcygpIHsKCWlmICghaGFzX2FsaWFzKSByZXR1cm47CgoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJcmV0dXJuOwoKCWdhdGhlcigib25saW5lcyIsICJ6eiIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQl0cnkgewoJCQkJY29uc3QgbGl2ZXMgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgkJCQljb25zdCBvbmxpbmVzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcnNvbmxpbmUnKTsKCQkJCW9ubGluZXNlbC5pbm5lckhUTUwgPSAiPHAgZGF0YS10dGlwPSd0b3RhbDogIiArIGxpdmVzLmFsbF9vbmxpbmVzICsgIicgc3R5bGU9J2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjE0cHg7bWFyZ2luLWJvdHRvbTowcHg7bWFyZ2luLXRvcDowcHg7Jz5vbmxpbmVzICgiICsgbGl2ZXMubGl2ZS5sZW5ndGggKyAiKTwvcD48YnI+IiArIGxpdmVzLmxpdmUuam9pbigiLCAiKTsKCQkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJCWNvbnNvbGUubG9nKGVycm9yLCByZXN1bHQpOwoJCQl9CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9CgpnX29ubGluZXMoKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2J0bihwYXRoLCAib3BlbmRsZ2ZpbmR1c2VyIiwgInNlYXJjaCB1c2VyIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kdXNlcmRsZyIpOwoJZGlhbG9nLnNob3dNb2RhbCgpOwp9LCAiQnVzY2EgdW4gdXN1YXJpby4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KTsKCmNfYnIoKTsKCmNfZGlhbG9nKHBhdGgsICJmaW5kdXNlcmRsZyIpOwpwYXRoID0gImZpbmR1c2VyZGxnIjsKCmNfdGV4dChwYXRoLCAidXNlcmZpbmR0eHQiLCAic2VhcmNoIHVzZXIiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKCWNvbG9yOiAid2hpdGUiCn0pOwoKY19icihwYXRoKTsKCmNfdGV4dGJveChwYXRoLCAiZmluZF91c2VyIiwgZmFsc2UsICIiLCAiIiwge30sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOV0qJCIsCgltaW5MZW5ndGg6IDMsCgltYXhMZW5ndGg6IDIwLAoJcmVxdWlyZWQ6IHRydWUsCglwbGFjZWhvbGRlcjogImFsaWFzIiwKCWV2ZW50TGlzdGVuZXI6IHsKCQlrZXlkb3duOiBmdW5jdGlvbiAoZWwsIGV2KSB7CgkJCWlmIChldi5rZXkgPT09ICdFbnRlcicpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidG5fZmluZF91c2VyIikuY2xpY2soKTsKCQkJfQoJCX0KCX0KfSwgdHJ1ZSk7Cgpjb25zdCByb2xlY2xyID0geyAibm9ybWFsIjogIiM2MDYwNjAiLCAicHJlbWl1bSI6ICIjOGJiMGZmIiwgImNoYWQiOiAiI2ZmZTU4YiIsICJHT0QiOiAiI2YxNGMzOSIsICJQQVBJIjogIiNjZTk4ZTIiIH07CnZhciBmdV9jb29sZG93biA9IDA7CgpjX2J0bihwYXRoLCAiYnRuX2ZpbmRfdXNlciIsICJmaW5kIiwgZnVuY3Rpb24gKCkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kX3VzZXIiKS52YWxpZGl0eS52YWxpZCkKCQlpZiAoZnVfY29vbGRvd24gPiBnX3RtX2koKSkgewoJCQlub3RpZnkoInJlY2VudGx5IHVzZWQsIHdhaXQgIiArIChmdV9jb29sZG93biAtIGdfdG1faSgpKSArICIgc2Vjb25kcyIsIDcwMDApOwoJCQlyZXR1cm47CgkJfQoJZ2F0aGVyKCJpbmZvX2FsaWFzIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRfdXNlciIpLnZhbHVlKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJdHJ5IHsKCQkJCXZhciB1X2luZiA9IEpTT04ucGFyc2UocmVzdWx0KTsKCgkJCQlpZiAodV9pbmZbImF2YXRhciJdKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZ0ciIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQl9CgoJCQkJdmFyIHVzZXJfZGF0YSA9ICIiOwoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07CgoJCQkJaWYgKHVfaW5mWyJyb2xlIl0pCgkJCQkJdXNlcl9kYXRhICs9ICI8c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmU7Zm9udC1zaXplOjEwcHg7Y29sb3I6IiArIHJvbGVjbHJbdV9pbmZbInJvbGUiXS50b0xvd2VyQ2FzZSgpXSArICI7Jz4gKCIgKyB1X2luZlsicm9sZSJdICsgIik8L3NwYW4+PGJyPjwvc3Ryb25nPjwvcD4iOwoKCQkJCWlmICh1X2luZlsidXNlcl9pZCJdKQoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+dWlkOiAiICsgdV9pbmZbInVzZXJfaWQiXTsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPmJldGEiOwoKCQkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQoJCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCAwKSArICI8L3A+IjsKCQkJCWVsc2UKCQkJCQl1c2VyX2RhdGEgKz0gIjwvcD4iOwoKCQkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTJweDttYXJnaW4tdG9wOiAwcHg7Jz5pbmZvOiAiICsgd2luZG93LmF0b2IodV9pbmZbImRlc2NyaXB0aW9uIl0pICsgIjwvcD4iOwoJCQkJZWxzZQoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPm5vIGluZm88L3A+IgoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2luZiIpLmlubmVySFRNTCA9IHVzZXJfZGF0YTsKCQkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJCW5vdGlmeShyZXN1bHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCWlmIChyZXN1bHQuaW5jbHVkZXMoInJlY2VudGx5IikpIHsKCQkJCQlpZiAoZnVfY29vbGRvd24gPCBnX3RtX2koKSkKCQkJCQkJZnVfY29vbGRvd24gPSBnX3RtX2koKSArIDMwOwoJCQkJfQoJCQl9CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9LCAiIiwgeyBtYXJnaW5MZWZ0OiAiMTBweCIgfSk7CgpjX2J0bihwYXRoLCAiY2xvc2VmaW5kdXNlciIsICJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZHVzZXJkbGciKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyBtYXJnaW5MZWZ0OiAiMTBweCIgfSk7CgpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19kaXYocGF0aCwgInVzZXJfaW5mYWxpYXMiLCB7CglkaXNwbGF5OiAiaW5saW5lLWdyaWQiLAoJZ3JpZFRlbXBsYXRlQ29sdW1uczogInJlcGVhdCgzLCAxMDVweCkiLAoJZ3JpZEdhcDogIjEwcHgiCn0pOwoKY19icihwYXRoLCAyKTsKCmNfaW1nKCJ1c2VyX2luZmFsaWFzIiwgInVzZXJfYXZ0ciIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsCgl7CgkJbWFyZ2luTGVmdDogIjEwcHgiLAoJCW9iamVjdEZpdDogImNvdmVyIiwKCQlib3JkZXJSYWRpdXM6ICI1cHgiLAoJCXBsYWNlU2VsZjogIm5vcm1hbCIKCX0pOwoKY19icihwYXRoLCAyKTsKCmNfdGV4dCgidXNlcl9pbmZhbGlhcyIsICJ1c2VyX2luZiIsICJub25lIiwgewoJZGlzcGxheTogImdyaWQiLCBncmlkVGVtcGxhdGVDb2x1bW5zOiAiMTYwcHgiLCBtYXJnaW5Ub3A6ICIwcHgiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7Cgp2YXIgbGFzdF9tc2cgPSAwOwp2YXIgZmlyc3Rfc25kID0gMDsKCmZ1bmN0aW9uIHBfc291bmQoaWQpIHsKCWlmIChmaXJzdF9zbmQgPT0gMCkgewoJCWZpcnN0X3NuZCsrOwoJfQoJZWxzZSB7CgkJdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CgkJZWxlbWVudC52b2x1bWUgPSAwLjE7CgkJZWxlbWVudC5wbGF5KCk7Cgl9Cn0KCmZ1bmN0aW9uIHVfY2hhdCgpIHsKCWlmICghaGFzX2FsaWFzKSB7CgkJY29uc3QgY2hhdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LWNvbnRhaW5lcicpOwoJCWNoYXRDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CgkJY29uc3QgY2hhdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQljaGF0RWxlbWVudC5zdHlsZS5mb250U2l6ZSA9ICIxMnB4IjsKCQljaGF0RWxlbWVudC5pbm5lckhUTUwgPSBgKDxzcGFuIGRhdGEtdHRpcD0nJHtnX3RtX2R0KHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCksIDApfScgc3R5bGU9Im9wYWNpdHk6IDAuNTsiPiR7Z190bV9kdChwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApKX08L3NwYW4+KSA8c3BhbiBzdHlsZT0nJHsoImNvbG9yOiIgKyAoT2JqZWN0LmVudHJpZXMocm9sZWNscilbNF1bIjEiXSkgKyAiOyIpfSc+PHN0cm9uZz5aSU5DPC9zdHJvbmc+PC9zcGFuPjogY2hhdCBkaXNhYmxlZCB0byBkZWZhdWx0IGFsaWFzZXMsIGNoYW5nZSB5b3VyIGFsaWFzIGluIHRoZSByaWdodCBwYW5lbGA7CgkJY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChjaGF0RWxlbWVudCk7CgkJcmV0dXJuOwoJfQoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQoJCXJldHVybjsKCglnYXRoZXIoImdldF9jaGF0IiwgInoiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJY29uc3QgY2hhdHMgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgkJCWNvbnN0IGNoYXRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdC1jb250YWluZXInKTsKCQkJY2hhdENvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKCgkJCWxldCBoaWdoZXN0X3RzID0gMDsKCQkJY2hhdHMuZm9yRWFjaChhc3luYyAoY2hhdCkgPT4gewoKCQkJCWlmICghY2hhdC5tc2cuaW5jbHVkZXMoImRpc2FibGVkIikpCgkJCQkJaWYgKGhpZ2hlc3RfdHMgPCBjaGF0LnRzKQoJCQkJCQloaWdoZXN0X3RzID0gY2hhdC50czsKCgkJCQljb25zdCBjaGF0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJY2hhdEVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CgoJCQkJaWYgKCFjaGF0Lm1zZy5pbmNsdWRlcygiZGlzYWJsZWQiKSkKCQkJCQljaGF0RWxlbWVudC5pbm5lckhUTUwgPSBgKDxzcGFuIGRhdGEtdHRpcD0nJHtnX3RtX2R0KGNoYXQudHMsIDApfScgc3R5bGU9Im9wYWNpdHk6IDAuNTsiPiR7Z190bV9kdChjaGF0LnRzKX08L3NwYW4+KSA8c3BhbiBzdHlsZT0nJHtjaGF0LnIgIT0gdW5kZWZpbmVkID8gKCJjb2xvcjoiICsgKE9iamVjdC5lbnRyaWVzKHJvbGVjbHIpW2NoYXQucl1bIjEiXSkgKyAiOyIpIDogIiJ9Jz48c3Ryb25nPiR7Y2hhdC51fTwvc3Ryb25nPjwvc3Bhbj46ICR7d2luZG93LmF0b2IoY2hhdC5tc2cpfWA7CgkJCQllbHNlCgkJCQkJY2hhdEVsZW1lbnQuaW5uZXJIVE1MID0gYCg8c3BhbiBkYXRhLXR0aXA9JyR7Z190bV9kdChjaGF0LnRzLCAwKX0nIHN0eWxlPSJvcGFjaXR5OiAwLjU7Ij4ke2dfdG1fZHQoY2hhdC50cyl9PC9zcGFuPikgPHNwYW4gc3R5bGU9JyR7Y2hhdC5yICE9IHVuZGVmaW5lZCA/ICgiY29sb3I6IiArIChPYmplY3QuZW50cmllcyhyb2xlY2xyKVtjaGF0LnJdWyIxIl0pICsgIjsiKSA6ICIifSc+PHN0cm9uZz4ke2NoYXQudX08L3N0cm9uZz48L3NwYW4+OiAke2NoYXQubXNnfWA7CgoJCQkJY2hhdENvbnRhaW5lci5hcHBlbmRDaGlsZChjaGF0RWxlbWVudCk7CgoJCQkJY19ocigiY2hhdC1jb250YWluZXIiLCBmYWxzZSwgewoJCQkJCW9wYWNpdHk6ICIwLjIiLAoJCQkJCXBhZGRpbmdUb3A6ICIwcHgiLAoJCQkJCXBhZGRpbmdCb3R0b206ICIwcHgiLAoJCQkJfSk7CgkJCX0pOwoKCQkJaWYgKGxhc3RfbXNnICE9IGhpZ2hlc3RfdHMpIHsKCQkJCXBfc291bmQoInNuZDEiKTsKCQkJCWxhc3RfbXNnID0gaGlnaGVzdF90czsKCQkJfQoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKdmFyIHBhdGggPSAibWFpbl9lbGVtZW50cyI7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGl0bGVfaWQiKS5pbm5lclRleHQgPSAiWklOQyI7CgpjX3RhYl9idXR0b24oImVsZW1lbnRfcmlnaHRfYnV0dG9ucyIsIFsKCXsgaWQ6ICJwX3VwZGF0ZXMiLCB0ZXh0OiAibG9ncyIgfSwKCXsgaWQ6ICJwX3RpY2tldHMiLCB0ZXh0OiAidGlja2V0cyIgfSwKCXsgaWQ6ICJwX3Byb2ZpbGUiLCB0ZXh0OiAicHJvZmlsZSIgfQpdLCAyKTsKCi8qU1RBUlQgRkVBVFVSRVMqLwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZHVjdF9pZCIpLmlubmVyVGV4dCA9ICJjb2xvcmJvdCI7CgpjX3RhYl9idXR0b24oImVsZW1lbnRfYnV0dG9ucyIsIFsKCXsgaWQ6ICJtYWluX3RhYiIsIHRleHQ6ICJtYWluIiB9LAoJeyBpZDogInFyY29kZV90YWIiLCB0ZXh0OiAiUVIiIH0sCgl7IGlkOiAic2V0dGluZ3NfdGFiIiwgdGV4dDogImNmZyIgfSwKXSk7CgpjX2NvbWJvYm94KHBhdGgsICJhbGxfcHJvZmlsZXMiLCAiIiwgMCwgMjAsIHRydWUsICIiLCBhc3luYyBmdW5jdGlvbiAoZWwpIHsKCWF3YWl0IGxpdmVfc2VydmVyKCk7Cn0sIHsgbWluV2lkdGg6ICIxODBweCIsIG1hcmdpblJpZ2h0OiAiLTE4MHB4IiwgcG9zaXRpb246ICdyZWxhdGl2ZScsIHRvcDogJy02OHB4JywgbGVmdDogJzEwMnB4JyB9KTsKCmNfY2hlY2tib3gocGF0aCwgImNvbG9yYm90IiwgImVuYWJsZWQiLCAiQWN0aXZhIGVsIGZ1bmNpb25hbWllbnRvIGRlbCBjb2xvcmJvdC4iKTsKY19jaGVja2JveChwYXRoLCAiZGluYW1pY19zbW9vdGgiLCAiZGluYW1pYyBzbW9vdGgiLCAiQWwgYWN0aXZhcmxvLCBibG9xdWVhIGVsIHNtb290aCBwcmluY2lwYWwuIik7Ci8vY19jaGVja2JveChwYXRoLCAibWFza19mb3JtYXQiLCAibWFzayBmb3JtYXQiLCAiQWwgZXN0YXIgYWN0aXZhZG8sIHV0aWxpemEgZWwgbWFzayB0aHJlYWQgKGRlamFuZG8gaW5oYWJpbGl0YWRvIGVsIHNpbXBsZSBmb3JtYXQpIik7Ci8vY19jaGVja2JveChwYXRoLCAic2ltcGxlX2Zvcm1hdCIsICJzaW1wbGUgZm9ybWF0IiwgIkFsIGVzdGFyIGFjdGl2YWRvLCB1dGlsaXphIHVuIHRocmVhZCBsaW1waW8gc2luIG9wY2lvbmVzIGRlIGRlYnVnLCBldGMuIik7CgpjX2NvbWJvYm94KHBhdGgsICJtYWluX2tleSIsICJtYWluIGtleSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJMYSBLZXkgcHJpbmNpcGFsIGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBhaW0uIik7CmNfY29tYm9ib3gocGF0aCwgInNlY29uZGFyeV9rZXkiLCAic2Vjb25kYXJ5IGtleSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJMYSBLZXkgc2VjdW5kYXJpYSBjb24gbGEgY3VhbCBzZSBhY3RpdmEgZWwgYWltLiIpOwpjX2NvbWJvYm94KHBhdGgsICJkaXNhYmxlX3NlY29uZGFyeV9rZXkiLCAiZGlzYWJsZSBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IGNvbiBsYSBjdWFsIHNlIGRlc2FjdGl2YSBlbCBhaW0uIik7CgpjX2NvbWJvYm94KHBhdGgsICJ0eXBlX2Zvcm1hdCIsICJmb3JtYXQiLCAwLCAzLCBmYWxzZSwgIkRpc3RpbnRvcyBtZXRvZG9zIHBhcmEgZXNjYW5lYXIvcHJvY2VzYXIgbG9zIGNvbG9yZXMuIik7CmNfY29tYm9ib3gocGF0aCwgImRpbmFtaWNfc21vb3RoX3R5cGUiLCAiZGluYW1pYyBzbW9vdGggdHlwZSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJBY29tb2RhIGVsIHNtb290aCBkaW5hbWljYW1lbnRlIGRlcGVuZGllbmRvIGxhIGRpc3RhbmNpYSBkZWwgZW5lbWlnbyIpOwpjX2NvbWJvYm94KHBhdGgsICJjb2xvcl90eXBlIiwgImNvbG9ycyIsIDAsIDQsIGZhbHNlLCAiRWwgY29sb3Igc2VsZWNjaW9uYWRvIGVzIGVuIGVsIGN1YWwgc2UgYmFzYXJhIGVsIGFpbWJvdCIpOwpjX2NvbWJvYm94KHBhdGgsICJzb3J0X21ldGhvZCIsICJtZXRob2RzIiwgMCwgOCwgZmFsc2UsICJEaXN0aW50b3MgbWV0b2RvcyBwYXJhIHF1ZSBlbCBhaW1ib3QgYXB1bnRlLCBzZSByZWNvbWllbmRhIGVsIEJFU1QuIik7CgpjX3NfaW50KHBhdGgsICd0YXJnZXRfb2Zmc2V0X3gnLCAib2Zmc2V0IFgiLCAwLCA1MCwgMSwgMCwgIkN1YW50byBtYXMgdmFsb3IgdGVuZ2EsIG1hcyBzZSBkZXNwbGF6YSBhIGxhIGRlcmVjaGEgZGVsIHRhcmdldCBpbmljaWFsLiIpOwpjX3NfaW50KHBhdGgsICJ0YXJnZXRfb2Zmc2V0X3kiLCAib2Zmc2V0IFkiLCAwLCA1MCwgMSwgNSwgIkN1YW50byBtYXMgdmFsb3IgdGVuZ2EsIG1hcyBzZSBkZXNwbGF6YSBhIGFiYWpvIGRlbCB0YXJnZXQgaW5pY2lhbC4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3NfZmxvYXQocGF0aCwgInNwZWVkIiwgInNtb290aCIsIDAuMCwgMTUuMCwgMC4xLCAyLjAsICJTdWF2aWRhZCBkZWwgYXB1bnRhZG8sIG1pZW50cmFzIG1hcyB0ZW5nYSwgbWFzIHN1YXZlIHNlIHZlIGVsIG1vdmltaWVudG8uIik7CmNfc19pbnQocGF0aCwgImZvdl94IiwgIkZvdiBYIiwgNSwgNTAwLCA1LCA1MCwgIlJhbmdvL0ZvdiBob3Jpem9udGFsLCBtaWVudHJhcyBtYXMgdGVuZ2EsIG1hcyBhIGxvIGFuY2hvIGVzY2FuZWFyYS4iKTsKY19zX2ludChwYXRoLCAiZm92X3kiLCAiRm92IFkiLCA1LCAyNTAsIDUsIDUwLCAiUmFuZ28vRm92IHZlcnRpY2FsLCBtaWVudHJhcyBtYXMgdGVuZ2EsIG1hcyBhIGxvIGFsdG8gZXNjYW5lYXJhLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfY2hlY2tib3gocGF0aCwgInJlY29pbCIsICJyZWNvaWwiLCAiQmFqYXJhIGVsIGNyb3NzaGFpciBhIGxhIGhvcmEgZGUgZGlzcGFyYXIgY29uIGxhIE1BSU4ga2V5LiIpOwpjX2NoZWNrYm94KHBhdGgsICJyY3NfY3JvdWNoX29ubHkiLCAiY3JvdWNoIG9ubHkiLCAiU29sbyBmdW5jaW9uYXJhIHNpIGVzdGFtb3MgYXByZXRhbmRvIENUUkwuIik7CmNfc19pbnQocGF0aCwgInJlY29pbF9kZWxheSIsICJkZWxheSIsIDUsIDUwMCwgNSwgMjAwLCAiRGVsYXkgcGFyYSBjYWRhIGJhamFkYSBkZWwgcmNzLiIpOwpjX3NfaW50KHBhdGgsICJyZWNvaWxfc3RyZW5naHQiLCAic3RyZW5naHQiLCAxLCA1MCwgMSwgMiwgIkZ1ZXJ6YSAoUFgpIHF1ZSBiYWphcmEgZWwgcmNzIGNhZGEgRGVsYXkuIik7CmNfc19pbnQocGF0aCwgIm1heF9yZWNvaWxfb2Zmc2V0IiwgIm1heCBvZmZzZXQiLCAxLCA1MCwgMSwgMiwgIkNhbnRpZGFkIG1heGltYSBkZSBwaXhlbGVzIHF1ZSBiYWphcmEgZWwgcmNzLiIpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfY2hlY2tib3gocGF0aCwgInRyaWdnZXJib3QiLCAidHJpZ2dlcmJvdCIsICJEaXNwYXJhcmEgYXV0b21hdGljYW1lbnRlIGN1YW5kbyBlbCBDT0xPUiBwYXNlIHBvciBlbCBjcm9zc2hhaXIuIik7CmNfY2hlY2tib3gocGF0aCwgImRpc2FibGVfYWltX29uX3RyaWdnZXIiLCAiZGlzYWJsZSBhaW0iLCAiRGVzaGFiaWxpdGEgZWwgYWltIGN1YW5kbyBlc3RhIHByZXNpb25hZG8gZWwgdHJpZ2dlci4iKTsKY19jb21ib2JveChwYXRoLCAidHJpZ2dlcl90eXBlIiwgInR5cGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlKTsKY19jb21ib2JveChwYXRoLCAidHJpZ2dlcl9rZXkiLCAidHJpZ2dlciBrZXkiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiTGEgS2V5IGNvbiBsYSBjdWFsIHNlIGFjdGl2YSBlbCBUUklHR0VSLiIpOwpjX3NfaW50KHBhdGgsICJ0cmlnZ2VyX3JhZGl1cyIsICJmb3YiLCAxLCA1MCwgMSwgMTUsICJSYW5nby9Gb3YgcGFyYSBlbXBlemFyIGEgZGV0ZWN0YXIgZGVzZGUgZWwgY2VudHJvIGRlIGxhIG1pcmEsIG1pZW50cmFzIG1hcyB0ZW5nYSBtYXMgaW1wcmVjaXNvLiIpOwpjX3NfaW50KHBhdGgsICJ0cmlnZ2VyX2RlbGF5IiwgImRlbGF5IiwgNSwgNTUwLCA1LCAyNTAsICJEZWxheSBwYXJhIGNhZGEgZGlzcGFybywgbm8gZXMgZWwgZGVsYXkgcGFyYSBlbCBwcmltZXIgdGlybywgc2lubyBwYXJhIGxhIHJhZmFnYS4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2NoZWNrYm94KHBhdGgsICJiaG9wX3RvZ2dsZSIsICJiaG9wIiwgIkFsIGFjdGl2YXJsbywgZGViZXMgYmluZGVhciBsYSBrZXkgWEJ1dHRvbjIgbyBNb3VzZTUgYWwgYmhvcCBlbiB2ZXogZGVsIGVzcGFjaW8uIik7CmNfc19pbnQocGF0aCwgImJob3BfZGVsYXkiLCAiYmhvcCBkZWxheSIsIDUsIDIwMCwgNSwgMjAwLCAiRGVsYXkgZW50cmUgY2FkYSBzYWx0bywgbWllbnRyYXMgbWFzIHRlbmdhIG1hcyB0YXJkYXJhIGVuIHNhbHRhci4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3NfaW50KHBhdGgsICJjdXN0b21fc2xlZXAiLCAic2xlZXAgJ21zJyIsIDEsIDIwMCwgMSwgMjAwLCAiTWlsaXNlZ3VuZG9zIHBhcmEgYWN0dWFsaXphciBlbCBjb2xvcmJvdCwgbWllbnRyYXMgbWFzIHZhbG9yLCBtYXMgdGFyZGFyYSBlbiBhY3R1YWxpemFyLiIpOwpjX3NfaW50KHBhdGgsICJhY2NlcHRhYmxlX2FyZWEiLCAiYWNjZXB0YWJsZSBhcmVhIiwgNSwgMjAwLCA1LCAyMDAsICJBcmVhIGFjZXB0YWJsZSBwYXJhIGVsIGZvcm1hdG8gcHkgKHRlc3QpLiIpOwoKZl9jb21ibygidHJpZ2dlcl90eXBlIiwgInRyaWdnZXJfdHlwZSIpOwpmX2NvbWJvKCJkaW5hbWljX3Ntb290aF90eXBlIiwgImRpbmFtaWNfc21vb3RoX3R5cGUiKTsKZl9jb21ibygiY29sb3JfdHlwZSIsICJjb2xvcnMiKTsKZl9jb21ibygic29ydF9tZXRob2QiLCAibWV0aG9kcyIpOwpmX2NvbWJvKCJ0eXBlX2Zvcm1hdCIsICJmb3JtYXRzIik7Cgpjb25zdCBiaW5kX2VsZW1lbnRzID0gWwoJeyBpZDogIm1haW5fa2V5IiwgdGFyZ2V0OiAibWFpbl9rZXkiIH0sCgl7IGlkOiAic2Vjb25kYXJ5X2tleSIsIHRhcmdldDogInNlY29uZGFyeV9rZXkiIH0sCgl7IGlkOiAidHJpZ2dlcl9rZXkiLCB0YXJnZXQ6ICJ0cmlnZ2VyX2tleSIgfSwKCXsgaWQ6ICJkaXNhYmxlX3NlY29uZGFyeV9rZXkiLCB0YXJnZXQ6ICJkaXNhYmxlX3NlY29uZGFyeV9rZXkiIH0sCl07CgovKkVORCBGRUFUVVJFUyovCgpmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CmZfY29tYm8oImFsbF9wcm9maWxlczIiLCAiYWxsX3Byb2ZpbGVzIik7CgpwYXRoID0gImVsZW1lbnRzX2NmZ2IiOwoKY19jaGVja2JveChwYXRoLCAiYXV0b191cGRhdGVfbWVudSIsICJBdXRvLXVwZGF0ZSBtZW51IiwgIlNlIGFjdHVhbGl6YXJhIGxhIHBhZ2luYSBhdXRvbWF0aWNhbWVudGUgY2FkYSA1IHNlZ3VuZG9zIGVuIGNhc28gZGUgcXVlIGhheWEgY2FtYmlvcyBkZXNkZSBvdHJhIHBhZ2luYS4iLCBmdW5jdGlvbiAoZWwpIHsKCWFsbG93X2F1ID0gZWwuY2hlY2tlZDsKfSk7CgpjX2hyKCk7CmNfdGV4dChwYXRoLCAicm5kIiwgIiYjOTY3OTsgY2xvdWQgcHJvZmlsZXMiLCB7IGZvbnRTaXplOiAiMThweCIsIGZvbnRXZWlnaHQ6ICJib2xkIiwgbWFyZ2luTGVmdDogIjIwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9zdl9wcm9maWxlIiwgImNyZWF0ZSBwcm9maWxlIiwgZnVuY3Rpb24gKGNfZWwpIHsKCWlmICghaXNfbW9kYWxvcGVuKCdkbGdfY3JlYXRlX3Byb2YnKSkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGxnX2NyZWF0ZV9wcm9mIikuc2hvd01vZGFsKCk7Cn0sICJHdWFyZGEgdHUgcGVyZmlsIGFjdHVhbCBlbiBlbCBzZXJ2aWRvciwgZWwgY3VhbCBwdWVkZXMgY2FyZ2FyIiwgeyBtYXJnaW5SaWdodDogIjVweCIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnZGxnX2NyZWF0ZV9wcm9mJyk7CmNfdGV4dCgnZGxnX2NyZWF0ZV9wcm9mJywgInJuZCIsICJDcmVhdGUgY2xvdWQgcHJvZmlsZS4iLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4Igp9KTsKY190ZXh0Ym94KCdkbGdfY3JlYXRlX3Byb2YnLCAiY3Byb2ZpbGVuYW1lIiwgZmFsc2UsICJwcm9maWxlIG5hbWUgIiwgIiIsIHsKCXJlc2l6ZTogJ25vbmUnLAoJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJd2hpdGVTcGFjZTogJ3ByZS13cmFwJywKCW1hcmdpblRvcDogIjVweCIsCgljb2xvcjoid2hpdGUiLGxhYmVsejp7Y29sb3I6IndoaXRlIn0KfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCW1pbkxlbmd0aDogMSwKCW1heExlbmd0aDogMTYsCglwbGFjZWhvbGRlcjogIm5hbWUiLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwpjX2J0bignZGxnX2NyZWF0ZV9wcm9mJywgInJuZCIsICJjcmVhdGUiLCBmdW5jdGlvbiAoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNwcm9maWxlbmFtZSIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHRpY2tldF9pbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNwcm9maWxlbmFtZSIpLnZhbHVlOwoJCXZhciB0aWNrZXRfcmVhc29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNwcm9maWxlbmFtZSIpLnZhbHVlOwoKCQlzX2J0bigic2F2ZV9wcm9maWxlIiwgdGlja2V0X3JlYXNvbiArICItIiArIHRpY2tldF9pbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBjYXJhY3RlcmVzIGVzcGVjaWFsZXMsIGRlIDEgYSAxNiBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CmNfYnRuKCdkbGdfY3JlYXRlX3Byb2YnLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkbGdfY3JlYXRlX3Byb2YiKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2xpc3QiLCAicHJvZmlsZSBsaXN0IiwgZnVuY3Rpb24gKCkgewoJaWYgKCFpc19tb2RhbG9wZW4oJ2RsZ19wcm9mX2xpc3QnKSkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGxnX3Byb2ZfbGlzdCIpLnNob3dNb2RhbCgpOwoKCXNfYnRuKCJwcm9maWxlX2xpc3QiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJdHJ5IHsKCQkJCWNvbnNvbGUubG9nKHJlc3BvbnNlVGV4dCk7CgkJCQl2YXIgcmVzanNvbiA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKCgkJCQlpZiAocmVzanNvbi5sZW5ndGggPT0gMCkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1X3Byb2ZpbGVfbGlzdCIpLmlubmVySFRNTCA9ICJubyBwcm9maWxlcyI7CgkJCQkJbm90aWZ5KCJ1c2VyIGhhcyBubyBwcm9maWxlcyIsIDcwMDApOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQl2YXIgdG9fdGlja2V0cyA9ICIiOwoJCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzanNvbikgewoJCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNqc29uLCBrZXkpKSB7CgkJCQkJCWNvbnN0IGVsZW1lbnQgPSByZXNqc29uW2tleV07CgkJCQkJCXRvX3RpY2tldHMgKz0gIjwvdHI+IjsKCQkJCQkJdG9fdGlja2V0cyArPSAiPHRkPiIgKyBrZXkgKyAiPC90ZD4iOwoJCQkJCQl0b190aWNrZXRzICs9ICI8dGQ+IiArIGdfdG1fZHQoZWxlbWVudFsidGltZXN0YW1wIl0sIDIpICsgIjwvdGQ+IjsKCQkJCQkJLyp0b190aWNrZXRzICs9ICI8dGQ+IiArIGVsZW1lbnRbInN0YXR1cyJdICsgIjwvdGQ+IjsqLwoJCQkJCQkvLyovCgkJCQkJCXRvX3RpY2tldHMgKz0gIjx0ZD4iOwoJCQkJCQl0b190aWNrZXRzICs9ICI8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIHRpdGxlPSdsb2FkIHByb2ZpbGUnIHN0eWxlPSdoZWlnaHQ6MzBweDt3aWR0aDphdXRvO2Rpc3BsYXk6aW5saW5lLWJsb2NrOycgb25jbGljaz1cInNfYnRuKCdnZXRfcHJvZmlsZScsICciICsga2V5ICsgIicpLnRoZW4oYXN5bmMgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7YXdhaXQgbGl2ZV9zZXJ2ZXIoKTtmX2NvbWJvKCdhbGxfcHJvZmlsZXMnLCAnYWxsX3Byb2ZpbGVzJyk7Zl9jb21ibygnYWxsX3Byb2ZpbGVzMicsICdhbGxfcHJvZmlsZXMnKTt9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtjb25zb2xlLmVycm9yKGVycm9yKTt9KTtcIj48aSBjbGFzcz0nZmEgZmEtcGxheScgYXJpYS1oaWRkZW49J3RydWUnPjwvaT48L2J1dHRvbj4iOwoJCQkJCQl0b190aWNrZXRzICs9ICI8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIHRpdGxlPSdzYXZlL292ZXJyaWRlIHByb2ZpbGUnIHN0eWxlPSdtYXJnaW4tbGVmdDoycHg7aGVpZ2h0OjMwcHg7d2lkdGg6YXV0bztkaXNwbGF5OmlubGluZS1ibG9jazsnIG9uY2xpY2s9XCJpZighY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIG92ZXJyaWRlIHRoaXMgY2xvdWQgcHJvZmlsZSB3aXRoIHlvdXIgY3VycmVudCBwcm9maWxlPycpKSByZXR1cm47IHNfYnRuKCdzYXZlX3Byb2ZpbGUnLCAnIiArIGtleSArICInKS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICcgJyksIDcwMDApO30pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge2NvbnNvbGUuZXJyb3IoZXJyb3IpfSlcIj48aSBjbGFzcz0nZmEgZmEtZmxvcHB5LW8nIGFyaWEtaGlkZGVuPSd0cnVlJz48L2k+PC9idXR0b24+IjsKCQkJCQkJLyp0b190aWNrZXRzICs9ICI8YnV0dG9uIGNsYXNzPSduZXdidXR0b24nIHRpdGxlPSdjaGFuZ2Ugc3RhdHVzJyBzdHlsZT0nbWFyZ2luLWxlZnQ6MnB4O2hlaWdodDozMHB4O3dpZHRoOmF1dG87ZGlzcGxheTppbmxpbmUtYmxvY2s7JyBvbmNsaWNrPVwic19idG4oJ2Nwcl9zdGF0dXMnLCAnIiArIGtleSArICInKS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICcgJyksIDcwMDApO30pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge2NvbnNvbGUuZXJyb3IoZXJyb3IpO30pO1wiPjxpIGNsYXNzPSdmYSBmYS1leWUnIGFyaWEtaGlkZGVuPSd0cnVlJz48L2k+PC9idXR0b24+IjsqLwoKCQkJCQkJdG9fdGlja2V0cyArPSAiPC90ZD4iOwoJCQkJCQkvLyovCgkJCQkJCXRvX3RpY2tldHMgKz0gIjwvdHI+IjsKCQkJCQl9CgkJCQl9CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVfcHJvZmlsZV9saXN0IikuaW5uZXJIVE1MID0gYDxicj4KCQkJCTx0cj4KCQkJCTx0aD5uYW1lPC90aD4KCQkJCTx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBvbmNsaWNrPSJzb3J0X3RhYmxlKDEsICd1X3Byb2ZpbGVfbGlzdCcpIj5sYXN0IHNhdmVkPC90aD4KCQkJCTwhLS08dGg+c3RhdHVzPC90aD4tLT4KCQkJCTx0aD5vcHRpb25zPC90aD4KCQkJCTwvdHI+CgkJCQlgOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVfcHJvZmlsZV9saXN0IikuaW5uZXJIVE1MICs9IHRvX3RpY2tldHM7CgkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQljb25zb2xlLmxvZyhlcnJvcik7CgkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJfIikpIHsKCQkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQl9CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9LCAiTXVlc3RyYSB0dXMgcGVyZmlsZXMgY3JlYWRvcyIpOwoKY19kaWFsb2coJ2VsZW1lbnRfY29uZmlnJywgJ2RsZ19wcm9mX2xpc3QnKTsKY190ZXh0KCdkbGdfcHJvZl9saXN0JywgInJuZCIsICJDbG91ZCBwcm9maWxlcy4iLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKCWNvbG9yOiAid2hpdGUiCn0pOwpjX3RhYmxlKCdkbGdfcHJvZl9saXN0JywgInVfcHJvZmlsZV9saXN0IiwgIiIsIHsgY29sb3I6ICJ3aGl0ZSIsIHdpZHRoOiAiMTAwJSIgfSk7CmNfYnRuKCdkbGdfcHJvZl9saXN0JywgInJuZCIsICJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkbGdfcHJvZl9saXN0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfaHIoKTsKCmNfdGV4dChwYXRoLCAicm5kIiwgIiYjOTY3OTsgbG9jYWwgcHJvZmlsZXMiLCB7IGZvbnRTaXplOiAiMThweCIsIGZvbnRXZWlnaHQ6ICJib2xkIiwgbWFyZ2luTGVmdDogIjIwcHgiIH0pOwoKY19jb21ib2JveChwYXRoLCAiYWxsX3Byb2ZpbGVzMiIsICJwcm9maWxlIiwgMCwgMjAsIGZhbHNlLCAiUGVyZmlsZXMgcGFyYSBjYWRhIHNpdHVhY2lvbi4iLCBhc3luYyBmdW5jdGlvbiAoZWwpIHsKCWF3YWl0IGxpdmVfc2VydmVyKCk7Cn0sIHsgbWluV2lkdGg6ICIxODBweCIgfSk7CgpjX3RleHRib3gocGF0aCwgInByb2ZpbGVfbmFtZV9jIiwgZmFsc2UsICIiLCAiNC05IGNoYXJhY3RlcnMuIiwgeyBtYXJnaW5MZWZ0OiAiNXB4Iiwgd2lkdGg6ICIxNTBweCIgfSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCW1pbkxlbmd0aDogMywKCW1heExlbmd0aDogOSwKCXJlcXVpcmVkOiBmYWxzZSwKfSwgdHJ1ZSk7CgpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfY2hhbmdlIiwgImNoYW5nZSBuYW1lIiwgYXN5bmMgZnVuY3Rpb24gKCkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9maWxlX25hbWVfYyIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHByb2ZfdmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZmlsZV9uYW1lX2MiKS52YWx1ZTsKCQlzX2luZm8oInByb2ZpbGVfbmFtZSIsIHByb2ZfdmFsdWUpOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9maWxlX25hbWVfYyIpLnZhbHVlID0gIiI7CgkJYXdhaXQgbGl2ZV9zZXJ2ZXIoKTsKCQlmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CgkJZl9jb21ibygiYWxsX3Byb2ZpbGVzMiIsICJhbGxfcHJvZmlsZXMiKTsKCX0KCWVsc2UgewoJCW5vdGlmeSgiTm8gc2UgYWNlcHRhbiBlc3BhY2lvcyBvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7Cgl9Cn0sICJDYW1iaWEgZWwgbm9tYnJlIGRlbCBwcm9maWxlIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2V4cG9ydCIsICJleHBvcnQgcHJvZmlsZSIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cF9wciIpLnNob3dNb2RhbCgpOwp9LCAiRXhwb3J0YSBlbCBwZXJmaWwgYWN0dWFsIGFsIENMSVBCT0FSRC4iLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leHBfcHInKTsKY190ZXh0KCdjb25maXJtX2V4cF9wcicsICJybmQiLCAiWW91IGFyZSBhYm91dCB0byA8dT5FWFBPUlQ8L3U+IHlvdXIgY3VycmVudCBwcm9maWxlLiIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CmNfYnRuKCdjb25maXJtX2V4cF9wcicsICJybmQiLCAiQ09ORklSTSIsIGFzeW5jIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCJleHBvcnRfcHJvZmlsZSIpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgpjX2J0bignY29uZmlybV9leHBfcHInLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cF9wciIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfaW1wb3J0IiwgImltcG9ydCBwcm9maWxlIiwgYXN5bmMgZnVuY3Rpb24gKCkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1faW1wX3ByIikuc2hvd01vZGFsKCk7Cn0pOwoKY19kaWFsb2coJ2VsZW1lbnRfY29uZmlnJywgJ2NvbmZpcm1faW1wX3ByJyk7CmNfdGV4dCgnY29uZmlybV9pbXBfcHInLCAicm5kIiwgIllvdSBhcmUgYWJvdXQgdG8gaW1wb3J0IGFuIDx1PlVOS05PV04gUFJPRklMRTwvdT48YnI+VGhpcyB3aWxsIDx1Pm92ZXJyaWRlPC91PiB5b3VyIGN1cnJlbnQgcHJvZmlsZS4iLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKCWNvbG9yOiAid2hpdGUiCn0pOwpjX2J0bignY29uZmlybV9pbXBfcHInLCAicm5kIiwgIkNPTkZJUk0iLCBhc3luYyBmdW5jdGlvbiAoKSB7CglzX2J0bigiaW1wb3J0X3Byb2ZpbGUiKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2ltcF9wciIpLmNsb3NlKCk7Cglhd2FpdCBsaXZlX3NlcnZlcigpOwoJZl9jb21ibygnYWxsX3Byb2ZpbGVzJywgJ2FsbF9wcm9maWxlcycpOwoJZl9jb21ibygnYWxsX3Byb2ZpbGVzMicsICdhbGxfcHJvZmlsZXMnKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1faW1wX3ByJywgInJuZCIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9pbXBfcHIiKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2ltcG9ydCIsICJzZXQgZGVmYXVsdCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZnJfc2V0ZGVmYXVsdCcpLnNob3dNb2RhbCgpOwp9LCAiRGV2dWVsdmUgZWwgcGVyZmlsIGEgdmFsb3JlcyBkZWZhdWx0LCB0YW1iaWVuIGVsIG5vbWJyZS4iKTsKCmNfZGlhbG9nKHBhdGgsICdjZnJfc2V0ZGVmYXVsdCcpOwpjX3RleHQoJ2Nmcl9zZXRkZWZhdWx0JywgImNmcmRsZ2RlZmF1bHRwciIsICJZb3UgYXJlIGFib3V0IHRvIHNldCB0aGUgY3VycmVudDxicj5wcm9maWxlIHRvIGRlZmF1bHQgVkFMVUVTIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2Nmcl9zZXRkZWZhdWx0JywgInJuZCIsICJDT05GSVJNIiwgYXN5bmMgZnVuY3Rpb24gKCkgewoJc19idG4oJ2RlZmF1bHRfcHJvZmlsZScpOwoJYXdhaXQgbGl2ZV9zZXJ2ZXIoKTsKCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCWZfY29tYm8oImFsbF9wcm9maWxlczIiLCAiYWxsX3Byb2ZpbGVzIik7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2ZyX3NldGRlZmF1bHQiKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgpjX2J0bignY2ZyX3NldGRlZmF1bHQnLCAicm5kIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZnJfc2V0ZGVmYXVsdCIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgoKY19ocigpOwoKY190ZXh0KHBhdGgsICJybmQiLCAiJiM5Njc5OyBsb2NhbCBjb25maWciLCB7IGZvbnRTaXplOiAiMThweCIsIGZvbnRXZWlnaHQ6ICJib2xkIiwgbWFyZ2luTGVmdDogIjIwcHgiIH0pOwoKY19kaWFsb2coJ2VsZW1lbnRfY29uZmlnJywgJ2NvbmZpcm1fbG9hZGNmZycpOwpjX3RleHQoJ2NvbmZpcm1fbG9hZGNmZycsICJjb25maXJtZGxnbG9hZGNmZyIsICJZb3UgYXJlIGFib3V0IHRvIGxvYWQgeW91ciA8dT5sb2NhbDwvdT4gQ0ZHIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2NvbmZpcm1fbG9hZGNmZycsICJjb25maXJtbG9hZGNmZyIsICJDT05GSVJNIiwgYXN5bmMgZnVuY3Rpb24gKCkgewoJc19idG4oJ2xvYWRfYycpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1fbG9hZGNmZyIpLmNsb3NlKCk7Cglhd2FpdCBsaXZlX3NlcnZlcigpOwoJZl9jb21ibygnYWxsX3Byb2ZpbGVzJywgJ2FsbF9wcm9maWxlcycpOwoJZl9jb21ibygnYWxsX3Byb2ZpbGVzMicsICdhbGxfcHJvZmlsZXMnKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1fbG9hZGNmZycsICJjYW5jZWxfbG9hZGNmZyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9sb2FkY2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX3NhdmVjZmcnKTsKY190ZXh0KCdjb25maXJtX3NhdmVjZmcnLCAiY29uZmlybWRsZ3NhdmVjZmciLCAiWW91IGFyZSBhYm91dCB0byBzYXZlIHlvdXIgbG9jYWwgQ0ZHIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKCmNfYnRuKCdjb25maXJtX3NhdmVjZmcnLCAiY29uZmlybXNhdmVjZmciLCAiQ09ORklSTSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCdzYXZlX2MnKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX3NhdmVjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgpjX2J0bignY29uZmlybV9zYXZlY2ZnJywgImNhbmNlbF9zYXZlY2ZnIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX3NhdmVjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2ltcG9ydGNmZycpOwpjX3RleHQoJ2NvbmZpcm1faW1wb3J0Y2ZnJywgImNvbmZpcm1kbGdpbXBjZmciLCAiWW91IGFyZSBhYm91dCB0byBJTVBPUlQgYW5vdGhlciBDRkciLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwgY29sb3I6ICJ3aGl0ZSIKfSk7CmNfYnRuKCdjb25maXJtX2ltcG9ydGNmZycsICJjb25maXJtaW1wb3J0Y2ZnIiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CglzX2J0bignaW1wb3J0X2MnKQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1faW1wb3J0Y2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1faW1wb3J0Y2ZnJywgImNhbmNlbF9pbXBvcnRjZmciLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1faW1wb3J0Y2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2V4cG9ydGNmZycpOwpjX3RleHQoJ2NvbmZpcm1fZXhwb3J0Y2ZnJywgImNvbmZpcm1kbGdleHBjZmciLCAiWW91IGFyZSBhYm91dCB0byBFWFBPUlQgdGhlIGVudGlyZSBsb2NhbCBDRkcsPGJyPiB3aGljaCBpbmNsdWRlIGFsbCB5b3VyIHByb2ZpbGVzIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsIGNvbG9yOiAid2hpdGUiCn0pOwpjX2J0bignY29uZmlybV9leHBvcnRjZmcnLCAiY29uZmlybWV4cG9ydGNmZyIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJc19idG4oJ2V4cG9ydF9jJykKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cG9ydGNmZyIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCmNfYnRuKCdjb25maXJtX2V4cG9ydGNmZycsICJjYW5jZWxfZXhwb3J0Y2ZnIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cG9ydGNmZyIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leGl0Jyk7CmNfdGV4dCgnY29uZmlybV9leGl0JywgImNvbmZpcm1kbGdleGl0IiwgIllvdSBhcmUgYWJvdXQgdG8gZXhpdCIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLCBjb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2NvbmZpcm1fZXhpdCcsICJjb25maXJtZXhpdCIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJY19leGl0KCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leGl0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1fZXhpdCcsICJjYW5jZWxfZXhpdCIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leGl0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCnBhdGggPSAicGFuZWxfdGlja2V0cyI7CgpjX3RleHQocGF0aCwgInRpY2tldGNlbnRlciIsICJUaWNrZXQgQ2VudGVyIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwoKdmFyIHRpY2tldF9mYXFfc3QgPSB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFNpemU6ICcxNHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAp9CgpjX3RleHQocGF0aCwgInRja3RmYXEiLCAiLSBEbyBub3Qgc3BhbSB0aGUgdGlja2V0IHN5c3RlbS48YnI+LSBPbmx5IGNyZWF0ZSB0aWNrZXRzIGlmIHlvdSBoYXZlIGFuIGlzc3VlLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYSBmZWF0dXJlIHJlcXVlc3QuPGJyPiIsIHRpY2tldF9mYXFfc3QpOwpjX3RleHQocGF0aCwgInRja3RmYXEiLCAiLSBPbmx5IGNyZWF0ZSB0aWNrZXRzIGlmIHlvdSBuZWVkIDx1PmhlbHA8L3U+Ljxicj4tIEFsbCB0aWNrZXRzIGFyZSA8dT5wcml2YXRlPC91Pi48YnI+LSBEbyBub3QgcG9zdCBpcnJlbGV2YW50IGNvbW1lbnRzIGluIHRpY2tldHMgb3IgeW91IG1heSBiZSA8dT5iYW5uZWQ8L3U+LiIsIHRpY2tldF9mYXFfc3QpOwoKY19jb21ib2JveDIocGF0aCwgInRpY2tldF9iZWhhdmlvciIsIFsiQnVnIiwgIkZlYXR1cmUiLCAiT3RoZXIiXSwgdHJ1ZSwgIlNlbGVjY2lvbmEgdW5hIHJhem9uIGRlbCB0aWNrZXQuIik7CgpjX3RleHRhcmVhKHBhdGgsICJ0aWNrZXRfY29udGVudCIsIHRydWUsICIiLCB7CgloZWlnaHQ6ICcxMDBweCcsCglyZXNpemU6ICdub25lJywKCW92ZXJmbG93OiAnaGlkZGVuJywKCXdoaXRlU3BhY2U6ICdwcmUtd3JhcCcsCgltYXJnaW5Ub3A6ICI1cHgiLAp9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokezV9IiwKCW1pbkxlbmd0aDogNSwKCW1heExlbmd0aDogMjU2LAoJcGxhY2Vob2xkZXI6ICJpbmZvIiwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCnZhciBzaG93X3RpY2tldF9jID0gZmFsc2U7CmNfYnRuKHBhdGgsICJidG5fY3JlYXRlX3RpY2tldCIsICJjcmVhdGUgdGlja2V0IiwgZnVuY3Rpb24gKCkgewoJaWYgKCFzaG93X3RpY2tldF9jKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50Iikuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJc2hvd190aWNrZXRfYyA9IHRydWU7CgkJcmV0dXJuOwoJfQoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS52YWxpZGl0eS52YWxpZCkgewoJCXZhciB0aWNrZXRfaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnZhbHVlOwoJCXZhciB0aWNrZXRfcmVhc29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnZhbHVlOwoKCQlzX2J0bigiY3JlYXRlX3RpY2tldCIsIHRpY2tldF9yZWFzb24gKyAiLSIgKyB0aWNrZXRfaW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoIk5vIHNlIGFjZXB0YW4gY2FyYWN0ZXJlcyBlc3BlY2lhbGVzLCBkZSA1IGEgMjU2IGNhcmFjdGVyZXMgc29sYW1lbnRlLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIkNyZWEgdW4gdGlja2V0IGVsIGN1YWwgc2VyYSBhdGVuZGlkby92aXN0byBwb3IgbG9zIGFkbWluaXN0cmFkb3Jlcy4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CmNfYnRuKHBhdGgsICJidG5fZ2V0X3RpY2tldHMiLCAidmlldyB0aWNrZXRzIiwgZnVuY3Rpb24gKCkgewoJaWYgKHNob3dfdGlja2V0X2MpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCXNob3dfdGlja2V0X2MgPSBmYWxzZTsKCX0KCglzX2J0bigiZ2V0X3RpY2tldHMiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJaWYgKHJlc3BvbnNlVGV4dC5zcGxpdCgiXyIpLmxlbmd0aCAtIDEgPiAyKSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXZhciByZXNqc29uID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpOwoKCQkJaWYgKHJlc2pzb24ubGVuZ3RoID09IDApIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX3RpY2tldHMiKS5pbm5lckhUTUwgPSAibm8gdGlja2V0cyI7CgkJCQlub3RpZnkoInVzZXIgaGFzIG5vIHRpY2tldHMiLCA3MDAwKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9ICJubyB0aWNrZXRzIjsKCgkJCXZhciB0b190aWNrZXRzID0gIiI7CgkJCWZvciAoY29uc3Qga2V5IGluIHJlc2pzb24pIHsKCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNqc29uLCBrZXkpKSB7CgkJCQkJY29uc3QgZWxlbWVudCA9IHJlc2pzb25ba2V5XTsKCQkJCQl0b190aWNrZXRzICs9ICI8c3Ryb25nPjx1PiIgKyBlbGVtZW50WyJyZWFzb24iXSArICIgWyIgKyBlbGVtZW50WyJpZCJdICsgIl08L3U+IHwgPGJ1dHRvbiBjbGFzcz0nbmV3YnV0dG9uJyBkYXRhLXR0aXA9J0RlbGV0ZSB0aWNrZXQnIHN0eWxlPSdoZWlnaHQ6MzBweDt3aWR0aDphdXRvO2Rpc3BsYXk6aW5saW5lLWJsb2NrO2NvbG9yOnJlZDsnIG9uY2xpY2s9XCJzX2J0bignZGVsZXRlX3RpY2tldCcsICciICsgZWxlbWVudFsiaWQiXSArICInKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICcgJyksIDcwMDApO30pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge2NvbnNvbGUuZXJyb3IoZXJyb3IpO30pO1wiPiZ0aW1lczs8L2J1dHRvbj48L3N0cm9uZz48YnI+IjsKCQkJCQl0b190aWNrZXRzICs9ICI8cD4iICsgZWxlbWVudFsiY29udGVudCJdICsgIjwvcD4iOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxicj48YnI+IjsKCQkJCX0KCQkJfQoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9IHRvX3RpY2tldHM7CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9LCAiTXVlc3RyYSB0dXMgdGlja2V0cyBjcmVhZG9zIik7CgpjX3RleHQocGF0aCwgInVzZXJfdGlja2V0cyIsICIiLCB7IHRleHRBbGlnbjogImNlbnRlciIgfSk7CgpjX2JyKHBhdGgpOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CgpjX3RleHQocGF0aCwgIm1haW5fcGZfdGV4dCIsICJQcm9maWxlIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCWZvbnRXZWlnaHQ6ICdib2xkJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMjBweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogJzBweCcKfSk7CgpjX2RpdihwYXRoLCAidXNlcmluZm8iLCB7CglkaXNwbGF5OiAiaW5saW5lLWdyaWQiLAoJZ3JpZFRlbXBsYXRlQ29sdW1uczogInJlcGVhdCgzLCAxZnIpIiwKCWdyaWRHYXA6ICIxMHB4Igp9KTsKCnBhdGggPSAidXNlcmluZm8iOwpjX2ltZyhwYXRoLCAidXNlcl9hdmF0YXIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLAoJewoJCWp1c3RpZnlTZWxmOiAic3RhcnQiLAoJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQlvYmplY3RGaXQ6ICJjb3ZlciIsCgkJYm9yZGVyUmFkaXVzOiAiNXB4IgoJfSk7CgpjX3RleHQocGF0aCwgInVzZXJfaW5mbyIsICJub25lIiwgeyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxNjBweCIsIG1hcmdpblRvcDogIjBweCIgfSk7CgpmdW5jdGlvbiBvd25faW5mbygpIHsKCWdhdGhlcigiZ2V0X3VzZXJfaW5mbyIsICJ6IikKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCWxldCB1X2luZiA9IEpTT04ucGFyc2UocmVzdWx0KTsKCgkJCWlmICh1X2luZlsiYXZhdGFyIl0pIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2YXRhciIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsKCQkJfQoKCQkJdmFyIHVzZXJfZGF0YSA9ICIiOwoJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdtYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDsnPjxzdHJvbmc+QCIgKyB1X2luZlsiYWxpYXMiXTsKCgkJCWlmICghdV9pbmZbImFsaWFzIl0uaW5jbHVkZXMoIlpVc2VyIikpCgkJCQloYXNfYWxpYXMgPSB0cnVlOwoKCQkJaWYgKHVfaW5mWyJyb2xlIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxzcGFuIHN0eWxlPSdkaXNwbGF5OmlubGluZTtmb250LXNpemU6MTBweDtjb2xvcjoiICsgcm9sZWNsclt1X2luZlsicm9sZSJdLnRvTG93ZXJDYXNlKCldICsgIjsnPiAoIiArIHVfaW5mWyJyb2xlIl0gKyAiKTwvc3Bhbj48YnI+PC9zdHJvbmc+PC9wPiI7CgoJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+dWlkOiAiICsgdV9pbmZbInVzZXJfaWQiXTsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz51aWQ6IE5PIjsKCgkJCWlmICh1X2luZlsicmVnaXN0ZXJfdGltZSJdKQoJCQkJdXNlcl9kYXRhICs9ICIgLSBqb2luZWQ6ICIgKyBnX3RtX2R0KHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0sIDApICsgIjwvcD4iOwoJCQllbHNlCgkJCQl1c2VyX2RhdGEgKz0gIjwvcD4iOwoKCQkJaWYgKHVfaW5mWyJkZXNjcmlwdGlvbiJdKQoJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJZWxzZQoJCQkJdXNlcl9kYXRhICs9ICI8cD48L3A+IgoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfaW5mbyIpLmlubmVySFRNTCA9IHVzZXJfZGF0YTsKCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0KCm93bl9pbmZvKCk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfYnRuKHBhdGgsICJvcGVuZGxnYWxpYXMiLCAiY2hhbmdlIGFsaWFzIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbGlhc19kbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIlBlcm1pdGUgY2FtYmlhciBlbCBhbGlhcyAxIHZleiBjYWRhIDMwIGRpYXMuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCmNfZGlhbG9nKHBhdGgsICJhbGlhc19kbGciLCB7fSwge30pOwpwYXRoID0gImFsaWFzX2RsZyI7CgpjX3RleHRib3gocGF0aCwgInBmX2FsaWFzX3RleHRib3giLCBmYWxzZSwgIiIsICIiLCB7CgltYXJnaW5Ub3A6ICI1cHgiLAp9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJbWluTGVuZ3RoOiAzLAoJbWF4TGVuZ3RoOiAyMCwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2FsaWFzIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwZl9hbGlhc190ZXh0Ym94Iik7CgoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCXZhciB0eHRpbmZvID0gZWxlbV9pdGVtLnZhbHVlOwoJCXNfYnRuKCJjaGFuZ2VfYWxpYXMiLCB0eHRpbmZvKQoJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgoJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgewoJCQkJCW93bl9pbmZvKCk7CgkJCQkJaGFzX2FsaWFzID0gdHJ1ZTsKCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImNhbmNlbF9hbGlhcyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFsaWFzX2RsZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfYnRuKHBhdGgsICJvcGVuZGxnYXZ0ciIsICJjaGFuZ2UgYXZhdGFyIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOwoJZGlhbG9nLnNob3dNb2RhbCgpOwp9LCAiQ2FtYmlhIGVsIGF2YXRhciBhIHVuYSBpbWFnZW4sIHNvbG8gVVJMUy4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQoKY19kaWFsb2cocGF0aCwgImF2dHJfZGxnIik7CnBhdGggPSAiYXZ0cl9kbGciOwoKY19pbWcocGF0aCwgImF2dHJfcHJldmlldyIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsIHsKCWRpc3BsYXk6ICJibG9jayIsCgltYXJnaW46ICIwIGF1dG8iLAoJb2JqZWN0Rml0OiAiY292ZXIiCn0pOwoKY19icigpOwoKY190ZXh0KHBhdGgsICIiLCAiSW1ndXIgVVJMIG9ubHksIGV4YW1wbGUuIiwgewoJdGV4dEFsaWduOiAiY2VudGVyIiwKCWNvbG9yOiAid2hpdGUiCn0pOwpjX3RleHQocGF0aCwgIiIsICJodHRwczovL2kuaW1ndXIuY29tL0duSmFFWkwucG5nIiwgewoJdGV4dEFsaWduOiAiY2VudGVyIiwKCWNvbG9yOiAid2hpdGUiCn0pOwoKY190ZXh0Ym94KHBhdGgsICJwZl9hdmF0YXJfdGV4dGJveCIsIGZhbHNlLCAiIiwgIjEwIGEgMTMwIGNhcmFjdGVyZXMuIEV2aXRhciB1c2FyIFVSTCdzIGRlIGdpZnMvdmlkZW9zLiIsIHsKCW1hcmdpblRvcDogIjVweCIsCgl3aWR0aDogIjk1JSIKfSwgewoJcGF0dGVybjogIl4oaHR0cHM/OlwvXC8pPyhpXC5pbWd1clwuY29tXC8pKFthLXpBLVowLTldKykoXC5qcGd8XC5qcGVnfFwucG5nKSQiLAoJbWluTGVuZ3RoOiAyMCwKCW1heExlbmd0aDogNDAsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiYnRuX3ByZXZpZXdfYXZhdGFyIiwgInByZXZpZXciLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYXZhdGFyX3RleHRib3giKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfcHJldmlldyIpLnNyYyA9IGVsZW1faXRlbS52YWx1ZTsKCX0KCWVsc2UgewoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnIoKTsKY19ocihwYXRoLCBmYWxzZSk7CgpjX2J0bihwYXRoLCAiYnRuX2NoYW5nZV9hdmF0YXIiLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2F2YXRhcl90ZXh0Ym94Iik7CgoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCXZhciB0eHRpbmZvID0gZWxlbV9pdGVtLnZhbHVlOwoJCXNfYnRuKCdjaGFuZ2VfYXZhdGFyJywgdHh0aW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gdHh0aW5mbzsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9hdmF0YXIiKS5zcmMgPSB0eHRpbmZvOwoKCQkJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CgkJCQkJZGlhbG9nLmNsb3NlKCk7CgkJCQl9CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJjYW5jZWxfYXZ0ciIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoKY19idG4ocGF0aCwgIm9wZW5kbGdkZXNjIiwgImNoYW5nZSBkZXNjcmlwdGlvbiIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY19kbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIkNhbWJpYSBsYSBkZXNjcmlwY2lvbiBkZSB0dSBwZXJmaWwuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCmNfYnIoKTsKCmNfZGlhbG9nKHBhdGgsICJkZXNjX2RsZyIpOwpwYXRoID0gImRlc2NfZGxnIjsKCmNfdGV4dGFyZWEocGF0aCwgImRlc2NyaXB0aW9uX2NvbnRlbnQiLCBmYWxzZSwgIiIsIHsKCWhlaWdodDogJzEwMHB4JywKCXJlc2l6ZTogJ25vbmUnLAoJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJd2hpdGVTcGFjZTogJ3ByZS13cmFwJywKCW1hcmdpblRvcDogIjVweCIsCglqdXN0aWZ5U2VsZjogImNlbnRlciIsCgl0ZXh0Ym94OiB7CgkJZGlzcGxheTogImluaGVyaXQiCgl9Cn0sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOSBdKiQiLAoJbWluTGVuZ3RoOiA0LAoJbWF4TGVuZ3RoOiAyNTYsCglwbGFjZWhvbGRlcjogImRlc2NyaXB0aW9uIiwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2Rlc2NyaXB0aW9uIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjcmlwdGlvbl9jb250ZW50Iik7CgoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCXZhciBkZXNjX2luZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgoJCXNfYnRuKCJjaGFuZ2VfZGVzY3JpcHRpb24iLCBkZXNjX2luZm8pCgkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJjaGFuZ2VkIikgJiYgIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygid2FpdCIpKSB7CgkJCQkJb3duX2luZm8oKTsKCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImNhbmNlbF9kZXNjIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY19kbGciKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY29uc3QgdmlydHVhbEtleXMgPSBbXTsKCmZvciAobGV0IGkgPSAweDQxOyBpIDw9IDB4NUE7IGkrKykgewoJdmlydHVhbEtleXMucHVzaCh7IGNvZGU6IGksIG5hbWU6IFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgfSk7Cn0KCmZvciAobGV0IGkgPSAweDMwOyBpIDw9IDB4Mzk7IGkrKykgewoJdmlydHVhbEtleXMucHVzaCh7IGNvZGU6IGksIG5hbWU6IFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgfSk7Cn0KCmNvbnN0IHNwZWNpYWxLZXlzID0gWwoJeyBjb2RlOiAwLCBuYW1lOiAnTk9ORScgfSwKCXsgY29kZTogMHgwOCwgbmFtZTogJ0JhY2tzcGFjZScgfSwKCXsgY29kZTogMHgwOSwgbmFtZTogJ1RhYicgfSwKCXsgY29kZTogMHgwRCwgbmFtZTogJ0VudGVyJyB9LAoJeyBjb2RlOiAweDEwLCBuYW1lOiAnU2hpZnQnIH0sCgl7IGNvZGU6IDB4MTEsIG5hbWU6ICdDdHJsJyB9LAoJeyBjb2RlOiAweDEyLCBuYW1lOiAnQWx0JyB9LAoJeyBjb2RlOiAweEE0LCBuYW1lOiAnTGVmdCBBbHQnIH0sCgl7IGNvZGU6IDB4QTUsIG5hbWU6ICdSaWdodCBBbHQnIH0sCgl7IGNvZGU6IDB4MTMsIG5hbWU6ICdQYXVzZS9CcmVhaycgfSwKCXsgY29kZTogMHg1QiwgbmFtZTogJ0xlZnQgV2luZG93cycgfSwKCXsgY29kZTogMHg1QywgbmFtZTogJ1JpZ2h0IFdpbmRvd3MnIH0sCgl7IGNvZGU6IDB4NUQsIG5hbWU6ICdBcHBsaWNhdGlvbnMnIH0sCgl7IGNvZGU6IDB4NjAsIG5hbWU6ICdOdW1QYWQgMCcgfSwKCXsgY29kZTogMHg2MSwgbmFtZTogJ051bVBhZCAxJyB9LAoJeyBjb2RlOiAweDYyLCBuYW1lOiAnTnVtUGFkIDInIH0sCgl7IGNvZGU6IDB4NjMsIG5hbWU6ICdOdW1QYWQgMycgfSwKCXsgY29kZTogMHg2NCwgbmFtZTogJ051bVBhZCA0JyB9LAoJeyBjb2RlOiAweDY1LCBuYW1lOiAnTnVtUGFkIDUnIH0sCgl7IGNvZGU6IDB4NjYsIG5hbWU6ICdOdW1QYWQgNicgfSwKCXsgY29kZTogMHg2NywgbmFtZTogJ051bVBhZCA3JyB9LAoJeyBjb2RlOiAweDY4LCBuYW1lOiAnTnVtUGFkIDgnIH0sCgl7IGNvZGU6IDB4NjksIG5hbWU6ICdOdW1QYWQgOScgfSwKCXsgY29kZTogMHg3MCwgbmFtZTogJ0YxJyB9LAoJeyBjb2RlOiAweDcxLCBuYW1lOiAnRjInIH0sCgl7IGNvZGU6IDB4NzIsIG5hbWU6ICdGMycgfSwKCXsgY29kZTogMHg3MywgbmFtZTogJ0Y0JyB9LAoJeyBjb2RlOiAweDc0LCBuYW1lOiAnRjUnIH0sCgl7IGNvZGU6IDB4NzUsIG5hbWU6ICdGNicgfSwKCXsgY29kZTogMHg3NiwgbmFtZTogJ0Y3JyB9LAoJeyBjb2RlOiAweDc3LCBuYW1lOiAnRjgnIH0sCgl7IGNvZGU6IDB4NzgsIG5hbWU6ICdGOScgfSwKCXsgY29kZTogMHg3OSwgbmFtZTogJ0YxMCcgfSwKCXsgY29kZTogMHg3QSwgbmFtZTogJ0YxMScgfSwKCXsgY29kZTogMHg3QiwgbmFtZTogJ0YxMicgfSwKCXsgY29kZTogMHgwMSwgbmFtZTogJ0xCVVRUT04nIH0sCgl7IGNvZGU6IDB4MDIsIG5hbWU6ICdSQlVUVE9OJyB9LAoJeyBjb2RlOiAweDA0LCBuYW1lOiAnTUJVVFRPTicgfSwKCXsgY29kZTogMHgwNSwgbmFtZTogJ1hCVVRUT04xJyB9LAoJeyBjb2RlOiAweDA2LCBuYW1lOiAnWEJVVFRPTjInIH0sCgl7IGNvZGU6IDB4QkIsIG5hbWU6ICc9JyB9LAoJeyBjb2RlOiAweEJDLCBuYW1lOiAnLCcgfSwKCXsgY29kZTogMHhCRCwgbmFtZTogJy0nIH0sCgl7IGNvZGU6IDB4QkUsIG5hbWU6ICcuJyB9LApdOwoKdmlydHVhbEtleXMucHVzaCguLi5zcGVjaWFsS2V5cyk7CnZpcnR1YWxLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEuY29kZSAtIGIuY29kZTsgfSk7CgpmdW5jdGlvbiBjcmVhdGVPcHRpb25FbGVtZW50KGtleUVsZW1lbnQsIGlkKSB7Cgljb25zdCBvcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CglvcHRpb25FbGVtZW50LnZhbHVlID0ga2V5RWxlbWVudC5jb2RlOwoJb3B0aW9uRWxlbWVudC50ZXh0ID0ga2V5RWxlbWVudC5uYW1lOwoJb3B0aW9uRWxlbWVudC5pZCA9IGlkICsgIl9vcHQiOwoJcmV0dXJuIG9wdGlvbkVsZW1lbnQ7Cn0KCmJpbmRfZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4gewoJY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnQudGFyZ2V0KTsKCXZpcnR1YWxLZXlzLmZvckVhY2goKGtleSkgPT4gewoJCXRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQoY3JlYXRlT3B0aW9uRWxlbWVudChrZXksIGVsZW1lbnQuaWQpKTsKCX0pOwp9KTsKCmZ1bmN0aW9uIHJfaW5mbygpIHsKCWZvciAoY29uc3QgaSBpbiB1X2Jvb2wpIHsKCQlnX2Jvb2wodV9ib29sW2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCWdfZmxvYXQodV9mbG9hdFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfaW50KSB7CgkJZ19pbnQodV9pbnRbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2ludDIpIHsKCQlnX2ludCh1X2ludDJbaV0sIGZhbHNlKTsKCX0KfQoKZnVuY3Rpb24gdV9zZXJ2ZXIoKSB7Cglmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7CgkJc19ib29sKHVfYm9vbFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfZmxvYXQpIHsKCQlzX2Zsb2F0KHVfZmxvYXRbaV0pOwoJfQp9CgpmdW5jdGlvbiBjdGFiX2ZpeChpZCwgZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSB7Cgl2YXIgZWxlbWVudG9zID0gWydlbGVtZW50X21haW4nLCAnZWxlbWVudF9rZXlzJywgJ2VsZW1lbnRfb3ZlcmxheScsICdlbGVtZW50X3NldHRpbmcnLCAnZWxlbWVudF9xcmNvZGUnXTsKCgllbGVtZW50b3MuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudG8pIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudG8pKQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50bykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCX0pOwoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5Owp9CgpmdW5jdGlvbiB0YWJfc3dpdGNoKGkgPSB0aGlzLmlkLCBwYW5lbCA9ICJjZW50ZXIiLCBkaXNwbGF5ID0gImlubGluZS1ibG9jayIpIHsKCXN3aXRjaCAocGFuZWwpIHsKCQljYXNlIDI6CgkJY2FzZSAiMiI6CgkJY2FzZSAicmlnaHQiOgoJCQlsZXQgdGFiMkJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbYy10YWIyLWJ0bl0iKTsKCQkJdGFiMkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7CgkJCQlpZiAoYnV0dG9uLmlkID09PSBpKSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwoJCQkJfSBlbHNlIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIik7CgkJCQl9CgkJCX0pOwoJCQlzd2l0Y2ggKGkpIHsKCQkJCWNhc2UgJ3BfdXBkYXRlcyc6CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAncF90aWNrZXRzJzoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdwX3Byb2ZpbGUnOgoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJncmlkIjsKCQkJCQlicmVhazsKCQkJfQoJCQlicmVhazsKCQljYXNlIDE6CgkJY2FzZSAiMSI6CgkJY2FzZSAiY2VudGVyIjoKCQkJbGV0IHRhYkJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbYy10YWItYnRuXSIpOwoJCQl0YWJCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4gewoJCQkJaWYgKGJ1dHRvbi5pZCA9PT0gaSkgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKCQkJCX0gZWxzZSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOwoJCQkJfQoJCQl9KTsKCgkJCXN3aXRjaCAoaSkgewoJCQkJY2FzZSAnbWFpbl90YWInOgoJCQkJCWN0YWJfZml4KCdlbGVtZW50X21haW4nLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ2tleXNfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9rZXlzJywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdvdmVybGF5X3RhYic6CgkJCQkJY3RhYl9maXgoJ2VsZW1lbnRfb3ZlcmxheScsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAnc2V0dGluZ3NfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9zZXR0aW5nJywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdxcmNvZGVfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9xcmNvZGUnLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJfQoJCQlicmVhazsKCX0KfQoKdGFiX3N3aXRjaCgibWFpbl90YWIiLCAiY2VudGVyIiwgIm5vbmUiKTsKCnZhciBpdGVyZm91bmQgPSAwOwp2YXIgd2FzX2dhbWVfZm91bmQgPSBmYWxzZTsKdmFyIHNob3VsZF91cGRhdGUgPSB0cnVlOwp2YXIgaXNfbW91c2VfaW5zaWRlID0gZmFsc2U7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiwgZnVuY3Rpb24gKCkgeyBpc19tb3VzZV9pbnNpZGUgPSB0cnVlOyB9KTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VsZWF2ZSIsIGZ1bmN0aW9uICgpIHsgaXNfbW91c2VfaW5zaWRlID0gZmFsc2U7IH0pOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidmlzaWJpbGl0eWNoYW5nZSIsIChldmVudCkgPT4gewoJc2hvdWxkX3VwZGF0ZSA9IChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT0gInZpc2libGUiKTsKfSk7Cgp2YXIgdXBkYXRlcnQgPSBzZXRJbnRlcnZhbChhc3luYyBmdW5jdGlvbiAoKSB7CglpZiAoYWxsb3dfYXUgJiYgc2hvdWxkX3VwZGF0ZSAmJiBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJYXdhaXQgbGl2ZV9zZXJ2ZXIoKTsKCX0KfSwgNTAwMCk7CgpzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CglpZiAoZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgIT0gIm5vbmUiICYmIGlzX21vdXNlX2luc2lkZSkgewoJCXVfY2hhdCgpOwoJCWdfb25saW5lcygpOwoJfQp9LCAyMDAwKTsKCmFzeW5jIGZ1bmN0aW9uIGdhdGhlcihpbmZvLCBleHRyYSwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0pIHsKCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJJC5nZXQoIi90b2dnbGU/ZmVhdHVyZT0iICsgaW5mbyArICImdmFsPSIgKyBleHRyYSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJcmVqZWN0KGVycm9yKTsKCQl9KTsKCX0pOwp9CgpmdW5jdGlvbiB6aW5jX2luZm8oaW5mbywgZXh0cmEpIHsKCSQuZ2V0KCIvZ19pbmZvP2luZm89IiArIGluZm8sIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykgIT0gdW5kZWZpbmVkKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLmlubmVySFRNTCA9IGV4dHJhICsgcmVzcG9uc2VUZXh0OwoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQl9Cgl9KTsKfQoKdmFyIHdhaXRpbmcgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgkkLmdldCgiL2dfaW5mbz9pbmZvPWdhbWVmb3VuZCIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQl3YXNfZ2FtZV9mb3VuZCA9IHBhcnNlSW50KHJlc3BvbnNlVGV4dCk7CgkJaWYgKCF3YXNfZ2FtZV9mb3VuZCkgewoJCQl6aW5jX2luZm8oIndhaXRpbmdfZ2FtZSIsICJpbnRpYWxpemluZzxicj5jbG9zaW5nIGluOiAiKTsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfZGF5cyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2J1dHRvbnMiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9tYWluIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfY29uZmlnIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJdGFiX3N3aXRjaCgibWFpbl90YWIiLCAiY2VudGVyIiwgIm5vbmUiKTsKCQl9CgkJZWxzZSB7CgkJCWl0ZXJmb3VuZCsrOwoKCQkJaWYgKGl0ZXJmb3VuZCA+IDIpIHsKCQkJCXppbmNfaW5mbygidXNlcl9kYXlzIiwgImRheXMgbGVmdDogIik7CgkJCQl6aW5jX2luZm8oImxhc3RfdXBkYXRlIiwgIjxzdHJvbmc+VXBkYXRlZDwvc3Ryb25nPjogIik7CgkJCQl6aW5jX2luZm8oImNoYW5nZWxvZ3MiLCAiPHN0cm9uZz5DaGFuZ2Vsb2dzPC9zdHJvbmc+OiAiKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YWl0aW5nX2dhbWUiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfYnV0dG9ucyIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9tYWluIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9jb25maWciKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCXRhYl9zd2l0Y2goIm1haW5fdGFiIik7CgkJCQl0YWJfc3dpdGNoKCJwX3VwZGF0ZXMiLCAyKTsKCQkJCWNsZWFySW50ZXJ2YWwod2FpdGluZyk7CgkJCX0KCQl9Cgl9KQp9LCAyNTApOwoKdmFyIHJ1bm5pbmcgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7Cgl0cnkgewoJCSQuZ2V0KCIvZ19pbmZvP2luZm89cnVubmluZyIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY19leGl0KCk7CgkJfSk7Cgl9IGNhdGNoIChlcnJvcikgewoJCWNvbnNvbGUubG9nKGVycm9yKTsKCQlhbGVydChlcnJvcik7CgkJY19leGl0KCk7Cgl9Cn0sIDUwMDApOwoKZnVuY3Rpb24gY19kaWFsb2coaWRfd2hlcmUsIGlkX2l0ZW0sIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF9pdGVtKSkgewoJCWNvbnNvbGUubG9nKCJlbGVtZW50IGV4aXN0IHdpdGggaWQ6ICIsIGlkX2l0ZW0pCgkJcmV0dXJuOwoJfQoKCWNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpYWxvZyIpOwoJZGlhbG9nLmlkID0gaWRfaXRlbTsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihkaWFsb2cuc3R5bGUsIHN0eWxleik7Cgl9CgoJaWYgKGVsZW1udCkgewoJCWZvciAobGV0IGtleSBpbiBlbGVtbnQpIHsKCQkJY29uc3QgZWxlbWVudCA9IGVsZW1udFtrZXldOwoJCQljb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZWxlbWVudC50eXBlKTsKCQkJT2JqZWN0LmFzc2lnbihlbCwgZWxlbWVudC5wcm9wcyk7CgkJCU9iamVjdC5hc3NpZ24oZWwuc3R5bGUsIGVsZW1lbnQuc3R5bGVzKTsKCQkJZGlhbG9nLmFwcGVuZENoaWxkKGVsKTsKCQl9Cgl9CgoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpLmFwcGVuZENoaWxkKGRpYWxvZyk7Cn0KCmZ1bmN0aW9uIGNfZGl2KGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWRpdi5pZCA9IGlkX2l0ZW07CglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihkaXYsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWRpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihkaXYuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7Cn0KCmZ1bmN0aW9uIGNfdGFiX2J1dHRvbihpZF93aGVyZSwgYnV0dG9ucywgdHlwZXogPSAxKSB7Cgljb25zdCB0YWJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgoJYnV0dG9ucy5mb3JFYWNoKGZ1bmN0aW9uIChidXR0b24sIGluZGV4KSB7CgkJdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJCWJ0bi5jbGFzc05hbWUgPSAidGFiLWJ1dHRvbiI7CgkJYnRuLnNldEF0dHJpYnV0ZSh0eXBleiA9PSAxID8gImMtdGFiLWJ0biIgOiAoImMtdGFiIiArIHR5cGV6ICsgIi1idG4iKSwgIiIpOwoJCWJ0bi5pZCA9IGJ1dHRvbi5pZDsKCQlidG4uaW5uZXJIVE1MID0gYnV0dG9uLnRleHQ7CgoJCWlmIChpbmRleCA9PT0gMCkgewoJCQlidG4uc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMgPSAiMHB4IjsKCQl9IGVsc2UgaWYgKGluZGV4ID09PSBidXR0b25zLmxlbmd0aCAtIDEpIHsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcExlZnRSYWRpdXMgPSAiMHB4IjsKCQl9IGVsc2UgewoJCQlidG4uc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMgPSAiMHB4IjsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcExlZnRSYWRpdXMgPSAiMHB4IjsKCQl9CgoJCWJ0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCQl0YWJfc3dpdGNoKHRoaXMuaWQsIHR5cGV6KTsKCQl9OwoKCQl0YWJDb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTsKCX0pOwp9CgpmdW5jdGlvbiBnX3RtX2R0KHRpbWVzdGFtcCwgaHJtaW4gPSAxKSB7Cgl2YXIgZGF0ZSA9IG5ldyBEYXRlKCt0aW1lc3RhbXAgKiAxMDAwKTsKCWlmIChocm1pbiA9PSAxKSB7CgkJdmFyIGhvdXIgPSAoIjAiICsgZGF0ZS5nZXRIb3VycygpKS5zdWJzdHIoLTIpOwoJCXZhciBtaW51dGVzID0gKCIwIiArIGRhdGUuZ2V0TWludXRlcygpKS5zdWJzdHIoLTIpOwoJCXJldHVybiAoaG91ciArICI6IiArIG1pbnV0ZXMpOwoJfQoJZWxzZSBpZiAoaHJtaW4gPT0gMikgewoJCXZhciBob3VyID0gKCIwIiArIGRhdGUuZ2V0SG91cnMoKSkuc3Vic3RyKC0yKTsKCQl2YXIgbWludXRlcyA9ICgiMCIgKyBkYXRlLmdldE1pbnV0ZXMoKSkuc3Vic3RyKC0yKTsKCQl2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQl2YXIgbW9udGggPSAoIjAiICsgKGRhdGUuZ2V0TW9udGgoKSArIDEpKS5zdWJzdHIoLTIpOwoJCXZhciBkYXkgPSAoIjAiICsgZGF0ZS5nZXREYXRlKCkpLnN1YnN0cigtMik7CgkJcmV0dXJuICAoZGF5ICsgIi8iICsgbW9udGggKyAiLyIgKyB5ZWFyKSsgIiAtICIgKyhob3VyICsgIjoiICsgbWludXRlcykgOwoJfQoJZWxzZSB7CgkJdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJdmFyIG1vbnRoID0gKCIwIiArIChkYXRlLmdldE1vbnRoKCkgKyAxKSkuc3Vic3RyKC0yKTsKCQl2YXIgZGF5ID0gKCIwIiArIGRhdGUuZ2V0RGF0ZSgpKS5zdWJzdHIoLTIpOwoJCXJldHVybiAoZGF5ICsgIi8iICsgbW9udGggKyAiLyIgKyB5ZWFyKTsKCX0KfQoKZnVuY3Rpb24gY19idG4oaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCWJ1dHRvbi50eXBlID0gImJ1dHRvbiI7CglidXR0b24uY2xhc3NMaXN0LmFkZCgibmV3YnV0dG9uIik7CglidXR0b24uaWQgPSBpZF9pdGVtOwoJYnV0dG9uLmlubmVySFRNTCA9IHRleHQ7CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oYnV0dG9uLCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oYnV0dG9uLnN0eWxlLCBzdHlsZXopOwoJfQoKCWJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCWZ1bmMyKGJ1dHRvbik7Cgl9OwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7Cn0KCmZ1bmN0aW9uIGNfaHIoaWRfd2hlcmUgPSBwYXRoLCBtYXJnaW4gPSB0cnVlLCBzdHlsZXogPSB7fSkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJdmFyIGhyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHIiKTsKCWlmIChtYXJnaW4pCgkJaHIuc3R5bGUubWFyZ2luTGVmdCA9ICItMjBweCI7CgoJaHIuc3R5bGUuYm9yZGVyID0gIjBweCI7Cgloci5zdHlsZS5ib3JkZXJUb3AgPSAiMXB4IHNvbGlkIHZhcigtLWMtaHIpIjsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihoci5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoaHIpOwp9CgpmdW5jdGlvbiBjX2JyKGlkX3doZXJlID0gcGF0aCwgYW1vdW50ID0gMSkgewoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGFtb3VudDsgaW5kZXgrKykgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKCX0KfQoKZnVuY3Rpb24gY19jaGVja2JveChpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgdG9vbHRpcCA9ICIiLCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdlbGVtaXRlbXNfYmcnKTsKCWRpdi5odG1sRm9yID0gaWRfaXRlbTsKCWRpdi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1mbGV4IjsKCgljb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgljaGVja2JveC50eXBlID0gImNoZWNrYm94IjsKCWNoZWNrYm94LmlkID0gaWRfaXRlbTsKCWNoZWNrYm94Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXVfc2VydmVyKCk7CgkJZnVuYzIoY2hlY2tib3gpOwoJfTsKCgljb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CglsYWJlbC5odG1sRm9yID0gaWRfaXRlbTsKCWxhYmVsLmlubmVySFRNTCA9IHRleHQ7CglsYWJlbC5pZCA9IGlkX2l0ZW0gKyAienp6enoiOwoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCglkaXYuYXBwZW5kQ2hpbGQoY2hlY2tib3gpOwoJZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlfdG9vbHRpcC5jbGFzc05hbWUgPSAiZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTIiOwoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCQlpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCWlfdG9vbHRpcC5zdHlsZS5mb250V2VpZ2h0ID0gIjkwMCI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRTaXplID0gIjE1cHgiOwoJCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CgkJaV90b29sdGlwLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7Cgl9CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaV90b29sdGlwKTsKCX0KCgl1X2Jvb2wucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19zX2Zsb2F0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBtaW4sIG1heCwgc3RlcF92YWwsIGRlZmF1bHRfdmFsLCB0b29sdGlwKSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJdmFyIHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHN0ZXBfdmFsKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsKCXN0ZXB2YWxfY2Vyb3MgPSBzdGVwdmFsX2Nlcm9zLmxlbmd0aDsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAnZl9zbGlkZXJfYmcnKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4JywgbWF4KTsKCWRpdi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1mbGV4IjsKCgljb25zdCB0aXRsZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJdGl0bGVEaXYuY2xhc3NMaXN0LmFkZCgnbF90aXRsZScsICdmX3RpdGxlJyk7Cgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgZGVmYXVsdF92YWwpOwoJdGl0bGVEaXYudGV4dENvbnRlbnQgPSB0ZXh0ICsgIjogIjsKCgljb25zdCBudW1iZXJfaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJbnVtYmVyX2lucHV0LmNsYXNzTGlzdC5hZGQoIm51bWJlcnNsaWRlciIpOwoJbnVtYmVyX2lucHV0LnR5cGUgPSAibnVtYmVyIjsKCW51bWJlcl9pbnB1dC5wYXR0ZXJuID0gIlswLTldKiI7CgludW1iZXJfaW5wdXQuaW5wdXRNb2RlID0gIm51bWVyaWMiOwoJbnVtYmVyX2lucHV0LmlkID0gaWRfaXRlbTsKCW51bWJlcl9pbnB1dC5taW4gPSBtaW47CgludW1iZXJfaW5wdXQubWF4ID0gbWF4OwoJbnVtYmVyX2lucHV0LnN0ZXAgPSBzdGVwX3ZhbDsKCW51bWJlcl9pbnB1dC52YWx1ZSA9IGRlZmF1bHRfdmFsOwoJbnVtYmVyX2lucHV0Lm9uaW5wdXQgPSBmdW5jdGlvbiAoKSB7CgkJdV9zZXJ2ZXIoKTsKCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJfTsKCgljb25zdCBtaW51c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCW1pbnVzX2J0bi5jbGFzc0xpc3QuYWRkKCJjb250cm9scy1udW1iZXIiKTsKCW1pbnVzX2J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgltaW51c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJbWludXNfYnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CgltaW51c19idG4uaW5uZXJIVE1MID0gKCImIzg3MjI7IikudHJpbSgpOwoJbWludXNfYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDAsIG1pbiwgbWF4LCAxLCBzdGVwdmFsX2Nlcm9zKTsKCQl1X3NlcnZlcigpOwoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7Cgl9OwoKCWNvbnN0IHBsdXNfYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CglwbHVzX2J0bi5jbGFzc0xpc3QuYWRkKCJjb250cm9scy1udW1iZXIiKTsKCXBsdXNfYnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCXBsdXNfYnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCXBsdXNfYnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CglwbHVzX2J0bi5pbm5lckhUTUwgPSAoIiYjNDM7IikudHJpbSgpOwoJcGx1c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMSwgbWluLCBtYXgsIDEsIHN0ZXB2YWxfY2Vyb3MpOwoJCXVfc2VydmVyKCk7CgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCX07CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTsKCWRpdi5hcHBlbmRDaGlsZChtaW51c19idG4pOwoJZGl2LmFwcGVuZENoaWxkKG51bWJlcl9pbnB1dCk7CglkaXYuYXBwZW5kQ2hpbGQocGx1c19idG4pOwoKCWNvbnN0IGlfdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImkiKTsKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaV90b29sdGlwLmNsYXNzTmFtZSA9ICJmYSBmYS1xdWVzdGlvbi1jaXJjbGUgZmEtMiI7CgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwoJCWlfdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRXZWlnaHQgPSAiOTAwIjsKCQlpX3Rvb2x0aXAuc3R5bGUuZm9udFNpemUgPSAiMTVweCI7CgkJaV90b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAiMC41IjsKCQlpX3Rvb2x0aXAuc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoKCQlpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpX3Rvb2x0aXApOwoJfQoKCXVfZmxvYXQucHVzaChpZF9pdGVtKTsKfQoKZnVuY3Rpb24gY19pbWcoaWRfd2hlcmUsIGlkX2l0ZW0sIGltYWdlLCB3aWR0aCwgaGVpZ2h0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKCglpbWcuc2V0QXR0cmlidXRlKCdpZCcsIGlkX2l0ZW0pOwoJaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1hZ2UpOwoJaW1nLnNldEF0dHJpYnV0ZSgnYWx0JywgInVfYXZhdGFyIik7CglpbWcuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGhlaWdodCk7CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oaW1nLCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlpbWcuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oaW1nLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbWcpOwp9CgpmdW5jdGlvbiBjX3RleHRhcmVhKGlkX3doZXJlLCBpZF9pdGVtLCBoaWRkZW4gPSBmYWxzZSwgbGFiZWwgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgdGV4dGJveF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Ym94Iik7CgoJCWNvbnN0IGxhYmVsRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CgkJbGFiZWxFbGVtLnRleHRDb250ZW50ID0gbGFiZWwudHJpbSgpOwoJCWxhYmVsRWxlbS5pZCA9IGlkX2l0ZW0gKyAibGJsIjsKCQlsYWJlbEVsZW0uc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoJCWxhYmVsRWxlbS5zZXRBdHRyaWJ1dGUoImZvciIsIGlkX2l0ZW0pOwoKCQlpZiAoc3R5bGV6ICYmIHN0eWxlei5sYWJlbHopIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LmxhYmVseik7CgkJfQoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7Cgl9CgoJY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwoKCXRleHRhcmVhLmlkID0gaWRfaXRlbTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0YXJlYSwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHRleHRhcmVhLnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRib3gpIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCX0KCX0KCglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJfSBlbHNlIHsKCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAobGFiZWwgPT09ICIiICYmIGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7Cgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Ym94X2Rpdik7Cgl9Cn0KCmZ1bmN0aW9uIGNfdGV4dGJveChpZF93aGVyZSwgaWRfaXRlbSwgaGlkZGVuID0gZmFsc2UsIGxhYmVsID0gIiIsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9LCBkaXNhYmxlc3R5bGUgPSBmYWxzZSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsKCgkJY29uc3QgbGFiZWxFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQlsYWJlbEVsZW0udGV4dENvbnRlbnQgPSBsYWJlbC50cmltKCk7CgkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOwoJCWxhYmVsRWxlbS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgkJbGFiZWxFbGVtLnNldEF0dHJpYnV0ZSgiZm9yIiwgaWRfaXRlbSk7CgoJCWlmIChzdHlsZXogJiYgc3R5bGV6LmxhYmVseikgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsKCQl9CgoJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7Cgl9CgoJY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQiKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZF9pdGVtKTsKCglpZiAoZGlzYWJsZXN0eWxlKQoJCWlucHV0LnNldEF0dHJpYnV0ZSgnZGF0YS1ub3ZhbGlkaW52YWxpZCcsICcnKTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlucHV0LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCkKCX0KCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihpbnB1dCwgZWxlbW50KTsKCgkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uIChldikgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcywgZXYpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaW5wdXQuc3R5bGUuZGlzcGxheSA9IGhpZGRlbiA/ICJub25lIiA6ICJpbmxpbmUtYmxvY2siOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGlucHV0LnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRib3gpIHsKCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCX0KCX0KCglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJfSBlbHNlIHsKCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAobGFiZWwgPT09ICIiICYmIGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7Cgl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0Ym94X2Rpdik7Cgl9Cn0KCmZ1bmN0aW9uIGNfdGFibGUoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRhYmxlIik7CgoJaWYgKHRleHQgIT0gIiIpCgkJdGV4dF9kaXYuaW5uZXJIVE1MID0gdGV4dC50cmltKCk7CgoJdGV4dF9kaXYuaWQgPSBpZF9pdGVtOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQl0ZXh0X2Rpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2Rpdi5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwp9CgpmdW5jdGlvbiBjX3RleHQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKCXRleHRfZGl2LmNsYXNzTGlzdC5hZGQoInRleHQiKTsKCglpZiAodGV4dCkKCQl0ZXh0X2Rpdi5pbm5lckhUTUwgPSB0ZXh0LnRyaW0oKTsKCgl0ZXh0X2Rpdi5pZCA9IGlkX2l0ZW07CgoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24odGV4dF9kaXYsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCXRleHRfZGl2LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0X2Rpdik7Cn0KCmZ1bmN0aW9uIGNfY29tYm9ib3gyKGlkX3doZXJlLCBpZF9pdGVtLCBvcHRpb25zLCBoaWRkZW4gPSBmYWxzZSwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSkgewoKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCW9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4gewoJCWNvbnN0IG9wdGlvbl9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CgkJb3B0aW9uX2VsZW0udmFsdWUgPSBpbmRleDsKCQlvcHRpb25fZWxlbS50ZXh0ID0gb3B0aW9uOwoJCXNlbGVjdF9lbGVtLmFkZChvcHRpb25fZWxlbSk7Cgl9KTsKCglzZWxlY3RfZWxlbS5zdHlsZS5kaXNwbGF5ID0gKChoaWRkZW4gPT0gdHJ1ZSkgPyAoIm5vbmUiKSA6ICgiaW5saW5lLWJsb2NrIikpOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3RfZWxlbSk7Cn0KCmZ1bmN0aW9uIGNfY29tYm9ib3goaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzYW1lbGluZSA9IGZhbHNlLCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSwgc3R5bGV6ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKHRleHQgIT0gIiIpIHsKCQl0ZXh0X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Iik7CgkJdGV4dF9kaXYudGV4dENvbnRlbnQgPSB0ZXh0LnRyaW0oKTsKCX0KCgljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CglzZWxlY3RfZWxlbS5pZCA9IGlkX2l0ZW07CglzZWxlY3RfZWxlbS5zdHlsZS5oZWlnaHQgPSAiNDJweCI7CgoJaWYgKHNhbWVsaW5lKQoJCXNlbGVjdF9lbGVtLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjEwcHgiOwoKCXNlbGVjdF9lbGVtLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJZnVuYzIoc2VsZWN0X2VsZW0pOwoJfTsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6KTsKCgkJaWYgKHN0eWxlei50ZXh0X2RpdikgewoJCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXoudGV4dF9kaXYpOwoJCX0KCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglpZiAodGV4dCAhPSAiIikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0X2Rpdik7Cgl9Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZWN0X2VsZW0pOwoKCWNvbnN0IGlfdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImkiKTsKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaV90b29sdGlwLmNsYXNzTmFtZSA9ICJmYSBmYS1xdWVzdGlvbi1jaXJjbGUgZmEtMiI7CgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwoJCWlfdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgkJaV90b29sdGlwLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQlpX3Rvb2x0aXAuc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiCgkJaV90b29sdGlwLnN0eWxlLmZvbnRXZWlnaHQgPSAiOTAwIjsKCQlpX3Rvb2x0aXAuc3R5bGUuZm9udFNpemUgPSAiMTVweCI7CgkJaV90b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAiMC41IjsKCgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlfdG9vbHRpcCk7Cgl9CgoJdV9pbnQyLnB1c2goaWRfaXRlbSk7Cn0KCmZ1bmN0aW9uIGNfc19pbnQoaWRfd2hlcmUsIGlkX2l0ZW0sIGlkX3RleHQsIG1pbiwgbWF4LCBzdGVwLCB2YWx1ZSwgdG9vbHRpcCA9ICIiKSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdyX3NsaWRlcl9iZycpOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1taW4nLCBtaW4pOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoJZGl2LnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWZsZXgiOwoKCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsKCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCB2YWx1ZSk7Cgl0aXRsZURpdi50ZXh0Q29udGVudCA9IGlkX3RleHQgKyAiOiAiOwoKCWNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCgljb25zdCBtaW51c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJbWludXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7CgltaW51c0J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgltaW51c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CgltaW51c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJbWludXNCdG4uaW5uZXJIVE1MID0gKCImIzg3MjI7IikudHJpbSgpOwoJbWludXNCdG4ub25jbGljayA9ICgpID0+IHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgpOwoJCXNfaW50MihpZF9pdGVtLCBtaW4sIG1heCk7CgkJYXBwbHlGaWxsKGlucHV0KTsKCX07CgoJY29uc3QgcGx1c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJcGx1c0J0bi5jbGFzc05hbWUgPSAiY29udHJvbHMtbnVtYmVyIjsKCXBsdXNCdG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJcGx1c0J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CglwbHVzQnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CglwbHVzQnRuLmlubmVySFRNTCA9ICgiJiM0MzsiKS50cmltKCk7CglwbHVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDEsIG1pbiwgbWF4KTsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWlucHV0LmNsYXNzTGlzdC5hZGQoJ3NsaWRlcicpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3JhbmdlJyk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21pbicsIG1pbik7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ21heCcsIG1heCk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3N0ZXAnLCBzdGVwKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCB2YWx1ZSk7CglpbnB1dC5vbmNoYW5nZSA9ICgpID0+IHsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7CglkaXYuYXBwZW5kQ2hpbGQobWludXNCdG4pOwoJZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKCWRpdi5hcHBlbmRDaGlsZChwbHVzQnRuKTsKCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgljb25zdCBpX3Rvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpIik7CglpZiAodG9vbHRpcCAhPSAiIikgewoJCWlfdG9vbHRpcC5jbGFzc05hbWUgPSAiZmEgZmEtcXVlc3Rpb24tY2lyY2xlIGZhLTIiOwoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKCQlpX3Rvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJCWlfdG9vbHRpcC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJaV90b29sdGlwLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IgoJCWlfdG9vbHRpcC5zdHlsZS5mb250V2VpZ2h0ID0gIjkwMCI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRTaXplID0gIjE1cHgiOwoJCWlfdG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gIjAuNSI7CgoJCWlfdG9vbHRpcC5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpX3Rvb2x0aXApOwoJfQoKCXVfaW50LnB1c2goaWRfaXRlbSk7Cn0KCmNvbnN0IHNsaWRlclByb3BzID0gewoJYmFja2dyb3VuZDogInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yMTQpIiwKfTsKCmZ1bmN0aW9uIHVfc2xpZGVycygpIHsKCWNvbnN0IHNsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucl9zbGlkZXJfYmciKTsKCglzbGlkZXJzLmZvckVhY2goKHNsaWRlcikgPT4gewoJCWNvbnN0IHNsaWRlcklucHV0ID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoIi5zbGlkZXIiKTsKCQljb25zdCBzbGlkZXJWYWx1ZSA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpOwoKCQlzbGlkZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChldmVudCkgPT4gewoJCQlzbGlkZXJWYWx1ZS5zZXRBdHRyaWJ1dGUoImRhdGEtbGVuZ3RoIiwgZXZlbnQudGFyZ2V0LnZhbHVlKTsKCQkJYXBwbHlGaWxsKGV2ZW50LnRhcmdldCk7CgkJfSk7CgoJCWFwcGx5RmlsbChzbGlkZXJJbnB1dCk7Cgl9KTsKCgljb25zdCBmX3NsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuZl9zbGlkZXJfYmciKTsKCglmX3NsaWRlcnMuZm9yRWFjaChhc3luYyAoc2xpZGVyKSA9PiB7CgkJY29uc3Qgc2xpZGVySW5wdXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLm51bWJlcnNsaWRlciIpOwoKCQlsZXQgc3RlcHZhbF9jZXJvcyA9IChTdHJpbmcoc2xpZGVySW5wdXQuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJCWFwcGx5RmlsbChzbGlkZXJJbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcy5sZW5ndGgsIHNsaWRlcklucHV0LnZhbHVlKTsKCX0pOwp9CgpmdW5jdGlvbiBhcHBseUZpbGwoc2xpZGVyLCBpc19mbHQgPSBmYWxzZSwgZmx0cGFyc2UgPSAxLCB2YWx1ZSkgewoJaWYgKGlzX2ZsdCkgewoJCXNsaWRlci5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoIi5sX3RpdGxlIikuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIHBhcnNlRmxvYXQodmFsdWUpLnRvRml4ZWQoZmx0cGFyc2UpKTsKCQlzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IHNsaWRlclByb3BzLmJhY2tncm91bmQ7CgkJc2xpZGVyLnN0eWxlLmNvbG9yID0gJ3ZhcigtLWMtdGV4dCknOwoJCXNsaWRlci5zdHlsZS5ib3JkZXJSYWRpdXMgPSAiNXB4IjsKCQlzbGlkZXIuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCB2YXIoLS1jLWNvbnRvcm5vcykiOwoJCXJldHVybjsKCX0KCgljb25zdCBwZXJjZW50YWdlID0gKCgxMDAgKiAoc2xpZGVyLnZhbHVlIC0gc2xpZGVyLm1pbikpIC8gKHNsaWRlci5tYXggLSBzbGlkZXIubWluKSkudG9GaXhlZCgxKTsKCWNvbnN0IGJnID0gYGxpbmVhci1ncmFkaWVudCg5MGRlZywgdmFyKC0tYy1wcmltYXJ5KSAwJSwgdmFyKC0tYy1zZWNvbmRhcnkpICR7cGVyY2VudGFnZX0lLCAke3NsaWRlclByb3BzLmJhY2tncm91bmR9ICR7cGVyY2VudGFnZX0lLCAke3NsaWRlclByb3BzLmJhY2tncm91bmR9IDEwMCUpYDsKCXNsaWRlci5zdHlsZS5iYWNrZ3JvdW5kID0gYmc7CglzbGlkZXIucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBzbGlkZXIudmFsdWUpOwp9CgpmdW5jdGlvbiBzdW1yZXN0X2J1dHRvbnMoaXRlbV9pZCwgc3VtLCBtaW4sIG1heCwgaXNfZmx0ID0gMCwgZmx0cGFyc2UgPSAxKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkgPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2coaXRlbV9pZCwgImRvZXNudCBleGlzdCIpOwoJCXJldHVybjsKCX0KCglpZiAoaXNfZmx0KSB7CgkJaWYgKHN1bSkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQl9IGVsc2UgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPCBtaW4pCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgLSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQl9Cgl9CgllbHNlIHsKCQlpZiAoc3VtKSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA+IG1heCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VJbnQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSArIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCk7CgkJfSBlbHNlIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUludChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQl9Cgl9Cn0KCndpbmRvdy5tb2JpbGVDaGVjayA9IGZ1bmN0aW9uICgpIHsKCWxldCBjaGVjayA9IGZhbHNlOwoJKGZ1bmN0aW9uIChhKSB7IGlmICgvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIGNoZWNrID0gdHJ1ZTsgfSkobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7CglyZXR1cm4gY2hlY2s7Cn07Cgp3aW5kb3cuc3RlYW1DaGVjayA9IGZ1bmN0aW9uICgpIHsKCWxldCB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7CglsZXQgaXNTdGVhbUJyb3dzZXIgPSB1c2VyQWdlbnQuaW5kZXhPZigic3RlYW0iKSA+IC0xOwoJcmV0dXJuIGlzU3RlYW1Ccm93c2VyOwp9OwoKaWYgKCF3aW5kb3cubW9iaWxlQ2hlY2soKSkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gInNjYW4gb24gbW9iaWxlIG9yIGVudGVyOiAiICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiBvbiB5b3VyIG1vYmlsZSBicm93c2VyIjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3JjID0gImh0dHBzOi8vY2hhcnQuZ29vZ2xlYXBpcy5jb20vY2hhcnQ/Y2h0PXFyJmNobD0iICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiZjaHM9MjUweDI1MCZjaGxkPUx8MCI7CgoJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQlpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJCXRfcGFuZWwoJ2xlZnRfcGFuZWwnKTsKCQkJdF9wYW5lbCgpOwoJCX0KCQllbHNlIHsKCQkJaWYgKHdpbmRvdy5zdGVhbUNoZWNrKCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsKCgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfSwgMjUwKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS53aWR0aCA9ICIwcHgiOwoKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0sIDI1MCk7CgoJCQkJbm90aWZ5KCJwYW5lbHMgZGlzYWJsZWQgb24gc3RlYW0uIik7CgkJCX0gZWxzZSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfSwgMjUwKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAxOwoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0sIDI1MCk7CgkJCX0KCQl9Cgl9Owp9CmVsc2UgewoJZG9jdW1lbnQuYm9keS5zdHlsZS56b29tID0gIjc1JSI7Cgl0X3BhbmVsKCdsZWZ0X3BhbmVsJyk7Cgl0X3BhbmVsKCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJjb2RlX3RleHQiKS5pbm5lckhUTUwgPSAib25seSBvbiBwYyIudHJpbSgpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyaW1hZ2UiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwp9CgpmdW5jdGlvbiBzdHJpbmcyYm9vbChzdHJpbmcpIHsKCXN3aXRjaCAoc3RyaW5nLnRvTG93ZXJDYXNlKCkudHJpbSgpKSB7CgkJY2FzZSAidHJ1ZSI6CgkJY2FzZSAieWVzIjoKCQljYXNlICIxIjoKCQkJcmV0dXJuIHRydWU7CgkJY2FzZSAiZmFsc2UiOgoJCWNhc2UgIm5vIjoKCQljYXNlICIwIjoKCQljYXNlIG51bGw6CgkJCXJldHVybiBmYWxzZTsKCQlkZWZhdWx0OgoJCQlyZXR1cm4gQm9vbGVhbihzdHJpbmcpOwoJfQp9CgpmdW5jdGlvbiBnX2Jvb2wobW9kdWxlKSB7CgkkLmdldCgiL2dfYm9vbD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuY2hlY2tlZCA9IHN0cmluZzJib29sKHJlc3BvbnNlVGV4dCk7CgoJCWlmICghdV9hbF9ib29sLmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCQl1X2FsX2Jvb2wucHVzaChtb2R1bGUpOwoJCX0KCX0pOwp9CgpmdW5jdGlvbiBnX2ludChtb2R1bGUsIHJldHVybmVkID0gdHJ1ZSkgewoJJC5nZXQoIi9nX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSByZXNwb25zZVRleHQ7CgoJCWlmIChtb2R1bGUuaW5jbHVkZXMoInRoZW1lX3NlbGVjdCIpKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsKCQl9CgoJCWlmIChyZXR1cm5lZCkgewoJCQlpZiAoIXVfYWxfaW50LmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoJCQkJdV9hbF9pbnQucHVzaChtb2R1bGUpOwoJCQl9CgoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdfZmxvYXQobW9kdWxlKSB7CgkkLmdldCgiL2dfZmxvYXQ/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQl2YXIgc3RlcHZhbF9jZXJvczIgPSAoU3RyaW5nKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSBwYXJzZUZsb2F0KHJlc3BvbnNlVGV4dCkudG9GaXhlZChzdGVwdmFsX2Nlcm9zMi5sZW5ndGgpOwoKCQlpZiAoIXVfYWxfZmxvYXQuaW5jbHVkZXMobW9kdWxlKSkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJpbnB1dCIpKTsKCQkJdV9hbF9mbG9hdC5wdXNoKG1vZHVsZSk7CgkJfQoKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZTsKCX0pOwp9CgpmdW5jdGlvbiBzX2Jvb2wobW9kdWxlKSB7CglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKQoJCXJldHVybjsKCX0KCXZhciB2YWx1ZSA9IG1vZHVsZXouY2hlY2tlZDsKCgkkLmdldCgiL3NfYm9vbD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgfSk7Cn0KCmZ1bmN0aW9uIHNfaW50Mihtb2R1bGUsIG1pbiA9IDAsIG1heCA9IDApIHsKCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKG1vZHVsZSArICIgbm90IGZvdW5kIik7CgkJcmV0dXJuOwoJfQoKCXZhciB2YWx1ZSA9IG1vZHVsZXoudmFsdWU7CgoJaWYgKG1pbiA9PSAwICYmIG1heCA9PSAwKSB7CgkJJC5nZXQoIi9zX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJdmFyIGVsZW1lbnRFeGlzdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpOwoJCQlpZiAoZWxlbWVudEV4aXN0cyAhPSB1bmRlZmluZWQgfHwgZWxlbWVudEV4aXN0cyAhPSBudWxsKQoJCQkJZWxlbWVudEV4aXN0cy5pbm5lckhUTUwgPSByZXNwb25zZVRleHQ7CgkJfSk7Cgl9IGVsc2UgewoJCWlmIChwYXJzZUludCh2YWx1ZSkgPj0gcGFyc2VJbnQobWluKSAmJiBwYXJzZUludCh2YWx1ZSkgPD0gcGFyc2VJbnQobWF4KSkgewoJCQkkLmdldCgiL3NfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJdmFyIGVsZW1lbnRFeGlzdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpOwoJCQkJaWYgKGVsZW1lbnRFeGlzdHMgIT0gdW5kZWZpbmVkIHx8IGVsZW1lbnRFeGlzdHMgIT0gbnVsbCkKCQkJCQllbGVtZW50RXhpc3RzLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsKCQkJfSk7CgkJfQoJCWVsc2UgewoJCQljb25zb2xlLmxvZygibWlubWF4IG92ZXJwYXNzZWQgfCAiLCB2YWx1ZSwgbWluLCBtYXgpOwoJCX0KCX0KfQoKZnVuY3Rpb24gc19mbG9hdChtb2R1bGUpIHsKCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpCgkJcmV0dXJuOwoJfQoKCXZhciB2YWx1ZSA9IHBhcnNlRmxvYXQobW9kdWxlei52YWx1ZSk7Cgl2YXIgbWluID0gcGFyc2VGbG9hdChtb2R1bGV6Lm1pbik7Cgl2YXIgbWF4ID0gcGFyc2VGbG9hdChtb2R1bGV6Lm1heCk7CgoJaWYgKHZhbHVlID49IG1pbiAmJiB2YWx1ZSA8PSBtYXgpIHsKCQkkLmdldCgiL3NfZmxvYXQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCX0pOwoJfQp9CgpmdW5jdGlvbiBzX2luZm8obW9kdWxlLCB2YWx1ZSwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0pIHsKCSQuZ2V0KCIvc19pbmZvP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWZ1bmMyKCk7Cgl9KTsKfQoKZnVuY3Rpb24gZ1JuZElkKGxlbmd0aCA9IDgpIHsKCXZhciBpZCA9ICcnOwoJdmFyIGNoYXJhY3RlcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknOwoJdmFyIGNoYXJhY3RlcnNMZW5ndGggPSBjaGFyYWN0ZXJzLmxlbmd0aDsKCglpZCA9ICcnOwoKCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKCQlpZCArPSBjaGFyYWN0ZXJzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFyYWN0ZXJzTGVuZ3RoKSk7Cgl9CgoJcmV0dXJuIGlkOwp9CgpmdW5jdGlvbiBzX2J0bihtb2R1bGUsIHZhbHVlID0gIiIpIHsKCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJaWYgKHZhbHVlID09ICIiKSB7CgkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJcmVqZWN0KGVycm9yKTsKCQkJfSk7CgkJfSBlbHNlIHsKCQkJJC5nZXQoIi90b2dnbGU/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCQlyZWplY3QoZXJyb3IpOwoJCQl9KTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gY19leGl0KCkgewoJc19idG4oImRlYWQiKTsKCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCXdpbmRvdy5vcGVuKCIiLCAiX3NlbGYiLCAiIik7CgkJd2luZG93LmNsb3NlKCk7CgkJaGlzdG9yeS5nbygtMSk7CgkJbmF2aWdhdG9yLmFwcC5iYWNrSGlzdG9yeSgpOwoJCXdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKCX0sIDUwMDApOwp9CgpmdW5jdGlvbiBmX2NvbWJvKGlkX2l0ZW0sIGlkX3NlcnZlcikgewoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaWRfc2VydmVyLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pOwoKCQlpZiAoc2VsZWN0ID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhpZF9pdGVtLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCXZhciByZXNwb25zZSA9IHdpbmRvdy5hdG9iKHJlc3BvbnNlVGV4dCk7CgoJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCXJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSk7CgkJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCQlzZWxlY3QuaW5uZXJIVE1MID0gKCIiKS50cmltKCk7CgoJCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzcG9uc2UpIHsKCQkJCQlpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzcG9uc2UsIGtleSkpIHsKCQkJCQkJY29uc3QgZWxlbWVudCA9IHJlc3BvbnNlW2tleV07CgkJCQkJCXZhciBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCQkJCQkJb3B0LnZhbHVlID0ga2V5OwoJCQkJCQlvcHQuaWQgPSBpZF9pdGVtICsgIl8iICsga2V5OwoJCQkJCQlvcHQuaW5uZXJIVE1MID0gZWxlbWVudFsiaWQiXTsKCQkJCQkJc2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfSk7Cn0KCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBmdW5jdGlvbiAoKSB7CglpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJdF9wYW5lbCgnbGVmdF9wYW5lbCcsIDEpOwoJCXRfcGFuZWwoJ3JpZ2h0X3BhbmVsJywgMSk7Cgl9CgllbHNlIHsKCQl0X3BhbmVsKCdsZWZ0X3BhbmVsJywgMik7CgkJdF9wYW5lbCgncmlnaHRfcGFuZWwnLCAyKTsKCX0KfSk7Cgphc3luYyBmdW5jdGlvbiB0X3BhbmVsKGlkID0gInJpZ2h0X3BhbmVsIiwgdHlwZSA9IDApIHsKCWNvbnN0IHBfZWxtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJaWYgKHR5cGUgPT0gMCkgewoJCWlmIChwX2VsbS5zdHlsZS5kaXNwbGF5ICE9ICJub25lIikgewoJCQlwX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOwoJCQlwX2VsbS5zdHlsZS5oZWlnaHQgPSAiMHB4IjsKCQkJcF9lbG0uc3R5bGUub3BhY2l0eSA9ICIwIjsKCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQlwX2VsbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl9LCAyNTApOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIHsKCQkJcF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCWF3YWl0IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4geyB9LCAyNTApOwoKCQkJcF9lbG0uc3R5bGUud2lkdGggPSAiYXV0byI7CgkJCXBfZWxtLnN0eWxlLmhlaWdodCA9ICJhdXRvIjsKCQkJcF9lbG0uc3R5bGUub3BhY2l0eSA9ICIxIjsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQl9CgoJCX0KCX0KCWVsc2UgewoJCWlmIChwX2VsbS5zdHlsZS5kaXNwbGF5ICE9ICJub25lIiAmJiB0eXBlID09IDEpIHsKCQkJcF9lbG0uc3R5bGUud2lkdGggPSAiMHB4IjsKCQkJcF9lbG0uc3R5bGUuaGVpZ2h0ID0gIjBweCI7CgkJCXBfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMCI7CgkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJcF9lbG0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJfSwgMjUwKTsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSBpZiAodHlwZSA9PSAyICYmIHBfZWxtLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKSB7CgkJCXBfZWxtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMjUwKTsKCgkJCXBfZWxtLnN0eWxlLndpZHRoID0gImF1dG8iOwoJCQlwX2VsbS5zdHlsZS5oZWlnaHQgPSAiYXV0byI7CgkJCXBfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMSI7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJfQoKCQl9Cgl9Cn0KCnZhciB6bm90aWZpY2F0aW9uSWQgPSAwLCBub3RpZmljYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbm90aWZpY2F0aW9uLWNvbnRhaW5lciIpOwpmdW5jdGlvbiBub3RpZnkoYSwgYiwgZCkgeyBiID0gdm9pZCAwID09PSBiID8gMjUwMCA6IGI7IGQgPSArK3pub3RpZmljYXRpb25JZDsgdmFyIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsgYy5jbGFzc0xpc3QuYWRkKCJub3RpZmljYXRpb24iKTsgYy5pbm5lckhUTUwgPSAoIjxwPiIgKyBhICsgIjwvcD48YnV0dG9uIGNsYXNzPSdjbG9zZS1idXR0b24nIGRhdGEtbm90aWZpY2F0aW9uLWlkPSciICsgZCArICInPiZ0aW1lczs8L2J1dHRvbj4iKS50cmltKCk7IGMuc3R5bGUubWFyZ2luTGVmdCA9ICJhdXRvIjsgYy5zdHlsZS53aWR0aCA9ICJmaXQtY29udGVudCI7IG5vdGlmaWNhdGlvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChjKTsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGMuc3R5bGUub3BhY2l0eSA9ICIwIjsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGMucmVtb3ZlKCkgfSwgNDUwKSB9LCBiKTsgKGEgPSBjLnByZXZpb3VzU2libGluZykgJiYgYS5zdHlsZSAmJiAoYS5zdHlsZS5tYXJnaW5Ub3AgPSAiNnB4IikgfQpub3RpZmljYXRpb25Db250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoYSkgeyBpZiAoYS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJjbG9zZS1idXR0b24iKSkgeyB2YXIgYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLW5vdGlmaWNhdGlvbi1pZD0nIiArIGEudGFyZ2V0LmRhdGFzZXQubm90aWZpY2F0aW9uSWQgKyAiJ10iKS5wYXJlbnRFbGVtZW50OyBiLnN0eWxlLm9wYWNpdHkgPSAiMCI7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBiLnJlbW92ZSgpIH0sIDI1MCk7IChhID0gYi5wcmV2aW91c1NpYmxpbmcpICYmIGEuc3R5bGUgJiYgKGEuc3R5bGUubWFyZ2luVG9wID0gIjZweCIpIH0gfSk7CmFzeW5jIGZ1bmN0aW9uIHNsZWVwKG1zKSB7IHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTsgfQoKZnVuY3Rpb24gaXNfbW9kYWxvcGVuKG1pZCkgewoJdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWlkKTsKCWlmIChtb2RhbCkgewoJICByZXR1cm4gbW9kYWwuaGFzQXR0cmlidXRlKCdvcGVuJyk7Cgl9CglyZXR1cm4gZmFsc2U7CiAgfQoKZnVuY3Rpb24gc29ydF90YWJsZShuLCBpZCkgewoJdmFyIHRhYmxlLAoJCXJvd3MsCgkJc3dpdGNoaW5nLAoJCWksCgkJeCwKCQl5LAoJCXNob3VsZFN3aXRjaCwKCQlkaXIsCgkJc3dpdGNoY291bnQgPSAwOwoJdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7Cglzd2l0Y2hpbmcgPSB0cnVlOwoJZGlyID0gImFzYyI7Cgl3aGlsZSAoc3dpdGNoaW5nKSB7CgkJc3dpdGNoaW5nID0gZmFsc2U7CgkJcm93cyA9IHRhYmxlLnJvd3M7CgkJZm9yIChpID0gMTsgaSA8IHJvd3MubGVuZ3RoIC0gMTsgaSsrKSB7CgkJCXNob3VsZFN3aXRjaCA9IGZhbHNlOwoJCQl4ID0gcm93c1tpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiVEQiKVtuXTsKCQkJeSA9IHJvd3NbaSArIDFdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJURCIpW25dOwoJCQlpZiAoZGlyID09ICJhc2MiKSB7CgkJCQlpZiAoeC5pbm5lckhUTUwudG9Mb3dlckNhc2UoKSA+IHkuaW5uZXJIVE1MLnRvTG93ZXJDYXNlKCkpIHsKCQkJCQlzaG91bGRTd2l0Y2ggPSB0cnVlOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGRpciA9PSAiZGVzYyIpIHsKCQkJCWlmICh4LmlubmVySFRNTC50b0xvd2VyQ2FzZSgpIDwgeS5pbm5lckhUTUwudG9Mb3dlckNhc2UoKSkgewoJCQkJCXNob3VsZFN3aXRjaCA9IHRydWU7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9CgkJaWYgKHNob3VsZFN3aXRjaCkgewoJCQlyb3dzW2ldLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHJvd3NbaSArIDFdLCByb3dzW2ldKTsKCQkJc3dpdGNoaW5nID0gdHJ1ZTsKCQkJc3dpdGNoY291bnQrKzsKCQl9IGVsc2UgewoJCQlpZiAoc3dpdGNoY291bnQgPT0gMCAmJiBkaXIgPT0gImFzYyIpIHsKCQkJCWRpciA9ICJkZXNjIjsKCQkJCXN3aXRjaGluZyA9IHRydWU7CgkJCX0KCQl9Cgl9Cn0KCmFzeW5jIGZ1bmN0aW9uIGxpdmVfc2VydmVyKCkgewoJYXdhaXQgc2xlZXAoNTAwKTsKCXJfaW5mbygpOwoJYXdhaXQgc2xlZXAoNTAwKTsKCXVfc2xpZGVycygpOwoJYXdhaXQgc2xlZXAoMTAwKTsKCXBfc291bmQoInNuZDEiKTsKfQpsaXZlX3NlcnZlcigpOwoKY29uc29sZS5sb2coImJyZWFraW5nIGNvY29udXRzIik7Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw==";
eval(atob(A));