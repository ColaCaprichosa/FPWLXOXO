var test = "dmFyIGRlZmF1bHRfYXZhdGFyID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9Db2xhQ2FwcmljaG9zYS9GUFdMUi9sb2dhcmRvLnBuZyI7CgoJCWZ1bmN0aW9uIGNfdGhlbWUoKSB7CgkJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmJvZHk7CgkJCWNvbnN0IHRoZW1lX3NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aGVtZV9zZWxlY3QnKTsKCQkJY29uc3Qgc2VsZWN0ZWQgPSB0aGVtZV9zZWxlY3QudmFsdWU7CgkJCWNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnLCBzZWxlY3RlZCk7CgoJCQlzZXRfaW50MigndGhlbWVfc2VsZWN0Jyk7CgkJfQoKCQlmdW5jdGlvbiBnX3RtX2koKSB7IHJldHVybiBNYXRoLnJvdW5kKCtuZXcgRGF0ZSgpIC8gMTAwMCk7IH0KCgkJY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCXRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcCIpOwoJCXRvb2x0aXAuaWQgPSAid210b29sdGlwIjsKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRvb2x0aXApOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkJY29uc3QgZWxlbWVudCA9IGV2ZW50LnRhcmdldDsKCQkJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CgkJCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCQkJdG9vbHRpcC5pbm5lclRleHQgPSB0b29sdGlwTWVzc2FnZTsKCQkJCXRvb2x0aXAuc3R5bGUudG9wID0gZWxlbWVudC5vZmZzZXRUb3AgLSB0b29sdGlwLm9mZnNldEhlaWdodCAtIDggKyAicHgiOwoJCQkJdG9vbHRpcC5zdHlsZS5sZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgKGVsZW1lbnQub2Zmc2V0V2lkdGggLSB0b29sdGlwLm9mZnNldFdpZHRoKSAvIDIgKyAicHgiOwoJCQkJdG9vbHRpcC5jbGFzc0xpc3QuYWRkKCJ0b29sdGlwLS12aXNpYmxlIik7CgkJCX0KCQl9KTsKCgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkJY29uc3QgZWxlbWVudCA9IGV2ZW50LnRhcmdldDsKCQkJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CgkJCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCQkJdG9vbHRpcC5pbm5lclRleHQgPSAoIi0iKS50cmltKCk7CgkJCQl0b29sdGlwLmNsYXNzTGlzdC5yZW1vdmUoInRvb2x0aXAtLXZpc2libGUiKTsKCQkJfQoJCX0pOwoKCQl2YXIgdV9ib29sID0gW107CgkJdmFyIHVfZmxvYXQgPSBbXTsKCQl2YXIgdV9pbnQgPSBbXTsKCQl2YXIgdV9pbnQyID0gWyJ0aGVtZV9zZWxlY3QiXTsKCgkJcGF0aCA9ICJwYW5lbF9jaGF0IjsKCgkJY190ZXh0KHBhdGgsICJjaGF0Ym94dHh0IiwgImNoYXQiLCB7CgkJCXRleHRBbGlnbjogJ2NlbnRlcicsCgkJCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCQkJZm9udFNpemU6ICcxOHB4JywKCQkJbWFyZ2luQm90dG9tOiAnMTBweCcsCgkJCW1hcmdpblRvcDogIjBweCIsCgkJfSk7CgoJCWNfZGl2KHBhdGgsICJjaGF0LWNvbnRhaW5lciIsIHsKCQkJd2lkdGg6ICIyMzBweCIsCgkJCWhlaWdodDogIjMxNXB4IiwKCQkJbWF4SGVpZ2h0OiAiMzE1cHgiLAoJCQlvdmVyZmxvd1k6ICJhdXRvIiwKCQkJcGFkZGluZzogIjEwcHgiLAoJCQliYWNrZ3JvdW5kQ29sb3I6ICd2YXIoLS1jLXNlY29uZGFyeSknLAoJCX0pOwoKCQljX2JyZWFrKCk7CgoJCWZ1bmN0aW9uIHNlbmRfY2hhdCgpIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWxpZGl0eS52YWxpZCkgewoJCQkJY29uc3QgY2hhdF90ZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlOwoJCQkJc2V0X2J1dHRvbigic2VuZF9jaGF0IiwgY2hhdF90ZXh0KQoJCQkJCS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCQkJaWYgKCFyZXNwb25zZVRleHQuaW5jbHVkZXMoImRvbmUiKSkKCQkJCQkJCXJldHVybjsKCgkJCQkJCWF3YWl0IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4geyB9LCAzNTApOwoJCQkJCQl1cGRhdGVfY2hhdCgpOwoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsdWUgPSAiIjsKCQkJCQl9KQoJCQkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0X3RleHQiKS52YWx1ZSA9ICIiOwoJCQkJCX0pOwoJCQl9CgkJCWVsc2UgewoJCQkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGNhcmFjdGVyZXMgZXNwZWNpYWxlcywgZGUgNSBhIDY0IGNhcmFjdGVyZXMgc29sYW1lbnRlLiIsIDUwMDAsICJSRUQiKTsKCQkJfQoJCX0KCgkJY190ZXh0Ym94KHBhdGgsICJjaGF0X3RleHQiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJCQlwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokIiwKCQkJbWluTGVuZ3RoOiAxLAoJCQltYXhMZW5ndGg6IDY0LAoJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJcGxhY2Vob2xkZXI6ICJ3cml0ZSBoZXJlIiwKCQkJZXZlbnRMaXN0ZW5lcjogewoJCQkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQkJCWlmIChldi5rZXkgPT09ICdFbnRlcicpIHsKCQkJCQkJc2VuZF9jaGF0KCk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSwgdHJ1ZSk7CgoJCWNfYnV0dG9uKHBhdGgsICJidG5fc2VuZF9jaGF0IiwgInNlbmQiLCBmdW5jdGlvbiAoKSB7CgkJCXNlbmRfY2hhdCgpOwoJCX0sICJFbnZpYSB1biBtZW5zYWplIGFsIGNoYXQsIHVuYSB2ZXogY2FkYSAzMCBzZWd1bmRvcy4iKTsKCgkJY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCgkJY190ZXh0KHBhdGgsICJ1c2Vyc29ubGluZSIsICJub25lIiwgewoJCQl0ZXh0QWxpZ246ICdjZW50ZXInLAoJCQl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCgkJCWZvbnRTaXplOiAnMTBweCcsCgkJCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJCQltYXJnaW5Ub3A6ICIwcHgiLAoJCX0pOwoKCQlmdW5jdGlvbiBnZXRfb25saW5lcygpIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJCQlyZXR1cm47CgoJCQlnYXRoZXIoIm9ubGluZXMiLCAienoiKQoJCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQkJCXRyeSB7CgkJCQkJCWNvbnN0IGxpdmVzID0gSlNPTi5wYXJzZShyZXN1bHQpOwoJCQkJCQljb25zdCBvbmxpbmVzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcnNvbmxpbmUnKTsKCQkJCQkJb25saW5lc2VsLmlubmVySFRNTCA9ICI8cCBzdHlsZT0nZm9udC13ZWlnaHQ6Ym9sZDtmb250LXNpemU6MTRweDttYXJnaW4tYm90dG9tOjBweDttYXJnaW4tdG9wOjBweDsnPm9ubGluZXMgKCIgKyBsaXZlcy5saXZlLmxlbmd0aCArICIpPC9wPjxicj4iICsgbGl2ZXMubGl2ZS5qb2luKCIsICIpOwoJCQkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQkJCW5vdGlmeShyZXN1bHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCQl9CgkJCQl9KQoJCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJfSk7CgkJfQoKCQlnZXRfb25saW5lcygpOwoKCQljX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKCQljX2J1dHRvbihwYXRoLCAib3BlbmRsZ2ZpbmR1c2VyIiwgInNlYXJjaCB1c2VyIiwgZnVuY3Rpb24gKCkgewoJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmR1c2VyZGxnIik7CgkJCWRpYWxvZy5zaG93TW9kYWwoKTsKCQl9LCAiQnVzY2EgdW4gdXN1YXJpby4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQoKCQljX2RpYWxvZyhwYXRoLCAiZmluZHVzZXJkbGciKTsKCQlwYXRoID0gImZpbmR1c2VyZGxnIjsKCgkJY190ZXh0KHBhdGgsICJ1c2VyZmluZHR4dCIsICJzZWFyY2ggdXNlciIsIHsKCQkJdGV4dEFsaWduOiAnY2VudGVyJywKCQkJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJCQlmb250U2l6ZTogJzE4cHgnLAoJCQltYXJnaW5Cb3R0b206ICcxMHB4JywKCQkJbWFyZ2luVG9wOiAiMHB4IiwKCQkJY29sb3I6ICJ3aGl0ZSIKCQl9KTsKCgkJY19icmVhayhwYXRoKTsKCgkJY190ZXh0Ym94KHBhdGgsICJmaW5kX3VzZXIiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJCQlwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJCQltaW5MZW5ndGg6IDMsCgkJCW1heExlbmd0aDogMjAsCgkJCXJlcXVpcmVkOiB0cnVlLAoJCQlwbGFjZWhvbGRlcjogImFsaWFzIiwKCQkJZXZlbnRMaXN0ZW5lcjogewoJCQkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQkJCWlmIChldi5rZXkgPT09ICdFbnRlcicpIHsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ0bl9maW5kX3VzZXIiKS5jbGljaygpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sIHRydWUpOwoKCQljb25zdCByb2xlY2xyID0geyAibm9ybWFsIjogIiM2MDYwNjAiLCAicHJlbWl1bSI6ICIjOGJiMGZmIiwgImNoYWQiOiAiI2ZmZTU4YiIsICJHT0QiOiAiI2YxNGMzOSIsICJQQVBJIjogIiNjZTk4ZTIiIH07CgkJdmFyIGNvb2xkb3duID0gMDsKCgkJY19idXR0b24ocGF0aCwgImJ0bl9maW5kX3VzZXIiLCAiZmluZCIsIGZ1bmN0aW9uICgpIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kX3VzZXIiKS52YWxpZGl0eS52YWxpZCkKCQkJCWlmIChjb29sZG93biA+IGdfdG1faSgpKSB7CgkJCQkJY29uc29sZS5sb2coImNvb2xkb3duIiwgKGNvb2xkb3duIC0gZ190bV9pKCkpKQoJCQkJCW5vdGlmeSgicmVjZW50bHkgdXNlZCwgd2FpdCAiICsgKGNvb2xkb3duIC0gZ190bV9pKCkpICsgIiBzZWNvbmRzIiwgNzAwMCk7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQlnYXRoZXIoImluZm9fYWxpYXMiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZF91c2VyIikudmFsdWUpCgkJCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCQkJdHJ5IHsKCQkJCQkJdmFyIHVfaW5mID0gSlNPTi5wYXJzZShyZXN1bHQpOwoKCQkJCQkJaWYgKHVfaW5mWyJhdmF0YXIiXSkgewoJCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZ0ciIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQkJCX0KCgkJCQkJCXZhciB1c2VyX2RhdGEgPSAiIjsKCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07CgoJCQkJCQlpZiAodV9pbmZbInJvbGUiXSkKCQkJCQkJCXVzZXJfZGF0YSArPSAiPHNwYW4gc3R5bGU9J2Rpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOiIgKyByb2xlY2xyW3VfaW5mWyJyb2xlIl0udG9Mb3dlckNhc2UoKV0gKyAiOyc+ICgiICsgdV9pbmZbInJvbGUiXSArICIpPC9zcGFuPjxicj48L3N0cm9uZz48L3A+IjsKCgkJCQkJCWlmICh1X2luZlsidXNlcl9pZCJdKQoJCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz51aWQ6ICIgKyB1X2luZlsidXNlcl9pZCJdOwoJCQkJCQllbHNlCgkJCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPmJldGEiOwoKCQkJCQkJaWYgKHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0pCgkJCQkJCQl1c2VyX2RhdGEgKz0gIiAtIGpvaW5lZDogIiArIGdfdG1fZHQodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSwgZmFsc2UpICsgIjwvcD4iOwoJCQkJCQllbHNlCgkJCQkJCQl1c2VyX2RhdGEgKz0gIjwvcD4iOwoKCQkJCQkJaWYgKHVfaW5mWyJkZXNjcmlwdGlvbiJdKQoJCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJCQkJZWxzZQoJCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+bm8gaW5mbzwvcD4iCgoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmYiKS5pbm5lckhUTUwgPSB1c2VyX2RhdGE7CgkJCQkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJCQkJbm90aWZ5KHJlc3VsdC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQkJCQlpZiAocmVzdWx0LmluY2x1ZGVzKCJyZWNlbnRseSIpKSB7CgkJCQkJCQlpZiAoY29vbGRvd24gPCBnX3RtX2koKSkKCQkJCQkJCQljb29sZG93biA9IGdfdG1faSgpICsgMzA7CgkJCQkJCX0KCQkJCQl9CgkJCQl9KQoJCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJfSk7CgkJfSwgIiIsIHsgbWFyZ2luTGVmdDogIjEwcHgiIH0pOwoKCQljX2J1dHRvbihwYXRoLCAiY2xvc2VmaW5kdXNlciIsICJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kdXNlcmRsZyIpOwoJCQlkaWFsb2cuY2xvc2UoKTsKCQl9LCAiIiwgeyBtYXJnaW5MZWZ0OiAiMTBweCIgfSk7CgoJCWNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgoJCWNfZGl2KHBhdGgsICJ1c2VyX2luZmFsaWFzIiwgewoJCQlkaXNwbGF5OiAiaW5saW5lLWdyaWQiLAoJCQlncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDEwNXB4KSIsCgkJCWdyaWRHYXA6ICIxMHB4IgoJCX0pOwoKCQljX2JyZWFrKHBhdGgsIDIpOwoKCQljX2ltYWdlKCJ1c2VyX2luZmFsaWFzIiwgInVzZXJfYXZ0ciIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsCgkJCXsKCQkJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQkJCW9iamVjdEZpdDogImNvdmVyIiwKCQkJCWJvcmRlclJhZGl1czogIjVweCIsCgkJCQlwbGFjZVNlbGY6ICJub3JtYWwiCgkJCX0pOwoKCQljX2JyZWFrKHBhdGgsIDIpOwoKCQljX3RleHQoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9pbmYiLCAibm9uZSIsIHsKCQkJZGlzcGxheTogImdyaWQiLCBncmlkVGVtcGxhdGVDb2x1bW5zOiAiMTYwcHgiLCBtYXJnaW5Ub3A6ICIwcHgiLAoJCQljb2xvcjogIndoaXRlIgoJCX0pOwoKCQl2YXIgbGFzdF9tc2cgPSAwOwoJCXZhciBmaXJzdF9zbmQgPSAwOwoKCQlmdW5jdGlvbiBwX3NvdW5kKGlkKSB7CgkJCWlmIChmaXJzdF9zbmQgPT0gMCkgewoJCQkJZmlyc3Rfc25kKys7CgkJCX0KCQkJZWxzZSB7CgkJCQl2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCQkJCWVsZW1lbnQudm9sdW1lID0gMC4xOwoJCQkJZWxlbWVudC5wbGF5KCk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZV9jaGF0KCkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQkJCXJldHVybjsKCgkJCWdhdGhlcigiZ2V0X2NoYXQiLCAieiIpCgkJCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCQkJY29uc3QgY2hhdHMgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgkJCQkJY29uc3QgY2hhdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LWNvbnRhaW5lcicpOwoJCQkJCWNoYXRDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CgoJCQkJCXZhciBoaWdoZXN0X3RzID0gMDsKCQkJCQljaGF0cy5mb3JFYWNoKGFzeW5jIChjaGF0KSA9PiB7CgkJCQkJCWlmIChoaWdoZXN0X3RzIDwgY2hhdC50cykKCQkJCQkJCWhpZ2hlc3RfdHMgPSBjaGF0LnRzOwoKCQkJCQkJY29uc3QgY2hhdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCQkJY2hhdEVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CgkJCQkJCWNoYXRFbGVtZW50LmlubmVySFRNTCA9IGAoPHNwYW4gZGF0YS10dGlwPScke2dfdG1fZHQoY2hhdC50cywgZmFsc2UpfScgc3R5bGU9Im9wYWNpdHk6IDAuNTsiPiR7Z190bV9kdChjaGF0LnRzKX08L3NwYW4+KSA8c3BhbiBzdHlsZT0nJHtjaGF0LnIgIT0gdW5kZWZpbmVkID8gKCJjb2xvcjoiICsgKE9iamVjdC5lbnRyaWVzKHJvbGVjbHIpW2NoYXQucl1bIjEiXSkgKyAiOyIpIDogIiJ9Jz48c3Ryb25nPiR7Y2hhdC51fTwvc3Ryb25nPjwvc3Bhbj46ICR7d2luZG93LmF0b2IoY2hhdC5tc2cpfWA7CgkJCQkJCWNoYXRDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hhdEVsZW1lbnQpOwoKCQkJCQkJY19ocigiY2hhdC1jb250YWluZXIiLCBmYWxzZSwgewoJCQkJCQkJb3BhY2l0eTogIjAuMiIsCgkJCQkJCQlwYWRkaW5nVG9wOiAiMHB4IiwKCQkJCQkJCXBhZGRpbmdCb3R0b206ICIwcHgiLAoJCQkJCQl9KTsKCQkJCQl9KTsKCgkJCQkJaWYgKGxhc3RfbXNnICE9IGhpZ2hlc3RfdHMpIHsKCQkJCQkJcF9zb3VuZCgic25kMSIpOwoJCQkJCQlsYXN0X21zZyA9IGhpZ2hlc3RfdHM7CgkJCQkJfQoJCQkJfSkKCQkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCX0pOwoJCX0KCgkJdXBkYXRlX2NoYXQoKTsKCgkJdmFyIHBhdGggPSAibWFpbl9lbGVtZW50cyI7CgoJCS8qU1RBUlQgRkVBVFVSRVMqLwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2lkIikuaW5uZXJUZXh0PSJzY3JpcHQiOwoKCQljX3RhYl9idXR0b24oImVsZW1lbnRfYnV0dG9ucyIsIFsKCQkJeyBpZDogIm1haW5fdGFiIiwgdGV4dDogIm1haW4iIH0sCgkJCXsgaWQ6ICJrZXlzX3RhYiIsIHRleHQ6ICJrZXlzIiB9LAoJCQl7IGlkOiAib3ZlcmxheV90YWIiLCB0ZXh0OiAib3ZlcmxheSIgfSwKCQkJeyBpZDogInNldHRpbmdzX3RhYiIsIHRleHQ6ICJtaXNjIiB9LAoJCQl7IGlkOiAicXJjb2RlX3RhYiIsIHRleHQ6ICJRUiIgfQoJCV0pOwoKCQljX3RhYl9idXR0b24oImVsZW1lbnRfcmlnaHRfYnV0dG9ucyIsIFsKCQkJeyBpZDogInBfdXBkYXRlcyIsIHRleHQ6ICJsb2dzIiB9LAoJCQl7IGlkOiAicF90aWNrZXRzIiwgdGV4dDogInRpY2tldHMiIH0sCgkJCXsgaWQ6ICJwX3Byb2ZpbGUiLCB0ZXh0OiAicHJvZmlsZSIgfQoJCV0sIDIpOwoKCQljX2NvbWJvYm94KHBhdGgsICJhbGxfcHJvZmlsZXMiLCAicHJvZmlsZSIsIDAsIDIwLCB0cnVlLCAiUGVyZmlsZXMgcGFyYSBjYWRhIHNpdHVhY2lvbi4iLCBmdW5jdGlvbiAoKSB7CgkJCXJlY2VpdmVfaW5mbygpOwoJCX0sIHsgbWluV2lkdGg6ICIxODBweCIgfSk7CgoJCWNfdGV4dGJveChwYXRoLCAicHJvZmlsZV9uYW1lX2MiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJCQlwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJCQltaW5MZW5ndGg6IDQsCgkJCW1heExlbmd0aDogOSwKCQkJcmVxdWlyZWQ6IGZhbHNlLAoJCX0sIHRydWUpOwoKCQljX2J1dHRvbihwYXRoLCAiYnRuX3Byb2ZpbGVfY2hhbmdlIiwgImNoYW5nZSBuYW1lIiwgZnVuY3Rpb24gKCkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsaWRpdHkudmFsaWQpIHsKCQkJCXZhciBwcm9mX3ZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsdWU7CgkJCQlzZXRfaW5mbygicHJvZmlsZV9uYW1lIiwgcHJvZl92YWx1ZSk7CgoJCQkJcmVjZWl2ZV9pbmZvKCk7CgkJCQlmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CgkJCX0KCQkJZWxzZSB7CgkJCQlub3RpZnkoIk5vIHNlIGFjZXB0YW4gZXNwYWNpb3MgbyBjYXJhY3RlcmVzIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJCQl9CgkJfSwgIkNhbWJpYSBlbCBub21icmUgZGVsIHByb2ZpbGUiLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgoJCWNfYnV0dG9uKHBhdGgsICJidG5fcHJvZmlsZV9leHBvcnQiLCAiZXhwb3J0IHByb2ZpbGUiLCBmdW5jdGlvbiAoKSB7CgkJCXNldF9idXR0b24oImV4cG9ydF9wcm9maWxlIik7CgkJfSwgIkV4cG9ydGEgZWwgcGVyZmlsIGFjdHVhbCBhbCBDTElQQk9BUkQuIiwgeyBtYXJnaW5SaWdodDogIjEwcHgiIH0pOwoKCQljX2J1dHRvbihwYXRoLCAiYnRuX3Byb2ZpbGVfaW1wb3J0IiwgImltcG9ydCBwcm9maWxlIiwgZnVuY3Rpb24gKCkgewoJCQlzZXRfYnV0dG9uKCJpbXBvcnRfcHJvZmlsZSIpOwoJCQlyZWNlaXZlX2luZm8oKTsKCQkJZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOwoJCX0sICJJbXBvcnRhIHVuIHBlcmZpbCBkZXNkZSBlbCBDTElQQk9BUkQuIik7CgoJCWNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgoJCWNfY2hlY2tib3gocGF0aCwgImVuYWJsZV9yY3MiLCAiZW5hYmxlIiwgIkFjdGl2YSBlbCBmdW5jaW9uYW1pZW50byBkZWwgc2NyaXB0LiIpOwoJCWNfY2hlY2tib3gocGF0aCwgImZhc3RfbW9kZSIsICJmYXN0IG1vZGUgKEhJR0ggQ1BVKSIsICJBY3RpdmEgZWwgbW9kbyByYXBpZG8sIGZvcnphbmRvIGFsIHByb2dyYW1hIGEgY29uc3VtaXIgbWFzIENQVS4iLCBmdW5jdGlvbiAoY19lbCkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2xvd3NldHRpbmdzX2NmZyIpLnN0eWxlLmRpc3BsYXkgPSBjX2VsLmNoZWNrZWQgPyAibm9uZSIgOiAiYmxvY2siOwoJCX0pOwoKCQljX2NvbWJvYm94KHBhdGgsICJ3ZWFwb25fY29tYm8iLCAid2VhcG9uIiwgMCwgOSwgZmFsc2UsICJBcm1hIHF1ZSBlbCBzY3JpcHQgaW50ZW50YXJhIGNvbXBlbnNhciIsIGZ1bmN0aW9uICgpIHsKCQkJcmVjZWl2ZV9pbmZvKCk7CgkJfSk7CgoJCWNfY29tYm9ib3gocGF0aCwgInNjb3BlX2NvbWJvIiwgInNjb3BlIiwgMCwgNCwgZmFsc2UsICJTY29wZSBxdWUgZWwgc2NyaXB0IGludGVudGFyYSBjb21wZW5zYXIiKTsKCQljX2NvbWJvYm94KHBhdGgsICJiYXJyZWxfY29tYm8iLCAiYmFycmVsIiwgMCwgMywgZmFsc2UsICJCYXJyZWwgcXVlIGVsIHNjcmlwdCBpbnRlbnRhcmEgY29tcGVuc2FyIik7CgoJCWNfc19mbG9hdChwYXRoLCAic2Vuc2luZ2FtZSIsICJzZW5zaXRpdml0eSIsIDAuMDEsIDMuMCwgMC4wMSwgMS4wLCAiRGViZXMgcG9uZXIgdHUgU0VOU0lCSUxJREFEIGRlbCBqdWVnbyAoIDAuMDEgLSAzLjAwICkiKTsKCQljX3NfZmxvYXQocGF0aCwgImZvdmluZ2FtZSIsICJmb3YiLCA3MC4wLCA5MC4wLCAxLjAsIDkwLjAsICJEZWJlcyBwb25lciB0dSBGT1YgZGVsIGp1ZWdvICggNzAgLSA5MCApIik7CgoJCWNfZGl2KHBhdGgsICJzbG93c2V0dGluZ3NfY2ZnIiwgewoJCQlkaXNwbGF5OiAiYmxvY2siLAoJCX0pOwoKCQlwYXRoID0gInNsb3dzZXR0aW5nc19jZmciOwoJCWNfc19pbnQocGF0aCwgInJjc3Ntb290aCIsICJzbW9vdGgiLCA0LCAxNSwgMSwgNSwgIk1pZW50cmFzIG1hcyB2YWxvciB0ZW5nYSwgbWFzIHN1YXZlIHNlIHZlIGVsIHNjcmlwdCIpOwoKCQlsZXQgc2hvd19hZHZhbmNlZF9jZmcgPSBmYWxzZTsKCQljX2J1dHRvbihwYXRoLCAiYnRuX3Nob3dfZGV2IiwgImFkdmFuY2VkIiwgZnVuY3Rpb24gKCkgewoJCQlsZXQgZWxtbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWR2bmNfY2ZnIik7CgkJCWlmICghc2hvd19hZHZhbmNlZF9jZmcpIHsKCQkJCWVsbW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJc2hvd19hZHZhbmNlZF9jZmcgPSB0cnVlOwoJCQl9CgkJCWVsc2UgewoJCQkJZWxtbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCXNob3dfYWR2YW5jZWRfY2ZnID0gZmFsc2U7CgkJCX0KCQl9LCAiTXVlc3RyYSBtYXMgY29uZmlndXJhY2lvbmVzLCBwYXNhciBlbCBtb3VzZSBwb3IgYXJyaWJhIGRlIGNhZGEgdW5hLiIpOwoKCQljX2RpdihwYXRoLCAiYWR2bmNfY2ZnIiwgewoJCQlkaXNwbGF5OiAibm9uZSIsCgkJfSk7CgoJCXBhdGggPSAiYWR2bmNfY2ZnIjsKCQljX3NfZmxvYXQocGF0aCwgInJjc194IiwgIm5vcm1hbCByY3MgeCIsIDAuMDEsIDEuNywgMC4wMSwgMS4wLCAiTWllbnRyYXMgbWFzIHZhbG9yIHRlbmdhLCBtb3ZlcmEgYSBsYSBpenF1aWVyZGEiKTsKCQljX3NfZmxvYXQocGF0aCwgInJjc195IiwgIm5vcm1hbCByY3MgeSIsIDAuMDEsIDEuNywgMC4wMSwgMS4wLCAiTWllbnRyYXMgbWFzIHZhbG9yIHRlbmdhLCBiYWphcmEgbWFzIGVsIG1vdmltaWVudG8iKTsKCgkJcGF0aCA9ICJrZXlzX2VsZW1lbnRzIjsKCQljX2NvbWJvYm94KHBhdGgsICJtYWluX3RvZ2dsZSIsICJtYWluIHRvZ2dsZSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJBY3RpdmEvRGVzYWN0aXZhIGVsIHNjcmlwdCIpOwoJCWNfY29tYm9ib3gocGF0aCwgImNyb3NzX3RvZ2dsZSIsICJjcm9zc2hhaXIgdG9nZ2xlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkFjdGl2YS9EZXNhY3RpdmEgZWwgY3Jvc3NoYWlyIik7CgkJY19jb21ib2JveChwYXRoLCAid2VhcG9uX2N5Y2xlIiwgIndlYXBvbiBjeWNsZSIsIC0xMDAwMDAsIDEwMDAwMCwgZmFsc2UsICJDYW1iaWEgYSBsYSBzaWd1aWVudGUgYXJtYSBlbiBsYSBsaXN0YSIpOwoJCWNfY29tYm9ib3gocGF0aCwgInNjb3BlX2N5Y2xlIiwgInNjb3BlIGN5Y2xlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkNhbWJpYSBhbCBzaWd1aWVudGUgc2NvcGUgZW4gbGEgbGlzdGEiKTsKCQljX2NvbWJvYm94KHBhdGgsICJiYXJyZWxfY3ljbGUiLCAiYmFycmVsIGN5Y2xlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkNhbWJpYSBhbCBzaWd1aWVudGUgYmFycmVsIGVuIGxhIGxpc3RhIik7CgoJCXBhdGggPSAib3ZlcmxheV9lbGVtZW50cyI7CgkJY19jaGVja2JveChwYXRoLCAib3ZlcmxheXoiLCAib3ZlcmxheSIsICJBY3RpdmEgZWwgb3ZlcmxheSAoZGViZXMgdGVuZXIgZWwgb3ZlcmxheSBkZWwganVlZ28gYWN0aXZhZG8pLiIpOwoJCWNfY2hlY2tib3gocGF0aCwgIndhdGVybWFyayIsICJpbmZvIHdlYXBvbiBhdHRhY2htZW50cyIsICJNdWVzdHJhIHR1IGFybWEtc2NvcGUtYmFycmVsIGFjdHVhbCBkZWwgc2NyaXB0Iik7CgkJY19jaGVja2JveChwYXRoLCAiY3Jvc3NoYWlyIiwgImNyb3NzaGFpciIsICJNdWVzdHJhIHVuIGNyb3NzaGFpciAoZG90KSBlbiBtZWRpbyBkZSBsYSBwYW50YWxsYSIpOwoJCWNfY2hlY2tib3gocGF0aCwgImRpc2FibGVjcm9zcyIsICJkaXNhYmxlIGNyb3NzaGFpciBvbiBhaW0iLCAiRGVzaGFiaWxpdGEgdHUgY3Jvc3NoYWlyIGFsIGFwdW50YXIgY29uIFItQ2xpY2suIik7CgoJCWNfc19pbnQocGF0aCwgIm92ZXJsYXlfcG9zX3giLCAib3ZlcmxheSBwb3NpdGlvbiB4IiwgMSwgMjQ0MCwgNSwgMTUpOwoJCWNfc19pbnQocGF0aCwgIm92ZXJsYXlfcG9zX3kiLCAib3ZlcmxheSBwb3NpdGlvbiB5IiwgMSwgMTQ0MCwgNSwgMTUpOwoKCQlwYXRoID0gInNldHRpbmdfZWxlbWVudHMiOwoJCWNfY2hlY2tib3gocGF0aCwgInNvdW5kX29uX2NoYW5nZSIsICJzb3VuZHMgb24gd2VhcG9uIGNoYW5nZSIpOwoJCWNfY2hlY2tib3gocGF0aCwgInNvdW5kX29uX2VuZGlzIiwgInNvdW5kcyBvbiBlbmFibGUvZGlzYWJsZSIpOwoJCWNfY2hlY2tib3gocGF0aCwgInNvdW5kc29uc3RhcnQiLCAic291bmRzIG9uIHN0YXJ0Iik7CgoJCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCQlmX2NvbWJvKCJ3ZWFwb25fY29tYm8iLCAid2VhcG9ucyIpOwoJCWZfY29tYm8oInNjb3BlX2NvbWJvIiwgInNjb3BlcyIpOwoJCWZfY29tYm8oImJhcnJlbF9jb21ibyIsICJiYXJyZWxzIik7CgoJCWNvbnN0IGJpbmRfZWxlbWVudHMgPSBbCgkJCXsgaWQ6ICJtYWluX3RvZ2dsZSIsIHRhcmdldDogIm1haW5fdG9nZ2xlIiB9LAoJCQl7IGlkOiAid2VhcG9uX2N5Y2xlIiwgdGFyZ2V0OiAid2VhcG9uX2N5Y2xlIiB9LAoJCQl7IGlkOiAic2NvcGVfY3ljbGUiLCB0YXJnZXQ6ICJzY29wZV9jeWNsZSIgfSwKCQkJeyBpZDogImJhcnJlbF9jeWNsZSIsIHRhcmdldDogImJhcnJlbF9jeWNsZSIgfSwKCQkJeyBpZDogImNyb3NzX3RvZ2dsZSIsIHRhcmdldDogImNyb3NzX3RvZ2dsZSIgfSwKCQldOwoKCQkvKkVORCBGRUFUVVJFUyovCgoJCXBhdGggPSAicGFuZWxfdGlja2V0cyI7CgoJCWNfdGV4dChwYXRoLCAidGlja2V0Y2VudGVyIiwgIlRpY2tldCBDZW50ZXIiLCB7CgkJCXRleHRBbGlnbjogJ2NlbnRlcicsCgkJCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCQkJZm9udFNpemU6ICcxOHB4JywKCQkJbWFyZ2luQm90dG9tOiAnMTBweCcsCgkJCW1hcmdpblRvcDogIjBweCIsCgkJfSk7CgoJCXZhciB0aWNrZXRfZmFxX3N0ID0gewoJCQl0ZXh0QWxpZ246ICdjZW50ZXInLAoJCQlmb250U2l6ZTogJzE0cHgnLAoJCQltYXJnaW5Cb3R0b206ICcxMHB4JywKCQl9CgoJCWNfdGV4dChwYXRoLCAidGNrdGZhcSIsICItIERvIG5vdCBzcGFtIHRoZSB0aWNrZXQgc3lzdGVtLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYW4gaXNzdWUuPGJyPi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgaGF2ZSBhIGZlYXR1cmUgcmVxdWVzdC48YnI+IiwgdGlja2V0X2ZhcV9zdCk7CgkJY190ZXh0KHBhdGgsICJ0Y2t0ZmFxIiwgIi0gT25seSBjcmVhdGUgdGlja2V0cyBpZiB5b3UgbmVlZCA8dT5oZWxwPC91Pi48YnI+LSBBbGwgdGlja2V0cyBhcmUgPHU+cHJpdmF0ZTwvdT4uPGJyPi0gRG8gbm90IHBvc3QgaXJyZWxldmFudCBjb21tZW50cyBpbiB0aWNrZXRzIG9yIHlvdSBtYXkgYmUgPHU+YmFubmVkPC91Pi4iLCB0aWNrZXRfZmFxX3N0KTsKCgkJY19jb21ib2JveDIocGF0aCwgInRpY2tldF9iZWhhdmlvciIsIFsiQnVnIiwgIkZlYXR1cmUiLCAiT3RoZXIiXSwgdHJ1ZSwgIlNlbGVjY2lvbmEgdW5hIHJhem9uIGRlbCB0aWNrZXQuIik7CgoJCWNfdGV4dGFyZWEocGF0aCwgInRpY2tldF9jb250ZW50IiwgdHJ1ZSwgIiIsIHsKCQkJaGVpZ2h0OiAnMTAwcHgnLAoJCQlyZXNpemU6ICdub25lJywKCQkJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJCQl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJCQltYXJnaW5Ub3A6ICI1cHgiLAoJCX0sIHsKCQkJcGF0dGVybjogIl5bYS16QS1aMC05IF0qJHs1fSIsCgkJCW1pbkxlbmd0aDogNSwKCQkJbWF4TGVuZ3RoOiAyNTYsCgkJCXBsYWNlaG9sZGVyOiAiaW5mbyIsCgkJCXJlcXVpcmVkOiB0cnVlLAoJCX0pOwoKCQl2YXIgc2hvd190aWNrZXRfYyA9IGZhbHNlOwoJCWNfYnV0dG9uKHBhdGgsICJidG5fY3JlYXRlX3RpY2tldCIsICJjcmVhdGUgdGlja2V0IiwgZnVuY3Rpb24gKCkgewoJCQlpZiAoIXNob3dfdGlja2V0X2MpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJCQlzaG93X3RpY2tldF9jID0gdHJ1ZTsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJCQl2YXIgdGlja2V0X2luZm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS52YWx1ZTsKCQkJCXZhciB0aWNrZXRfcmVhc29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnZhbHVlOwoKCQkJCXNldF9idXR0b24oImNyZWF0ZV90aWNrZXQiLCB0aWNrZXRfcmVhc29uICsgIi0iICsgdGlja2V0X2luZm8pCgkJCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQkJfSkKCQkJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJCX0pOwoJCQl9CgkJCWVsc2UgewoJCQkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGNhcmFjdGVyZXMgZXNwZWNpYWxlcywgZGUgNSBhIDI1NiBjYXJhY3RlcmVzIHNvbGFtZW50ZS4iLCA1MDAwLCAiUkVEIik7CgkJCX0KCQl9LCAiQ3JlYSB1biB0aWNrZXQgZWwgY3VhbCBzZXJhIGF0ZW5kaWRvL3Zpc3RvIHBvciBsb3MgYWRtaW5pc3RyYWRvcmVzLiIpOwoKCQljX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoJCWNfYnV0dG9uKHBhdGgsICJidG5fZ2V0X3RpY2tldHMiLCAidmlldyB0aWNrZXRzIiwgZnVuY3Rpb24gKCkgewoJCQlpZiAoc2hvd190aWNrZXRfYykgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50Iikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJc2hvd190aWNrZXRfYyA9IGZhbHNlOwoJCQl9CgoJCQlzZXRfYnV0dG9uKCJnZXRfdGlja2V0cyIpCgkJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygidXNlcl9oYXNfbm9fdGlja2V0cyIpKSB7CgkJCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCgkJCQkJdmFyIHJlc2pzb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CgoJCQkJCWlmIChyZXNqc29uLmxlbmd0aCA9PSAwKSB7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX3RpY2tldHMiKS5pbm5lckhUTUwgPSAibm8gdGlja2V0cyI7CgkJCQkJCW5vdGlmeSgidXNlciBoYXMgbm8gdGlja2V0cyIsIDcwMDApOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl90aWNrZXRzIikuaW5uZXJIVE1MID0gIm5vIHRpY2tldHMiOwoKCQkJCQl2YXIgdG9fdGlja2V0cyA9ICIiOwoJCQkJCWZvciAoY29uc3Qga2V5IGluIHJlc2pzb24pIHsKCQkJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc2pzb24sIGtleSkpIHsKCQkJCQkJCWNvbnN0IGVsZW1lbnQgPSByZXNqc29uW2tleV07CgkJCQkJCQl0b190aWNrZXRzICs9ICI8c3Ryb25nPjx1PiIgKyBlbGVtZW50WyJyZWFzb24iXSArICIgWyIgKyBlbGVtZW50WyJpZCJdICsgIl08L3U+IHwgPGJ1dHRvbiBjbGFzcz0nbmV3YnV0dG9uJyBkYXRhLXR0aXA9J0RlbGV0ZSB0aWNrZXQnIHN0eWxlPSdoZWlnaHQ6MzBweDt3aWR0aDphdXRvO2Rpc3BsYXk6aW5saW5lLWJsb2NrO2NvbG9yOnJlZDsnIG9uY2xpY2s9XCJzZXRfYnV0dG9uKCdkZWxldGVfdGlja2V0JywgJyIgKyBlbGVtZW50WyJpZCJdICsgIicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgeyBub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgJyAnKSwgNzAwMCk7fSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7Y29uc29sZS5lcnJvcihlcnJvcik7fSk7XCI+JnRpbWVzOzwvYnV0dG9uPjwvc3Ryb25nPjxicj4iOwoJCQkJCQkJdG9fdGlja2V0cyArPSAiPHA+IiArIGVsZW1lbnRbImNvbnRlbnQiXSArICI8L3A+IjsKCQkJCQkJCXRvX3RpY2tldHMgKz0gIjxicj48YnI+IjsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9IHRvX3RpY2tldHM7CgkJCQl9KQoJCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkJfSk7CgkJfSwgIk11ZXN0cmEgdHVzIHRpY2tldHMgY3JlYWRvcyIpOwoKCQljX3RleHQocGF0aCwgInVzZXJfdGlja2V0cyIsICIiLCB7IHRleHRBbGlnbjogImNlbnRlciIgfSk7CgoJCWNfYnJlYWsocGF0aCk7CgoJCXBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoKCQljX3RleHQocGF0aCwgIm1haW5fcGZfdGV4dCIsICJQcm9maWxlIiwgewoJCQl0ZXh0QWxpZ246ICdjZW50ZXInLAoJCQlmb250V2VpZ2h0OiAnYm9sZCcsCgkJCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCQkJZm9udFNpemU6ICcyMHB4JywKCQkJbWFyZ2luQm90dG9tOiAnMTBweCcsCgkJCW1hcmdpblRvcDogJzBweCcKCQl9KTsKCgkJY19kaXYocGF0aCwgInVzZXJpbmZvIiwgewoJCQlkaXNwbGF5OiAiaW5saW5lLWdyaWQiLAoJCQlncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDFmcikiLAoJCQlncmlkR2FwOiAiMTBweCIKCQl9KTsKCgkJcGF0aCA9ICJ1c2VyaW5mbyI7CgkJY19pbWFnZShwYXRoLCAidXNlcl9hdmF0YXIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLAoJCQl7CgkJCQlqdXN0aWZ5U2VsZjogInN0YXJ0IiwKCQkJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQkJCW9iamVjdEZpdDogImNvdmVyIiwKCQkJCWJvcmRlclJhZGl1czogIjVweCIKCQkJfSk7CgoJCWNfdGV4dChwYXRoLCAidXNlcl9pbmZvIiwgIm5vbmUiLCB7IGRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjE2MHB4IiwgbWFyZ2luVG9wOiAiMHB4IiB9KTsKCgkJZnVuY3Rpb24gb3duX2luZm8oKSB7CgkJCWdhdGhlcigiZ2V0X3VzZXJfaW5mbyIsICJ6IikKCQkJCS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJCQlsZXQgdV9pbmYgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgoJCQkJCWlmICh1X2luZlsiYXZhdGFyIl0pIHsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfcHJldmlldyIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQkJfQoKCQkJCQl2YXIgdXNlcl9kYXRhID0gIiI7CgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nbWFyZ2luLXRvcDowcHg7bWFyZ2luLWJvdHRvbTowcHg7Jz48c3Ryb25nPkAiICsgdV9pbmZbImFsaWFzIl07CgoJCQkJCWlmICh1X2luZlsicm9sZSJdKQoJCQkJCQl1c2VyX2RhdGEgKz0gIjxzcGFuIHN0eWxlPSdkaXNwbGF5OmlubGluZTtmb250LXNpemU6MTBweDtjb2xvcjoiICsgcm9sZWNsclt1X2luZlsicm9sZSJdLnRvTG93ZXJDYXNlKCldICsgIjsnPiAoIiArIHVfaW5mWyJyb2xlIl0gKyAiKTwvc3Bhbj48YnI+PC9zdHJvbmc+PC9wPiI7CgoJCQkJCWlmICh1X2luZlsidXNlcl9pZCJdKQoJCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPnVpZDogIiArIHVfaW5mWyJ1c2VyX2lkIl07CgkJCQkJZWxzZQoJCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPmJldGEiOwoKCQkJCQlpZiAodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSkKCQkJCQkJdXNlcl9kYXRhICs9ICIgLSBqb2luZWQ6ICIgKyBnX3RtX2R0KHVfaW5mWyJyZWdpc3Rlcl90aW1lIl0sIGZhbHNlKSArICI8L3A+IjsKCQkJCQllbHNlCgkJCQkJCXVzZXJfZGF0YSArPSAiPC9wPiI7CgoJCQkJCWlmICh1X2luZlsiZGVzY3JpcHRpb24iXSkKCQkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+aW5mbzogIiArIHdpbmRvdy5hdG9iKHVfaW5mWyJkZXNjcmlwdGlvbiJdKSArICI8L3A+IjsKCQkJCQllbHNlCgkJCQkJCXVzZXJfZGF0YSArPSAiPHA+PC9wPiIKCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfaW5mbyIpLmlubmVySFRNTCA9IHVzZXJfZGF0YTsKCQkJCX0pCgkJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCQl9KTsKCQl9CgoJCW93bl9pbmZvKCk7CgoJCXBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoJCWNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgoJCWNfYnV0dG9uKHBhdGgsICJvcGVuZGxnYWxpYXMiLCAiY2hhbmdlIGFsaWFzIiwgZnVuY3Rpb24gKCkgewoJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFsaWFzX2RsZyIpOwoJCQlkaWFsb2cuc2hvd01vZGFsKCk7CgkJfSwgIlBlcm1pdGUgY2FtYmlhciBlbCBhbGlhcyAxIHZleiBjYWRhIDMwIGRpYXMuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCgkJY19kaWFsb2cocGF0aCwgImFsaWFzX2RsZyIsIHt9LCB7fSk7CgkJcGF0aCA9ICJhbGlhc19kbGciOwoKCQljX3RleHRib3gocGF0aCwgInBmX2FsaWFzX3RleHRib3giLCBmYWxzZSwgIiIsICIiLCB7CgkJCW1hcmdpblRvcDogIjVweCIsCgkJfSwgewoJCQlwYXR0ZXJuOiAiXlthLXpBLVowLTldKiQiLAoJCQltaW5MZW5ndGg6IDMsCgkJCW1heExlbmd0aDogMjAsCgkJCXJlcXVpcmVkOiB0cnVlLAoJCX0pOwoKCQljX2JyZWFrKCk7CgoJCWNfYnV0dG9uKHBhdGgsICJidG5fY2hhbmdlX2FsaWFzIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCQkJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2FsaWFzX3RleHRib3giKTsKCgkJCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQkJCXZhciB0eHRpbmZvID0gZWxlbV9pdGVtLnZhbHVlOwoJCQkJc2V0X2J1dHRvbigiY2hhbmdlX2FsaWFzIiwgdHh0aW5mbykKCQkJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQkJCW93bl9pbmZvKCk7CgkJCQkJCX0KCQkJCQl9KQoJCQkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCQkJfSk7CgkJCX0KCQkJZWxzZSB7CgkJCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7CgkJCX0KCQl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCQljX2JyZWFrKCk7CgoJCWNfYnV0dG9uKHBhdGgsICJjYW5jZWxfYWxpYXMiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFsaWFzX2RsZyIpOwoJCQlkaWFsb2cuY2xvc2UoKTsKCQl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCQlwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCgkJY19idXR0b24ocGF0aCwgIm9wZW5kbGdhdnRyIiwgImNoYW5nZSBhdmF0YXIiLCBmdW5jdGlvbiAoKSB7CgkJCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9kbGciKTsKCQkJZGlhbG9nLnNob3dNb2RhbCgpOwoJCX0sICJDYW1iaWEgZWwgYXZhdGFyIGEgdW5hIGltYWdlbiwgc29sbyBVUkxTLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pCgoJCWNfZGlhbG9nKHBhdGgsICJhdnRyX2RsZyIpOwoJCXBhdGggPSAiYXZ0cl9kbGciOwoKCQljX2ltYWdlKHBhdGgsICJhdnRyX3ByZXZpZXciLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLCB7CgkJCWRpc3BsYXk6ICJibG9jayIsCgkJCW1hcmdpbjogIjAgYXV0byIsCgkJCW9iamVjdEZpdDogImNvdmVyIgoJCX0pOwoKCQljX2JyZWFrKCk7CgoJCWNfdGV4dChwYXRoLCAiIiwgIkltZ3VyIFVSTCBvbmx5LCBleGFtcGxlLiIsIHsKCQkJdGV4dEFsaWduOiAiY2VudGVyIiwKCQkJY29sb3I6ICJ3aGl0ZSIKCQl9KTsKCQljX3RleHQocGF0aCwgIiIsICJodHRwczovL2kuaW1ndXIuY29tL0duSmFFWkwucG5nIiwgewoJCQl0ZXh0QWxpZ246ICJjZW50ZXIiLAoJCQljb2xvcjogIndoaXRlIgoJCX0pOwoKCQljX3RleHRib3gocGF0aCwgInBmX2F2YXRhcl90ZXh0Ym94IiwgZmFsc2UsICIiLCAiMTAgYSAxMzAgY2FyYWN0ZXJlcy4gRXZpdGFyIHVzYXIgVVJMJ3MgZGUgZ2lmcy92aWRlb3MuIiwgewoJCQltYXJnaW5Ub3A6ICI1cHgiLAoJCQl3aWR0aDogIjk1JSIKCQl9LCB7CgkJCXBhdHRlcm46ICJeKGh0dHBzPzpcL1wvKT8oaVwuaW1ndXJcLmNvbVwvKShbYS16QS1aMC05XSspKFwuanBnfFwuanBlZ3xcLnBuZykkIiwKCQkJbWluTGVuZ3RoOiAyMCwKCQkJbWF4TGVuZ3RoOiA0MCwKCQkJcmVxdWlyZWQ6IHRydWUsCgkJfSk7CgoJCWNfYnJlYWsoKTsKCgkJY19idXR0b24ocGF0aCwgImJ0bl9wcmV2aWV3X2F2YXRhciIsICJwcmV2aWV3IiwgZnVuY3Rpb24gKCkgewoJCQljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYXZhdGFyX3RleHRib3giKTsKCgkJCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSBlbGVtX2l0ZW0udmFsdWU7CgkJCX0KCQkJZWxzZSB7CgkJCQlub3RpZnkoZWxlbV9pdGVtLm1pbkxlbmd0aCArICIgYSAiICsgZWxlbV9pdGVtLm1heExlbmd0aCArICIgY2FyYWN0ZXJlcy4gU2luIGNhcmFjdGVyZXMvc2ltYm9sb3MgZXNwZWNpYWxlcy4iLCA1MDAwLCAiUkVEIik7CgkJCX0KCQl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCQljX2JyZWFrKCk7CgkJY19ocihwYXRoLCBmYWxzZSk7CgoJCWNfYnV0dG9uKHBhdGgsICJidG5fY2hhbmdlX2F2YXRhciIsICJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7CgkJCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwZl9hdmF0YXJfdGV4dGJveCIpOwoKCQkJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCQkJdmFyIHR4dGluZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgkJCQlzZXRfYnV0dG9uKCdjaGFuZ2VfYXZhdGFyJywgdHh0aW5mbykKCQkJCQkudGhlbihmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX3ByZXZpZXciKS5zcmMgPSB0eHRpbmZvOwoJCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfYXZhdGFyIikuc3JjID0gdHh0aW5mbzsKCgkJCQkJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CgkJCQkJCQlkaWFsb2cuY2xvc2UoKTsKCQkJCQkJfQoJCQkJCX0pCgkJCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCQl9KTsKCQkJfQoJCQllbHNlIHsKCQkJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCQkJfQoJCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgoJCWNfYnJlYWsoKTsKCgkJY19idXR0b24ocGF0aCwgImNhbmNlbF9hdnRyIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOwoJCQlkaWFsb2cuY2xvc2UoKTsKCQl9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCQlwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCgkJY19idXR0b24ocGF0aCwgIm9wZW5kbGdkZXNjIiwgImNoYW5nZSBkZXNjcmlwdGlvbiIsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjX2RsZyIpOwoJCQlkaWFsb2cuc2hvd01vZGFsKCk7CgkJfSwgIkNhbWJpYSBsYSBkZXNjcmlwY2lvbiBkZSB0dSBwZXJmaWwuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCgkJY19kaWFsb2cocGF0aCwgImRlc2NfZGxnIik7CgkJcGF0aCA9ICJkZXNjX2RsZyI7CgoJCWNfdGV4dGFyZWEocGF0aCwgImRlc2NyaXB0aW9uX2NvbnRlbnQiLCBmYWxzZSwgIiIsIHsKCQkJaGVpZ2h0OiAnMTAwcHgnLAoJCQlyZXNpemU6ICdub25lJywKCQkJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJCQl3aGl0ZVNwYWNlOiAncHJlLXdyYXAnLAoJCQltYXJnaW5Ub3A6ICI1cHgiLAoJCQlqdXN0aWZ5U2VsZjogImNlbnRlciIsCgkJCXRleHRib3g6IHsKCQkJCWRpc3BsYXk6ICJpbmhlcml0IgoJCQl9CgkJfSwgewoJCQlwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokIiwKCQkJbWluTGVuZ3RoOiA0LAoJCQltYXhMZW5ndGg6IDI1NiwKCQkJcGxhY2Vob2xkZXI6ICJkZXNjcmlwdGlvbiIsCgkJCXJlcXVpcmVkOiB0cnVlLAoJCX0pOwoKCQljX2JyZWFrKCk7CgoJCWNfYnV0dG9uKHBhdGgsICJidG5fY2hhbmdlX2Rlc2NyaXB0aW9uIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCQkJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NyaXB0aW9uX2NvbnRlbnQiKTsKCgkJCWlmIChlbGVtX2l0ZW0udmFsaWRpdHkudmFsaWQpIHsKCQkJCXZhciBkZXNjX2luZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgoJCQkJc2V0X2J1dHRvbigiY2hhbmdlX2Rlc2NyaXB0aW9uIiwgZGVzY19pbmZvKQoJCQkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygiY2hhbmdlZCIpICYmICFyZXNwb25zZVRleHQuaW5jbHVkZXMoIndhaXQiKSkgewoJCQkJCQkJb3duX2luZm8oKTsKCQkJCQkJfQoJCQkJCX0pCgkJCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJCQl9KTsKCQkJfQoJCQllbHNlIHsKCQkJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCQkJfQoJCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgkJY19icmVhaygpOwoKCQljX2J1dHRvbihwYXRoLCAiY2FuY2VsX2Rlc2MiLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NfZGxnIik7CgkJCWRpYWxvZy5jbG9zZSgpOwoJCX0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgoJCWNvbnN0IHZpcnR1YWxLZXlzID0gW107CgoJCWZvciAobGV0IGkgPSAweDQxOyBpIDw9IDB4NUE7IGkrKykgewoJCQl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKCQl9CgoJCWZvciAobGV0IGkgPSAweDMwOyBpIDw9IDB4Mzk7IGkrKykgewoJCQl2aXJ0dWFsS2V5cy5wdXNoKHsgY29kZTogaSwgbmFtZTogU3RyaW5nLmZyb21DaGFyQ29kZShpKSB9KTsKCQl9CgoJCWNvbnN0IHNwZWNpYWxLZXlzID0gWwoJCQl7IGNvZGU6IDAsIG5hbWU6ICdOT05FJyB9LAoJCQl7IGNvZGU6IDB4MDgsIG5hbWU6ICdCYWNrc3BhY2UnIH0sCgkJCXsgY29kZTogMHgwOSwgbmFtZTogJ1RhYicgfSwKCQkJeyBjb2RlOiAweDBELCBuYW1lOiAnRW50ZXInIH0sCgkJCXsgY29kZTogMHgxMCwgbmFtZTogJ1NoaWZ0JyB9LAoJCQl7IGNvZGU6IDB4MTEsIG5hbWU6ICdDdHJsJyB9LAoJCQl7IGNvZGU6IDB4MTIsIG5hbWU6ICdBbHQnIH0sCgkJCXsgY29kZTogMHhBNCwgbmFtZTogJ0xlZnQgQWx0JyB9LAoJCQl7IGNvZGU6IDB4QTUsIG5hbWU6ICdSaWdodCBBbHQnIH0sCgkJCXsgY29kZTogMHgxMywgbmFtZTogJ1BhdXNlL0JyZWFrJyB9LAoJCQl7IGNvZGU6IDB4NUIsIG5hbWU6ICdMZWZ0IFdpbmRvd3MnIH0sCgkJCXsgY29kZTogMHg1QywgbmFtZTogJ1JpZ2h0IFdpbmRvd3MnIH0sCgkJCXsgY29kZTogMHg1RCwgbmFtZTogJ0FwcGxpY2F0aW9ucycgfSwKCQkJeyBjb2RlOiAweDYwLCBuYW1lOiAnTnVtUGFkIDAnIH0sCgkJCXsgY29kZTogMHg2MSwgbmFtZTogJ051bVBhZCAxJyB9LAoJCQl7IGNvZGU6IDB4NjIsIG5hbWU6ICdOdW1QYWQgMicgfSwKCQkJeyBjb2RlOiAweDYzLCBuYW1lOiAnTnVtUGFkIDMnIH0sCgkJCXsgY29kZTogMHg2NCwgbmFtZTogJ051bVBhZCA0JyB9LAoJCQl7IGNvZGU6IDB4NjUsIG5hbWU6ICdOdW1QYWQgNScgfSwKCQkJeyBjb2RlOiAweDY2LCBuYW1lOiAnTnVtUGFkIDYnIH0sCgkJCXsgY29kZTogMHg2NywgbmFtZTogJ051bVBhZCA3JyB9LAoJCQl7IGNvZGU6IDB4NjgsIG5hbWU6ICdOdW1QYWQgOCcgfSwKCQkJeyBjb2RlOiAweDY5LCBuYW1lOiAnTnVtUGFkIDknIH0sCgkJCXsgY29kZTogMHg3MCwgbmFtZTogJ0YxJyB9LAoJCQl7IGNvZGU6IDB4NzEsIG5hbWU6ICdGMicgfSwKCQkJeyBjb2RlOiAweDcyLCBuYW1lOiAnRjMnIH0sCgkJCXsgY29kZTogMHg3MywgbmFtZTogJ0Y0JyB9LAoJCQl7IGNvZGU6IDB4NzQsIG5hbWU6ICdGNScgfSwKCQkJeyBjb2RlOiAweDc1LCBuYW1lOiAnRjYnIH0sCgkJCXsgY29kZTogMHg3NiwgbmFtZTogJ0Y3JyB9LAoJCQl7IGNvZGU6IDB4NzcsIG5hbWU6ICdGOCcgfSwKCQkJeyBjb2RlOiAweDc4LCBuYW1lOiAnRjknIH0sCgkJCXsgY29kZTogMHg3OSwgbmFtZTogJ0YxMCcgfSwKCQkJeyBjb2RlOiAweDdBLCBuYW1lOiAnRjExJyB9LAoJCQl7IGNvZGU6IDB4N0IsIG5hbWU6ICdGMTInIH0sCgkJCXsgY29kZTogMHgwMSwgbmFtZTogJ0xCVVRUT04nIH0sCgkJCXsgY29kZTogMHgwMiwgbmFtZTogJ1JCVVRUT04nIH0sCgkJCXsgY29kZTogMHgwNCwgbmFtZTogJ01CVVRUT04nIH0sCgkJCXsgY29kZTogMHgwNSwgbmFtZTogJ1hCVVRUT04xJyB9LAoJCQl7IGNvZGU6IDB4MDYsIG5hbWU6ICdYQlVUVE9OMicgfSwKCQkJeyBjb2RlOiAweEJCLCBuYW1lOiAnPScgfSwKCQkJeyBjb2RlOiAweEJDLCBuYW1lOiAnLCcgfSwKCQkJeyBjb2RlOiAweEJELCBuYW1lOiAnLScgfSwKCQkJeyBjb2RlOiAweEJFLCBuYW1lOiAnLicgfSwKCQldOwoKCQl2aXJ0dWFsS2V5cy5wdXNoKC4uLnNwZWNpYWxLZXlzKTsKCQl2aXJ0dWFsS2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhLmNvZGUgLSBiLmNvZGU7IH0pOwoKCQlmdW5jdGlvbiBjcmVhdGVPcHRpb25FbGVtZW50KGtleUVsZW1lbnQsIGlkKSB7CgkJCWNvbnN0IG9wdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCQkJb3B0aW9uRWxlbWVudC52YWx1ZSA9IGtleUVsZW1lbnQuY29kZTsKCQkJb3B0aW9uRWxlbWVudC50ZXh0ID0ga2V5RWxlbWVudC5uYW1lOwoJCQlvcHRpb25FbGVtZW50LmlkID0gaWQ7CgkJCXJldHVybiBvcHRpb25FbGVtZW50OwoJCX0KCgkJYmluZF9lbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7CgkJCWNvbnN0IHRhcmdldEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50LnRhcmdldCk7CgkJCXZpcnR1YWxLZXlzLmZvckVhY2goKGtleSkgPT4gewoJCQkJdGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChjcmVhdGVPcHRpb25FbGVtZW50KGtleSwgZWxlbWVudC5pZCkpOwoJCQl9KTsKCQl9KTsKCgkJZnVuY3Rpb24gcmVjZWl2ZV9pbmZvKCkgewoJCQlmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7CgkJCQlnZXRfYm9vbCh1X2Jvb2xbaV0pOwoJCQl9CgoJCQlmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCQkJZ2V0X2Zsb2F0KHVfZmxvYXRbaV0pOwoJCQl9CgoJCQlmb3IgKGNvbnN0IGkgaW4gdV9pbnQpIHsKCQkJCWdldF9pbnQodV9pbnRbaV0pOwoJCQl9CgoJCQlmb3IgKGNvbnN0IGkgaW4gdV9pbnQyKSB7CgkJCQlnZXRfaW50KHVfaW50MltpXSwgZmFsc2UpOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVfc2VydmVyKCkgewoJCQlmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7CgkJCQlzZXRfYm9vbCh1X2Jvb2xbaV0pOwoJCQl9CgoJCQlmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCQkJc2V0X2Zsb2F0KHVfZmxvYXRbaV0pOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBjZW50ZXJfdGFic19maXgoaWQsIGRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIikgewoJCQl2YXIgZWxlbWVudG9zID0gWydlbGVtZW50X21haW4nLCAnZWxlbWVudF9rZXlzJywgJ2VsZW1lbnRfb3ZlcmxheScsICdlbGVtZW50X3NldHRpbmcnLCAnZWxlbWVudF9xcmNvZGUnXTsKCgkJCWVsZW1lbnRvcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50bykgewoJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRvKSkKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50bykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfSk7CgoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5OwoJCX0KCgkJZnVuY3Rpb24gdGFiX3N3aXRjaChpID0gdGhpcy5pZCwgcGFuZWwgPSAiY2VudGVyIiwgZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSB7CgkJCXN3aXRjaCAocGFuZWwpIHsKCQkJCWNhc2UgMjoKCQkJCWNhc2UgIjIiOgoJCQkJY2FzZSAicmlnaHQiOgoJCQkJCWxldCB0YWIyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltjLXRhYjItYnRuXSIpOwoJCQkJCXRhYjJCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4gewoJCQkJCQlpZiAoYnV0dG9uLmlkID09PSBpKSB7CgkJCQkJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIik7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCQlzd2l0Y2ggKGkpIHsKCQkJCQkJY2FzZSAncF91cGRhdGVzJzoKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAncF90aWNrZXRzJzoKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAncF9wcm9maWxlJzoKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAiZ3JpZCI7CgkJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlIDE6CgkJCQljYXNlICIxIjoKCQkJCWNhc2UgImNlbnRlciI6CgkJCQkJbGV0IHRhYkJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbYy10YWItYnRuXSIpOwoJCQkJCXRhYkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7CgkJCQkJCWlmIChidXR0b24uaWQgPT09IGkpIHsKCQkJCQkJCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKTsKCQkJCQkJfQoJCQkJCX0pOwoKCQkJCQlzd2l0Y2ggKGkpIHsKCQkJCQkJY2FzZSAnbWFpbl90YWInOgoJCQkJCQkJY2VudGVyX3RhYnNfZml4KCdlbGVtZW50X21haW4nLCBkaXNwbGF5KTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdrZXlzX3RhYic6CgkJCQkJCQljZW50ZXJfdGFic19maXgoJ2VsZW1lbnRfa2V5cycsIGRpc3BsYXkpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ292ZXJsYXlfdGFiJzoKCQkJCQkJCWNlbnRlcl90YWJzX2ZpeCgnZWxlbWVudF9vdmVybGF5JywgZGlzcGxheSk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnc2V0dGluZ3NfdGFiJzoKCQkJCQkJCWNlbnRlcl90YWJzX2ZpeCgnZWxlbWVudF9zZXR0aW5nJywgZGlzcGxheSk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAncXJjb2RlX3RhYic6CgkJCQkJCQljZW50ZXJfdGFic19maXgoJ2VsZW1lbnRfcXJjb2RlJywgZGlzcGxheSk7CgkJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCXRhYl9zd2l0Y2goIm1haW5fdGFiIiwgImNlbnRlciIsICJub25lIik7CgkJcmVjZWl2ZV9pbmZvKCk7CgoJCXZhciBpdGVyZm91bmQgPSAwOwoJCXZhciB3YXNfZ2FtZV9mb3VuZCA9IGZhbHNlOwoJCXZhciBzaG91bGRfdXBkYXRlID0gdHJ1ZTsKCQl2YXIgaXNfbW91c2VfaW5zaWRlID0gZmFsc2U7CgoJCWZ1bmN0aW9uIGhNb3VzZUUoKSB7IGlzX21vdXNlX2luc2lkZSA9IHRydWU7IH0KCQlmdW5jdGlvbiBoTW91c2VMKCkgeyBpc19tb3VzZV9pbnNpZGUgPSBmYWxzZTsgfQoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiwgaE1vdXNlRSk7CgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VsZWF2ZSIsIGhNb3VzZUwpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ2aXNpYmlsaXR5Y2hhbmdlIiwgKGV2ZW50KSA9PiB7CgkJCWlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT0gInZpc2libGUiKSB7CgkJCQlzaG91bGRfdXBkYXRlID0gdHJ1ZTsKCQkJfSBlbHNlIHsKCQkJCXNob3VsZF91cGRhdGUgPSBmYWxzZTsKCQkJfQoJCX0pOwoKCQl2YXIgdXBkYXRlcnQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgkJCWlmIChzaG91bGRfdXBkYXRlICYmIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsKCQkJCXJlY2VpdmVfaW5mbygpOwoJCQkJZ2V0X29ubGluZXMoKTsKCQkJfQoKCQl9LCA1NTAwKTsKCgoKCQlzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgkJCWlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJCQl1cGRhdGVfY2hhdCgpOwoJCQl9CgkJfSwgMzAwMCk7CgoJCWFzeW5jIGZ1bmN0aW9uIGdhdGhlcihpbmZvLCBleHRyYSwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0pIHsKCQkJcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKCQkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIGluZm8gKyAiJnZhbD0iICsgZXh0cmEsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJCXJlamVjdChlcnJvcik7CgkJCQl9KTsKCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiB6aW5jX2luZm8oaW5mbywgZXh0cmEpIHsKCQkJJC5nZXQoIi9nZXRfaW5mbz9pbmZvPSIgKyBpbmZvLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykgIT0gdW5kZWZpbmVkKSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuaW5uZXJIVE1MID0gZXh0cmEgKyByZXNwb25zZVRleHQ7CgkJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJfSk7CgkJfQoKCQl2YXIgd2FpdGluZyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCQkJJC5nZXQoIi9nZXRfaW5mbz9pbmZvPWdhbWVmb3VuZCIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCXdhc19nYW1lX2ZvdW5kID0gcGFyc2VJbnQocmVzcG9uc2VUZXh0KTsKCQkJCWlmICghd2FzX2dhbWVfZm91bmQpIHsKCQkJCQl6aW5jX2luZm8oIndhaXRpbmdfZ2FtZSIsICJpbnRpYWxpemluZzxicj5jbG9zaW5nIGluOiAiKTsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9kYXlzIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9idXR0b25zIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9tYWluIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9jb25maWciKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCXRhYl9zd2l0Y2goIm1haW5fdGFiIiwgImNlbnRlciIsICJub25lIik7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlpdGVyZm91bmQrKzsKCgkJCQkJaWYgKGl0ZXJmb3VuZCA+IDIpIHsKCQkJCQkJemluY19pbmZvKCJ1c2VyX2RheXMiLCAiZGF5cyBsZWZ0OiAiKTsKCQkJCQkJemluY19pbmZvKCJsYXN0X3VwZGF0ZSIsICI8c3Ryb25nPlVwZGF0ZWQ8L3N0cm9uZz46ICIpOwoJCQkJCQl6aW5jX2luZm8oImNoYW5nZWxvZ3MiLCAiPHN0cm9uZz5DaGFuZ2Vsb2dzPC9zdHJvbmc+OiAiKTsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXRpbmdfZ2FtZSIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2J1dHRvbnMiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9tYWluIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIpOwoJCQkJCQl0YWJfc3dpdGNoKCJwX3VwZGF0ZXMiLCAyKTsKCQkJCQkJY2xlYXJJbnRlcnZhbCh3YWl0aW5nKTsKCQkJCQl9CgkJCQl9CgkJCX0pCgkJfSwgMjUwKTsKCgkJdmFyIHJ1bm5pbmcgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgkJCXRyeSB7CgkJCQkkLmdldCgiL2dldF9pbmZvP2luZm89cnVubmluZyIsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQljYWxsX2V4aXQoKTsKCQkJCX0pOwoJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJY2FsbF9leGl0KCk7CgkJCX0KCQl9LCAxMjUwKTsKCgkJZnVuY3Rpb24gY19kaWFsb2coaWRfd2hlcmUsIGlkX2l0ZW0sIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJCQljb25zdCBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaWFsb2ciKTsKCQkJZGlhbG9nLmlkID0gaWRfaXRlbTsKCgkJCWlmIChzdHlsZXopIHsKCQkJCU9iamVjdC5hc3NpZ24oZGlhbG9nLnN0eWxlLCBzdHlsZXopOwoJCQl9CgoJCQlpZiAoZWxlbW50KSB7CgkJCQlmb3IgKGxldCBrZXkgaW4gZWxlbW50KSB7CgkJCQkJY29uc3QgZWxlbWVudCA9IGVsZW1udFtrZXldOwoJCQkJCWNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50LnR5cGUpOwoJCQkJCU9iamVjdC5hc3NpZ24oZWwsIGVsZW1lbnQucHJvcHMpOwoJCQkJCU9iamVjdC5hc3NpZ24oZWwuc3R5bGUsIGVsZW1lbnQuc3R5bGVzKTsKCQkJCQlkaWFsb2cuYXBwZW5kQ2hpbGQoZWwpOwoJCQkJfQoJCQl9CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSkuYXBwZW5kQ2hpbGQoZGlhbG9nKTsKCQl9CgoJCWZ1bmN0aW9uIGNfZGl2KGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCQkJY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgkJCWRpdi5pZCA9IGlkX2l0ZW07CgkJCWlmIChlbGVtbnQpIHsKCQkJCU9iamVjdC5hc3NpZ24oZGl2LCBlbGVtbnQpOwoKCQkJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJCQlkaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKHN0eWxleikgewoJCQkJT2JqZWN0LmFzc2lnbihkaXYuc3R5bGUsIHN0eWxleik7CgkJCX0KCgkJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CgkJfQoKCQlmdW5jdGlvbiBjX3RhYl9idXR0b24oaWRfd2hlcmUsIGJ1dHRvbnMsIHR5cGV6ID0gMSkgewoJCQljb25zdCB0YWJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgoJCQlidXR0b25zLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbiwgaW5kZXgpIHsKCQkJCXZhciBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCQkJCWJ0bi5jbGFzc05hbWUgPSAidGFiLWJ1dHRvbiI7CgkJCQlidG4uc2V0QXR0cmlidXRlKHR5cGV6ID09IDEgPyAiYy10YWItYnRuIiA6ICgiYy10YWIiICsgdHlwZXogKyAiLWJ0biIpLCAiIik7CgkJCQlidG4uaWQgPSBidXR0b24uaWQ7CgkJCQlidG4uaW5uZXJIVE1MID0gYnV0dG9uLnRleHQ7CgoJCQkJaWYgKGluZGV4ID09PSAwKSB7CgkJCQkJYnRuLnN0eWxlLmJvcmRlclRvcFJpZ2h0UmFkaXVzID0gIjBweCI7CgkJCQl9IGVsc2UgaWYgKGluZGV4ID09PSBidXR0b25zLmxlbmd0aCAtIDEpIHsKCQkJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOwoJCQkJfSBlbHNlIHsKCQkJCQlidG4uc3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXMgPSAiMHB4IjsKCQkJCQlidG4uc3R5bGUuYm9yZGVyVG9wTGVmdFJhZGl1cyA9ICIwcHgiOwoJCQkJfQoKCQkJCWJ0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCQkJCXRhYl9zd2l0Y2godGhpcy5pZCwgdHlwZXopOwoJCQkJfTsKCgkJCQl0YWJDb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTsKCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBnX3RtX2R0KHRpbWVzdGFtcCwgaHJtaW4gPSB0cnVlKSB7CgkJCXZhciBkYXRlID0gbmV3IERhdGUoK3RpbWVzdGFtcCAqIDEwMDApOwoJCQlpZiAoaHJtaW4pIHsKCQkJCXZhciBob3VyID0gKCIwIiArIGRhdGUuZ2V0SG91cnMoKSkuc3Vic3RyKC0yKTsKCQkJCXZhciBtaW51dGVzID0gKCIwIiArIGRhdGUuZ2V0TWludXRlcygpKS5zdWJzdHIoLTIpOwoJCQkJcmV0dXJuIChob3VyICsgIjoiICsgbWludXRlcyk7CgkJCX0KCQkJZWxzZSB7CgkJCQl2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQkJCXZhciBtb250aCA9ICgiMCIgKyAoZGF0ZS5nZXRNb250aCgpICsgMSkpLnN1YnN0cigtMik7CgkJCQl2YXIgZGF5ID0gKCIwIiArIGRhdGUuZ2V0RGF0ZSgpKS5zdWJzdHIoLTIpOwoJCQkJcmV0dXJuIChkYXkgKyAiLyIgKyBtb250aCArICIvIiArIHllYXIpOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBjX2J1dHRvbihpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0sIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CgkJCWNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJCQlidXR0b24udHlwZSA9ICJidXR0b24iOwoJCQlidXR0b24uY2xhc3NMaXN0LmFkZCgibmV3YnV0dG9uIik7CgkJCWJ1dHRvbi5pZCA9IGlkX2l0ZW07CgkJCWJ1dHRvbi5pbm5lckhUTUwgPSB0ZXh0OwoKCQkJaWYgKGVsZW1udCkgewoJCQkJT2JqZWN0LmFzc2lnbihidXR0b24sIGVsZW1udCk7CgoJCQkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQkJCWJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlpZiAoc3R5bGV6KSB7CgkJCQlPYmplY3QuYXNzaWduKGJ1dHRvbi5zdHlsZSwgc3R5bGV6KTsKCQkJfQoKCQkJYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJCQlmdW5jMigpOwoJCQl9OwoKCQkJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQkJCWJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJCQl9CgoJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwoJCX0KCgkJZnVuY3Rpb24gY19ocihpZF93aGVyZSA9IHBhdGgsIG1hcmdpbiA9IHRydWUsIHN0eWxleiA9IHt9KSB7CgkJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQkJdmFyIGhyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHIiKTsKCQkJaWYgKG1hcmdpbikKCQkJCWhyLnN0eWxlLm1hcmdpbkxlZnQgPSAiLTIwcHgiOwoJCQloci5zdHlsZS5ib3JkZXJUb3AgPSAiMXB4IHNvbGlkIHZhcigtLWMtaHIpIjsKCgkJCWlmIChzdHlsZXopIHsKCQkJCU9iamVjdC5hc3NpZ24oaHIuc3R5bGUsIHN0eWxleik7CgkJCX0KCgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChocik7CgkJfQoKCQlmdW5jdGlvbiBjX2JyZWFrKGlkX3doZXJlID0gcGF0aCwgYW1vdW50ID0gMSkgewoJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCWZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhbW91bnQ7IGluZGV4KyspIHsKCQkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gY19jaGVja2JveChpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgdG9vbHRpcCA9ICIiLCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0pIHsKCQkJY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCWRpdi5jbGFzc0xpc3QuYWRkKCdlbGVtaXRlbXNfYmcnKTsKCQkJZGl2Lmh0bWxGb3IgPSBpZF9pdGVtOwoKCQkJY29uc3QgY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJCQljaGVja2JveC50eXBlID0gImNoZWNrYm94IjsKCQkJY2hlY2tib3guaWQgPSBpZF9pdGVtOwoJCQljaGVja2JveC5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKCQkJCXVwZGF0ZV9zZXJ2ZXIoKTsKCQkJCWZ1bmMyKGNoZWNrYm94KTsKCQkJfTsKCgkJCWNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQkJbGFiZWwuaHRtbEZvciA9IGlkX2l0ZW07CgkJCWxhYmVsLmlubmVySFRNTCA9IHRleHQ7CgkJCWxhYmVsLmlkID0gaWRfaXRlbSArICJ6enp6eiI7CgoJCQlpZiAodG9vbHRpcCAhPSAiIikgewoJCQkJZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7CgkJCX0KCgkJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCgkJCWRpdi5hcHBlbmRDaGlsZChjaGVja2JveCk7CgkJCWRpdi5hcHBlbmRDaGlsZChsYWJlbCk7CgoJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgkJCXVfYm9vbC5wdXNoKGlkX2l0ZW0pOwoJCX0KCgkJZnVuY3Rpb24gY19zX2Zsb2F0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBtaW4sIG1heCwgc3RlcF92YWwsIGRlZmF1bHRfdmFsKSB7CgkJCXZhciBzdGVwdmFsX2Nlcm9zID0gKFN0cmluZyhzdGVwX3ZhbCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgkJCXN0ZXB2YWxfY2Vyb3MgPSBzdGVwdmFsX2Nlcm9zLmxlbmd0aDsKCgkJCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlkaXYuY2xhc3NMaXN0LmFkZCgnbGVuZ3RoJywgJ2Zfc2xpZGVyX2JnJyk7CgkJCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTsKCQkJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoKCQkJY29uc3QgdGl0bGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJdGl0bGVEaXYuY2xhc3NMaXN0LmFkZCgnbF90aXRsZScsICdmX3RpdGxlJyk7CgkJCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCBkZWZhdWx0X3ZhbCk7CgkJCXRpdGxlRGl2LnRleHRDb250ZW50ID0gdGV4dCArICI6ICI7CgoJCQljb25zdCBudW1iZXJfaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJCQludW1iZXJfaW5wdXQuY2xhc3NMaXN0LmFkZCgibnVtYmVyc2xpZGVyIik7CgkJCW51bWJlcl9pbnB1dC50eXBlID0gIm51bWJlciI7CgkJCW51bWJlcl9pbnB1dC5wYXR0ZXJuID0gIlswLTldKiI7CgkJCW51bWJlcl9pbnB1dC5pbnB1dE1vZGUgPSAibnVtZXJpYyI7CgkJCW51bWJlcl9pbnB1dC5pZCA9IGlkX2l0ZW07CgkJCW51bWJlcl9pbnB1dC5taW4gPSBtaW47CgkJCW51bWJlcl9pbnB1dC5tYXggPSBtYXg7CgkJCW51bWJlcl9pbnB1dC5zdGVwID0gc3RlcF92YWw7CgkJCW51bWJlcl9pbnB1dC52YWx1ZSA9IGRlZmF1bHRfdmFsOwoJCQludW1iZXJfaW5wdXQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsKCQkJCXVwZGF0ZV9zZXJ2ZXIoKTsKCQkJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7CgkJCX07CgoJCQljb25zdCBtaW51c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCQkJbWludXNfYnRuLmNsYXNzTGlzdC5hZGQoImNvbnRyb2xzLW51bWJlciIpOwoJCQltaW51c19idG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJCQltaW51c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJCQltaW51c19idG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCQkJbWludXNfYnRuLmlubmVySFRNTCA9ICgiJiM4NzIyOyIpLnRyaW0oKTsKCQkJbWludXNfYnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgsIDEsIHN0ZXB2YWxfY2Vyb3MpOwoJCQkJdXBkYXRlX3NlcnZlcigpOwoJCQkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCQkJfTsKCgkJCWNvbnN0IHBsdXNfYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CgkJCXBsdXNfYnRuLmNsYXNzTGlzdC5hZGQoImNvbnRyb2xzLW51bWJlciIpOwoJCQlwbHVzX2J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgkJCXBsdXNfYnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAiOHB4IjsKCQkJcGx1c19idG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCQkJcGx1c19idG4uaW5uZXJIVE1MID0gKCImIzQzOyIpLnRyaW0oKTsKCQkJcGx1c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQkJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAxLCBtaW4sIG1heCwgMSwgc3RlcHZhbF9jZXJvcyk7CgkJCQl1cGRhdGVfc2VydmVyKCk7CgkJCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJCQl9OwoKCQkJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJCQlkaXYuYXBwZW5kQ2hpbGQodGl0bGVEaXYpOwoJCQlkaXYuYXBwZW5kQ2hpbGQobWludXNfYnRuKTsKCQkJZGl2LmFwcGVuZENoaWxkKG51bWJlcl9pbnB1dCk7CgkJCWRpdi5hcHBlbmRDaGlsZChwbHVzX2J0bik7CgoJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgkJCXVfZmxvYXQucHVzaChpZF9pdGVtKTsKCQl9CgoJCWZ1bmN0aW9uIGNfaW1hZ2UoaWRfd2hlcmUsIGlkX2l0ZW0sIGltYWdlLCB3aWR0aCwgaGVpZ2h0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCQkJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCQkJY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CgoJCQlpbWcuc2V0QXR0cmlidXRlKCdpZCcsIGlkX2l0ZW0pOwoJCQlpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBpbWFnZSk7CgkJCWltZy5zZXRBdHRyaWJ1dGUoJ2FsdCcsICJ1X2F2YXRhciIpOwoJCQlpbWcuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTsKCQkJaW1nLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsKCgkJCWlmIChlbGVtbnQpIHsKCQkJCU9iamVjdC5hc3NpZ24oaW1nLCBlbGVtbnQpOwoKCQkJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJCQlpbWcuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKHN0eWxleikgewoJCQkJT2JqZWN0LmFzc2lnbihpbWcuc3R5bGUsIHN0eWxleik7CgkJCX0KCgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpbWcpOwoJCX0KCgkJZnVuY3Rpb24gY190ZXh0YXJlYShpZF93aGVyZSwgaWRfaXRlbSwgaGlkZGVuID0gZmFsc2UsIGxhYmVsID0gIiIsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJCQljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCQlpZiAobGFiZWwgIT09ICIiKSB7CgkJCQl0ZXh0Ym94X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Ym94Iik7CgoJCQkJY29uc3QgbGFiZWxFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQkJCWxhYmVsRWxlbS50ZXh0Q29udGVudCA9IGxhYmVsLnRyaW0oKTsKCQkJCWxhYmVsRWxlbS5pZCA9IGlkX2l0ZW0gKyAibGJsIjsKCQkJCWxhYmVsRWxlbS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgkJCQlsYWJlbEVsZW0uc2V0QXR0cmlidXRlKCJmb3IiLCBpZF9pdGVtKTsKCgkJCQlpZiAoc3R5bGV6ICYmIHN0eWxlei5sYWJlbHopIHsKCQkJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsKCQkJCX0KCQkJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7CgkJCX0KCgkJCWNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKCgkJCXRleHRhcmVhLmlkID0gaWRfaXRlbTsKCgkJCWlmIChlbGVtbnQpIHsKCQkJCU9iamVjdC5hc3NpZ24odGV4dGFyZWEsIGVsZW1udCk7CgoJCQkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQkJCXRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7CgkJCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCXRleHRhcmVhLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCgkJCWlmIChzdHlsZXopIHsKCQkJCU9iamVjdC5hc3NpZ24odGV4dGFyZWEuc3R5bGUsIHN0eWxleik7CgoJCQkJaWYgKHN0eWxlei50ZXh0Ym94KSB7CgkJCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCQkJfQoJCQl9CgoJCQlpZiAobGFiZWwgIT09ICIiKSB7CgkJCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7CgkJCX0gZWxzZSB7CgkJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJCQl9CgoJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7CgkJCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJCQl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gY190ZXh0Ym94KGlkX3doZXJlLCBpZF9pdGVtLCBoaWRkZW4gPSBmYWxzZSwgbGFiZWwgPSAiIiwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30sIGRpc2FibGVzdHlsZSA9IGZhbHNlKSB7CgkJCWNvbnN0IHRleHRib3hfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgkJCWlmIChsYWJlbCAhPT0gIiIpIHsKCQkJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsKCgkJCQljb25zdCBsYWJlbEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOwoJCQkJbGFiZWxFbGVtLnRleHRDb250ZW50ID0gbGFiZWwudHJpbSgpOwoJCQkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOwoJCQkJbGFiZWxFbGVtLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCQkJCWxhYmVsRWxlbS5zZXRBdHRyaWJ1dGUoImZvciIsIGlkX2l0ZW0pOwoKCQkJCWlmIChzdHlsZXogJiYgc3R5bGV6LmxhYmVseikgewoJCQkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei5sYWJlbHopOwoJCQkJfQoKCQkJCXRleHRib3hfZGl2LmFwcGVuZENoaWxkKGxhYmVsRWxlbSk7CgkJCX0KCgkJCWNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCQkJaW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQiKTsKCQkJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoKCQkJaWYgKGRpc2FibGVzdHlsZSkKCQkJCWlucHV0LnNldEF0dHJpYnV0ZSgnZGF0YS1ub3ZhbGlkaW52YWxpZCcsICcnKTsKCgkJCWlmICh0b29sdGlwICE9ICIiKSB7CgkJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApCgkJCX0KCgkJCWlmIChlbGVtbnQpIHsKCQkJCU9iamVjdC5hc3NpZ24oaW5wdXQsIGVsZW1udCk7CgoJCQkJaWYgKGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQkJCWlucHV0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiAoZXYpIHsKCQkJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcywgZXYpOwoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWlucHV0LnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCgkJCWlmIChzdHlsZXopIHsKCQkJCU9iamVjdC5hc3NpZ24oaW5wdXQuc3R5bGUsIHN0eWxleik7CgoJCQkJaWYgKHN0eWxlei50ZXh0Ym94KSB7CgkJCQkJT2JqZWN0LmFzc2lnbih0ZXh0Ym94X2Rpdi5zdHlsZSwgc3R5bGV6LnRleHRib3gpOwoJCQkJfQoJCQl9CgoJCQlpZiAobGFiZWwgIT09ICIiKSB7CgkJCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZChpbnB1dCk7CgkJCX0gZWxzZSB7CgkJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJCQl9CgoJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7CgkJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJCQl9IGVsc2UgaWYgKGNvbnRhaW5lcikgewoJCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gY190ZXh0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCQkJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7CgkJCXRleHRfZGl2LmNsYXNzTGlzdC5hZGQoInRleHQiKTsKCgkJCWlmICh0ZXh0KQoJCQkJdGV4dF9kaXYuaW5uZXJIVE1MID0gdGV4dC50cmltKCk7CgoJCQl0ZXh0X2Rpdi5pZCA9IGlkX2l0ZW07CgoJCQlpZiAoZWxlbW50KSB7CgkJCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LCBlbGVtbnQpOwoKCQkJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJCWZvciAobGV0IGV2ZW50TmFtZSBpbiBlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQkJCQl0ZXh0X2Rpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlpZiAoc3R5bGV6KSB7CgkJCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LnN0eWxlLCBzdHlsZXopOwoJCQl9CgoJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0X2Rpdik7CgkJfQoKCQlmdW5jdGlvbiBjX2NvbWJvYm94MihpZF93aGVyZSwgaWRfaXRlbSwgb3B0aW9ucywgaGlkZGVuID0gZmFsc2UsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30pIHsKCQkJY29uc3Qgc2VsZWN0X2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsKCQkJc2VsZWN0X2VsZW0uY2xhc3NMaXN0LmFkZCgic2VsZWN0LWRyb3Bkb3duIik7CgkJCXNlbGVjdF9lbGVtLmlkID0gaWRfaXRlbTsKCgkJCWlmICh0b29sdGlwICE9ICIiKSB7CgkJCQlzZWxlY3RfZWxlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJCQl9CgoJCQlvcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHsKCQkJCWNvbnN0IG9wdGlvbl9lbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CgkJCQlvcHRpb25fZWxlbS52YWx1ZSA9IGluZGV4OwoJCQkJb3B0aW9uX2VsZW0udGV4dCA9IG9wdGlvbjsKCQkJCXNlbGVjdF9lbGVtLmFkZChvcHRpb25fZWxlbSk7CgkJCX0pOwoKCQkJc2VsZWN0X2VsZW0uc3R5bGUuZGlzcGxheSA9ICgoaGlkZGVuID09IHRydWUpID8gKCJub25lIikgOiAoImlubGluZS1ibG9jayIpKTsKCgkJCWlmIChzdHlsZXopIHsKCQkJCU9iamVjdC5hc3NpZ24oc2VsZWN0X2VsZW0uc3R5bGUsIHN0eWxleik7CgkJCX0KCgkJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdF9lbGVtKTsKCQl9CgoJCWZ1bmN0aW9uIGNfY29tYm9ib3goaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzYW1lbGluZSA9IGZhbHNlLCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9LCBzdHlsZXogPSB7fSkgewoJCQljb25zdCB0ZXh0X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCQl0ZXh0X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Iik7CgkJCXRleHRfZGl2LnRleHRDb250ZW50ID0gdGV4dC50cmltKCk7CgoJCQljb25zdCBzZWxlY3RfZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJCQlzZWxlY3RfZWxlbS5jbGFzc0xpc3QuYWRkKCJzZWxlY3QtZHJvcGRvd24iKTsKCQkJc2VsZWN0X2VsZW0uaWQgPSBpZF9pdGVtOwoKCQkJaWYgKHNhbWVsaW5lKQoJCQkJc2VsZWN0X2VsZW0uc3R5bGUubWFyZ2luUmlnaHQgPSAiMTBweCI7CgoJCQlzZWxlY3RfZWxlbS5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKCQkJCXNldF9pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQkJCWZ1bmMyKCk7CgkJCX07CgoJCQlpZiAodG9vbHRpcCAhPSAiIikgewoJCQkJc2VsZWN0X2VsZW0uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCQkJfQoKCQkJaWYgKHN0eWxleikgewoJCQkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6KTsKCgkJCQlpZiAoc3R5bGV6LnRleHRfZGl2KSB7CgkJCQkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6LnRleHRfZGl2KTsKCQkJCX0KCQkJfQoKCQkJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoJCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwoJCQljb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZWN0X2VsZW0pOwoKCQkJdV9pbnQyLnB1c2goaWRfaXRlbSk7CgkJfQoKCQlmdW5jdGlvbiBjX3NfaW50KGlkX3doZXJlLCBpZF9pdGVtLCBpZF90ZXh0LCBtaW4sIG1heCwgc3RlcCwgdmFsdWUsIHRvb2x0aXAgPSAiIikgewoJCQljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CgoJCQljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdyX3NsaWRlcl9iZycpOwoJCQlkaXYuc2V0QXR0cmlidXRlKCdkYXRhLW1pbicsIG1pbik7CgkJCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4JywgbWF4KTsKCgkJCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCXRpdGxlRGl2LmNsYXNzTGlzdC5hZGQoJ2xfdGl0bGUnLCAnZl90aXRsZScpOwoJCQl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgdmFsdWUpOwoJCQl0aXRsZURpdi50ZXh0Q29udGVudCA9IGlkX3RleHQgKyAiOiAiOwoKCQkJY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoKCQkJY29uc3QgbWludXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCQkJbWludXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7CgkJCW1pbnVzQnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCQkJbWludXNCdG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJCQltaW51c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJCQltaW51c0J0bi5pbm5lckhUTUwgPSAoIiYjODcyMjsiKS50cmltKCk7CgkJCW1pbnVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7CgkJCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgpOwoJCQkJc2V0X2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCQkJYXBwbHlGaWxsKGlucHV0KTsKCQkJfTsKCgkJCWNvbnN0IHBsdXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCQkJcGx1c0J0bi5jbGFzc05hbWUgPSAiY29udHJvbHMtbnVtYmVyIjsKCQkJcGx1c0J0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CgkJCXBsdXNCdG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJCQlwbHVzQnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjhweCI7CgkJCXBsdXNCdG4uaW5uZXJIVE1MID0gKCImIzQzOyIpLnRyaW0oKTsKCQkJcGx1c0J0bi5vbmNsaWNrID0gKCkgPT4gewoJCQkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDEsIG1pbiwgbWF4KTsKCQkJCXNldF9pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQkJCWFwcGx5RmlsbChpbnB1dCk7CgkJCX07CgoJCQlpbnB1dC5jbGFzc0xpc3QuYWRkKCdzbGlkZXInKTsKCQkJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncmFuZ2UnKTsKCQkJaW5wdXQuc2V0QXR0cmlidXRlKCdtaW4nLCBtaW4pOwoJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoJ21heCcsIG1heCk7CgkJCWlucHV0LnNldEF0dHJpYnV0ZSgnc3RlcCcsIHN0ZXApOwoJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgdmFsdWUpOwoJCQlpbnB1dC5vbmNoYW5nZSA9ICgpID0+IHsKCQkJCXNldF9pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQkJCWFwcGx5RmlsbChpbnB1dCk7CgkJCX07CgoJCQlpZiAodG9vbHRpcCAhPSAiIikgewoJCQkJZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS10dGlwIiwgdG9vbHRpcCk7CgkJCX0KCgkJCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7CgkJCWRpdi5hcHBlbmRDaGlsZChtaW51c0J0bik7CgkJCWRpdi5hcHBlbmRDaGlsZChpbnB1dCk7CgkJCWRpdi5hcHBlbmRDaGlsZChwbHVzQnRuKTsKCgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwoKCQkJdV9pbnQucHVzaChpZF9pdGVtKTsKCQl9CgoJCWNvbnN0IHNsaWRlclByb3BzID0gewoJCQliYWNrZ3JvdW5kOiAicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIxNCkiLAoJCX07CgoJCWNvbnN0IHNsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucl9zbGlkZXJfYmciKTsKCgkJc2xpZGVycy5mb3JFYWNoKChzbGlkZXIpID0+IHsKCQkJY29uc3Qgc2xpZGVySW5wdXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLnNsaWRlciIpOwoJCQljb25zdCBzbGlkZXJWYWx1ZSA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpOwoKCQkJc2xpZGVySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoZXZlbnQpID0+IHsKCQkJCXNsaWRlclZhbHVlLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBldmVudC50YXJnZXQudmFsdWUpOwoJCQkJYXBwbHlGaWxsKGV2ZW50LnRhcmdldCk7CgkJCX0pOwoKCQkJYXBwbHlGaWxsKHNsaWRlcklucHV0KTsKCQl9KTsKCgkJY29uc3QgZl9zbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZfc2xpZGVyX2JnIik7CgoJCWZfc2xpZGVycy5mb3JFYWNoKGFzeW5jIChzbGlkZXIpID0+IHsKCQkJY29uc3Qgc2xpZGVySW5wdXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLm51bWJlcnNsaWRlciIpOwoJCQljb25zdCBzbGlkZXJWYWx1ZSA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpOwoKCQkJbGV0IHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHNsaWRlcklucHV0LnN0ZXApLnNwbGl0KCIuIilbMV0gfHwgIiIpOwoKCQkJYXBwbHlGaWxsKHNsaWRlcklucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLmxlbmd0aCwgc2xpZGVySW5wdXQudmFsdWUpOwoJCX0pOwoKCQlmdW5jdGlvbiBhcHBseUZpbGwoc2xpZGVyLCBpc19mbHQgPSBmYWxzZSwgZmx0cGFyc2UgPSAxLCB2YWx1ZSkgewoJCQlpZiAoaXNfZmx0KSB7CgkJCQlzbGlkZXIucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBwYXJzZUZsb2F0KHZhbHVlKS50b0ZpeGVkKGZsdHBhcnNlKSk7CgkJCQlzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IHNsaWRlclByb3BzLmJhY2tncm91bmQ7CgkJCQlzbGlkZXIuc3R5bGUuY29sb3IgPSAndmFyKC0tYy10ZXh0KSc7CgkJCQlzbGlkZXIuc3R5bGUuYm9yZGVyUmFkaXVzID0gIjVweCI7CgkJCQlzbGlkZXIuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCB2YXIoLS1jLWNvbnRvcm5vcykiOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQljb25zdCBwZXJjZW50YWdlID0gKCgxMDAgKiAoc2xpZGVyLnZhbHVlIC0gc2xpZGVyLm1pbikpIC8gKHNsaWRlci5tYXggLSBzbGlkZXIubWluKSkudG9GaXhlZCgxKTsKCQkJY29uc3QgYmcgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCB2YXIoLS1jLXByaW1hcnkpIDAlLCB2YXIoLS1jLXNlY29uZGFyeSkgJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gJHtwZXJjZW50YWdlfSUsICR7c2xpZGVyUHJvcHMuYmFja2dyb3VuZH0gMTAwJSlgOwoJCQlzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IGJnOwoJCQlzbGlkZXIucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBzbGlkZXIudmFsdWUpOwoJCX0KCgkJZnVuY3Rpb24gc3VtcmVzdF9idXR0b25zKGl0ZW1faWQsIHN1bSwgbWluLCBtYXgsIGlzX2ZsdCA9IDAsIGZsdHBhcnNlID0gMSkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkgPT0gdW5kZWZpbmVkKSB7CgkJCQljb25zb2xlLmxvZyhpdGVtX2lkLCAiZG9lc250IGV4aXN0Iik7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmIChpc19mbHQpIHsKCQkJCWlmIChzdW0pIHsKCQkJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VGbG9hdChtYXgpOwoJCQkJCWVsc2UKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQkJCX0gZWxzZSB7CgkJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJCQllbHNlCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gKHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKSkudG9GaXhlZChmbHRwYXJzZSk7CgkJCQl9CgkJCX0KCQkJZWxzZSB7CgkJCQlpZiAoc3VtKSB7CgkJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID4gbWF4KQoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlSW50KG1heCk7CgkJCQkJZWxzZQoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpICsgcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQkJCX0gZWxzZSB7CgkJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlSW50KG1heCk7CgkJCQkJZWxzZQoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQkJCX0KCQkJfQoJCX0KCgkJd2luZG93Lm1vYmlsZUNoZWNrID0gZnVuY3Rpb24gKCkgewoJCQlsZXQgY2hlY2sgPSBmYWxzZTsKCQkJKGZ1bmN0aW9uIChhKSB7IGlmICgvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIGNoZWNrID0gdHJ1ZTsgfSkobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7CgkJCXJldHVybiBjaGVjazsKCQl9OwoKCQl3aW5kb3cuc3RlYW1DaGVjayA9IGZ1bmN0aW9uICgpIHsKCQkJbGV0IHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKCQkJbGV0IGlzU3RlYW1Ccm93c2VyID0gdXNlckFnZW50LmluZGV4T2YoInN0ZWFtIikgPiAtMTsKCQkJcmV0dXJuIGlzU3RlYW1Ccm93c2VyOwoJCX07CgoJCWlmICghd2luZG93Lm1vYmlsZUNoZWNrKCkpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gInNjYW4gb24gbW9iaWxlIG9yIGVudGVyOiAiICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiBvbiB5b3VyIG1vYmlsZSBicm93c2VyIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyaW1hZ2UiKS5zcmMgPSAiaHR0cHM6Ly9jaGFydC5nb29nbGVhcGlzLmNvbS9jaGFydD9jaHQ9cXImY2hsPSIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiJmNocz0yNTB4MjUwJmNobGQ9THwwIjsKCgkJCXdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CgkJCQlpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJCQkJdG9nZ2xlUGFuZWwodGhpcywgJ2xlZnRfcGFuZWwnKTsKCQkJCQl0b2dnbGVQYW5lbCh0aGlzKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWlmICh3aW5kb3cuc3RlYW1DaGVjaygpKSB7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS53aWR0aCA9ICIwcHgiOwoKCQkJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCQl9LCAyNTApOwoKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMDsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS53aWR0aCA9ICIwcHgiOwoKCQkJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCX0sIDI1MCk7CgoJCQkJCQlub3RpZnkoInBhbmVscyBkaXNhYmxlZCBvbiBzdGVhbS4iKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsKCQkJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCQkJfSwgMjUwKTsKCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUub3BhY2l0eSA9IDE7CgkJCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCQkJfSwgMjUwKTsKCQkJCQl9CgkJCQl9CgkJCX07CgkJfQoJCWVsc2UgewoJCQlkb2N1bWVudC5ib2R5LnN0eWxlLnpvb20gPSAiNzUlIjsKCQkJdG9nZ2xlUGFuZWwodGhpcywgJ2xlZnRfcGFuZWwnKTsKCQkJdG9nZ2xlUGFuZWwodGhpcyk7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmNvZGVfdGV4dCIpLmlubmVySFRNTCA9ICJvbmx5IG9uIHBjIi50cmltKCk7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQl9CgoJCWZ1bmN0aW9uIHN0cmluZzJib29sKHN0cmluZykgewoJCQlzd2l0Y2ggKHN0cmluZy50b0xvd2VyQ2FzZSgpLnRyaW0oKSkgewoJCQkJY2FzZSAidHJ1ZSI6CgkJCQljYXNlICJ5ZXMiOgoJCQkJY2FzZSAiMSI6CgkJCQkJcmV0dXJuIHRydWU7CgkJCQljYXNlICJmYWxzZSI6CgkJCQljYXNlICJubyI6CgkJCQljYXNlICIwIjoKCQkJCWNhc2UgbnVsbDoKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBCb29sZWFuKHN0cmluZyk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIGdldF9ib29sKG1vZHVsZSkgewoJCQkkLmdldCgiL2dldF9ib29sP2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuY2hlY2tlZCA9IHN0cmluZzJib29sKHJlc3BvbnNlVGV4dCk7CgkJCX0pOwoJCX0KCgkJZnVuY3Rpb24gZ2V0X2ludChtb2R1bGUsIHJldHVybmVkID0gdHJ1ZSkgewoJCQkkLmdldCgiL2dldF9pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKTsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZSA9IHJlc3BvbnNlVGV4dDsKCgkJCQlpZiAobW9kdWxlLmluY2x1ZGVzKCJ0aGVtZV9zZWxlY3QiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsKCQkJCX0KCgkJCQlpZiAocmV0dXJuZWQpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJpbnB1dCIpKTsKCQkJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZTsKCQkJCX0KCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBnZXRfZmxvYXQobW9kdWxlKSB7CgkJCSQuZ2V0KCIvZ2V0X2Zsb2F0P2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCXZhciBzdGVwdmFsX2Nlcm9zMiA9IChTdHJpbmcoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5zdGVwKS5zcGxpdCgiLiIpWzFdIHx8ICIiKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLnZhbHVlID0gcGFyc2VGbG9hdChyZXNwb25zZVRleHQpLnRvRml4ZWQoc3RlcHZhbF9jZXJvczIubGVuZ3RoKTsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoKCQkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7CgkJCX0pOwoJCX0KCgkJZnVuY3Rpb24gc2V0X2Jvb2wobW9kdWxlKSB7CgkJCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCQkJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKQoJCQkJcmV0dXJuOwoJCQl9CgkJCXZhciB2YWx1ZSA9IG1vZHVsZXouY2hlY2tlZDsKCgkJCSQuZ2V0KCIvc2V0X2Jvb2w/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IH0pOwoJCX0KCgkJZnVuY3Rpb24gc2V0X2ludDIobW9kdWxlLCBtaW4gPSAwLCBtYXggPSAwKSB7CgkJCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCQkJaWYgKG1vZHVsZXogPT0gdW5kZWZpbmVkKSB7CgkJCQljb25zb2xlLmxvZyhtb2R1bGUgKyAiIG5vdCBmb3VuZCIpOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQl2YXIgdmFsdWUgPSBtb2R1bGV6LnZhbHVlOwoKCQkJaWYgKG1pbiA9PSAwICYmIG1heCA9PSAwKSB7CgkJCQkkLmdldCgiL3NldF9pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQkJdmFyIGVsZW1lbnRFeGlzdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpOwoJCQkJCWlmIChlbGVtZW50RXhpc3RzICE9IHVuZGVmaW5lZCB8fCBlbGVtZW50RXhpc3RzICE9IG51bGwpCgkJCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCQkJfSk7CgkJCX0gZWxzZSB7CgkJCQlpZiAocGFyc2VJbnQodmFsdWUpID49IHBhcnNlSW50KG1pbikgJiYgcGFyc2VJbnQodmFsdWUpIDw9IHBhcnNlSW50KG1heCkpIHsKCQkJCQkkLmdldCgiL3NldF9pbnQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQkJCXZhciBlbGVtZW50RXhpc3RzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKTsKCQkJCQkJaWYgKGVsZW1lbnRFeGlzdHMgIT0gdW5kZWZpbmVkIHx8IGVsZW1lbnRFeGlzdHMgIT0gbnVsbCkKCQkJCQkJCWVsZW1lbnRFeGlzdHMuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCQkJCX0pOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJY29uc29sZS5sb2coIm1pbm1heCBvdmVycGFzc2VkIHwgIiwgdmFsdWUsIG1pbiwgbWF4KTsKCQkJCX0KCQkJfQoJCX0KCgkJZnVuY3Rpb24gc2V0X2Zsb2F0KG1vZHVsZSkgewoJCQlsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CgkJCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0IikKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIHZhbHVlID0gcGFyc2VGbG9hdChtb2R1bGV6LnZhbHVlKTsKCQkJdmFyIG1pbiA9IHBhcnNlRmxvYXQobW9kdWxlei5taW4pOwoJCQl2YXIgbWF4ID0gcGFyc2VGbG9hdChtb2R1bGV6Lm1heCk7CgkJCXZhciBzdGVwcyA9IHBhcnNlRmxvYXQobW9kdWxlei5zdGVwKTsKCgkJCWlmICh2YWx1ZSA+PSBtaW4gJiYgdmFsdWUgPD0gbWF4KSB7CgkJCQkkLmdldCgiL3NldF9mbG9hdD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCQkJfSk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIHNldF9pbmZvKG1vZHVsZSwgdmFsdWUsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9KSB7CgkJCSQuZ2V0KCIvc2V0X2luZm8/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlmdW5jMigpOwoJCQl9KTsKCQl9CgoJCWZ1bmN0aW9uIHNldF9idXR0b24obW9kdWxlLCB2YWx1ZSA9ICIiKSB7CgkJCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJCQlpZiAodmFsdWUgPT0gIiIpIHsKCQkJCQkkLmdldCgiL3RvZ2dsZT9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCQkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCQkJCXJlamVjdChlcnJvcik7CgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCQkJfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCQkJcmVqZWN0KGVycm9yKTsKCQkJCQl9KTsKCQkJCX0KCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBjYWxsX2V4aXQoKSB7CgkJCXNldF9idXR0b24oImRlYWQiKTsKCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQl3aW5kb3cub3BlbigiIiwgIl9zZWxmIiwgIiIpOwoJCQkJd2luZG93LmNsb3NlKCk7CgkJCQloaXN0b3J5LmdvKC0xKTsKCQkJCW5hdmlnYXRvci5hcHAuYmFja0hpc3RvcnkoKTsKCQkJCXdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKCQkJfSwgNTAwMCk7CgkJfQoKCQlmdW5jdGlvbiBmX2NvbWJvKGlkX2l0ZW0sIGlkX3NlcnZlcikgewoJCQkkLmdldCgiL2dldF9pbmZvP2luZm89IiArIGlkX3NlcnZlciwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pOwoKCQkJCWlmIChzZWxlY3QgPT0gdW5kZWZpbmVkKSB7CgkJCQkJY29uc29sZS5sb2coaWRfaXRlbSwgImRvZXNudCBleGlzdCIpOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQl2YXIgcmVzcG9uc2UgPSB3aW5kb3cuYXRvYihyZXNwb25zZVRleHQpOwoKCQkJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCQkJcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTsKCQkJCQlpZiAocmVzcG9uc2UgIT0gbnVsbCkgewoJCQkJCQlzZWxlY3QuaW5uZXJIVE1MID0gKCIiKS50cmltKCk7CgoJCQkJCQlmb3IgKGNvbnN0IGtleSBpbiByZXNwb25zZSkgewoJCQkJCQkJaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc3BvbnNlLCBrZXkpKSB7CgkJCQkJCQkJY29uc3QgZWxlbWVudCA9IHJlc3BvbnNlW2tleV07CgkJCQkJCQkJdmFyIG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwoJCQkJCQkJCW9wdC52YWx1ZSA9IGtleTsKCQkJCQkJCQlvcHQuaW5uZXJIVE1MID0gZWxlbWVudFsiaWQiXTsKCQkJCQkJCQlzZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJfQoKCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgZnVuY3Rpb24gKGYpIHsKCQkJaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkgewoJCQkJdG9nZ2xlUGFuZWwodGhpcywgJ2xlZnRfcGFuZWwnLCAxKTsKCQkJCXRvZ2dsZVBhbmVsKHRoaXMsICdyaWdodF9wYW5lbCcsIDEpOwoJCQl9CgkJCWVsc2UgewoJCQkJdG9nZ2xlUGFuZWwodGhpcywgJ2xlZnRfcGFuZWwnLCAyKTsKCQkJCXRvZ2dsZVBhbmVsKHRoaXMsICdyaWdodF9wYW5lbCcsIDIpOwoJCQl9CgkJfSk7CgoJCWFzeW5jIGZ1bmN0aW9uIHRvZ2dsZVBhbmVsKGJ0biwgaWQgPSAicmlnaHRfcGFuZWwiLCB0eXBlID0gMCkgewoJCQljb25zdCBwYW5lbF9lbG0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CgkJCWlmICh0eXBlID09IDApIHsKCQkJCWlmIChwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSAhPSAibm9uZSIpIHsKCQkJCQlwYW5lbF9lbG0uc3R5bGUud2lkdGggPSAiMHB4IjsKCQkJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gIjBweCI7CgkJCQkJcGFuZWxfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMCI7CgkJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJCXBhbmVsX2VsbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCX0sIDI1MCk7CgoJCQkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQkJfQoJCQkJCQllbHNlIHsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQkJYXdhaXQgc2V0VGltZW91dChhc3luYyAoKSA9PiB7IH0sIDI1MCk7CgoJCQkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICJhdXRvIjsKCQkJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwoJCQkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjEiOwoKCQkJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCQkJfQoJCQkJCX0KCgkJCQl9CgkJCX0KCQkJZWxzZSB7CgkJCQlpZiAocGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgIT0gIm5vbmUiICYmIHR5cGUgPT0gMSkgewoJCQkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOwoJCQkJCXBhbmVsX2VsbS5zdHlsZS5oZWlnaHQgPSAiMHB4IjsKCQkJCQlwYW5lbF9lbG0uc3R5bGUub3BhY2l0eSA9ICIwIjsKCQkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQkJcGFuZWxfZWxtLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJfSwgMjUwKTsKCgkJCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCQl9CgkJCQkJCWVsc2UgewoJCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCWVsc2UgaWYgKHR5cGUgPT0gMiAmJiBwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpIHsKCQkJCQlwYW5lbF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQkJYXdhaXQgc2V0VGltZW91dChhc3luYyAoKSA9PiB7IH0sIDI1MCk7CgoJCQkJCXBhbmVsX2VsbS5zdHlsZS53aWR0aCA9ICJhdXRvIjsKCQkJCQlwYW5lbF9lbG0uc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwoJCQkJCXBhbmVsX2VsbS5zdHlsZS5vcGFjaXR5ID0gIjEiOwoKCQkJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJCWlmICgoaWQpLmluY2x1ZGVzKCJyaWdodCIpKSB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCQkJfQoJCQkJCX0KCgkJCQl9CgkJCX0KCQl9CgoJCXZhciB6bm90aWZpY2F0aW9uSWQgPSAwLCBub3RpZmljYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbm90aWZpY2F0aW9uLWNvbnRhaW5lciIpOwoJCWZ1bmN0aW9uIG5vdGlmeShhLCBiLCBkKSB7IGIgPSB2b2lkIDAgPT09IGIgPyAyNTAwIDogYjsgZCA9ICsrem5vdGlmaWNhdGlvbklkOyB2YXIgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOyBjLmNsYXNzTGlzdC5hZGQoIm5vdGlmaWNhdGlvbiIpOyBjLmlubmVySFRNTCA9ICgiPHA+IiArIGEgKyAiPC9wPjxidXR0b24gY2xhc3M9J2Nsb3NlLWJ1dHRvbicgZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBkICsgIic+JnRpbWVzOzwvYnV0dG9uPiIpLnRyaW0oKTsgYy5zdHlsZS53aWR0aCA9ICJhdXRvIjsgbm90aWZpY2F0aW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKGMpOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5yZW1vdmUoKSB9LCA0NTApIH0sIGIpOyAoYSA9IGMucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9CgkJbm90aWZpY2F0aW9uQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGEpIHsgaWYgKGEudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY2xvc2UtYnV0dG9uIikpIHsgdmFyIGIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1ub3RpZmljYXRpb24taWQ9JyIgKyBhLnRhcmdldC5kYXRhc2V0Lm5vdGlmaWNhdGlvbklkICsgIiddIikucGFyZW50RWxlbWVudDsgYi5zdHlsZS5vcGFjaXR5ID0gIjAiOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYi5yZW1vdmUoKSB9LCAyNTApOyAoYSA9IGIucHJldmlvdXNTaWJsaW5nKSAmJiBhLnN0eWxlICYmIChhLnN0eWxlLm1hcmdpblRvcCA9ICI2cHgiKSB9IH0pOwoJCg==";
eval(atob(test));
