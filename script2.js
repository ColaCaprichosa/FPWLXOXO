var A = "Ly8gQHRzLW5vY2hlY2sKCnZhciBkZWZhdWx0X2F2YXRhciA9ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvQ29sYUNhcHJpY2hvc2EvRlBXTFIvbG9nYXJkby5wbmciOwp2YXIgYWxsb3dfYXUgPSB0cnVlOwoKZnVuY3Rpb24gY190aGVtZSgpIHsKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmJvZHk7Cgljb25zdCB0aGVtZV9zZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWVfc2VsZWN0Jyk7Cgljb25zdCBzZWxlY3RlZCA9IHRoZW1lX3NlbGVjdC52YWx1ZTsKCWNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnLCBzZWxlY3RlZCk7CgoJc19pbnQyKCd0aGVtZV9zZWxlY3QnKTsKfQoKZnVuY3Rpb24gZ190bV9pKCkgeyByZXR1cm4gTWF0aC5yb3VuZCgrbmV3IERhdGUoKSAvIDEwMDApOyB9Cgpjb25zdCB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CnRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcCIpOwp0b29sdGlwLmlkID0gIndtdG9vbHRpcCI7CmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcCk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoZXZlbnQpIHsKCWNvbnN0IGVsZW1lbnQgPSBldmVudC50YXJnZXQ7Cgljb25zdCB0b29sdGlwTWVzc2FnZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiKTsKCWlmICh0b29sdGlwTWVzc2FnZSkgewoJCXRvb2x0aXAuaW5uZXJUZXh0ID0gdG9vbHRpcE1lc3NhZ2U7CgkJdG9vbHRpcC5zdHlsZS50b3AgPSBlbGVtZW50Lm9mZnNldFRvcCAtIHRvb2x0aXAub2Zmc2V0SGVpZ2h0IC0gOCArICJweCI7CgkJdG9vbHRpcC5zdHlsZS5sZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgKGVsZW1lbnQub2Zmc2V0V2lkdGggLSB0b29sdGlwLm9mZnNldFdpZHRoKSAvIDIgKyAicHgiOwoJCXRvb2x0aXAuY2xhc3NMaXN0LmFkZCgidG9vbHRpcC0tdmlzaWJsZSIpOwoJfQp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IiwgZnVuY3Rpb24gKGV2ZW50KSB7Cgljb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0OwoJY29uc3QgdG9vbHRpcE1lc3NhZ2UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS10dGlwIik7CglpZiAodG9vbHRpcE1lc3NhZ2UpIHsKCQl0b29sdGlwLmlubmVyVGV4dCA9ICgiLSIpLnRyaW0oKTsKCQl0b29sdGlwLmNsYXNzTGlzdC5yZW1vdmUoInRvb2x0aXAtLXZpc2libGUiKTsKCX0KfSk7CgovKmFscmVhZHkgZGlzcGF0Y2hlZCBpZHMqLwp2YXIgdV9hbF9ib29sID0gW107CnZhciB1X2FsX2Zsb2F0ID0gW107CnZhciB1X2FsX2ludCA9IFtdOwoKdmFyIHVfYm9vbCA9IFtdOwp2YXIgdV9mbG9hdCA9IFtdOwp2YXIgdV9pbnQgPSBbXTsKdmFyIHVfaW50MiA9IFsidGhlbWVfc2VsZWN0Il07CgpwYXRoID0gInBhbmVsX2NoYXQiOwoKY190ZXh0KHBhdGgsICJjaGF0Ym94dHh0IiwgImNoYXQiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CgpjX2RpdihwYXRoLCAiY2hhdC1jb250YWluZXIiLCB7Cgl3aWR0aDogIjIzMHB4IiwKCWhlaWdodDogIjMxNXB4IiwKCW1heEhlaWdodDogIjMxNXB4IiwKCW92ZXJmbG93WTogImF1dG8iLAoJcGFkZGluZzogIjEwcHgiLAoJYmFja2dyb3VuZENvbG9yOiAndmFyKC0tYy1zZWNvbmRhcnkpJywKfSk7CgpjX2JyKCk7CgpmdW5jdGlvbiBzZW5kX2NoYXQoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbGlkaXR5LnZhbGlkKSB7CgkJY29uc3QgY2hhdF90ZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRfdGV4dCIpLnZhbHVlOwoJCXNfYnRuKCJzZW5kX2NoYXQiLCBjaGF0X3RleHQpCgkJCS50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAoIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygiZG9uZSIpKQoJCQkJCXJldHVybjsKCgkJCQlhd2FpdCBzbGVlcCgzNTApOwoJCQkJdV9jaGF0KCk7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsdWUgPSAiIjsKCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhdF90ZXh0IikudmFsdWUgPSAiIjsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoIk5vIHNlIGFjZXB0YW4gY2FyYWN0ZXJlcyBlc3BlY2lhbGVzLCBkZSAxIGEgNjQgY2FyYWN0ZXJlcyBzb2xhbWVudGUuIiwgNTAwMCwgIlJFRCIpOwoJfQp9CgpjX3RleHRib3gocGF0aCwgImNoYXRfdGV4dCIsIGZhbHNlLCAiIiwgIiIsIHt9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokIiwKCW1pbkxlbmd0aDogMSwKCW1heExlbmd0aDogNjQsCglyZXF1aXJlZDogdHJ1ZSwKCXBsYWNlaG9sZGVyOiAid3JpdGUgaGVyZSIsCglldmVudExpc3RlbmVyOiB7CgkJa2V5ZG93bjogZnVuY3Rpb24gKGVsLCBldikgewoJCQlpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CgkJCQlzZW5kX2NoYXQoKTsKCQkJfQoJCX0KCX0KfSwgdHJ1ZSk7CgpjX2J0bihwYXRoLCAiYnRuX3NlbmRfY2hhdCIsICJzZW5kIiwgZnVuY3Rpb24gKCkgewoJc2VuZF9jaGF0KCk7Cn0sICJFbnZpYSB1biBtZW5zYWplIGFsIGNoYXQsIHVuYSB2ZXogY2FkYSAzMCBzZWd1bmRvcy4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX3RleHQocGF0aCwgInVzZXJzb25saW5lIiwgIm5vbmUiLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxMHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwKfSk7CgpmdW5jdGlvbiBnX29ubGluZXMoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKCQlyZXR1cm47CgoJZ2F0aGVyKCJvbmxpbmVzIiwgInp6IikKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCXRyeSB7CgkJCQljb25zdCBsaXZlcyA9IEpTT04ucGFyc2UocmVzdWx0KTsKCQkJCWNvbnN0IG9ubGluZXNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2Vyc29ubGluZScpOwoJCQkJb25saW5lc2VsLmlubmVySFRNTCA9ICI8cCBzdHlsZT0nZm9udC13ZWlnaHQ6Ym9sZDtmb250LXNpemU6MTRweDttYXJnaW4tYm90dG9tOjBweDttYXJnaW4tdG9wOjBweDsnPm9ubGluZXMgKCIgKyBsaXZlcy5saXZlLmxlbmd0aCArICIpPC9wPjxicj4iICsgbGl2ZXMubGl2ZS5qb2luKCIsICIpOwoJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJY29uc29sZS5sb2coZXJyb3IsIHJlc3VsdCk7CgkJCX0KCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0KCmdfb25saW5lcygpOwoKY19ocihwYXRoLCBmYWxzZSwgeyB3aWR0aDogIjIwMHB4IiB9KTsKCmNfYnRuKHBhdGgsICJvcGVuZGxnZmluZHVzZXIiLCAic2VhcmNoIHVzZXIiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmR1c2VyZGxnIik7CglkaWFsb2cuc2hvd01vZGFsKCk7Cn0sICJCdXNjYSB1biB1c3VhcmlvLiIsIHsganVzdGlmeVNlbGY6ICJjZW50ZXIiIH0pOwoKY19icigpOwoKY19kaWFsb2cocGF0aCwgImZpbmR1c2VyZGxnIik7CnBhdGggPSAiZmluZHVzZXJkbGciOwoKY190ZXh0KHBhdGgsICJ1c2VyZmluZHR4dCIsICJzZWFyY2ggdXNlciIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLAoJY29sb3I6ICJ3aGl0ZSIKfSk7CgpjX2JyKHBhdGgpOwoKY190ZXh0Ym94KHBhdGgsICJmaW5kX3VzZXIiLCBmYWxzZSwgIiIsICIiLCB7fSwgewoJcGF0dGVybjogIl5bYS16QS1aMC05XSokIiwKCW1pbkxlbmd0aDogMywKCW1heExlbmd0aDogMjAsCglyZXF1aXJlZDogdHJ1ZSwKCXBsYWNlaG9sZGVyOiAiYWxpYXMiLAoJZXZlbnRMaXN0ZW5lcjogewoJCWtleWRvd246IGZ1bmN0aW9uIChlbCwgZXYpIHsKCQkJaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ0bl9maW5kX3VzZXIiKS5jbGljaygpOwoJCQl9CgkJfQoJfQp9LCB0cnVlKTsKCmNvbnN0IHJvbGVjbHIgPSB7ICJub3JtYWwiOiAiIzYwNjA2MCIsICJwcmVtaXVtIjogIiM4YmIwZmYiLCAiY2hhZCI6ICIjZmZlNThiIiwgIkdPRCI6ICIjZjE0YzM5IiwgIlBBUEkiOiAiI2NlOThlMiIgfTsKdmFyIGZ1X2Nvb2xkb3duID0gMDsKCmNfYnRuKHBhdGgsICJidG5fZmluZF91c2VyIiwgImZpbmQiLCBmdW5jdGlvbiAoKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRfdXNlciIpLnZhbGlkaXR5LnZhbGlkKQoJCWlmIChmdV9jb29sZG93biA+IGdfdG1faSgpKSB7CgkJCWNvbnNvbGUubG9nKCJjb29sZG93biIsIChmdV9jb29sZG93biAtIGdfdG1faSgpKSkKCQkJbm90aWZ5KCJyZWNlbnRseSB1c2VkLCB3YWl0ICIgKyAoZnVfY29vbGRvd24gLSBnX3RtX2koKSkgKyAiIHNlY29uZHMiLCA3MDAwKTsKCQkJcmV0dXJuOwoJCX0KCWdhdGhlcigiaW5mb19hbGlhcyIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kX3VzZXIiKS52YWx1ZSkKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCXRyeSB7CgkJCQl2YXIgdV9pbmYgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgoJCQkJaWYgKHVfaW5mWyJhdmF0YXIiXSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2dHIiKS5zcmMgPSB3aW5kb3cuYXRvYih1X2luZlsiYXZhdGFyIl0pOwoJCQkJfQoKCQkJCXZhciB1c2VyX2RhdGEgPSAiIjsKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J21hcmdpbi10b3A6MHB4O21hcmdpbi1ib3R0b206MHB4Oyc+PHN0cm9uZz5AIiArIHVfaW5mWyJhbGlhcyJdOwoKCQkJCWlmICh1X2luZlsicm9sZSJdKQoJCQkJCXVzZXJfZGF0YSArPSAiPHNwYW4gc3R5bGU9J2Rpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOiIgKyByb2xlY2xyW3VfaW5mWyJyb2xlIl0udG9Mb3dlckNhc2UoKV0gKyAiOyc+ICgiICsgdV9pbmZbInJvbGUiXSArICIpPC9zcGFuPjxicj48L3N0cm9uZz48L3A+IjsKCgkJCQlpZiAodV9pbmZbInVzZXJfaWQiXSkKCQkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPnVpZDogIiArIHVfaW5mWyJ1c2VyX2lkIl07CgkJCQllbHNlCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEwcHg7bWFyZ2luLXRvcDowcHg7Jz5iZXRhIjsKCgkJCQlpZiAodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSkKCQkJCQl1c2VyX2RhdGEgKz0gIiAtIGpvaW5lZDogIiArIGdfdG1fZHQodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSwgZmFsc2UpICsgIjwvcD4iOwoJCQkJZWxzZQoJCQkJCXVzZXJfZGF0YSArPSAiPC9wPiI7CgoJCQkJaWYgKHVfaW5mWyJkZXNjcmlwdGlvbiJdKQoJCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6IDBweDsnPmluZm86ICIgKyB3aW5kb3cuYXRvYih1X2luZlsiZGVzY3JpcHRpb24iXSkgKyAiPC9wPiI7CgkJCQllbHNlCgkJCQkJdXNlcl9kYXRhICs9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDogMHB4Oyc+bm8gaW5mbzwvcD4iCgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfaW5mIikuaW5uZXJIVE1MID0gdXNlcl9kYXRhOwoJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJbm90aWZ5KHJlc3VsdC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQkJaWYgKHJlc3VsdC5pbmNsdWRlcygicmVjZW50bHkiKSkgewoJCQkJCWlmIChmdV9jb29sZG93biA8IGdfdG1faSgpKQoJCQkJCQlmdV9jb29sZG93biA9IGdfdG1faSgpICsgMzA7CgkJCQl9CgkJCX0KCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0sICIiLCB7IG1hcmdpbkxlZnQ6ICIxMHB4IiB9KTsKCmNfYnRuKHBhdGgsICJjbG9zZWZpbmR1c2VyIiwgImNsb3NlIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kdXNlcmRsZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IG1hcmdpbkxlZnQ6ICIxMHB4IiB9KTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CgpjX2RpdihwYXRoLCAidXNlcl9pbmZhbGlhcyIsIHsKCWRpc3BsYXk6ICJpbmxpbmUtZ3JpZCIsCglncmlkVGVtcGxhdGVDb2x1bW5zOiAicmVwZWF0KDMsIDEwNXB4KSIsCglncmlkR2FwOiAiMTBweCIKfSk7CgpjX2JyKHBhdGgsIDIpOwoKY19pbWcoInVzZXJfaW5mYWxpYXMiLCAidXNlcl9hdnRyIiwgZGVmYXVsdF9hdmF0YXIsIDkwLCA5MCwKCXsKCQltYXJnaW5MZWZ0OiAiMTBweCIsCgkJb2JqZWN0Rml0OiAiY292ZXIiLAoJCWJvcmRlclJhZGl1czogIjVweCIsCgkJcGxhY2VTZWxmOiAibm9ybWFsIgoJfSk7CgpjX2JyKHBhdGgsIDIpOwoKY190ZXh0KCJ1c2VyX2luZmFsaWFzIiwgInVzZXJfaW5mIiwgIm5vbmUiLCB7CglkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxNjBweCIsIG1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKCnZhciBsYXN0X21zZyA9IDA7CnZhciBmaXJzdF9zbmQgPSAwOwoKZnVuY3Rpb24gcF9zb3VuZChpZCkgewoJaWYgKGZpcnN0X3NuZCA9PSAwKSB7CgkJZmlyc3Rfc25kKys7Cgl9CgllbHNlIHsKCQl2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCQllbGVtZW50LnZvbHVtZSA9IDAuMTsKCQllbGVtZW50LnBsYXkoKTsKCX0KfQoKZnVuY3Rpb24gdV9jaGF0KCkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpCgkJcmV0dXJuOwoKCWdhdGhlcigiZ2V0X2NoYXQiLCAieiIpCgkJLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewoJCQljb25zdCBjaGF0cyA9IEpTT04ucGFyc2UocmVzdWx0KTsKCQkJY29uc3QgY2hhdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LWNvbnRhaW5lcicpOwoJCQljaGF0Q29udGFpbmVyLmlubmVySFRNTCA9ICcnOwoKCQkJdmFyIGhpZ2hlc3RfdHMgPSAwOwoJCQljaGF0cy5mb3JFYWNoKGFzeW5jIChjaGF0KSA9PiB7CgkJCQlpZiAoaGlnaGVzdF90cyA8IGNoYXQudHMpCgkJCQkJaGlnaGVzdF90cyA9IGNoYXQudHM7CgoJCQkJY29uc3QgY2hhdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCWNoYXRFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gIjEycHgiOwoJCQkJY2hhdEVsZW1lbnQuaW5uZXJIVE1MID0gYCg8c3BhbiBkYXRhLXR0aXA9JyR7Z190bV9kdChjaGF0LnRzLCBmYWxzZSl9JyBzdHlsZT0ib3BhY2l0eTogMC41OyI+JHtnX3RtX2R0KGNoYXQudHMpfTwvc3Bhbj4pIDxzcGFuIHN0eWxlPScke2NoYXQuciAhPSB1bmRlZmluZWQgPyAoImNvbG9yOiIgKyAoT2JqZWN0LmVudHJpZXMocm9sZWNscilbY2hhdC5yXVsiMSJdKSArICI7IikgOiAiIn0nPjxzdHJvbmc+JHtjaGF0LnV9PC9zdHJvbmc+PC9zcGFuPjogJHt3aW5kb3cuYXRvYihjaGF0Lm1zZyl9YDsKCQkJCWNoYXRDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hhdEVsZW1lbnQpOwoKCQkJCWNfaHIoImNoYXQtY29udGFpbmVyIiwgZmFsc2UsIHsKCQkJCQlvcGFjaXR5OiAiMC4yIiwKCQkJCQlwYWRkaW5nVG9wOiAiMHB4IiwKCQkJCQlwYWRkaW5nQm90dG9tOiAiMHB4IiwKCQkJCX0pOwoJCQl9KTsKCgkJCWlmIChsYXN0X21zZyAhPSBoaWdoZXN0X3RzKSB7CgkJCQlwX3NvdW5kKCJzbmQxIik7CgkJCQlsYXN0X21zZyA9IGhpZ2hlc3RfdHM7CgkJCX0KCQl9KQoJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJfSk7Cn0KCnVfY2hhdCgpOwoKdmFyIHBhdGggPSAibWFpbl9lbGVtZW50cyI7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGl0bGVfaWQiKS5pbm5lclRleHQgPSAiWklOQyI7CgpjX3RhYl9idXR0b24oImVsZW1lbnRfcmlnaHRfYnV0dG9ucyIsIFsKCXsgaWQ6ICJwX3VwZGF0ZXMiLCB0ZXh0OiAibG9ncyIgfSwKCXsgaWQ6ICJwX3RpY2tldHMiLCB0ZXh0OiAidGlja2V0cyIgfSwKCXsgaWQ6ICJwX3Byb2ZpbGUiLCB0ZXh0OiAicHJvZmlsZSIgfQpdLCAyKTsKCi8qU1RBUlQgRkVBVFVSRVMqLwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZHVjdF9pZCIpLmlubmVyVGV4dCA9ICJzY3JpcHQiOwoKY190YWJfYnV0dG9uKCJlbGVtZW50X2J1dHRvbnMiLCBbCgl7IGlkOiAibWFpbl90YWIiLCB0ZXh0OiAibWFpbiIgfSwKCXsgaWQ6ICJrZXlzX3RhYiIsIHRleHQ6ICJrZXlzIiB9LAoJeyBpZDogIm92ZXJsYXlfdGFiIiwgdGV4dDogIm92ZXJsYXkiIH0sCgl7IGlkOiAic2V0dGluZ3NfdGFiIiwgdGV4dDogIm1pc2MiIH0sCgl7IGlkOiAicXJjb2RlX3RhYiIsIHRleHQ6ICJRUiIgfQpdKTsKCmNfY29tYm9ib3gocGF0aCwgImFsbF9wcm9maWxlcyIsICIiLCAwLCAyMCwgdHJ1ZSwgIiIsIGFzeW5jIGZ1bmN0aW9uIChlbCkgewoJYXdhaXQgc2xlZXAoNTAwKTsKCXJfaW5mbygpOwoJYXdhaXQgc2xlZXAoNTAwKTsKCXVfc2xpZGVycygpOwp9LCB7IG1pbldpZHRoOiAiMTgwcHgiLCBtYXJnaW5SaWdodDoiLTE4MHB4IiwgcG9zaXRpb246ICdyZWxhdGl2ZScsIHRvcDogJy02OHB4JywgbGVmdDogJzEwMnB4JyB9KTsKCmNfY2hlY2tib3gocGF0aCwgImVuYWJsZV9yY3MiLCAiZW5hYmxlIiwgIkFjdGl2YSBlbCBmdW5jaW9uYW1pZW50byBkZWwgc2NyaXB0LiIpOwpjX2NoZWNrYm94KHBhdGgsICJmYXN0X21vZGUiLCAiZmFzdCBtb2RlIChISUdIIENQVSkiLCAiQWN0aXZhIGVsIG1vZG8gcmFwaWRvLCBmb3J6YW5kbyBhbCBwcm9ncmFtYSBhIGNvbnN1bWlyIG1hcyBDUFUuIiwgZnVuY3Rpb24gKGNfZWwpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzbG93c2V0dGluZ3NfY2ZnIikuc3R5bGUuZGlzcGxheSA9IGNfZWwuY2hlY2tlZCA/ICJub25lIiA6ICJibG9jayI7Cn0pOwoKY19jb21ib2JveChwYXRoLCAid2VhcG9uX2NvbWJvIiwgIndlYXBvbiIsIDAsIDksIGZhbHNlLCAiQXJtYSBxdWUgZWwgc2NyaXB0IGludGVudGFyYSBjb21wZW5zYXIiLCBmdW5jdGlvbiAoKSB7CglyX2luZm8oKTsKfSk7CgpjX2NvbWJvYm94KHBhdGgsICJzY29wZV9jb21ibyIsICJzY29wZSIsIDAsIDQsIGZhbHNlLCAiU2NvcGUgcXVlIGVsIHNjcmlwdCBpbnRlbnRhcmEgY29tcGVuc2FyIik7CmNfY29tYm9ib3gocGF0aCwgImJhcnJlbF9jb21ibyIsICJiYXJyZWwiLCAwLCAzLCBmYWxzZSwgIkJhcnJlbCBxdWUgZWwgc2NyaXB0IGludGVudGFyYSBjb21wZW5zYXIiKTsKCmNfc19mbG9hdChwYXRoLCAic2Vuc2luZ2FtZSIsICJzZW5zaXRpdml0eSIsIDAuMDEsIDMuMCwgMC4wMSwgMS4wLCAiRGViZXMgcG9uZXIgdHUgU0VOU0lCSUxJREFEIGRlbCBqdWVnbyAoIDAuMDEgLSAzLjAwICkiKTsKY19zX2Zsb2F0KHBhdGgsICJmb3ZpbmdhbWUiLCAiZm92IiwgNzAuMCwgOTAuMCwgMS4wLCA5MC4wLCAiRGViZXMgcG9uZXIgdHUgRk9WIGRlbCBqdWVnbyAoIDcwIC0gOTAgKSIpOwoKY19kaXYocGF0aCwgInNsb3dzZXR0aW5nc19jZmciLCB7CglkaXNwbGF5OiAiYmxvY2siLAp9KTsKCnBhdGggPSAic2xvd3NldHRpbmdzX2NmZyI7CmNfc19pbnQocGF0aCwgInJjc3Ntb290aCIsICJzbW9vdGgiLCA0LCAxNSwgMSwgNSwgIk1pZW50cmFzIG1hcyB2YWxvciB0ZW5nYSwgbWFzIHN1YXZlIHNlIHZlIGVsIHNjcmlwdCIpOwoKbGV0IHNob3dfYWR2YW5jZWRfY2ZnID0gZmFsc2U7CmNfYnRuKHBhdGgsICJidG5fc2hvd19kZXYiLCAiYWR2YW5jZWQiLCBmdW5jdGlvbiAoKSB7CglsZXQgZWxtbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWR2bmNfY2ZnIik7CglpZiAoIXNob3dfYWR2YW5jZWRfY2ZnKSB7CgkJZWxtbnQuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJc2hvd19hZHZhbmNlZF9jZmcgPSB0cnVlOwoJfQoJZWxzZSB7CgkJZWxtbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQlzaG93X2FkdmFuY2VkX2NmZyA9IGZhbHNlOwoJfQp9LCAiTXVlc3RyYSBtYXMgY29uZmlndXJhY2lvbmVzLCBwYXNhciBlbCBtb3VzZSBwb3IgYXJyaWJhIGRlIGNhZGEgdW5hLiIpOwoKY19kaXYocGF0aCwgImFkdm5jX2NmZyIsIHsKCWRpc3BsYXk6ICJub25lIiwKfSk7CgpwYXRoID0gImFkdm5jX2NmZyI7CmNfc19mbG9hdChwYXRoLCAicmNzX3giLCAibm9ybWFsIHJjcyB4IiwgMC4wMSwgMS43LCAwLjAxLCAxLjAsICJNaWVudHJhcyBtYXMgdmFsb3IgdGVuZ2EsIG1vdmVyYSBhIGxhIGl6cXVpZXJkYSIpOwpjX3NfZmxvYXQocGF0aCwgInJjc195IiwgIm5vcm1hbCByY3MgeSIsIDAuMDEsIDEuNywgMC4wMSwgMS4wLCAiTWllbnRyYXMgbWFzIHZhbG9yIHRlbmdhLCBiYWphcmEgbWFzIGVsIG1vdmltaWVudG8iKTsKCnBhdGggPSAia2V5c19lbGVtZW50cyI7CmNfY29tYm9ib3gocGF0aCwgIm1haW5fdG9nZ2xlIiwgIm1haW4gdG9nZ2xlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkFjdGl2YS9EZXNhY3RpdmEgZWwgc2NyaXB0Iik7CmNfY29tYm9ib3gocGF0aCwgImNyb3NzX3RvZ2dsZSIsICJjcm9zc2hhaXIgdG9nZ2xlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkFjdGl2YS9EZXNhY3RpdmEgZWwgY3Jvc3NoYWlyIik7CmNfY29tYm9ib3gocGF0aCwgIndlYXBvbl9jeWNsZSIsICJ3ZWFwb24gY3ljbGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiQ2FtYmlhIGEgbGEgc2lndWllbnRlIGFybWEgZW4gbGEgbGlzdGEiKTsKY19jb21ib2JveChwYXRoLCAic2NvcGVfY3ljbGUiLCAic2NvcGUgY3ljbGUiLCAtMTAwMDAwLCAxMDAwMDAsIGZhbHNlLCAiQ2FtYmlhIGFsIHNpZ3VpZW50ZSBzY29wZSBlbiBsYSBsaXN0YSIpOwpjX2NvbWJvYm94KHBhdGgsICJiYXJyZWxfY3ljbGUiLCAiYmFycmVsIGN5Y2xlIiwgLTEwMDAwMCwgMTAwMDAwLCBmYWxzZSwgIkNhbWJpYSBhbCBzaWd1aWVudGUgYmFycmVsIGVuIGxhIGxpc3RhIik7CgpwYXRoID0gIm92ZXJsYXlfZWxlbWVudHMiOwpjX2NoZWNrYm94KHBhdGgsICJvdmVybGF5eiIsICJvdmVybGF5IiwgIkFjdGl2YSBlbCBvdmVybGF5IChkZWJlcyB0ZW5lciBlbCBvdmVybGF5IGRlbCBqdWVnbyBhY3RpdmFkbykuIik7CmNfY2hlY2tib3gocGF0aCwgIndhdGVybWFyayIsICJpbmZvIHdlYXBvbiBhdHRhY2htZW50cyIsICJNdWVzdHJhIHR1IGFybWEtc2NvcGUtYmFycmVsIGFjdHVhbCBkZWwgc2NyaXB0Iik7CmNfY2hlY2tib3gocGF0aCwgImNyb3NzaGFpciIsICJjcm9zc2hhaXIiLCAiTXVlc3RyYSB1biBjcm9zc2hhaXIgKGRvdCkgZW4gbWVkaW8gZGUgbGEgcGFudGFsbGEiKTsKY19jaGVja2JveChwYXRoLCAiZGlzYWJsZWNyb3NzIiwgImRpc2FibGUgY3Jvc3NoYWlyIG9uIGFpbSIsICJEZXNoYWJpbGl0YSB0dSBjcm9zc2hhaXIgYWwgYXB1bnRhciBjb24gUi1DbGljay4iKTsKCmNfc19pbnQocGF0aCwgIm92ZXJsYXlfcG9zX3giLCAib3ZlcmxheSBwb3NpdGlvbiB4IiwgMSwgMjQ0MCwgNSwgMTUpOwpjX3NfaW50KHBhdGgsICJvdmVybGF5X3Bvc195IiwgIm92ZXJsYXkgcG9zaXRpb24geSIsIDEsIDE0NDAsIDUsIDE1KTsKCnBhdGggPSAiZWxlbWVudHNfY2ZnYiI7CmNfY2hlY2tib3gocGF0aCwgInNvdW5kX29uX2NoYW5nZSIsICJzb3VuZHMgb24gd2VhcG9uIGNoYW5nZSIpOwpjX2NoZWNrYm94KHBhdGgsICJzb3VuZF9vbl9lbmRpcyIsICJzb3VuZHMgb24gZW5hYmxlL2Rpc2FibGUiKTsKY19jaGVja2JveChwYXRoLCAic291bmRzb25zdGFydCIsICJzb3VuZHMgb24gc3RhcnQiKTsKCmZfY29tYm8oIndlYXBvbl9jb21ibyIsICJ3ZWFwb25zIik7CmZfY29tYm8oInNjb3BlX2NvbWJvIiwgInNjb3BlcyIpOwpmX2NvbWJvKCJiYXJyZWxfY29tYm8iLCAiYmFycmVscyIpOwoKY29uc3QgYmluZF9lbGVtZW50cyA9IFsKCXsgaWQ6ICJtYWluX3RvZ2dsZSIsIHRhcmdldDogIm1haW5fdG9nZ2xlIiB9LAoJeyBpZDogIndlYXBvbl9jeWNsZSIsIHRhcmdldDogIndlYXBvbl9jeWNsZSIgfSwKCXsgaWQ6ICJzY29wZV9jeWNsZSIsIHRhcmdldDogInNjb3BlX2N5Y2xlIiB9LAoJeyBpZDogImJhcnJlbF9jeWNsZSIsIHRhcmdldDogImJhcnJlbF9jeWNsZSIgfSwKCXsgaWQ6ICJjcm9zc190b2dnbGUiLCB0YXJnZXQ6ICJjcm9zc190b2dnbGUiIH0sCl07CgovKkVORCBGRUFUVVJFUyovCgpmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CmZfY29tYm8oImFsbF9wcm9maWxlczIiLCAiYWxsX3Byb2ZpbGVzIik7CgpwYXRoID0gImVsZW1lbnRzX2NmZ2IiOwoKY19jaGVja2JveChwYXRoLCAiYXV0b191cGRhdGVfbWVudSIsICJBdXRvLXVwZGF0ZSBtZW51IiwgIlNlIGFjdHVhbGl6YXJhIGxhIHBhZ2luYSBhdXRvbWF0aWNhbWVudGUgY2FkYSA1IHNlZ3VuZG9zIGVuIGNhc28gZGUgcXVlIGhheWEgY2FtYmlvcyBkZXNkZSBvdHJhIHBhZ2luYS4iLCBmdW5jdGlvbiAoZWwpIHsKCWFsbG93X2F1ID0gZWwuY2hlY2tlZDsKfSk7CgpjX2hyKCk7CgpjX3RleHQocGF0aCwgInJuZCIsICImIzk2Nzk7IHByb2ZpbGVzIiwgeyBmb250U2l6ZTogIjE4cHgiLCBmb250V2VpZ2h0OiAiYm9sZCIsIG1hcmdpbkxlZnQ6ICIyMHB4IiB9KTsKCmNfY29tYm9ib3gocGF0aCwgImFsbF9wcm9maWxlczIiLCAicHJvZmlsZSIsIDAsIDIwLCBmYWxzZSwgIlBlcmZpbGVzIHBhcmEgY2FkYSBzaXR1YWNpb24uIiwgYXN5bmMgZnVuY3Rpb24gKGVsKSB7Cglhd2FpdCBzbGVlcCg1MDApOwoJcl9pbmZvKCk7Cglhd2FpdCBzbGVlcCg1MDApOwoJdV9zbGlkZXJzKCk7Cn0sIHsgbWluV2lkdGg6ICIxODBweCIgfSk7CgpjX3RleHRib3gocGF0aCwgInByb2ZpbGVfbmFtZV9jIiwgZmFsc2UsICIiLCAiNC0xNiBjaGFyYWN0ZXJzLiIsIHsgbWFyZ2luTGVmdDogIjVweCIsIHdpZHRoOiAiMTUwcHgiIH0sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOV0qJCIsCgltaW5MZW5ndGg6IDQsCgltYXhMZW5ndGg6IDksCglyZXF1aXJlZDogZmFsc2UsCn0sIHRydWUpOwoKY19idG4ocGF0aCwgImJ0bl9wcm9maWxlX2NoYW5nZSIsICJjaGFuZ2UgbmFtZSIsIGZ1bmN0aW9uICgpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZmlsZV9uYW1lX2MiKS52YWxpZGl0eS52YWxpZCkgewoJCXZhciBwcm9mX3ZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2ZpbGVfbmFtZV9jIikudmFsdWU7CgkJc19pbmZvKCJwcm9maWxlX25hbWUiLCBwcm9mX3ZhbHVlKTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZmlsZV9uYW1lX2MiKS52YWx1ZSA9ICIiOwoJCXJfaW5mbygpOwoJCWZfY29tYm8oImFsbF9wcm9maWxlcyIsICJhbGxfcHJvZmlsZXMiKTsKCQlmX2NvbWJvKCJhbGxfcHJvZmlsZXMyIiwgImFsbF9wcm9maWxlcyIpOwoJfQoJZWxzZSB7CgkJbm90aWZ5KCJObyBzZSBhY2VwdGFuIGVzcGFjaW9zIG8gY2FyYWN0ZXJlcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIkNhbWJpYSBlbCBub21icmUgZGVsIHByb2ZpbGUiLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfZXhwb3J0IiwgImV4cG9ydCBwcm9maWxlIiwgZnVuY3Rpb24gKCkgewoJc19idG4oImV4cG9ydF9wcm9maWxlIik7Cn0sICJFeHBvcnRhIGVsIHBlcmZpbCBhY3R1YWwgYWwgQ0xJUEJPQVJELiIsIHsgbWFyZ2luUmlnaHQ6ICIxMHB4IiB9KTsKCmNfYnRuKHBhdGgsICJidG5fcHJvZmlsZV9pbXBvcnQiLCAiaW1wb3J0IHByb2ZpbGUiLCBmdW5jdGlvbiAoKSB7CglzX2J0bigiaW1wb3J0X3Byb2ZpbGUiKTsKCXJfaW5mbygpOwoJZl9jb21ibygiYWxsX3Byb2ZpbGVzIiwgImFsbF9wcm9maWxlcyIpOwoJZl9jb21ibygiYWxsX3Byb2ZpbGVzMiIsICJhbGxfcHJvZmlsZXMiKTsKfSwgIkltcG9ydGEgdW4gcGVyZmlsIGRlc2RlIGVsIENMSVBCT0FSRC4iLCB7IG1hcmdpblJpZ2h0OiAiMTBweCIgfSk7CgpjX2J0bihwYXRoLCAiYnRuX3Byb2ZpbGVfaW1wb3J0IiwgInNldCBkZWZhdWx0IiwgZnVuY3Rpb24gKCkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nmcl9zZXRkZWZhdWx0Jykuc2hvd01vZGFsKCkKfSwgIkRldnVlbHZlIGVsIHBlcmZpbCBhIHZhbG9yZXMgZGVmYXVsdCwgdGFtYmllbiBlbCBub21icmUuIik7CgpjX2RpYWxvZyhwYXRoLCAnY2ZyX3NldGRlZmF1bHQnKTsKY190ZXh0KCdjZnJfc2V0ZGVmYXVsdCcsICJjZnJkbGdkZWZhdWx0cHIiLCAiWW91IGFyZSBhYm91dCB0byBzZXQgdGhlIGN1cnJlbnQ8YnI+cHJvZmlsZSBhcyBkZWZhdWx0IiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2Nmcl9zZXRkZWZhdWx0JywgInJuZCIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJc19idG4oJ2RlZmF1bHRfcHJvZmlsZScpOwoJcl9pbmZvKCk7CglmX2NvbWJvKCJhbGxfcHJvZmlsZXMiLCAiYWxsX3Byb2ZpbGVzIik7CglmX2NvbWJvKCJhbGxfcHJvZmlsZXMyIiwgImFsbF9wcm9maWxlcyIpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNmcl9zZXRkZWZhdWx0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2Nmcl9zZXRkZWZhdWx0JywgInJuZCIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2ZyX3NldGRlZmF1bHQiKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCmNfaHIoKTsKCmNfdGV4dChwYXRoLCAicm5kIiwgIiYjOTY3OTsgY29uZmlnIiwgeyBmb250U2l6ZTogIjE4cHgiLCBmb250V2VpZ2h0OiAiYm9sZCIsIG1hcmdpbkxlZnQ6ICIyMHB4IiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2xvYWRjZmcnKTsKY190ZXh0KCdjb25maXJtX2xvYWRjZmcnLCAiY29uZmlybWRsZ2xvYWRjZmciLCAiWW91IGFyZSBhYm91dCB0byBsb2FkIHlvdXIgbG9jYWwgQ0ZHIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2NvbmZpcm1fbG9hZGNmZycsICJjb25maXJtbG9hZGNmZyIsICJDT05GSVJNIiwgYXN5bmMgZnVuY3Rpb24gKCkgewoJc19idG4oJ2xvYWRfYycpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1fbG9hZGNmZyIpLmNsb3NlKCk7Cglhd2FpdCBzbGVlcCg1MDApOwoJcl9pbmZvKCk7Cgp9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgpjX2J0bignY29uZmlybV9sb2FkY2ZnJywgImNhbmNlbF9sb2FkY2ZnIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2xvYWRjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19kaWFsb2coJ2VsZW1lbnRfY29uZmlnJywgJ2NvbmZpcm1fc2F2ZWNmZycpOwoKY190ZXh0KCdjb25maXJtX3NhdmVjZmcnLCAiY29uZmlybWRsZ3NhdmVjZmciLCAiWW91IGFyZSBhYm91dCB0byBzYXZlIHlvdXIgbG9jYWwgQ0ZHIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCgljb2xvcjogIndoaXRlIgp9KTsKCmNfYnRuKCdjb25maXJtX3NhdmVjZmcnLCAiY29uZmlybXNhdmVjZmciLCAiQ09ORklSTSIsIGZ1bmN0aW9uICgpIHsKCXNfYnRuKCdzYXZlX2MnKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX3NhdmVjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiLCBmb250V2VpZ2h0OiAiYm9sZCIgfSk7CgpjX2J0bignY29uZmlybV9zYXZlY2ZnJywgImNhbmNlbF9zYXZlY2ZnIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX3NhdmVjZmciKS5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2ltcG9ydGNmZycpOwpjX3RleHQoJ2NvbmZpcm1faW1wb3J0Y2ZnJywgImNvbmZpcm1kbGdpbXBjZmciLCAiWW91IGFyZSBhYm91dCB0byBJTVBPUlQgYW5vdGhlciBDRkciLCB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnLAoJZm9udFNpemU6ICcxOHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAoJbWFyZ2luVG9wOiAiMHB4IiwgY29sb3I6ICJ3aGl0ZSIKfSk7CmNfYnRuKCdjb25maXJtX2ltcG9ydGNmZycsICJjb25maXJtaW1wb3J0Y2ZnIiwgIkNPTkZJUk0iLCBmdW5jdGlvbiAoKSB7CglzX2J0bignaW1wb3J0X2MnKQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1faW1wb3J0Y2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1faW1wb3J0Y2ZnJywgImNhbmNlbF9pbXBvcnRjZmciLCAiY2FuY2VsIiwgZnVuY3Rpb24gKCkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1faW1wb3J0Y2ZnIikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfZGlhbG9nKCdlbGVtZW50X2NvbmZpZycsICdjb25maXJtX2V4cG9ydGNmZycpOwpjX3RleHQoJ2NvbmZpcm1fZXhwb3J0Y2ZnJywgImNvbmZpcm1kbGdleHBjZmciLCAiWW91IGFyZSBhYm91dCB0byBFWFBPUlQgdGhlIGVudGlyZSBsb2NhbCBDRkcsPGJyPiB3aGljaCBpbmNsdWRlIGFsbCB5b3VyIHByb2ZpbGVzIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsIGNvbG9yOiAid2hpdGUiCn0pOwpjX2J0bignY29uZmlybV9leHBvcnRjZmcnLCAiY29uZmlybWV4cG9ydGNmZyIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJc19idG4oJ2V4cG9ydF9jJykKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cG9ydGNmZyIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIsIGZvbnRXZWlnaHQ6ICJib2xkIiB9KTsKCmNfYnRuKCdjb25maXJtX2V4cG9ydGNmZycsICJjYW5jZWxfZXhwb3J0Y2ZnIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtX2V4cG9ydGNmZyIpLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpjX2RpYWxvZygnZWxlbWVudF9jb25maWcnLCAnY29uZmlybV9leGl0Jyk7CmNfdGV4dCgnY29uZmlybV9leGl0JywgImNvbmZpcm1kbGdleGl0IiwgIllvdSBhcmUgYWJvdXQgdG8gZXhpdCIsIHsKCXRleHRBbGlnbjogJ2NlbnRlcicsCgl0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZScsCglmb250U2l6ZTogJzE4cHgnLAoJbWFyZ2luQm90dG9tOiAnMTBweCcsCgltYXJnaW5Ub3A6ICIwcHgiLCBjb2xvcjogIndoaXRlIgp9KTsKY19idG4oJ2NvbmZpcm1fZXhpdCcsICJjb25maXJtZXhpdCIsICJDT05GSVJNIiwgZnVuY3Rpb24gKCkgewoJY19leGl0KCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leGl0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiwgZm9udFdlaWdodDogImJvbGQiIH0pOwoKY19idG4oJ2NvbmZpcm1fZXhpdCcsICJjYW5jZWxfZXhpdCIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybV9leGl0IikuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCnBhdGggPSAicGFuZWxfdGlja2V0cyI7CgpjX3RleHQocGF0aCwgInRpY2tldGNlbnRlciIsICJUaWNrZXQgQ2VudGVyIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMThweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogIjBweCIsCn0pOwoKdmFyIHRpY2tldF9mYXFfc3QgPSB7Cgl0ZXh0QWxpZ246ICdjZW50ZXInLAoJZm9udFNpemU6ICcxNHB4JywKCW1hcmdpbkJvdHRvbTogJzEwcHgnLAp9CgpjX3RleHQocGF0aCwgInRja3RmYXEiLCAiLSBEbyBub3Qgc3BhbSB0aGUgdGlja2V0IHN5c3RlbS48YnI+LSBPbmx5IGNyZWF0ZSB0aWNrZXRzIGlmIHlvdSBoYXZlIGFuIGlzc3VlLjxicj4tIE9ubHkgY3JlYXRlIHRpY2tldHMgaWYgeW91IGhhdmUgYSBmZWF0dXJlIHJlcXVlc3QuPGJyPiIsIHRpY2tldF9mYXFfc3QpOwpjX3RleHQocGF0aCwgInRja3RmYXEiLCAiLSBPbmx5IGNyZWF0ZSB0aWNrZXRzIGlmIHlvdSBuZWVkIDx1PmhlbHA8L3U+Ljxicj4tIEFsbCB0aWNrZXRzIGFyZSA8dT5wcml2YXRlPC91Pi48YnI+LSBEbyBub3QgcG9zdCBpcnJlbGV2YW50IGNvbW1lbnRzIGluIHRpY2tldHMgb3IgeW91IG1heSBiZSA8dT5iYW5uZWQ8L3U+LiIsIHRpY2tldF9mYXFfc3QpOwoKY19jb21ib2JveDIocGF0aCwgInRpY2tldF9iZWhhdmlvciIsIFsiQnVnIiwgIkZlYXR1cmUiLCAiT3RoZXIiXSwgdHJ1ZSwgIlNlbGVjY2lvbmEgdW5hIHJhem9uIGRlbCB0aWNrZXQuIik7CgpjX3RleHRhcmVhKHBhdGgsICJ0aWNrZXRfY29udGVudCIsIHRydWUsICIiLCB7CgloZWlnaHQ6ICcxMDBweCcsCglyZXNpemU6ICdub25lJywKCW92ZXJmbG93OiAnaGlkZGVuJywKCXdoaXRlU3BhY2U6ICdwcmUtd3JhcCcsCgltYXJnaW5Ub3A6ICI1cHgiLAp9LCB7CglwYXR0ZXJuOiAiXlthLXpBLVowLTkgXSokezV9IiwKCW1pbkxlbmd0aDogNSwKCW1heExlbmd0aDogMjU2LAoJcGxhY2Vob2xkZXI6ICJpbmZvIiwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCnZhciBzaG93X3RpY2tldF9jID0gZmFsc2U7CmNfYnRuKHBhdGgsICJidG5fY3JlYXRlX3RpY2tldCIsICJjcmVhdGUgdGlja2V0IiwgZnVuY3Rpb24gKCkgewoJaWYgKCFzaG93X3RpY2tldF9jKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9jb250ZW50Iikuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJc2hvd190aWNrZXRfYyA9IHRydWU7CgkJcmV0dXJuOwoJfQoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS52YWxpZGl0eS52YWxpZCkgewoJCXZhciB0aWNrZXRfaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfY29udGVudCIpLnZhbHVlOwoJCXZhciB0aWNrZXRfcmVhc29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRpY2tldF9iZWhhdmlvciIpLnZhbHVlOwoKCQlzX2J0bigiY3JlYXRlX3RpY2tldCIsIHRpY2tldF9yZWFzb24gKyAiLSIgKyB0aWNrZXRfaW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoJCQl9KQoJCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQkJfSk7Cgl9CgllbHNlIHsKCQlub3RpZnkoIk5vIHNlIGFjZXB0YW4gY2FyYWN0ZXJlcyBlc3BlY2lhbGVzLCBkZSA1IGEgMjU2IGNhcmFjdGVyZXMgc29sYW1lbnRlLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIkNyZWEgdW4gdGlja2V0IGVsIGN1YWwgc2VyYSBhdGVuZGlkby92aXN0byBwb3IgbG9zIGFkbWluaXN0cmFkb3Jlcy4iKTsKCmNfaHIocGF0aCwgZmFsc2UsIHsgd2lkdGg6ICIyMDBweCIgfSk7CmNfYnRuKHBhdGgsICJidG5fZ2V0X3RpY2tldHMiLCAidmlldyB0aWNrZXRzIiwgZnVuY3Rpb24gKCkgewoJaWYgKHNob3dfdGlja2V0X2MpIHsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGlja2V0X2NvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aWNrZXRfYmVoYXZpb3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCXNob3dfdGlja2V0X2MgPSBmYWxzZTsKCX0KCglzX2J0bigiZ2V0X3RpY2tldHMiKQoJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJaWYgKHJlc3BvbnNlVGV4dC5pbmNsdWRlcygidXNlcl9oYXNfbm9fdGlja2V0cyIpKSB7CgkJCQlub3RpZnkocmVzcG9uc2VUZXh0LnJlcGxhY2UoL18vZywgIiAiKSwgNzAwMCk7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXZhciByZXNqc29uID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpOwoKCQkJaWYgKHJlc2pzb24ubGVuZ3RoID09IDApIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX3RpY2tldHMiKS5pbm5lckhUTUwgPSAibm8gdGlja2V0cyI7CgkJCQlub3RpZnkoInVzZXIgaGFzIG5vIHRpY2tldHMiLCA3MDAwKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9ICJubyB0aWNrZXRzIjsKCgkJCXZhciB0b190aWNrZXRzID0gIiI7CgkJCWZvciAoY29uc3Qga2V5IGluIHJlc2pzb24pIHsKCQkJCWlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXNqc29uLCBrZXkpKSB7CgkJCQkJY29uc3QgZWxlbWVudCA9IHJlc2pzb25ba2V5XTsKCQkJCQl0b190aWNrZXRzICs9ICI8c3Ryb25nPjx1PiIgKyBlbGVtZW50WyJyZWFzb24iXSArICIgWyIgKyBlbGVtZW50WyJpZCJdICsgIl08L3U+IHwgPGJ1dHRvbiBjbGFzcz0nbmV3YnV0dG9uJyBkYXRhLXR0aXA9J0RlbGV0ZSB0aWNrZXQnIHN0eWxlPSdoZWlnaHQ6MzBweDt3aWR0aDphdXRvO2Rpc3BsYXk6aW5saW5lLWJsb2NrO2NvbG9yOnJlZDsnIG9uY2xpY2s9XCJzX2J0bignZGVsZXRlX3RpY2tldCcsICciICsgZWxlbWVudFsiaWQiXSArICInKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICcgJyksIDcwMDApO30pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge2NvbnNvbGUuZXJyb3IoZXJyb3IpO30pO1wiPiZ0aW1lczs8L2J1dHRvbj48L3N0cm9uZz48YnI+IjsKCQkJCQl0b190aWNrZXRzICs9ICI8cD4iICsgZWxlbWVudFsiY29udGVudCJdICsgIjwvcD4iOwoJCQkJCXRvX3RpY2tldHMgKz0gIjxicj48YnI+IjsKCQkJCX0KCQkJfQoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJfdGlja2V0cyIpLmlubmVySFRNTCA9IHRvX3RpY2tldHM7CgkJfSkKCQkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCX0pOwp9LCAiTXVlc3RyYSB0dXMgdGlja2V0cyBjcmVhZG9zIik7CgpjX3RleHQocGF0aCwgInVzZXJfdGlja2V0cyIsICIiLCB7IHRleHRBbGlnbjogImNlbnRlciIgfSk7CgpjX2JyKHBhdGgpOwoKcGF0aCA9ICJwYW5lbF9wcm9maWxlcyI7CgpjX3RleHQocGF0aCwgIm1haW5fcGZfdGV4dCIsICJQcm9maWxlIiwgewoJdGV4dEFsaWduOiAnY2VudGVyJywKCWZvbnRXZWlnaHQ6ICdib2xkJywKCXRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJywKCWZvbnRTaXplOiAnMjBweCcsCgltYXJnaW5Cb3R0b206ICcxMHB4JywKCW1hcmdpblRvcDogJzBweCcKfSk7CgpjX2RpdihwYXRoLCAidXNlcmluZm8iLCB7CglkaXNwbGF5OiAiaW5saW5lLWdyaWQiLAoJZ3JpZFRlbXBsYXRlQ29sdW1uczogInJlcGVhdCgzLCAxZnIpIiwKCWdyaWRHYXA6ICIxMHB4Igp9KTsKCnBhdGggPSAidXNlcmluZm8iOwpjX2ltZyhwYXRoLCAidXNlcl9hdmF0YXIiLCBkZWZhdWx0X2F2YXRhciwgOTAsIDkwLAoJewoJCWp1c3RpZnlTZWxmOiAic3RhcnQiLAoJCW1hcmdpbkxlZnQ6ICIxMHB4IiwKCQlvYmplY3RGaXQ6ICJjb3ZlciIsCgkJYm9yZGVyUmFkaXVzOiAiNXB4IgoJfSk7CgpjX3RleHQocGF0aCwgInVzZXJfaW5mbyIsICJub25lIiwgeyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxNjBweCIsIG1hcmdpblRvcDogIjBweCIgfSk7CgpmdW5jdGlvbiBvd25faW5mbygpIHsKCWdhdGhlcigiZ2V0X3VzZXJfaW5mbyIsICJ6IikKCQkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgkJCWxldCB1X2luZiA9IEpTT04ucGFyc2UocmVzdWx0KTsKCgkJCWlmICh1X2luZlsiYXZhdGFyIl0pIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2F2YXRhciIpLnNyYyA9IHdpbmRvdy5hdG9iKHVfaW5mWyJhdmF0YXIiXSk7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gd2luZG93LmF0b2IodV9pbmZbImF2YXRhciJdKTsKCQkJfQoKCQkJdmFyIHVzZXJfZGF0YSA9ICIiOwoJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdtYXJnaW4tdG9wOjBweDttYXJnaW4tYm90dG9tOjBweDsnPjxzdHJvbmc+QCIgKyB1X2luZlsiYWxpYXMiXTsKCgkJCWlmICh1X2luZlsicm9sZSJdKQoJCQkJdXNlcl9kYXRhICs9ICI8c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmU7Zm9udC1zaXplOjEwcHg7Y29sb3I6IiArIHJvbGVjbHJbdV9pbmZbInJvbGUiXS50b0xvd2VyQ2FzZSgpXSArICI7Jz4gKCIgKyB1X2luZlsicm9sZSJdICsgIik8L3NwYW4+PGJyPjwvc3Ryb25nPjwvcD4iOwoKCQkJaWYgKHVfaW5mWyJ1c2VyX2lkIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTBweDttYXJnaW4tdG9wOjBweDsnPnVpZDogIiArIHVfaW5mWyJ1c2VyX2lkIl07CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPHAgc3R5bGU9J2ZvbnQtc2l6ZToxMHB4O21hcmdpbi10b3A6MHB4Oyc+YmV0YSI7CgoJCQlpZiAodV9pbmZbInJlZ2lzdGVyX3RpbWUiXSkKCQkJCXVzZXJfZGF0YSArPSAiIC0gam9pbmVkOiAiICsgZ190bV9kdCh1X2luZlsicmVnaXN0ZXJfdGltZSJdLCBmYWxzZSkgKyAiPC9wPiI7CgkJCWVsc2UKCQkJCXVzZXJfZGF0YSArPSAiPC9wPiI7CgoJCQlpZiAodV9pbmZbImRlc2NyaXB0aW9uIl0pCgkJCQl1c2VyX2RhdGEgKz0gIjxwIHN0eWxlPSdmb250LXNpemU6MTJweDttYXJnaW4tdG9wOiAwcHg7Jz5pbmZvOiAiICsgd2luZG93LmF0b2IodV9pbmZbImRlc2NyaXB0aW9uIl0pICsgIjwvcD4iOwoJCQllbHNlCgkJCQl1c2VyX2RhdGEgKz0gIjxwPjwvcD4iCgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9pbmZvIikuaW5uZXJIVE1MID0gdXNlcl9kYXRhOwoJCX0pCgkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQljb25zb2xlLmVycm9yKGVycm9yKTsKCQl9KTsKfQoKb3duX2luZm8oKTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwpjX2hyKHBhdGgsIGZhbHNlLCB7IHdpZHRoOiAiMjAwcHgiIH0pOwoKY19idG4ocGF0aCwgIm9wZW5kbGdhbGlhcyIsICJjaGFuZ2UgYWxpYXMiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFsaWFzX2RsZyIpOwoJZGlhbG9nLnNob3dNb2RhbCgpOwp9LCAiUGVybWl0ZSBjYW1iaWFyIGVsIGFsaWFzIDEgdmV6IGNhZGEgMzAgZGlhcy4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQoKY19kaWFsb2cocGF0aCwgImFsaWFzX2RsZyIsIHt9LCB7fSk7CnBhdGggPSAiYWxpYXNfZGxnIjsKCmNfdGV4dGJveChwYXRoLCAicGZfYWxpYXNfdGV4dGJveCIsIGZhbHNlLCAiIiwgIiIsIHsKCW1hcmdpblRvcDogIjVweCIsCn0sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOV0qJCIsCgltaW5MZW5ndGg6IDMsCgltYXhMZW5ndGg6IDIwLAoJcmVxdWlyZWQ6IHRydWUsCn0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImJ0bl9jaGFuZ2VfYWxpYXMiLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2FsaWFzX3RleHRib3giKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJdmFyIHR4dGluZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgkJc19idG4oImNoYW5nZV9hbGlhcyIsIHR4dGluZm8pCgkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJjaGFuZ2VkIikgJiYgIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygid2FpdCIpKSB7CgkJCQkJb3duX2luZm8oKTsKCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImNhbmNlbF9hbGlhcyIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFsaWFzX2RsZyIpOwoJZGlhbG9nLmNsb3NlKCk7Cn0sICIiLCB7IHdpZHRoOiAiMTAwJSIgfSk7CgpwYXRoID0gInBhbmVsX3Byb2ZpbGVzIjsKCmNfYnRuKHBhdGgsICJvcGVuZGxnYXZ0ciIsICJjaGFuZ2UgYXZhdGFyIiwgZnVuY3Rpb24gKCkgewoJdmFyIGRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdnRyX2RsZyIpOwoJZGlhbG9nLnNob3dNb2RhbCgpOwp9LCAiQ2FtYmlhIGVsIGF2YXRhciBhIHVuYSBpbWFnZW4sIHNvbG8gVVJMUy4iLCB7IGp1c3RpZnlTZWxmOiAiY2VudGVyIiB9KQoKY19kaWFsb2cocGF0aCwgImF2dHJfZGxnIik7CnBhdGggPSAiYXZ0cl9kbGciOwoKY19pbWcocGF0aCwgImF2dHJfcHJldmlldyIsIGRlZmF1bHRfYXZhdGFyLCA5MCwgOTAsIHsKCWRpc3BsYXk6ICJibG9jayIsCgltYXJnaW46ICIwIGF1dG8iLAoJb2JqZWN0Rml0OiAiY292ZXIiCn0pOwoKY19icigpOwoKY190ZXh0KHBhdGgsICIiLCAiSW1ndXIgVVJMIG9ubHksIGV4YW1wbGUuIiwgewoJdGV4dEFsaWduOiAiY2VudGVyIiwKCWNvbG9yOiAid2hpdGUiCn0pOwpjX3RleHQocGF0aCwgIiIsICJodHRwczovL2kuaW1ndXIuY29tL0duSmFFWkwucG5nIiwgewoJdGV4dEFsaWduOiAiY2VudGVyIiwKCWNvbG9yOiAid2hpdGUiCn0pOwoKY190ZXh0Ym94KHBhdGgsICJwZl9hdmF0YXJfdGV4dGJveCIsIGZhbHNlLCAiIiwgIjEwIGEgMTMwIGNhcmFjdGVyZXMuIEV2aXRhciB1c2FyIFVSTCdzIGRlIGdpZnMvdmlkZW9zLiIsIHsKCW1hcmdpblRvcDogIjVweCIsCgl3aWR0aDogIjk1JSIKfSwgewoJcGF0dGVybjogIl4oaHR0cHM/OlwvXC8pPyhpXC5pbWd1clwuY29tXC8pKFthLXpBLVowLTldKykoXC5qcGd8XC5qcGVnfFwucG5nKSQiLAoJbWluTGVuZ3RoOiAyMCwKCW1heExlbmd0aDogNDAsCglyZXF1aXJlZDogdHJ1ZSwKfSk7CgpjX2JyKCk7CgpjX2J0bihwYXRoLCAiYnRuX3ByZXZpZXdfYXZhdGFyIiwgInByZXZpZXciLCBmdW5jdGlvbiAoKSB7Cgljb25zdCBlbGVtX2l0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGZfYXZhdGFyX3RleHRib3giKTsKCglpZiAoZWxlbV9pdGVtLnZhbGlkaXR5LnZhbGlkKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfcHJldmlldyIpLnNyYyA9IGVsZW1faXRlbS52YWx1ZTsKCX0KCWVsc2UgewoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnIoKTsKY19ocihwYXRoLCBmYWxzZSk7CgpjX2J0bihwYXRoLCAiYnRuX2NoYW5nZV9hdmF0YXIiLCAiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoJY29uc3QgZWxlbV9pdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBmX2F2YXRhcl90ZXh0Ym94Iik7CgoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCXZhciB0eHRpbmZvID0gZWxlbV9pdGVtLnZhbHVlOwoJCXNfYnRuKCdjaGFuZ2VfYXZhdGFyJywgdHh0aW5mbykKCQkJLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJbm90aWZ5KHJlc3BvbnNlVGV4dC5yZXBsYWNlKC9fL2csICIgIiksIDcwMDApOwoKCQkJCWlmIChyZXNwb25zZVRleHQuaW5jbHVkZXMoImNoYW5nZWQiKSAmJiAhcmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJ3YWl0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXZ0cl9wcmV2aWV3Iikuc3JjID0gdHh0aW5mbzsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcl9hdmF0YXIiKS5zcmMgPSB0eHRpbmZvOwoKCQkJCQl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CgkJCQkJZGlhbG9nLmNsb3NlKCk7CgkJCQl9CgkJCX0pCgkJCS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQl9KTsKCX0KCWVsc2UgewoJCW5vdGlmeShlbGVtX2l0ZW0ubWluTGVuZ3RoICsgIiBhICIgKyBlbGVtX2l0ZW0ubWF4TGVuZ3RoICsgIiBjYXJhY3RlcmVzLiBTaW4gY2FyYWN0ZXJlcy9zaW1ib2xvcyBlc3BlY2lhbGVzLiIsIDUwMDAsICJSRUQiKTsKCX0KfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJjYW5jZWxfYXZ0ciIsICJjYW5jZWwiLCBmdW5jdGlvbiAoKSB7Cgl2YXIgZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF2dHJfZGxnIik7CglkaWFsb2cuY2xvc2UoKTsKfSwgIiIsIHsgd2lkdGg6ICIxMDAlIiB9KTsKCnBhdGggPSAicGFuZWxfcHJvZmlsZXMiOwoKY19idG4ocGF0aCwgIm9wZW5kbGdkZXNjIiwgImNoYW5nZSBkZXNjcmlwdGlvbiIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY19kbGciKTsKCWRpYWxvZy5zaG93TW9kYWwoKTsKfSwgIkNhbWJpYSBsYSBkZXNjcmlwY2lvbiBkZSB0dSBwZXJmaWwuIiwgeyBqdXN0aWZ5U2VsZjogImNlbnRlciIgfSkKCmNfZGlhbG9nKHBhdGgsICJkZXNjX2RsZyIpOwpwYXRoID0gImRlc2NfZGxnIjsKCmNfdGV4dGFyZWEocGF0aCwgImRlc2NyaXB0aW9uX2NvbnRlbnQiLCBmYWxzZSwgIiIsIHsKCWhlaWdodDogJzEwMHB4JywKCXJlc2l6ZTogJ25vbmUnLAoJb3ZlcmZsb3c6ICdoaWRkZW4nLAoJd2hpdGVTcGFjZTogJ3ByZS13cmFwJywKCW1hcmdpblRvcDogIjVweCIsCglqdXN0aWZ5U2VsZjogImNlbnRlciIsCgl0ZXh0Ym94OiB7CgkJZGlzcGxheTogImluaGVyaXQiCgl9Cn0sIHsKCXBhdHRlcm46ICJeW2EtekEtWjAtOSBdKiQiLAoJbWluTGVuZ3RoOiA0LAoJbWF4TGVuZ3RoOiAyNTYsCglwbGFjZWhvbGRlcjogImRlc2NyaXB0aW9uIiwKCXJlcXVpcmVkOiB0cnVlLAp9KTsKCmNfYnIoKTsKCmNfYnRuKHBhdGgsICJidG5fY2hhbmdlX2Rlc2NyaXB0aW9uIiwgImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCWNvbnN0IGVsZW1faXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXNjcmlwdGlvbl9jb250ZW50Iik7CgoJaWYgKGVsZW1faXRlbS52YWxpZGl0eS52YWxpZCkgewoJCXZhciBkZXNjX2luZm8gPSBlbGVtX2l0ZW0udmFsdWU7CgoJCXNfYnRuKCJjaGFuZ2VfZGVzY3JpcHRpb24iLCBkZXNjX2luZm8pCgkJCS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJCW5vdGlmeShyZXNwb25zZVRleHQucmVwbGFjZSgvXy9nLCAiICIpLCA3MDAwKTsKCgkJCQlpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKCJjaGFuZ2VkIikgJiYgIXJlc3BvbnNlVGV4dC5pbmNsdWRlcygid2FpdCIpKSB7CgkJCQkJb3duX2luZm8oKTsKCQkJCX0KCQkJfSkKCQkJLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJY29uc29sZS5lcnJvcihlcnJvcik7CgkJCX0pOwoJfQoJZWxzZSB7CgkJbm90aWZ5KGVsZW1faXRlbS5taW5MZW5ndGggKyAiIGEgIiArIGVsZW1faXRlbS5tYXhMZW5ndGggKyAiIGNhcmFjdGVyZXMuIFNpbiBjYXJhY3RlcmVzL3NpbWJvbG9zIGVzcGVjaWFsZXMuIiwgNTAwMCwgIlJFRCIpOwoJfQp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY19icigpOwoKY19idG4ocGF0aCwgImNhbmNlbF9kZXNjIiwgImNhbmNlbCIsIGZ1bmN0aW9uICgpIHsKCXZhciBkaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY19kbGciKTsKCWRpYWxvZy5jbG9zZSgpOwp9LCAiIiwgeyB3aWR0aDogIjEwMCUiIH0pOwoKY29uc3QgdmlydHVhbEtleXMgPSBbXTsKCmZvciAobGV0IGkgPSAweDQxOyBpIDw9IDB4NUE7IGkrKykgewoJdmlydHVhbEtleXMucHVzaCh7IGNvZGU6IGksIG5hbWU6IFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgfSk7Cn0KCmZvciAobGV0IGkgPSAweDMwOyBpIDw9IDB4Mzk7IGkrKykgewoJdmlydHVhbEtleXMucHVzaCh7IGNvZGU6IGksIG5hbWU6IFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgfSk7Cn0KCmNvbnN0IHNwZWNpYWxLZXlzID0gWwoJeyBjb2RlOiAwLCBuYW1lOiAnTk9ORScgfSwKCXsgY29kZTogMHgwOCwgbmFtZTogJ0JhY2tzcGFjZScgfSwKCXsgY29kZTogMHgwOSwgbmFtZTogJ1RhYicgfSwKCXsgY29kZTogMHgwRCwgbmFtZTogJ0VudGVyJyB9LAoJeyBjb2RlOiAweDEwLCBuYW1lOiAnU2hpZnQnIH0sCgl7IGNvZGU6IDB4MTEsIG5hbWU6ICdDdHJsJyB9LAoJeyBjb2RlOiAweDEyLCBuYW1lOiAnQWx0JyB9LAoJeyBjb2RlOiAweEE0LCBuYW1lOiAnTGVmdCBBbHQnIH0sCgl7IGNvZGU6IDB4QTUsIG5hbWU6ICdSaWdodCBBbHQnIH0sCgl7IGNvZGU6IDB4MTMsIG5hbWU6ICdQYXVzZS9CcmVhaycgfSwKCXsgY29kZTogMHg1QiwgbmFtZTogJ0xlZnQgV2luZG93cycgfSwKCXsgY29kZTogMHg1QywgbmFtZTogJ1JpZ2h0IFdpbmRvd3MnIH0sCgl7IGNvZGU6IDB4NUQsIG5hbWU6ICdBcHBsaWNhdGlvbnMnIH0sCgl7IGNvZGU6IDB4NjAsIG5hbWU6ICdOdW1QYWQgMCcgfSwKCXsgY29kZTogMHg2MSwgbmFtZTogJ051bVBhZCAxJyB9LAoJeyBjb2RlOiAweDYyLCBuYW1lOiAnTnVtUGFkIDInIH0sCgl7IGNvZGU6IDB4NjMsIG5hbWU6ICdOdW1QYWQgMycgfSwKCXsgY29kZTogMHg2NCwgbmFtZTogJ051bVBhZCA0JyB9LAoJeyBjb2RlOiAweDY1LCBuYW1lOiAnTnVtUGFkIDUnIH0sCgl7IGNvZGU6IDB4NjYsIG5hbWU6ICdOdW1QYWQgNicgfSwKCXsgY29kZTogMHg2NywgbmFtZTogJ051bVBhZCA3JyB9LAoJeyBjb2RlOiAweDY4LCBuYW1lOiAnTnVtUGFkIDgnIH0sCgl7IGNvZGU6IDB4NjksIG5hbWU6ICdOdW1QYWQgOScgfSwKCXsgY29kZTogMHg3MCwgbmFtZTogJ0YxJyB9LAoJeyBjb2RlOiAweDcxLCBuYW1lOiAnRjInIH0sCgl7IGNvZGU6IDB4NzIsIG5hbWU6ICdGMycgfSwKCXsgY29kZTogMHg3MywgbmFtZTogJ0Y0JyB9LAoJeyBjb2RlOiAweDc0LCBuYW1lOiAnRjUnIH0sCgl7IGNvZGU6IDB4NzUsIG5hbWU6ICdGNicgfSwKCXsgY29kZTogMHg3NiwgbmFtZTogJ0Y3JyB9LAoJeyBjb2RlOiAweDc3LCBuYW1lOiAnRjgnIH0sCgl7IGNvZGU6IDB4NzgsIG5hbWU6ICdGOScgfSwKCXsgY29kZTogMHg3OSwgbmFtZTogJ0YxMCcgfSwKCXsgY29kZTogMHg3QSwgbmFtZTogJ0YxMScgfSwKCXsgY29kZTogMHg3QiwgbmFtZTogJ0YxMicgfSwKCXsgY29kZTogMHgwMSwgbmFtZTogJ0xCVVRUT04nIH0sCgl7IGNvZGU6IDB4MDIsIG5hbWU6ICdSQlVUVE9OJyB9LAoJeyBjb2RlOiAweDA0LCBuYW1lOiAnTUJVVFRPTicgfSwKCXsgY29kZTogMHgwNSwgbmFtZTogJ1hCVVRUT04xJyB9LAoJeyBjb2RlOiAweDA2LCBuYW1lOiAnWEJVVFRPTjInIH0sCgl7IGNvZGU6IDB4QkIsIG5hbWU6ICc9JyB9LAoJeyBjb2RlOiAweEJDLCBuYW1lOiAnLCcgfSwKCXsgY29kZTogMHhCRCwgbmFtZTogJy0nIH0sCgl7IGNvZGU6IDB4QkUsIG5hbWU6ICcuJyB9LApdOwoKdmlydHVhbEtleXMucHVzaCguLi5zcGVjaWFsS2V5cyk7CnZpcnR1YWxLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEuY29kZSAtIGIuY29kZTsgfSk7CgpmdW5jdGlvbiBjcmVhdGVPcHRpb25FbGVtZW50KGtleUVsZW1lbnQsIGlkKSB7Cgljb25zdCBvcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CglvcHRpb25FbGVtZW50LnZhbHVlID0ga2V5RWxlbWVudC5jb2RlOwoJb3B0aW9uRWxlbWVudC50ZXh0ID0ga2V5RWxlbWVudC5uYW1lOwoJb3B0aW9uRWxlbWVudC5pZCA9IGlkICsgIl9vcHQiOwoJcmV0dXJuIG9wdGlvbkVsZW1lbnQ7Cn0KCmJpbmRfZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4gewoJY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnQudGFyZ2V0KTsKCXZpcnR1YWxLZXlzLmZvckVhY2goKGtleSkgPT4gewoJCXRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQoY3JlYXRlT3B0aW9uRWxlbWVudChrZXksIGVsZW1lbnQuaWQpKTsKCX0pOwp9KTsKCmZ1bmN0aW9uIHJfaW5mbygpIHsKCWZvciAoY29uc3QgaSBpbiB1X2Jvb2wpIHsKCQlnX2Jvb2wodV9ib29sW2ldKTsKCX0KCglmb3IgKGNvbnN0IGkgaW4gdV9mbG9hdCkgewoJCWdfZmxvYXQodV9mbG9hdFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfaW50KSB7CgkJZ19pbnQodV9pbnRbaV0pOwoJfQoKCWZvciAoY29uc3QgaSBpbiB1X2ludDIpIHsKCQlnX2ludCh1X2ludDJbaV0sIGZhbHNlKTsKCX0KfQoKZnVuY3Rpb24gdV9zZXJ2ZXIoKSB7Cglmb3IgKGNvbnN0IGkgaW4gdV9ib29sKSB7CgkJc19ib29sKHVfYm9vbFtpXSk7Cgl9CgoJZm9yIChjb25zdCBpIGluIHVfZmxvYXQpIHsKCQlzX2Zsb2F0KHVfZmxvYXRbaV0pOwoJfQp9CgpmdW5jdGlvbiBjdGFiX2ZpeChpZCwgZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siKSB7Cgl2YXIgZWxlbWVudG9zID0gWydlbGVtZW50X21haW4nLCAnZWxlbWVudF9rZXlzJywgJ2VsZW1lbnRfb3ZlcmxheScsICdlbGVtZW50X3NldHRpbmcnLCAnZWxlbWVudF9xcmNvZGUnXTsKCgllbGVtZW50b3MuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudG8pIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudG8pKQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50bykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCX0pOwoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5Owp9CgpmdW5jdGlvbiB0YWJfc3dpdGNoKGkgPSB0aGlzLmlkLCBwYW5lbCA9ICJjZW50ZXIiLCBkaXNwbGF5ID0gImlubGluZS1ibG9jayIpIHsKCXN3aXRjaCAocGFuZWwpIHsKCQljYXNlIDI6CgkJY2FzZSAiMiI6CgkJY2FzZSAicmlnaHQiOgoJCQlsZXQgdGFiMkJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbYy10YWIyLWJ0bl0iKTsKCQkJdGFiMkJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7CgkJCQlpZiAoYnV0dG9uLmlkID09PSBpKSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwoJCQkJfSBlbHNlIHsKCQkJCQlidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIik7CgkJCQl9CgkJCX0pOwoJCQlzd2l0Y2ggKGkpIHsKCQkJCWNhc2UgJ3BfdXBkYXRlcyc6CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3VwZGF0ZXMnKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF90aWNrZXRzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfcHJvZmlsZXMnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAncF90aWNrZXRzJzoKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdXBkYXRlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3RpY2tldHMnKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF9wcm9maWxlcycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdwX3Byb2ZpbGUnOgoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYW5lbF91cGRhdGVzJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFuZWxfdGlja2V0cycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbmVsX3Byb2ZpbGVzJykuc3R5bGUuZGlzcGxheSA9ICJncmlkIjsKCQkJCQlicmVhazsKCQkJfQoJCQlicmVhazsKCQljYXNlIDE6CgkJY2FzZSAiMSI6CgkJY2FzZSAiY2VudGVyIjoKCQkJbGV0IHRhYkJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbYy10YWItYnRuXSIpOwoJCQl0YWJCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4gewoJCQkJaWYgKGJ1dHRvbi5pZCA9PT0gaSkgewoJCQkJCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKCQkJCX0gZWxzZSB7CgkJCQkJYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOwoJCQkJfQoJCQl9KTsKCgkJCXN3aXRjaCAoaSkgewoJCQkJY2FzZSAnbWFpbl90YWInOgoJCQkJCWN0YWJfZml4KCdlbGVtZW50X21haW4nLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ2tleXNfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9rZXlzJywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdvdmVybGF5X3RhYic6CgkJCQkJY3RhYl9maXgoJ2VsZW1lbnRfb3ZlcmxheScsIGRpc3BsYXkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAnc2V0dGluZ3NfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9zZXR0aW5nJywgZGlzcGxheSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdxcmNvZGVfdGFiJzoKCQkJCQljdGFiX2ZpeCgnZWxlbWVudF9xcmNvZGUnLCBkaXNwbGF5KTsKCQkJCQlicmVhazsKCQkJfQoJCQlicmVhazsKCX0KfQoKdGFiX3N3aXRjaCgibWFpbl90YWIiLCAiY2VudGVyIiwgIm5vbmUiKTsKcl9pbmZvKCk7Cgp2YXIgaXRlcmZvdW5kID0gMDsKdmFyIHdhc19nYW1lX2ZvdW5kID0gZmFsc2U7CnZhciBzaG91bGRfdXBkYXRlID0gdHJ1ZTsKdmFyIGlzX21vdXNlX2luc2lkZSA9IGZhbHNlOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VlbnRlciIsIGZ1bmN0aW9uICgpIHsgaXNfbW91c2VfaW5zaWRlID0gdHJ1ZTsgfSk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbGVhdmUiLCBmdW5jdGlvbiAoKSB7IGlzX21vdXNlX2luc2lkZSA9IGZhbHNlOyB9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInZpc2liaWxpdHljaGFuZ2UiLCAoZXZlbnQpID0+IHsKCWlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT0gInZpc2libGUiKSB7CgkJc2hvdWxkX3VwZGF0ZSA9IHRydWU7Cgl9IGVsc2UgewoJCXNob3VsZF91cGRhdGUgPSBmYWxzZTsKCX0KfSk7Cgp2YXIgdXBkYXRlcnQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CglpZiAoYWxsb3dfYXUgJiYgc2hvdWxkX3VwZGF0ZSAmJiBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPSAibm9uZSIgJiYgaXNfbW91c2VfaW5zaWRlKSB7CgkJcl9pbmZvKCk7CgkJZ19vbmxpbmVzKCk7Cgl9IGVsc2UgewoJCWNvbnNvbGUubG9nKCJhdSBza2lwcGVkIik7Cgl9Cn0sIDUwMDApOwoKc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJaWYgKGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9ICJub25lIiAmJiBpc19tb3VzZV9pbnNpZGUpIHsKCQl1X2NoYXQoKTsKCX0KfSwgNDAwMCk7Cgphc3luYyBmdW5jdGlvbiBnYXRoZXIoaW5mbywgZXh0cmEsIGZ1bmMyID0gZnVuY3Rpb24gKCkgeyB9KSB7CglyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIGluZm8gKyAiJnZhbD0iICsgZXh0cmEsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCXJlamVjdChlcnJvcik7CgkJfSk7Cgl9KTsKfQoKZnVuY3Rpb24gemluY19pbmZvKGluZm8sIGV4dHJhKSB7CgkkLmdldCgiL2dfaW5mbz9pbmZvPSIgKyBpbmZvLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pICE9IHVuZGVmaW5lZCkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmZvKS5pbm5lckhUTUwgPSBleHRyYSArIHJlc3BvbnNlVGV4dDsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8pLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5mbykuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJfQoJfSk7Cn0KCnZhciB3YWl0aW5nID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJJC5nZXQoIi9nX2luZm8/aW5mbz1nYW1lZm91bmQiLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJd2FzX2dhbWVfZm91bmQgPSBwYXJzZUludChyZXNwb25zZVRleHQpOwoJCWlmICghd2FzX2dhbWVfZm91bmQpIHsKCQkJemluY19pbmZvKCJ3YWl0aW5nX2dhbWUiLCAiaW50aWFsaXppbmc8YnI+Y2xvc2luZyBpbjogIik7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VyX2RheXMiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxlbWVudF9idXR0b25zIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfbWFpbiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2NvbmZpZyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCXRhYl9zd2l0Y2goIm1haW5fdGFiIiwgImNlbnRlciIsICJub25lIik7CgkJfQoJCWVsc2UgewoJCQlpdGVyZm91bmQrKzsKCgkJCWlmIChpdGVyZm91bmQgPiAyKSB7CgkJCQl6aW5jX2luZm8oInVzZXJfZGF5cyIsICJkYXlzIGxlZnQ6ICIpOwoJCQkJemluY19pbmZvKCJsYXN0X3VwZGF0ZSIsICI8c3Ryb25nPlVwZGF0ZWQ8L3N0cm9uZz46ICIpOwoJCQkJemluY19pbmZvKCJjaGFuZ2Vsb2dzIiwgIjxzdHJvbmc+Q2hhbmdlbG9nczwvc3Ryb25nPjogIik7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2FpdGluZ19nYW1lIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbGVtZW50X2J1dHRvbnMiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfbWFpbiIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVsZW1lbnRfY29uZmlnIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl0YWJfc3dpdGNoKCJtYWluX3RhYiIpOwoJCQkJdGFiX3N3aXRjaCgicF91cGRhdGVzIiwgMik7CgkJCQljbGVhckludGVydmFsKHdhaXRpbmcpOwoJCQl9CgkJfQoJfSkKfSwgMjUwKTsKCnZhciBydW5uaW5nID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewoJdHJ5IHsKCQkkLmdldCgiL2dfaW5mbz9pbmZvPXJ1bm5pbmciLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7IH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCWNfZXhpdCgpOwoJCX0pOwoJfSBjYXRjaCAoZXJyb3IpIHsKCQljb25zb2xlLmxvZyhlcnJvcik7CgkJYWxlcnQoZXJyb3IpOwoJCWNfZXhpdCgpOwoJfQp9LCAxNTAwKTsKCmZ1bmN0aW9uIGNfZGlhbG9nKGlkX3doZXJlLCBpZF9pdGVtLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfaXRlbSkpIHsKCQljb25zb2xlLmxvZygiZWxlbWVudCBleGlzdCB3aXRoIGlkOiAiLCBpZF9pdGVtKQoJCXJldHVybjsKCX0KCgljb25zdCBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaWFsb2ciKTsKCWRpYWxvZy5pZCA9IGlkX2l0ZW07CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oZGlhbG9nLnN0eWxlLCBzdHlsZXopOwoJfQoKCWlmIChlbGVtbnQpIHsKCQlmb3IgKGxldCBrZXkgaW4gZWxlbW50KSB7CgkJCWNvbnN0IGVsZW1lbnQgPSBlbGVtbnRba2V5XTsKCQkJY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGVsZW1lbnQudHlwZSk7CgkJCU9iamVjdC5hc3NpZ24oZWwsIGVsZW1lbnQucHJvcHMpOwoJCQlPYmplY3QuYXNzaWduKGVsLnN0eWxlLCBlbGVtZW50LnN0eWxlcyk7CgkJCWRpYWxvZy5hcHBlbmRDaGlsZChlbCk7CgkJfQoJfQoKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKS5hcHBlbmRDaGlsZChkaWFsb2cpOwp9CgpmdW5jdGlvbiBjX2RpdihpZF93aGVyZSwgaWRfaXRlbSwgc3R5bGV6ID0ge30sIGVsZW1udCA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CglkaXYuaWQgPSBpZF9pdGVtOwoJaWYgKGVsZW1udCkgewoJCU9iamVjdC5hc3NpZ24oZGl2LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlkaXYuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKCQkJCQllbGVtbnQuZXZlbnRMaXN0ZW5lcltldmVudE5hbWVdKHRoaXMpOwoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oZGl2LnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwp9CgpmdW5jdGlvbiBjX3RhYl9idXR0b24oaWRfd2hlcmUsIGJ1dHRvbnMsIHR5cGV6ID0gMSkgewoJY29uc3QgdGFiQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWJ1dHRvbnMuZm9yRWFjaChmdW5jdGlvbiAoYnV0dG9uLCBpbmRleCkgewoJCXZhciBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCQlidG4uY2xhc3NOYW1lID0gInRhYi1idXR0b24iOwoJCWJ0bi5zZXRBdHRyaWJ1dGUodHlwZXogPT0gMSA/ICJjLXRhYi1idG4iIDogKCJjLXRhYiIgKyB0eXBleiArICItYnRuIiksICIiKTsKCQlidG4uaWQgPSBidXR0b24uaWQ7CgkJYnRuLmlubmVySFRNTCA9IGJ1dHRvbi50ZXh0OwoKCQlpZiAoaW5kZXggPT09IDApIHsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcFJpZ2h0UmFkaXVzID0gIjBweCI7CgkJfSBlbHNlIGlmIChpbmRleCA9PT0gYnV0dG9ucy5sZW5ndGggLSAxKSB7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gIjBweCI7CgkJfSBlbHNlIHsKCQkJYnRuLnN0eWxlLmJvcmRlclRvcFJpZ2h0UmFkaXVzID0gIjBweCI7CgkJCWJ0bi5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gIjBweCI7CgkJfQoKCQlidG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQkJdGFiX3N3aXRjaCh0aGlzLmlkLCB0eXBleik7CgkJfTsKCgkJdGFiQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ0bik7Cgl9KTsKfQoKZnVuY3Rpb24gZ190bV9kdCh0aW1lc3RhbXAsIGhybWluID0gdHJ1ZSkgewoJdmFyIGRhdGUgPSBuZXcgRGF0ZSgrdGltZXN0YW1wICogMTAwMCk7CglpZiAoaHJtaW4pIHsKCQl2YXIgaG91ciA9ICgiMCIgKyBkYXRlLmdldEhvdXJzKCkpLnN1YnN0cigtMik7CgkJdmFyIG1pbnV0ZXMgPSAoIjAiICsgZGF0ZS5nZXRNaW51dGVzKCkpLnN1YnN0cigtMik7CgkJcmV0dXJuIChob3VyICsgIjoiICsgbWludXRlcyk7Cgl9CgllbHNlIHsKCQl2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQl2YXIgbW9udGggPSAoIjAiICsgKGRhdGUuZ2V0TW9udGgoKSArIDEpKS5zdWJzdHIoLTIpOwoJCXZhciBkYXkgPSAoIjAiICsgZGF0ZS5nZXREYXRlKCkpLnN1YnN0cigtMik7CgkJcmV0dXJuIChkYXkgKyAiLyIgKyBtb250aCArICIvIiArIHllYXIpOwoJfQp9CgpmdW5jdGlvbiBjX2J0bihpZF93aGVyZSwgaWRfaXRlbSwgdGV4dCwgZnVuYzIgPSBmdW5jdGlvbiAoY19lbCkgeyB9LCB0b29sdGlwID0gIiIsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJYnV0dG9uLnR5cGUgPSAiYnV0dG9uIjsKCWJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJuZXdidXR0b24iKTsKCWJ1dHRvbi5pZCA9IGlkX2l0ZW07CglidXR0b24uaW5uZXJIVE1MID0gdGV4dDsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihidXR0b24sIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihidXR0b24uc3R5bGUsIHN0eWxleik7Cgl9CgoJYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJZnVuYzIoKTsKCX07CgoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlidXR0b24uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKfQoKZnVuY3Rpb24gY19ocihpZF93aGVyZSA9IHBhdGgsIG1hcmdpbiA9IHRydWUsIHN0eWxleiA9IHt9KSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgl2YXIgaHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJociIpOwoJaWYgKG1hcmdpbikKCQloci5zdHlsZS5tYXJnaW5MZWZ0ID0gIi0yMHB4IjsKCWhyLnN0eWxlLmJvcmRlclRvcCA9ICIxcHggc29saWQgdmFyKC0tYy1ocikiOwoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKGhyLnN0eWxlLCBzdHlsZXopOwoJfQoKCWNvbnRhaW5lci5hcHBlbmRDaGlsZChocik7Cn0KCmZ1bmN0aW9uIGNfYnIoaWRfd2hlcmUgPSBwYXRoLCBhbW91bnQgPSAxKSB7Cgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cglmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYW1vdW50OyBpbmRleCsrKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwoJfQp9CgpmdW5jdGlvbiBjX2NoZWNrYm94KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCB0b29sdGlwID0gIiIsIGZ1bmMyID0gZnVuY3Rpb24gKGNfZWwpIHsgfSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2VsZW1pdGVtc19iZycpOwoJZGl2Lmh0bWxGb3IgPSBpZF9pdGVtOwoJZGl2LnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWZsZXgiOwoKCWNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCWNoZWNrYm94LnR5cGUgPSAiY2hlY2tib3giOwoJY2hlY2tib3guaWQgPSBpZF9pdGVtOwoJY2hlY2tib3gub25jaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CgkJdV9zZXJ2ZXIoKTsKCQlmdW5jMihjaGVja2JveCk7Cgl9OwoKCWNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCWxhYmVsLmh0bWxGb3IgPSBpZF9pdGVtOwoJbGFiZWwuaW5uZXJIVE1MID0gdGV4dDsKCWxhYmVsLmlkID0gaWRfaXRlbSArICJ6enp6eiI7CgoJY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRfd2hlcmUpOwoKCWRpdi5hcHBlbmRDaGlsZChjaGVja2JveCk7CglkaXYuYXBwZW5kQ2hpbGQobGFiZWwpOwoKCWNvbnN0IGlfdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImkiKTsKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaV90b29sdGlwLmNsYXNzTmFtZSA9ICJmYSBmYS1xdWVzdGlvbi1jaXJjbGUgZmEtMiI7CgkJaV90b29sdGlwLnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwoJCWlfdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgkJaV90b29sdGlwLnN0eWxlLmZvbnRXZWlnaHQgPSAiOTAwIjsKCQlpX3Rvb2x0aXAuc3R5bGUuZm9udFNpemUgPSAiMTVweCI7CgkJaV90b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAiMC41IjsKCQlpX3Rvb2x0aXAuc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoKCQlpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpX3Rvb2x0aXApOwoJfQoKCXVfYm9vbC5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX3NfZmxvYXQoaWRfd2hlcmUsIGlkX2l0ZW0sIHRleHQsIG1pbiwgbWF4LCBzdGVwX3ZhbCwgZGVmYXVsdF92YWwpIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgl2YXIgc3RlcHZhbF9jZXJvcyA9IChTdHJpbmcoc3RlcF92YWwpLnNwbGl0KCIuIilbMV0gfHwgIiIpOwoJc3RlcHZhbF9jZXJvcyA9IHN0ZXB2YWxfY2Vyb3MubGVuZ3RoOwoKCWNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJZGl2LmNsYXNzTGlzdC5hZGQoJ2xlbmd0aCcsICdmX3NsaWRlcl9iZycpOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1taW4nLCBtaW4pOwoJZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpOwoKCWNvbnN0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Cgl0aXRsZURpdi5jbGFzc0xpc3QuYWRkKCdsX3RpdGxlJywgJ2ZfdGl0bGUnKTsKCXRpdGxlRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1sZW5ndGgnLCBkZWZhdWx0X3ZhbCk7Cgl0aXRsZURpdi50ZXh0Q29udGVudCA9IHRleHQgKyAiOiAiOwoKCWNvbnN0IG51bWJlcl9pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CgludW1iZXJfaW5wdXQuY2xhc3NMaXN0LmFkZCgibnVtYmVyc2xpZGVyIik7CgludW1iZXJfaW5wdXQudHlwZSA9ICJudW1iZXIiOwoJbnVtYmVyX2lucHV0LnBhdHRlcm4gPSAiWzAtOV0qIjsKCW51bWJlcl9pbnB1dC5pbnB1dE1vZGUgPSAibnVtZXJpYyI7CgludW1iZXJfaW5wdXQuaWQgPSBpZF9pdGVtOwoJbnVtYmVyX2lucHV0Lm1pbiA9IG1pbjsKCW51bWJlcl9pbnB1dC5tYXggPSBtYXg7CgludW1iZXJfaW5wdXQuc3RlcCA9IHN0ZXBfdmFsOwoJbnVtYmVyX2lucHV0LnZhbHVlID0gZGVmYXVsdF92YWw7CgludW1iZXJfaW5wdXQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsKCQl1X3NlcnZlcigpOwoJCWFwcGx5RmlsbChudW1iZXJfaW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MsIG51bWJlcl9pbnB1dC52YWx1ZSk7Cgl9OwoKCWNvbnN0IG1pbnVzX2J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwoJbWludXNfYnRuLmNsYXNzTGlzdC5hZGQoImNvbnRyb2xzLW51bWJlciIpOwoJbWludXNfYnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCW1pbnVzX2J0bi5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCI7CgltaW51c19idG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCW1pbnVzX2J0bi5pbm5lckhUTUwgPSAoIiYjODcyMjsiKS50cmltKCk7CgltaW51c19idG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCQlzdW1yZXN0X2J1dHRvbnMoaWRfaXRlbSwgMCwgbWluLCBtYXgsIDEsIHN0ZXB2YWxfY2Vyb3MpOwoJCXVfc2VydmVyKCk7CgkJYXBwbHlGaWxsKG51bWJlcl9pbnB1dCwgdHJ1ZSwgc3RlcHZhbF9jZXJvcywgbnVtYmVyX2lucHV0LnZhbHVlKTsKCX07CgoJY29uc3QgcGx1c19idG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCXBsdXNfYnRuLmNsYXNzTGlzdC5hZGQoImNvbnRyb2xzLW51bWJlciIpOwoJcGx1c19idG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJcGx1c19idG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJcGx1c19idG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCXBsdXNfYnRuLmlubmVySFRNTCA9ICgiJiM0MzsiKS50cmltKCk7CglwbHVzX2J0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAxLCBtaW4sIG1heCwgMSwgc3RlcHZhbF9jZXJvcyk7CgkJdV9zZXJ2ZXIoKTsKCQlhcHBseUZpbGwobnVtYmVyX2lucHV0LCB0cnVlLCBzdGVwdmFsX2Nlcm9zLCBudW1iZXJfaW5wdXQudmFsdWUpOwoJfTsKCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7CglkaXYuYXBwZW5kQ2hpbGQodGl0bGVEaXYpOwoJZGl2LmFwcGVuZENoaWxkKG1pbnVzX2J0bik7CglkaXYuYXBwZW5kQ2hpbGQobnVtYmVyX2lucHV0KTsKCWRpdi5hcHBlbmRDaGlsZChwbHVzX2J0bik7CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CgoJdV9mbG9hdC5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX2ltZyhpZF93aGVyZSwgaWRfaXRlbSwgaW1hZ2UsIHdpZHRoLCBoZWlnaHQsIHN0eWxleiA9IHt9LCBlbGVtbnQgPSB7fSkgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwoKCWltZy5zZXRBdHRyaWJ1dGUoJ2lkJywgaWRfaXRlbSk7CglpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBpbWFnZSk7CglpbWcuc2V0QXR0cmlidXRlKCdhbHQnLCAidV9hdmF0YXIiKTsKCWltZy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgd2lkdGgpOwoJaW1nLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsKCglpZiAoZWxlbW50KSB7CgkJT2JqZWN0LmFzc2lnbihpbWcsIGVsZW1udCk7CgoJCWlmIChlbGVtbnQuZXZlbnRMaXN0ZW5lcikgewoJCQlmb3IgKGxldCBldmVudE5hbWUgaW4gZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJCWltZy5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihpbWcuc3R5bGUsIHN0eWxleik7Cgl9CgoJY29udGFpbmVyLmFwcGVuZENoaWxkKGltZyk7Cn0KCmZ1bmN0aW9uIGNfdGV4dGFyZWEoaWRfd2hlcmUsIGlkX2l0ZW0sIGhpZGRlbiA9IGZhbHNlLCBsYWJlbCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCWlmIChpZF9pdGVtID09ICJybmQiKQoJCWlkX2l0ZW0gPSBnUm5kSWQoKTsKCgljb25zdCB0ZXh0Ym94X2RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJaWYgKGxhYmVsICE9PSAiIikgewoJCXRleHRib3hfZGl2LmNsYXNzTGlzdC5hZGQoInRleHRib3giKTsKCgkJY29uc3QgbGFiZWxFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKCQlsYWJlbEVsZW0udGV4dENvbnRlbnQgPSBsYWJlbC50cmltKCk7CgkJbGFiZWxFbGVtLmlkID0gaWRfaXRlbSArICJsYmwiOwoJCWxhYmVsRWxlbS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgkJbGFiZWxFbGVtLnNldEF0dHJpYnV0ZSgiZm9yIiwgaWRfaXRlbSk7CgoJCWlmIChzdHlsZXogJiYgc3R5bGV6LmxhYmVseikgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoubGFiZWx6KTsKCQl9CgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQobGFiZWxFbGVtKTsKCX0KCgljb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CgoJdGV4dGFyZWEuaWQgPSBpZF9pdGVtOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKHRleHRhcmVhLCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQl0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCgl0ZXh0YXJlYS5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24odGV4dGFyZWEuc3R5bGUsIHN0eWxleik7CgoJCWlmIChzdHlsZXoudGV4dGJveCkgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoudGV4dGJveCk7CgkJfQoJfQoKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7Cgl9IGVsc2UgewoJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRhcmVhKTsKCX0gZWxzZSBpZiAoY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsKCX0KfQoKZnVuY3Rpb24gY190ZXh0Ym94KGlkX3doZXJlLCBpZF9pdGVtLCBoaWRkZW4gPSBmYWxzZSwgbGFiZWwgPSAiIiwgdG9vbHRpcCA9ICIiLCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30sIGRpc2FibGVzdHlsZSA9IGZhbHNlKSB7CgoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWNvbnN0IHRleHRib3hfZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CglpZiAobGFiZWwgIT09ICIiKSB7CgkJdGV4dGJveF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dGJveCIpOwoKCQljb25zdCBsYWJlbEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOwoJCWxhYmVsRWxlbS50ZXh0Q29udGVudCA9IGxhYmVsLnRyaW0oKTsKCQlsYWJlbEVsZW0uaWQgPSBpZF9pdGVtICsgImxibCI7CgkJbGFiZWxFbGVtLnN0eWxlLmRpc3BsYXkgPSBoaWRkZW4gPyAibm9uZSIgOiAiaW5saW5lLWJsb2NrIjsKCQlsYWJlbEVsZW0uc2V0QXR0cmlidXRlKCJmb3IiLCBpZF9pdGVtKTsKCgkJaWYgKHN0eWxleiAmJiBzdHlsZXoubGFiZWx6KSB7CgkJCU9iamVjdC5hc3NpZ24odGV4dGJveF9kaXYuc3R5bGUsIHN0eWxlei5sYWJlbHopOwoJCX0KCgkJdGV4dGJveF9kaXYuYXBwZW5kQ2hpbGQobGFiZWxFbGVtKTsKCX0KCgljb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CglpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCJpZCIsIGlkX2l0ZW0pOwoKCWlmIChkaXNhYmxlc3R5bGUpCgkJaW5wdXQuc2V0QXR0cmlidXRlKCdkYXRhLW5vdmFsaWRpbnZhbGlkJywgJycpOwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJaW5wdXQuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKQoJfQoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKGlucHV0LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQlpbnB1dC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKGV2KSB7CgkJCQkJZWxlbW50LmV2ZW50TGlzdGVuZXJbZXZlbnROYW1lXSh0aGlzLCBldik7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpbnB1dC5zdHlsZS5kaXNwbGF5ID0gaGlkZGVuID8gIm5vbmUiIDogImlubGluZS1ibG9jayI7CgoJaWYgKHN0eWxleikgewoJCU9iamVjdC5hc3NpZ24oaW5wdXQuc3R5bGUsIHN0eWxleik7CgoJCWlmIChzdHlsZXoudGV4dGJveCkgewoJCQlPYmplY3QuYXNzaWduKHRleHRib3hfZGl2LnN0eWxlLCBzdHlsZXoudGV4dGJveCk7CgkJfQoJfQoKCWlmIChsYWJlbCAhPT0gIiIpIHsKCQl0ZXh0Ym94X2Rpdi5hcHBlbmRDaGlsZChpbnB1dCk7Cgl9IGVsc2UgewoJCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpOwoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWlmIChsYWJlbCA9PT0gIiIgJiYgY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsKCX0gZWxzZSBpZiAoY29udGFpbmVyKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRib3hfZGl2KTsKCX0KfQoKZnVuY3Rpb24gY190ZXh0KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBzdHlsZXogPSB7fSwgZWxlbW50ID0ge30pIHsKCglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7Cgl0ZXh0X2Rpdi5jbGFzc0xpc3QuYWRkKCJ0ZXh0Iik7CgoJaWYgKHRleHQpCgkJdGV4dF9kaXYuaW5uZXJIVE1MID0gdGV4dC50cmltKCk7CgoJdGV4dF9kaXYuaWQgPSBpZF9pdGVtOwoKCWlmIChlbGVtbnQpIHsKCQlPYmplY3QuYXNzaWduKHRleHRfZGl2LCBlbGVtbnQpOwoKCQlpZiAoZWxlbW50LmV2ZW50TGlzdGVuZXIpIHsKCQkJZm9yIChsZXQgZXZlbnROYW1lIGluIGVsZW1udC5ldmVudExpc3RlbmVyKSB7CgkJCQl0ZXh0X2Rpdi5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWVsZW1udC5ldmVudExpc3RlbmVyW2V2ZW50TmFtZV0odGhpcyk7CgkJCQl9KTsKCQkJfQoJCX0KCX0KCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbih0ZXh0X2Rpdi5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dF9kaXYpOwp9CgpmdW5jdGlvbiBjX2NvbWJvYm94MihpZF93aGVyZSwgaWRfaXRlbSwgb3B0aW9ucywgaGlkZGVuID0gZmFsc2UsIHRvb2x0aXAgPSAiIiwgc3R5bGV6ID0ge30pIHsKCglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3Qgc2VsZWN0X2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsKCXNlbGVjdF9lbGVtLmNsYXNzTGlzdC5hZGQoInNlbGVjdC1kcm9wZG93biIpOwoJc2VsZWN0X2VsZW0uaWQgPSBpZF9pdGVtOwoKCWlmICh0b29sdGlwICE9ICIiKSB7CgkJc2VsZWN0X2VsZW0uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCglvcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHsKCQljb25zdCBvcHRpb25fZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwoJCW9wdGlvbl9lbGVtLnZhbHVlID0gaW5kZXg7CgkJb3B0aW9uX2VsZW0udGV4dCA9IG9wdGlvbjsKCQlzZWxlY3RfZWxlbS5hZGQob3B0aW9uX2VsZW0pOwoJfSk7CgoJc2VsZWN0X2VsZW0uc3R5bGUuZGlzcGxheSA9ICgoaGlkZGVuID09IHRydWUpID8gKCJub25lIikgOiAoImlubGluZS1ibG9jayIpKTsKCglpZiAoc3R5bGV6KSB7CgkJT2JqZWN0LmFzc2lnbihzZWxlY3RfZWxlbS5zdHlsZSwgc3R5bGV6KTsKCX0KCgljb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZF93aGVyZSk7Cgljb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZWN0X2VsZW0pOwp9CgpmdW5jdGlvbiBjX2NvbWJvYm94KGlkX3doZXJlLCBpZF9pdGVtLCB0ZXh0LCBtaW4sIG1heCwgc2FtZWxpbmUgPSBmYWxzZSwgdG9vbHRpcCA9ICIiLCBmdW5jMiA9IGZ1bmN0aW9uIChjX2VsKSB7IH0sIHN0eWxleiA9IHt9KSB7CglpZiAoaWRfaXRlbSA9PSAicm5kIikKCQlpZF9pdGVtID0gZ1JuZElkKCk7CgoJY29uc3QgdGV4dF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWlmICh0ZXh0ICE9ICIiKSB7CgkJdGV4dF9kaXYuY2xhc3NMaXN0LmFkZCgidGV4dCIpOwoJCXRleHRfZGl2LnRleHRDb250ZW50ID0gdGV4dC50cmltKCk7Cgl9CgoJY29uc3Qgc2VsZWN0X2VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsKCXNlbGVjdF9lbGVtLmNsYXNzTGlzdC5hZGQoInNlbGVjdC1kcm9wZG93biIpOwoJc2VsZWN0X2VsZW0uaWQgPSBpZF9pdGVtOwoJc2VsZWN0X2VsZW0uc3R5bGUuaGVpZ2h0ID0gIjQycHgiOwoKCWlmIChzYW1lbGluZSkKCQlzZWxlY3RfZWxlbS5zdHlsZS5tYXJnaW5SaWdodCA9ICIxMHB4IjsKCglzZWxlY3RfZWxlbS5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWZ1bmMyKHNlbGVjdF9lbGVtKTsKCX07CgoJLy9pZiAodG9vbHRpcCAhPSAiIikgewoJLy8Jc2VsZWN0X2VsZW0uc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCS8vfQoKCWlmIChzdHlsZXopIHsKCQlPYmplY3QuYXNzaWduKHNlbGVjdF9lbGVtLnN0eWxlLCBzdHlsZXopOwoKCQlpZiAoc3R5bGV6LnRleHRfZGl2KSB7CgkJCU9iamVjdC5hc3NpZ24oc2VsZWN0X2VsZW0uc3R5bGUsIHN0eWxlei50ZXh0X2Rpdik7CgkJfQoJfQoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCWlmICh0ZXh0ICE9ICIiKSB7CgkJY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRfZGl2KTsKCX0KCWNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3RfZWxlbSk7CgoJY29uc3QgaV90b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaSIpOwoJaWYgKHRvb2x0aXAgIT0gIiIpIHsKCQlpX3Rvb2x0aXAuY2xhc3NOYW1lID0gImZhIGZhLXF1ZXN0aW9uLWNpcmNsZSBmYS0yIjsKCQlpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJhcmlhLWhpZGRlbiIsICJ0cnVlIik7CgkJaV90b29sdGlwLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCQlpX3Rvb2x0aXAuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCWlfdG9vbHRpcC5zdHlsZS5tYXJnaW5MZWZ0ID0gIjhweCIKCQlpX3Rvb2x0aXAuc3R5bGUuZm9udFdlaWdodCA9ICI5MDAiOwoJCWlfdG9vbHRpcC5zdHlsZS5mb250U2l6ZSA9ICIxNXB4IjsKCQlpX3Rvb2x0aXAuc3R5bGUub3BhY2l0eSA9ICIwLjUiOwoKCQlpX3Rvb2x0aXAuc2V0QXR0cmlidXRlKCJkYXRhLXR0aXAiLCB0b29sdGlwKTsKCX0KCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChpX3Rvb2x0aXApOwoJfQoKCXVfaW50Mi5wdXNoKGlkX2l0ZW0pOwp9CgpmdW5jdGlvbiBjX3NfaW50KGlkX3doZXJlLCBpZF9pdGVtLCBpZF90ZXh0LCBtaW4sIG1heCwgc3RlcCwgdmFsdWUsIHRvb2x0aXAgPSAiIikgewoJaWYgKGlkX2l0ZW0gPT0gInJuZCIpCgkJaWRfaXRlbSA9IGdSbmRJZCgpOwoKCWNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX3doZXJlKTsKCgljb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWRpdi5jbGFzc0xpc3QuYWRkKCdsZW5ndGgnLCAncl9zbGlkZXJfYmcnKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTsKCWRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4JywgbWF4KTsKCgljb25zdCB0aXRsZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJdGl0bGVEaXYuY2xhc3NMaXN0LmFkZCgnbF90aXRsZScsICdmX3RpdGxlJyk7Cgl0aXRsZURpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGVuZ3RoJywgdmFsdWUpOwoJdGl0bGVEaXYudGV4dENvbnRlbnQgPSBpZF90ZXh0ICsgIjogIjsKCgljb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CgoJY29uc3QgbWludXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCW1pbnVzQnRuLmNsYXNzTmFtZSA9ICJjb250cm9scy1udW1iZXIiOwoJbWludXNCdG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwoJbWludXNCdG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJbWludXNCdG4uc3R5bGUubWFyZ2luUmlnaHQgPSAiOHB4IjsKCW1pbnVzQnRuLmlubmVySFRNTCA9ICgiJiM4NzIyOyIpLnRyaW0oKTsKCW1pbnVzQnRuLm9uY2xpY2sgPSAoKSA9PiB7CgkJc3VtcmVzdF9idXR0b25zKGlkX2l0ZW0sIDAsIG1pbiwgbWF4KTsKCQlzX2ludDIoaWRfaXRlbSwgbWluLCBtYXgpOwoJCWFwcGx5RmlsbChpbnB1dCk7Cgl9OwoKCWNvbnN0IHBsdXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKCXBsdXNCdG4uY2xhc3NOYW1lID0gImNvbnRyb2xzLW51bWJlciI7CglwbHVzQnRuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCXBsdXNCdG4uc3R5bGUubWFyZ2luTGVmdCA9ICI4cHgiOwoJcGx1c0J0bi5zdHlsZS5tYXJnaW5SaWdodCA9ICI4cHgiOwoJcGx1c0J0bi5pbm5lckhUTUwgPSAoIiYjNDM7IikudHJpbSgpOwoJcGx1c0J0bi5vbmNsaWNrID0gKCkgPT4gewoJCXN1bXJlc3RfYnV0dG9ucyhpZF9pdGVtLCAxLCBtaW4sIG1heCk7CgkJc19pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQlhcHBseUZpbGwoaW5wdXQpOwoJfTsKCglpbnB1dC5jbGFzc0xpc3QuYWRkKCdzbGlkZXInKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZF9pdGVtKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdyYW5nZScpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCdtaW4nLCBtaW4pOwoJaW5wdXQuc2V0QXR0cmlidXRlKCdtYXgnLCBtYXgpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCdzdGVwJywgc3RlcCk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgdmFsdWUpOwoJaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7CgkJc19pbnQyKGlkX2l0ZW0sIG1pbiwgbWF4KTsKCQlhcHBseUZpbGwoaW5wdXQpOwoJfTsKCglpZiAodG9vbHRpcCAhPSAiIikgewoJCWRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtdHRpcCIsIHRvb2x0aXApOwoJfQoKCWRpdi5hcHBlbmRDaGlsZCh0aXRsZURpdik7CglkaXYuYXBwZW5kQ2hpbGQobWludXNCdG4pOwoJZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKCWRpdi5hcHBlbmRDaGlsZChwbHVzQnRuKTsKCgljb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKCgl1X2ludC5wdXNoKGlkX2l0ZW0pOwp9Cgpjb25zdCBzbGlkZXJQcm9wcyA9IHsKCWJhY2tncm91bmQ6ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMjE0KSIsCn07CgpmdW5jdGlvbiB1X3NsaWRlcnMoKSB7Cgljb25zdCBzbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnJfc2xpZGVyX2JnIik7CgoJc2xpZGVycy5mb3JFYWNoKChzbGlkZXIpID0+IHsKCQljb25zdCBzbGlkZXJJbnB1dCA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCIuc2xpZGVyIik7CgkJY29uc3Qgc2xpZGVyVmFsdWUgPSBzbGlkZXIucXVlcnlTZWxlY3RvcigiLmxfdGl0bGUiKTsKCgkJc2xpZGVySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoZXZlbnQpID0+IHsKCQkJc2xpZGVyVmFsdWUuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIGV2ZW50LnRhcmdldC52YWx1ZSk7CgkJCWFwcGx5RmlsbChldmVudC50YXJnZXQpOwoJCX0pOwoKCQlhcHBseUZpbGwoc2xpZGVySW5wdXQpOwoJfSk7CgoJY29uc3QgZl9zbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZfc2xpZGVyX2JnIik7CgoJZl9zbGlkZXJzLmZvckVhY2goYXN5bmMgKHNsaWRlcikgPT4gewoJCWNvbnN0IHNsaWRlcklucHV0ID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoIi5udW1iZXJzbGlkZXIiKTsKCgkJbGV0IHN0ZXB2YWxfY2Vyb3MgPSAoU3RyaW5nKHNsaWRlcklucHV0LnN0ZXApLnNwbGl0KCIuIilbMV0gfHwgIiIpOwoKCQlhcHBseUZpbGwoc2xpZGVySW5wdXQsIHRydWUsIHN0ZXB2YWxfY2Vyb3MubGVuZ3RoLCBzbGlkZXJJbnB1dC52YWx1ZSk7Cgl9KTsKfQoKdV9zbGlkZXJzKCk7CgpmdW5jdGlvbiBhcHBseUZpbGwoc2xpZGVyLCBpc19mbHQgPSBmYWxzZSwgZmx0cGFyc2UgPSAxLCB2YWx1ZSkgewoJaWYgKGlzX2ZsdCkgewoJCXNsaWRlci5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoIi5sX3RpdGxlIikuc2V0QXR0cmlidXRlKCJkYXRhLWxlbmd0aCIsIHBhcnNlRmxvYXQodmFsdWUpLnRvRml4ZWQoZmx0cGFyc2UpKTsKCQlzbGlkZXIuc3R5bGUuYmFja2dyb3VuZCA9IHNsaWRlclByb3BzLmJhY2tncm91bmQ7CgkJc2xpZGVyLnN0eWxlLmNvbG9yID0gJ3ZhcigtLWMtdGV4dCknOwoJCXNsaWRlci5zdHlsZS5ib3JkZXJSYWRpdXMgPSAiNXB4IjsKCQlzbGlkZXIuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCB2YXIoLS1jLWNvbnRvcm5vcykiOwoJCXJldHVybjsKCX0KCgljb25zdCBwZXJjZW50YWdlID0gKCgxMDAgKiAoc2xpZGVyLnZhbHVlIC0gc2xpZGVyLm1pbikpIC8gKHNsaWRlci5tYXggLSBzbGlkZXIubWluKSkudG9GaXhlZCgxKTsKCWNvbnN0IGJnID0gYGxpbmVhci1ncmFkaWVudCg5MGRlZywgdmFyKC0tYy1wcmltYXJ5KSAwJSwgdmFyKC0tYy1zZWNvbmRhcnkpICR7cGVyY2VudGFnZX0lLCAke3NsaWRlclByb3BzLmJhY2tncm91bmR9ICR7cGVyY2VudGFnZX0lLCAke3NsaWRlclByb3BzLmJhY2tncm91bmR9IDEwMCUpYDsKCXNsaWRlci5zdHlsZS5iYWNrZ3JvdW5kID0gYmc7CglzbGlkZXIucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIubF90aXRsZSIpLnNldEF0dHJpYnV0ZSgiZGF0YS1sZW5ndGgiLCBzbGlkZXIudmFsdWUpOwp9CgpmdW5jdGlvbiBzdW1yZXN0X2J1dHRvbnMoaXRlbV9pZCwgc3VtLCBtaW4sIG1heCwgaXNfZmx0ID0gMCwgZmx0cGFyc2UgPSAxKSB7CglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkgPT0gdW5kZWZpbmVkKSB7CgkJY29uc29sZS5sb2coaXRlbV9pZCwgImRvZXNudCBleGlzdCIpOwoJCXJldHVybjsKCX0KCglpZiAoaXNfZmx0KSB7CgkJaWYgKHN1bSkgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPiBtYXgpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgKyBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQl9IGVsc2UgewoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPCBtaW4pCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSAocGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSkgLSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnN0ZXApKS50b0ZpeGVkKGZsdHBhcnNlKTsKCQl9Cgl9CgllbHNlIHsKCQlpZiAoc3VtKSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA+IG1heCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlID0gcGFyc2VJbnQobWF4KTsKCQkJZWxzZQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlKSArIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkuc3RlcCk7CgkJfSBlbHNlIHsKCQkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW1faWQpLnZhbHVlIDwgbWluKQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUgPSBwYXJzZUludChtYXgpOwoJCQllbHNlCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS52YWx1ZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaXRlbV9pZCkudmFsdWUpIC0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtX2lkKS5zdGVwKTsKCQl9Cgl9Cn0KCndpbmRvdy5tb2JpbGVDaGVjayA9IGZ1bmN0aW9uICgpIHsKCWxldCBjaGVjayA9IGZhbHNlOwoJKGZ1bmN0aW9uIChhKSB7IGlmICgvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIGNoZWNrID0gdHJ1ZTsgfSkobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7CglyZXR1cm4gY2hlY2s7Cn07Cgp3aW5kb3cuc3RlYW1DaGVjayA9IGZ1bmN0aW9uICgpIHsKCWxldCB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7CglsZXQgaXNTdGVhbUJyb3dzZXIgPSB1c2VyQWdlbnQuaW5kZXhPZigic3RlYW0iKSA+IC0xOwoJcmV0dXJuIGlzU3RlYW1Ccm93c2VyOwp9OwoKaWYgKCF3aW5kb3cubW9iaWxlQ2hlY2soKSkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyY29kZV90ZXh0IikuaW5uZXJIVE1MID0gInNjYW4gb24gbW9iaWxlIG9yIGVudGVyOiAiICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiBvbiB5b3VyIG1vYmlsZSBicm93c2VyIjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxcmltYWdlIikuc3JjID0gImh0dHBzOi8vY2hhcnQuZ29vZ2xlYXBpcy5jb20vY2hhcnQ/Y2h0PXFyJmNobD0iICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgIiZjaHM9MjUweDI1MCZjaGxkPUx8MCI7CgoJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQlpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJCXRfcGFuZWwoJ2xlZnRfcGFuZWwnKTsKCQkJdF9wYW5lbCgpOwoJCX0KCQllbHNlIHsKCQkJaWYgKHdpbmRvdy5zdGVhbUNoZWNrKCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJpZ2h0X3BhbmVsIikuc3R5bGUud2lkdGggPSAiMHB4IjsKCgkJCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfSwgMjUwKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAwOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS53aWR0aCA9ICIwcHgiOwoKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0sIDI1MCk7CgoJCQkJbm90aWZ5KCJwYW5lbHMgZGlzYWJsZWQgb24gc3RlYW0uIik7CgkJCX0gZWxzZSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmlnaHRfcGFuZWwiKS5zdHlsZS5vcGFjaXR5ID0gMTsKCQkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyaWdodF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfSwgMjUwKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVmdF9wYW5lbCIpLnN0eWxlLm9wYWNpdHkgPSAxOwoJCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0sIDI1MCk7CgkJCX0KCQl9Cgl9Owp9CmVsc2UgewoJZG9jdW1lbnQuYm9keS5zdHlsZS56b29tID0gIjc1JSI7Cgl0X3BhbmVsKCdsZWZ0X3BhbmVsJyk7Cgl0X3BhbmVsKCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXJjb2RlX3RleHQiKS5pbm5lckhUTUwgPSAib25seSBvbiBwYyIudHJpbSgpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInFyaW1hZ2UiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwp9CgpmdW5jdGlvbiBzdHJpbmcyYm9vbChzdHJpbmcpIHsKCXN3aXRjaCAoc3RyaW5nLnRvTG93ZXJDYXNlKCkudHJpbSgpKSB7CgkJY2FzZSAidHJ1ZSI6CgkJY2FzZSAieWVzIjoKCQljYXNlICIxIjoKCQkJcmV0dXJuIHRydWU7CgkJY2FzZSAiZmFsc2UiOgoJCWNhc2UgIm5vIjoKCQljYXNlICIwIjoKCQljYXNlIG51bGw6CgkJCXJldHVybiBmYWxzZTsKCQlkZWZhdWx0OgoJCQlyZXR1cm4gQm9vbGVhbihzdHJpbmcpOwoJfQp9CgpmdW5jdGlvbiBnX2Jvb2wobW9kdWxlKSB7CgkkLmdldCgiL2dfYm9vbD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuY2hlY2tlZCA9IHN0cmluZzJib29sKHJlc3BvbnNlVGV4dCk7CgoJCWlmICghdV9hbF9ib29sLmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgiY2hhbmdlIikpOwoJCQl1X2FsX2Jvb2wucHVzaChtb2R1bGUpOwoJCX0KCX0pOwp9CgpmdW5jdGlvbiBnX2ludChtb2R1bGUsIHJldHVybmVkID0gdHJ1ZSkgewoJJC5nZXQoIi9nX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKSA9PSB1bmRlZmluZWQpIHsKCQkJY29uc29sZS5sb2cobW9kdWxlLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSByZXNwb25zZVRleHQ7CgoJCWlmIChtb2R1bGUuaW5jbHVkZXMoInRoZW1lX3NlbGVjdCIpKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImNoYW5nZSIpKTsKCQl9CgoJCWlmIChyZXR1cm5lZCkgewoJCQlpZiAoIXVfYWxfaW50LmluY2x1ZGVzKG1vZHVsZSkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoImlucHV0IikpOwoJCQkJdV9hbF9pbnQucHVzaChtb2R1bGUpOwoJCQl9CgoJCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWU7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdfZmxvYXQobW9kdWxlKSB7CgkkLmdldCgiL2dfZmxvYXQ/ZmVhdHVyZT0iICsgbW9kdWxlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkgPT0gdW5kZWZpbmVkKSB7CgkJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpOwoJCQlyZXR1cm47CgkJfQoKCQl2YXIgc3RlcHZhbF9jZXJvczIgPSAoU3RyaW5nKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkuc3RlcCkuc3BsaXQoIi4iKVsxXSB8fCAiIik7CgoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSkudmFsdWUgPSBwYXJzZUZsb2F0KHJlc3BvbnNlVGV4dCkudG9GaXhlZChzdGVwdmFsX2Nlcm9zMi5sZW5ndGgpOwoKCQlpZiAoIXVfYWxfZmxvYXQuaW5jbHVkZXMobW9kdWxlKSkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJpbnB1dCIpKTsKCQkJdV9hbF9mbG9hdC5wdXNoKG1vZHVsZSk7CgkJfQoKCQlpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlICsgInoiKSAhPSB1bmRlZmluZWQpCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKS52YWx1ZTsKCX0pOwp9CgpmdW5jdGlvbiBzX2Jvb2wobW9kdWxlKSB7CglsZXQgbW9kdWxleiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSk7CglpZiAobW9kdWxleiA9PSB1bmRlZmluZWQpIHsKCQljb25zb2xlLmxvZyhtb2R1bGUsICJkb2VzbnQgZXhpc3QiKQoJCXJldHVybjsKCX0KCXZhciB2YWx1ZSA9IG1vZHVsZXouY2hlY2tlZDsKCgkkLmdldCgiL3NfYm9vbD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsgfSk7Cn0KCmZ1bmN0aW9uIHNfaW50Mihtb2R1bGUsIG1pbiA9IDAsIG1heCA9IDApIHsKCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKG1vZHVsZSArICIgbm90IGZvdW5kIik7CgkJcmV0dXJuOwoJfQoKCXZhciB2YWx1ZSA9IG1vZHVsZXoudmFsdWU7CgoJaWYgKG1pbiA9PSAwICYmIG1heCA9PSAwKSB7CgkJJC5nZXQoIi9zX2ludD9mZWF0dXJlPSIgKyBtb2R1bGUgKyAiJnZhbD0iICsgdmFsdWUsIGZ1bmN0aW9uIChyZXNwb25zZVRleHQpIHsKCQkJdmFyIGVsZW1lbnRFeGlzdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpOwoJCQlpZiAoZWxlbWVudEV4aXN0cyAhPSB1bmRlZmluZWQgfHwgZWxlbWVudEV4aXN0cyAhPSBudWxsKQoJCQkJZWxlbWVudEV4aXN0cy5pbm5lckhUTUwgPSByZXNwb25zZVRleHQ7CgkJfSk7Cgl9IGVsc2UgewoJCWlmIChwYXJzZUludCh2YWx1ZSkgPj0gcGFyc2VJbnQobWluKSAmJiBwYXJzZUludCh2YWx1ZSkgPD0gcGFyc2VJbnQobWF4KSkgewoJCQkkLmdldCgiL3NfaW50P2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJdmFyIGVsZW1lbnRFeGlzdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpOwoJCQkJaWYgKGVsZW1lbnRFeGlzdHMgIT0gdW5kZWZpbmVkIHx8IGVsZW1lbnRFeGlzdHMgIT0gbnVsbCkKCQkJCQllbGVtZW50RXhpc3RzLmlubmVySFRNTCA9IHJlc3BvbnNlVGV4dDsKCQkJfSk7CgkJfQoJCWVsc2UgewoJCQljb25zb2xlLmxvZygibWlubWF4IG92ZXJwYXNzZWQgfCAiLCB2YWx1ZSwgbWluLCBtYXgpOwoJCX0KCX0KfQoKZnVuY3Rpb24gc19mbG9hdChtb2R1bGUpIHsKCWxldCBtb2R1bGV6ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kdWxlKTsKCWlmIChtb2R1bGV6ID09IHVuZGVmaW5lZCkgewoJCWNvbnNvbGUubG9nKG1vZHVsZSwgImRvZXNudCBleGlzdCIpCgkJcmV0dXJuOwoJfQoKCXZhciB2YWx1ZSA9IHBhcnNlRmxvYXQobW9kdWxlei52YWx1ZSk7Cgl2YXIgbWluID0gcGFyc2VGbG9hdChtb2R1bGV6Lm1pbik7Cgl2YXIgbWF4ID0gcGFyc2VGbG9hdChtb2R1bGV6Lm1heCk7CgoJaWYgKHZhbHVlID49IG1pbiAmJiB2YWx1ZSA8PSBtYXgpIHsKCQkkLmdldCgiL3NfZmxvYXQ/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2R1bGUgKyAieiIpICE9IHVuZGVmaW5lZCkKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZHVsZSArICJ6IikuaW5uZXJIVE1MID0gcmVzcG9uc2VUZXh0OwoJCX0pOwoJfQp9CgpmdW5jdGlvbiBzX2luZm8obW9kdWxlLCB2YWx1ZSwgZnVuYzIgPSBmdW5jdGlvbiAoKSB7IH0pIHsKCSQuZ2V0KCIvc19pbmZvP2ZlYXR1cmU9IiArIG1vZHVsZSArICImdmFsPSIgKyB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCWZ1bmMyKCk7Cgl9KTsKfQoKZnVuY3Rpb24gZ1JuZElkKGxlbmd0aCA9IDgpIHsKCXZhciBpZCA9ICcnOwoJdmFyIGNoYXJhY3RlcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknOwoJdmFyIGNoYXJhY3RlcnNMZW5ndGggPSBjaGFyYWN0ZXJzLmxlbmd0aDsKCglpZCA9ICcnOwoKCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKCQlpZCArPSBjaGFyYWN0ZXJzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFyYWN0ZXJzTGVuZ3RoKSk7Cgl9CgoJcmV0dXJuIGlkOwp9CgpmdW5jdGlvbiBzX2J0bihtb2R1bGUsIHZhbHVlID0gIiIpIHsKCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJaWYgKHZhbHVlID09ICIiKSB7CgkJCSQuZ2V0KCIvdG9nZ2xlP2ZlYXR1cmU9IiArIG1vZHVsZSwgZnVuY3Rpb24gKHJlc3BvbnNlVGV4dCkgewoJCQkJcmVzb2x2ZShyZXNwb25zZVRleHQpOwoJCQl9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikgewoJCQkJcmVqZWN0KGVycm9yKTsKCQkJfSk7CgkJfSBlbHNlIHsKCQkJJC5nZXQoIi90b2dnbGU/ZmVhdHVyZT0iICsgbW9kdWxlICsgIiZ2YWw9IiArIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJCQlyZXNvbHZlKHJlc3BvbnNlVGV4dCk7CgkJCX0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7CgkJCQlyZWplY3QoZXJyb3IpOwoJCQl9KTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gY19leGl0KCkgewoJc19idG4oImRlYWQiKTsKCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCXdpbmRvdy5vcGVuKCIiLCAiX3NlbGYiLCAiIik7CgkJd2luZG93LmNsb3NlKCk7CgkJaGlzdG9yeS5nbygtMSk7CgkJbmF2aWdhdG9yLmFwcC5iYWNrSGlzdG9yeSgpOwoJCXdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKCX0sIDUwMDApOwp9CgpmdW5jdGlvbiBmX2NvbWJvKGlkX2l0ZW0sIGlkX3NlcnZlcikgewoJJC5nZXQoIi9nX2luZm8/aW5mbz0iICsgaWRfc2VydmVyLCBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CgkJdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkX2l0ZW0pOwoKCQlpZiAoc2VsZWN0ID09IHVuZGVmaW5lZCkgewoJCQljb25zb2xlLmxvZyhpZF9pdGVtLCAiZG9lc250IGV4aXN0Iik7CgkJCXJldHVybjsKCQl9CgoJCXZhciByZXNwb25zZSA9IHdpbmRvdy5hdG9iKHJlc3BvbnNlVGV4dCk7CgoJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCXJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSk7CgkJCWlmIChyZXNwb25zZSAhPSBudWxsKSB7CgkJCQlzZWxlY3QuaW5uZXJIVE1MID0gKCIiKS50cmltKCk7CgoJCQkJZm9yIChjb25zdCBrZXkgaW4gcmVzcG9uc2UpIHsKCQkJCQlpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzcG9uc2UsIGtleSkpIHsKCQkJCQkJY29uc3QgZWxlbWVudCA9IHJlc3BvbnNlW2tleV07CgkJCQkJCXZhciBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKCQkJCQkJb3B0LnZhbHVlID0ga2V5OwoJCQkJCQlvcHQuaWQgPSBpZF9pdGVtICsgIl8iICsga2V5OwoJCQkJCQlvcHQuaW5uZXJIVE1MID0gZWxlbWVudFsiaWQiXTsKCQkJCQkJc2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfSk7Cn0KCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBmdW5jdGlvbiAoKSB7CglpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSB7CgkJdF9wYW5lbCgnbGVmdF9wYW5lbCcsIDEpOwoJCXRfcGFuZWwoJ3JpZ2h0X3BhbmVsJywgMSk7Cgl9CgllbHNlIHsKCQl0X3BhbmVsKCdsZWZ0X3BhbmVsJywgMik7CgkJdF9wYW5lbCgncmlnaHRfcGFuZWwnLCAyKTsKCX0KfSk7Cgphc3luYyBmdW5jdGlvbiB0X3BhbmVsKGlkID0gInJpZ2h0X3BhbmVsIiwgdHlwZSA9IDApIHsKCWNvbnN0IHBfZWxtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJaWYgKHR5cGUgPT0gMCkgewoJCWlmIChwX2VsbS5zdHlsZS5kaXNwbGF5ICE9ICJub25lIikgewoJCQlwX2VsbS5zdHlsZS53aWR0aCA9ICIwcHgiOwoJCQlwX2VsbS5zdHlsZS5oZWlnaHQgPSAiMHB4IjsKCQkJcF9lbG0uc3R5bGUub3BhY2l0eSA9ICIwIjsKCQkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCQlwX2VsbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl9LCAyNTApOwoKCQkJaWYgKHdpbmRvdy5tb2JpbGVDaGVjaygpIHx8ICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEwMDApKSB7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2VudGVyX3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1fdF9sZWZ0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIHsKCQkJcF9lbG0uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCWF3YWl0IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4geyB9LCAyNTApOwoKCQkJcF9lbG0uc3R5bGUud2lkdGggPSAiYXV0byI7CgkJCXBfZWxtLnN0eWxlLmhlaWdodCA9ICJhdXRvIjsKCQkJcF9lbG0uc3R5bGUub3BhY2l0eSA9ICIxIjsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQlpZiAoKGlkKS5pbmNsdWRlcygicmlnaHQiKSkgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfcmlnaHRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJfQoJCQl9CgoJCX0KCX0KCWVsc2UgewoJCWlmIChwX2VsbS5zdHlsZS5kaXNwbGF5ICE9ICJub25lIiAmJiB0eXBlID09IDEpIHsKCQkJcF9lbG0uc3R5bGUud2lkdGggPSAiMHB4IjsKCQkJcF9lbG0uc3R5bGUuaGVpZ2h0ID0gIjBweCI7CgkJCXBfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMCI7CgkJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewoJCQkJcF9lbG0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJfSwgMjUwKTsKCgkJCWlmICh3aW5kb3cubW9iaWxlQ2hlY2soKSB8fCAod2luZG93LmlubmVyV2lkdGggPCAxMDAwKSkgewoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNlbnRlcl9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtX3RfbGVmdF9wYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSBpZiAodHlwZSA9PSAyICYmIHBfZWxtLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKSB7CgkJCXBfZWxtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQlhd2FpdCBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsgfSwgMjUwKTsKCgkJCXBfZWxtLnN0eWxlLndpZHRoID0gImF1dG8iOwoJCQlwX2VsbS5zdHlsZS5oZWlnaHQgPSAiYXV0byI7CgkJCXBfZWxtLnN0eWxlLm9wYWNpdHkgPSAiMSI7CgoJCQlpZiAod2luZG93Lm1vYmlsZUNoZWNrKCkgfHwgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTAwMCkpIHsKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZW50ZXJfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQkJaWYgKChpZCkuaW5jbHVkZXMoInJpZ2h0IikpIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X3JpZ2h0X3BhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibV90X2xlZnRfcGFuZWwiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJCX0KCQkJfQoKCQl9Cgl9Cn0KCnZhciB6bm90aWZpY2F0aW9uSWQgPSAwLCBub3RpZmljYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbm90aWZpY2F0aW9uLWNvbnRhaW5lciIpOwpmdW5jdGlvbiBub3RpZnkoYSwgYiwgZCkgeyBiID0gdm9pZCAwID09PSBiID8gMjUwMCA6IGI7IGQgPSArK3pub3RpZmljYXRpb25JZDsgdmFyIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsgYy5jbGFzc0xpc3QuYWRkKCJub3RpZmljYXRpb24iKTsgYy5pbm5lckhUTUwgPSAoIjxwPiIgKyBhICsgIjwvcD48YnV0dG9uIGNsYXNzPSdjbG9zZS1idXR0b24nIGRhdGEtbm90aWZpY2F0aW9uLWlkPSciICsgZCArICInPiZ0aW1lczs8L2J1dHRvbj4iKS50cmltKCk7IGMuc3R5bGUud2lkdGggPSAiYXV0byI7IG5vdGlmaWNhdGlvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChjKTsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGMuc3R5bGUub3BhY2l0eSA9ICIwIjsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGMucmVtb3ZlKCkgfSwgNDUwKSB9LCBiKTsgKGEgPSBjLnByZXZpb3VzU2libGluZykgJiYgYS5zdHlsZSAmJiAoYS5zdHlsZS5tYXJnaW5Ub3AgPSAiNnB4IikgfQpub3RpZmljYXRpb25Db250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoYSkgeyBpZiAoYS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJjbG9zZS1idXR0b24iKSkgeyB2YXIgYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLW5vdGlmaWNhdGlvbi1pZD0nIiArIGEudGFyZ2V0LmRhdGFzZXQubm90aWZpY2F0aW9uSWQgKyAiJ10iKS5wYXJlbnRFbGVtZW50OyBiLnN0eWxlLm9wYWNpdHkgPSAiMCI7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBiLnJlbW92ZSgpIH0sIDI1MCk7IChhID0gYi5wcmV2aW91c1NpYmxpbmcpICYmIGEuc3R5bGUgJiYgKGEuc3R5bGUubWFyZ2luVG9wID0gIjZweCIpIH0gfSk7Cgphc3luYyBmdW5jdGlvbiBzbGVlcChtcykgeyByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7IH0KCmNvbnNvbGUubG9nKCJsb2xhc28iKTsvLw==";
eval(atob(A));